<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ZDWğŸ¥</title>
  
  <subtitle>ä¸€ä¸ªå…¥è¡ŒJavaç¨‹åºå‘˜</subtitle>
  <link href="https://eizo01.github.io/atom.xml" rel="self"/>
  
  <link href="https://eizo01.github.io/"/>
  <updated>2023-03-23T15:48:13.327Z</updated>
  <id>https://eizo01.github.io/</id>
  
  <author>
    <name>æ›¾å¾·å¨ğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="https://eizo01.github.io/posts/0.html"/>
    <id>https://eizo01.github.io/posts/0.html</id>
    <published>2023-03-23T15:48:13.055Z</published>
    <updated>2023-03-23T15:48:13.327Z</updated>
    
    <content type="html"><![CDATA[<h1>JMM&amp;å¹¶å‘ä¸‰å¤§ç‰¹æ€§</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;JMM&amp;amp;å¹¶å‘ä¸‰å¤§ç‰¹æ€§&lt;/h1&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://eizo01.github.io/posts/0.html"/>
    <id>https://eizo01.github.io/posts/0.html</id>
    <published>2023-03-23T09:12:41.459Z</published>
    <updated>2023-03-23T09:12:41.753Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>Javaçº¿ç¨‹è¯¦è§£</strong></h1><h2 id="1-Javaçº¿ç¨‹çš„å®ç°æ–¹å¼"><strong>1 Javaçº¿ç¨‹çš„å®ç°æ–¹å¼</strong></h2><h3 id="æ–¹å¼1ï¼šä½¿ç”¨-Threadç±»æˆ–ç»§æ‰¿Threadç±»"><strong>æ–¹å¼1ï¼šä½¿ç”¨ Threadç±»æˆ–ç»§æ‰¿Threadç±»</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//ç»§æ‰¿Threadç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡çš„ä»£ç </span></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello from thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        t.start(); <span class="comment">// ç»§æ‰¿Threadç±»å¯åŠ¨æ–°çº¿ç¨‹</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä½¿ç”¨ Threadç±»åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼2ï¼šå®ç°-Runnable-æ¥å£é…åˆThread"><strong>æ–¹å¼2ï¼šå®ç° Runnable æ¥å£é…åˆThread</strong></h3><p>æŠŠã€çº¿ç¨‹ã€‘å’Œã€ä»»åŠ¡ã€‘ï¼ˆè¦æ‰§è¡Œçš„ä»£ç ï¼‰åˆ†å¼€</p><ul><li>Thread ä»£è¡¨çº¿ç¨‹</li><li>Runnable å¯è¿è¡Œçš„ä»»åŠ¡ï¼ˆçº¿ç¨‹è¦æ‰§è¡Œçš„ä»£ç ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡çš„ä»£ç </span></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello from thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line">        t.start(); <span class="comment">// å¯åŠ¨æ–°çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„-Callable"><strong>æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„ Callable</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureExample</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">    Future&lt;String&gt; future = executor.submit(<span class="keyword">new</span> <span class="title class_">Callable</span>&lt;String&gt;() &#123;</span><br><span class="line">      <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä¸€æ®µè€—æ—¶çš„æ“ä½œ</span></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾… future å®Œæˆå¹¶è·å–è¿”å›å€¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> future.get();</span><br><span class="line"></span><br><span class="line">    System.out.println(result); <span class="comment">// è¾“å‡º &quot;Hello, World!&quot;</span></span><br><span class="line"></span><br><span class="line">    executor.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»»åŠ¡æ²¡æœ‰å®Œæˆå°±è°ƒç”¨ <code>future.get()</code> æ–¹æ³•ï¼Œç¨‹åºå°†ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»“åˆ <code>isDone()</code> å’Œ <code>get()</code> æ–¹æ³•æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œå¹¶æ ¹æ®æƒ…å†µé‡‡å–ç›¸åº”çš„å¤„ç†ã€‚</p><h3 id="æ–¹å¼4ï¼šä½¿ç”¨-lambda"><strong>æ–¹å¼4ï¼šä½¿ç”¨ lambda</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>Â <span class="title class_">Thread</span>(()Â -&gt;Â </span><br><span class="line">           System.out.println(Thread.currentThread().getName()))</span><br><span class="line">    .start();</span><br></pre></td></tr></table></figure><p><font color="red"><strong>æœ¬è´¨ä¸ŠJavaä¸­å®ç°çº¿ç¨‹åªæœ‰ä¸€ç§æ–¹å¼ï¼Œéƒ½æ˜¯é€šè¿‡new Thread()åˆ›å»ºçº¿ç¨‹ï¼Œè°ƒç”¨Thread.start()å¯åŠ¨çº¿ç¨‹æœ€ç»ˆéƒ½ä¼šè°ƒç”¨Thread.run()æ–¹æ³•</strong></font></p><h3 id="Javaçº¿ç¨‹å®ç°åŸç†"><strong>Javaçº¿ç¨‹å®ç°åŸç†</strong></h3><blockquote><p>Javaçº¿ç¨‹æ‰§è¡Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è°ƒç”¨run()æ–¹æ³•,è€Œè¦è°ƒç”¨start()æ–¹æ³•ï¼Ÿ</p></blockquote><p>åœ¨ Java ä¸­ï¼Œçº¿ç¨‹çš„æ‰§è¡Œéœ€è¦æ“ä½œç³»ç»Ÿè¿›è¡Œæ”¯æŒå’Œè°ƒåº¦ï¼Œè€Œè°ƒç”¨çº¿ç¨‹çš„ <code>run()</code> æ–¹æ³•åªæ˜¯å•çº¯åœ°æ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œè·Ÿæ™®é€šçš„æ–¹æ³•è°ƒç”¨å¹¶æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«å˜é‡æ—¶ï¼Œå¦‚æœç›´æ¥è°ƒç”¨ <code>run()</code> æ–¹æ³•ï¼Œåˆ™æ‰€æœ‰çº¿ç¨‹éƒ½å°†åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ <code>run()</code> æ–¹æ³•ä¸­çš„ä»£ç ï¼Œå®¹æ˜“å‡ºç°ç«äº‰æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ã€‚è€Œé€šè¿‡ <code>start()</code> æ–¹æ³•åˆ›å»ºæ–°çº¿ç¨‹ï¼Œåˆ™å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œé¿å…äº†è¿™äº›å®‰å…¨é—®é¢˜ã€‚</p><p><strong>Thread#start()æ‰§è¡Œæµç¨‹</strong></p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323163847031.png" alt="image-20230323163847031"></p><p><strong>Javaçº¿ç¨‹å±äºå†…æ ¸çº§çº¿ç¨‹</strong></p><p>JDK1.2â€”â€”<font color="red">åŸºäºæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ¨¡å‹æ¥å®ç°ã€‚Sun JDK,å®ƒçš„Windowsç‰ˆæœ¬å’ŒLinuxç‰ˆæœ¬éƒ½ä½¿ç”¨ä¸€å¯¹ä¸€çš„çº¿ç¨‹æ¨¡å‹å®ç°ï¼Œä¸€æ¡Javaçº¿ç¨‹å°±æ˜ å°„åˆ°ä¸€æ¡è½»é‡çº§è¿›ç¨‹ä¹‹ä¸­ã€‚</font></p><blockquote><p>åœ¨JDK1.2ä¸­ï¼ŒJavaçº¿ç¨‹ç¡®å®æ˜¯é€šè¿‡ä¸æ“ä½œç³»ç»Ÿå†…æ ¸çº§çº¿ç¨‹ï¼ˆä¹Ÿç§°ä¸ºåŸç”Ÿçº¿ç¨‹ï¼‰è¿›è¡Œä¸€å¯¹ä¸€æ˜ å°„æ¥å®ç°çš„ï¼Œè¿™ä½¿å¾—Javaçº¿ç¨‹å¯ä»¥åˆ©ç”¨å¤šå¤„ç†å™¨å’Œå¤šæ ¸å¿ƒç­‰ç¡¬ä»¶èµ„æºï¼Œå¹¶ä¸”èƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å¹¶å‘è°ƒåº¦æœºåˆ¶ã€‚ä½†æ˜¯ï¼Œ<strong>ç”±äºJavaçº¿ç¨‹çš„åˆ›å»ºã€é”€æ¯å’Œè°ƒåº¦ç­‰è¿‡ç¨‹éƒ½æ˜¯ç”±Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰è´Ÿè´£ç®¡ç†ï¼Œå› æ­¤Javaçº¿ç¨‹å¹¶ä¸æ˜¯å®Œå…¨çš„å†…æ ¸çº§çº¿ç¨‹ï¼Œè€Œæ˜¯ä»‹äºç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹ä¹‹é—´çš„æ··åˆä½“ã€‚</strong></p></blockquote><p><strong>å†…æ ¸çº§çº¿ç¨‹ï¼ˆKernel Level Thread ï¼ŒKLT</strong>ï¼‰ï¼šå®ƒä»¬æ˜¯ä¾èµ–äºå†…æ ¸çš„ï¼Œå³æ— è®ºæ˜¯ç”¨æˆ·è¿›ç¨‹ä¸­çš„çº¿ç¨‹ï¼Œè¿˜æ˜¯ç³»ç»Ÿè¿›ç¨‹ä¸­çš„çº¿ç¨‹ï¼Œå®ƒä»¬çš„åˆ›å»ºã€æ’¤æ¶ˆã€åˆ‡æ¢éƒ½ç”±å†…æ ¸å®ç°ã€‚</p><p><strong>ç”¨æˆ·çº§çº¿ç¨‹ï¼ˆUser Level Threadï¼ŒULTï¼‰</strong>ï¼šæ“ä½œç³»ç»Ÿå†…æ ¸ä¸çŸ¥é“åº”ç”¨çº¿ç¨‹çš„å­˜åœ¨ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323164557128.png" alt="image-20230323164557128"></p><p>è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹åç¨‹ï¼š</p><p>æ˜¯ä¸€ç§åŸºäºçº¿ç¨‹ä¹‹ä¸Šï¼Œä½†åˆæ¯”çº¿ç¨‹æ›´åŠ è½»é‡çº§çš„å­˜åœ¨ï¼Œåç¨‹ä¸æ˜¯è¢«æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€ç®¡ç†ï¼Œè€Œå®Œå…¨æ˜¯ç”±ç¨‹åºæ‰€æ§åˆ¶ï¼ˆä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼‰ï¼Œå…·æœ‰å¯¹å†…æ ¸æ¥è¯´ä¸å¯è§çš„ç‰¹æ€§ã€‚è¿™æ ·å¸¦æ¥çš„å¥½å¤„å°±æ˜¯æ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œä¸ä¼šåƒçº¿ç¨‹åˆ‡æ¢é‚£æ ·æ¶ˆè€—èµ„æºã€‚</p><img src="HTTPs://zdwtop.cn/blog/image-20230323164710034.png" alt="image-20230323164710034" style="zoom:50%;"><p>åç¨‹çš„ç‰¹ç‚¹åœ¨äºæ˜¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œé‚£å’Œå¤šçº¿ç¨‹æ¯”ï¼Œåç¨‹æœ‰ä½•ä¼˜åŠ¿ï¼Ÿ</p><ul><li><p>çº¿ç¨‹çš„åˆ‡æ¢ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œåç¨‹ç”±ç”¨æˆ·è‡ªå·±è¿›è¡Œè°ƒåº¦ï¼Œå› æ­¤å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæé«˜äº†æ•ˆç‡ã€‚</p></li><li><p>çº¿ç¨‹çš„é»˜è®¤stackå¤§å°æ˜¯1Mï¼Œè€Œåç¨‹æ›´è½»é‡ï¼Œæ¥è¿‘1kã€‚å› æ­¤å¯ä»¥åœ¨ç›¸åŒçš„å†…å­˜ä¸­å¼€å¯æ›´å¤šçš„åç¨‹ã€‚</p></li><li><p>ä¸éœ€è¦å¤šçº¿ç¨‹çš„é”æœºåˆ¶ï¼šå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨åŒæ—¶å†™å˜é‡å†²çªï¼Œåœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±å¥½äº†ï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡æ¯”å¤šçº¿ç¨‹é«˜å¾ˆå¤šã€‚</p></li></ul><p><strong>æ³¨æ„ï¼š åç¨‹é€‚ç”¨äºè¢«é˜»å¡çš„ï¼Œä¸”éœ€è¦å¤§é‡å¹¶å‘çš„åœºæ™¯ï¼ˆç½‘ç»œioï¼‰ã€‚ä¸é€‚åˆå¤§é‡è®¡ç®—çš„åœºæ™¯ã€‚</strong></p><h2 id="2-Javaçº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶"><strong>2.Javaçº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶</strong></h2><p>çº¿ç¨‹è°ƒåº¦æ˜¯æŒ‡ç³»ç»Ÿä¸ºçº¿ç¨‹åˆ†é…å¤„ç†å™¨ä½¿ç”¨æƒçš„è¿‡ç¨‹ï¼Œä¸»è¦è°ƒåº¦æ–¹å¼åˆ†ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ååŒå¼çº¿ç¨‹è°ƒåº¦å’ŒæŠ¢å å¼çº¿ç¨‹è°ƒåº¦</p><h4 id="ååŒå¼çº¿ç¨‹è°ƒåº¦"><strong>ååŒå¼çº¿ç¨‹è°ƒåº¦</strong></h4><p><strong>çº¿ç¨‹æ‰§è¡Œæ—¶é—´ç”±çº¿ç¨‹æœ¬èº«æ¥æ§åˆ¶</strong>ï¼Œçº¿ç¨‹æŠŠè‡ªå·±çš„å·¥ä½œæ‰§è¡Œå®Œä¹‹åï¼Œè¦ä¸»åŠ¨é€šçŸ¥ç³»ç»Ÿåˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸Šã€‚æœ€å¤§å¥½å¤„æ˜¯å®ç°ç®€å•ï¼Œä¸”åˆ‡æ¢æ“ä½œå¯¹çº¿ç¨‹è‡ªå·±æ˜¯å¯çŸ¥çš„ï¼Œæ²¡å•¥çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚åå¤„æ˜¯çº¿ç¨‹æ‰§è¡Œæ—¶é—´ä¸å¯æ§åˆ¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æœ‰é—®é¢˜ï¼Œå¯èƒ½ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œã€‚</p><h4 id="æŠ¢å å¼çº¿ç¨‹è°ƒåº¦"><strong>æŠ¢å å¼çº¿ç¨‹è°ƒåº¦</strong></h4><p><strong>æ¯ä¸ªçº¿ç¨‹å°†ç”±ç³»ç»Ÿæ¥åˆ†é…æ‰§è¡Œæ—¶é—´ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ç”±çº¿ç¨‹æœ¬èº«æ¥å†³å®š</strong>ï¼ˆJavaä¸­ï¼ŒThread.yield()å¯ä»¥è®©å‡ºæ‰§è¡Œæ—¶é—´ï¼Œä½†æ— æ³•è·å–æ‰§è¡Œæ—¶é—´ï¼‰ã€‚çº¿ç¨‹æ‰§è¡Œæ—¶é—´ç³»ç»Ÿå¯æ§ï¼Œä¹Ÿä¸ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¼è‡´æ•´ä¸ªè¿›ç¨‹é˜»å¡ã€‚</p><h4 id="Javaçº¿ç¨‹è°ƒåº¦å°±æ˜¯æŠ¢å å¼è°ƒåº¦"><strong>Javaçº¿ç¨‹è°ƒåº¦å°±æ˜¯æŠ¢å å¼è°ƒåº¦</strong></h4><p>åœ¨Javaä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´ä»1åˆ°10ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸º5ã€‚</p><p>åœ¨Javaçº¿ç¨‹è°ƒåº¦ä¸­ï¼Œæ“ä½œç³»ç»Ÿæ ¹æ®çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¥å†³å®šå“ªä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å¾—CPUçš„æ§åˆ¶æƒã€‚ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šè¾ƒæ—©åœ°è¢«è°ƒåº¦æ‰§è¡Œï¼Œè€Œä½ä¼˜å…ˆçº§çš„çº¿ç¨‹åˆ™ç›¸å¯¹æ»åã€‚åŒæ—¶ï¼ŒJavaè¿˜æä¾›äº†Thread.yield()æ–¹æ³•ï¼Œå¯ä»¥è®©å½“å‰çº¿ç¨‹æ”¾å¼ƒä¸€æ¬¡CPUçš„ä½¿ç”¨æƒï¼Œè®©å…¶ä»–ç­‰å¾…æ‰§è¡Œçš„çº¿ç¨‹æœ‰æ›´å¤šæœºä¼šå¾—åˆ°CPUçš„è°ƒåº¦ã€‚</p><p>å½“éœ€è¦è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Threadç±»çš„setPriority(int priority)æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>();</span><br><span class="line">thread.setPriority(Thread.MAX_PRIORITY); <span class="comment">// è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ä¸ºæœ€é«˜çº§åˆ«</span></span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦è®©å½“å‰çº¿ç¨‹æ”¾å¼ƒä¸€æ¬¡CPUçš„ä½¿ç”¨æƒï¼Œå¯ä»¥ä½¿ç”¨Threadç±»çš„yield()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread.<span class="keyword">yield</span>(); <span class="comment">// è®©å½“å‰çº¿ç¨‹æ”¾å¼ƒä¸€æ¬¡CPUçš„ä½¿ç”¨æƒ</span></span><br><span class="line"><span class="comment">//è°ƒç”¨yield()æ–¹æ³•å¹¶ä¸ä¼šä¿è¯ä¸‹ä¸€ä¸ªè¢«æ‰§è¡Œçš„çº¿ç¨‹ä¸€å®šæ˜¯ä¼˜å…ˆçº§æ¯”å½“å‰çº¿ç¨‹ä½çš„çº¿ç¨‹ï¼Œè€Œåªæ˜¯æç¤ºçº¿ç¨‹è°ƒåº¦å™¨æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦å¾—åˆ°æ‰§è¡Œæœºä¼š</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJavaçº¿ç¨‹è°ƒåº¦ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„åº•å±‚æ”¯æŒï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿå¯èƒ½å¯¹çº¿ç¨‹è°ƒåº¦çš„å®ç°æ–¹å¼ç•¥æœ‰å·®å¼‚ã€‚</p><h2 id="3-Javaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">3.<strong>Javaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</strong></h2><p>Java è¯­è¨€ä¸­çº¿ç¨‹å…±æœ‰å…­ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>NEWï¼ˆåˆå§‹åŒ–çŠ¶æ€ï¼‰</li><li>RUNNABLEï¼ˆå¯è¿è¡ŒçŠ¶æ€+è¿è¡ŒçŠ¶æ€ï¼‰</li><li>BLOCKEDï¼ˆé˜»å¡çŠ¶æ€ï¼‰</li><li>WAITINGï¼ˆæ— æ—¶é™ç­‰å¾…ï¼‰</li><li>TIMED_WAITINGï¼ˆæœ‰æ—¶é™ç­‰å¾…ï¼‰</li><li>TERMINATEDï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰</li></ol><p>åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼ŒJava çº¿ç¨‹ä¸­çš„ BLOCKEDã€WAITINGã€TIMED_WAITING æ˜¯ä¸€ç§çŠ¶æ€ï¼Œå³å‰é¢æˆ‘ä»¬æåˆ°çš„ä¼‘çœ çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦ Java çº¿ç¨‹å¤„äºè¿™ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ°¸è¿œæ²¡æœ‰ CPU çš„ä½¿ç”¨æƒã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323165249316.png" alt="image-20230323165249316"></p><p><strong>ä»JavaThreadçš„è§’åº¦ï¼ŒJVMå®šä¹‰äº†ä¸€äº›é’ˆå¯¹Java Threadå¯¹è±¡çš„çŠ¶æ€ï¼ˆjvm.hï¼‰</strong></p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323165307125.png" alt="image-20230323165307125"></p><p><strong>ä»OSThreadçš„è§’åº¦ï¼ŒJVMè¿˜å®šä¹‰äº†ä¸€äº›çº¿ç¨‹çŠ¶æ€ç»™å¤–éƒ¨ä½¿ç”¨ï¼Œæ¯”å¦‚ç”¨jstackè¾“å‡ºçš„çº¿ç¨‹å †æ ˆä¿¡æ¯ä¸­çº¿ç¨‹çš„çŠ¶æ€ï¼ˆosThread.hppï¼‰</strong></p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323165320241.png" alt="image-20230323165320241"></p><h2 id="4-Threadå¸¸ç”¨æ–¹æ³•"><strong>4.Threadå¸¸ç”¨æ–¹æ³•</strong></h2><h4 id="sleepæ–¹æ³•"><strong>sleepæ–¹æ³•</strong></h4><ul><li>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» <em>Running</em> è¿›å…¥TIMED_WAITINGçŠ¶æ€ï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”</li><li>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ interrupt æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedExceptionï¼Œå¹¶ä¸”ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—</li><li>ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ</li><li>sleepå½“ä¼ å…¥å‚æ•°ä¸º0æ—¶ï¼Œå’Œyieldç›¸åŒ</li></ul><h4 id="yieldæ–¹æ³•"><strong>yieldæ–¹æ³•</strong></h4><ul><li>yieldä¼šé‡Šæ”¾CPUèµ„æºï¼Œè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ RunnableçŠ¶æ€ï¼Œè®©ä¼˜å…ˆçº§æ›´é«˜ï¼ˆè‡³å°‘æ˜¯ç›¸åŒï¼‰çš„çº¿ç¨‹è·å¾—æ‰§è¡Œæœºä¼šï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼›</li><li>å‡è®¾å½“å‰è¿›ç¨‹åªæœ‰mainçº¿ç¨‹ï¼Œå½“è°ƒç”¨yieldä¹‹åï¼Œmainçº¿ç¨‹ä¼šç»§ç»­è¿è¡Œï¼Œå› ä¸ºæ²¡æœ‰æ¯”å®ƒä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹ï¼›</li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ul><h4 id="joinæ–¹æ³•"><strong>joinæ–¹æ³•</strong></h4><p>ç­‰å¾…è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ç»“æŸä¹‹åï¼Œç¨‹åºå†ç»§ç»­æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨äºç­‰å¾…å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œå®Œç»“æœä¹‹åæ‰èƒ½ç»§ç»­è¿è¡Œçš„åœºæ™¯ã€‚</p><pre><code>           <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadJoinDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] sure)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;t begin&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;t finished&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">//ä¸»çº¿ç¨‹ç­‰å¾…çº¿ç¨‹tæ‰§è¡Œå®Œæˆ</span></span><br><span class="line">        t.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œæ—¶é—´:&quot;</span> + (System.currentTimeMillis() - start));</span><br><span class="line">        System.out.println(<span class="string">&quot;Main finished&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></code></pre><p>æ€è€ƒï¼šå¦‚ä½•æ­£ç¡®ä¼˜é›…çš„åœæ­¢çº¿ç¨‹ï¼Ÿ</p><h4 id="stopæ–¹æ³•"><strong>stopæ–¹æ³•</strong></h4><p><strong>stop()æ–¹æ³•å·²ç»è¢«jdkåºŸå¼ƒï¼ŒåŸå› å°±æ˜¯stop()æ–¹æ³•å¤ªè¿‡äºæš´åŠ›ï¼Œå¼ºè¡ŒæŠŠæ‰§è¡Œåˆ°ä¸€åŠçš„çº¿ç¨‹ç»ˆæ­¢ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadStopDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è·å–é”&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">60000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;æ‰§è¡Œå®Œæˆ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        <span class="comment">// åœæ­¢threadï¼Œå¹¶é‡Šæ”¾é”</span></span><br><span class="line">        thread.stop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç­‰å¾…è·å–é”&quot;</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è·å–é”&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>stopä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚å› ä¸ºåœ¨ä½¿ç”¨stop()æ–¹æ³•å¼ºåˆ¶åœæ­¢çº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹å¯èƒ½æ­£åœ¨è¿›è¡Œä¸€äº›å…³é”®æ“ä½œï¼Œä¾‹å¦‚ä¿®æ”¹å…±äº«å˜é‡ã€æ›´æ–°æ•°æ®ç»“æ„ç­‰ã€‚å¦‚æœåœ¨æ­¤æ—¶é‡Šæ”¾å¯¹è±¡é”ï¼Œåˆ™å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®æˆ–å‡ºç°ç«æ€æ¡ä»¶ã€‚å› æ­¤ï¼Œåœ¨å®é™…ç¼–ç¨‹ä¸­åº”é¿å…ä½¿ç”¨stop()æ–¹æ³•ï¼Œè€Œåº”è¯¥ä½¿ç”¨å…¶ä»–æœºåˆ¶æ¥å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹ã€‚</strong></p><h3 id="Javaçº¿ç¨‹çš„ä¸­æ–­æœºåˆ¶"><strong>Javaçº¿ç¨‹çš„ä¸­æ–­æœºåˆ¶</strong></h3><p>Javaæ²¡æœ‰æä¾›ä¸€ç§å®‰å…¨ã€ç›´æ¥çš„æ–¹æ³•æ¥åœæ­¢æŸä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯æä¾›äº†ä¸­æ–­æœºåˆ¶ã€‚**ä¸­æ–­æœºåˆ¶æ˜¯ä¸€ç§åä½œæœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡ä¸­æ–­å¹¶ä¸èƒ½ç›´æ¥ç»ˆæ­¢å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œéœ€è¦è¢«ä¸­æ–­çš„çº¿ç¨‹è‡ªå·±å¤„ç†ã€‚**è¢«ä¸­æ–­çš„çº¿ç¨‹æ‹¥æœ‰å®Œå…¨çš„è‡ªä¸»æƒï¼Œå®ƒæ—¢å¯ä»¥é€‰æ‹©ç«‹å³åœæ­¢ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸€æ®µæ—¶é—´ååœæ­¢ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å‹æ ¹ä¸åœæ­¢ã€‚</p><h4 id="APIçš„ä½¿ç”¨"><strong>APIçš„ä½¿ç”¨</strong></h4><ul><li><strong>interrupt()ï¼š</strong> å°†çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½è®¾ç½®ä¸ºtrueï¼Œä¸ä¼šåœæ­¢çº¿ç¨‹</li><li><strong>isInterrupted():</strong> åˆ¤æ–­å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½æ˜¯å¦ä¸ºtrueï¼Œä¸ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</li><li><strong>Thread.interrupted()</strong>ï¼šåˆ¤æ–­å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½æ˜¯å¦ä¸ºtrueï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ï¼Œé‡ç½®ä¸ºfasle</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterruptTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>  &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;begin&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                    System.out.println(i);</span><br><span class="line">                    <span class="comment">//Thread.interrupted()  æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">                    <span class="comment">//Thread.currentThread().isInterrupted() ä¸ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">                    <span class="keyword">if</span> (Thread.currentThread().isInterrupted() ) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;=========&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(i==<span class="number">10</span>)&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="comment">//ä¸ä¼šåœæ­¢çº¿ç¨‹t1,åªä¼šè®¾ç½®ä¸€ä¸ªä¸­æ–­æ ‡å¿—ä½ flag=true</span></span><br><span class="line">        t1.interrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨ä¸­æ–­æœºåˆ¶ä¼˜é›…çš„åœæ­¢çº¿ç¨‹"><strong>åˆ©ç”¨ä¸­æ–­æœºåˆ¶ä¼˜é›…çš„åœæ­¢çº¿ç¨‹</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StopThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; count &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;count = &quot;</span> + count++);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹åœæ­¢ï¼š stop thread&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">StopThread</span>());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">5</span>);</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><font color="red">æ³¨æ„ï¼šä½¿ç”¨ä¸­æ–­æœºåˆ¶æ—¶ä¸€å®šè¦æ³¨æ„æ˜¯å¦å­˜åœ¨ä¸­æ–­æ ‡å¿—ä½è¢«æ¸…é™¤çš„æƒ…å†µ</font></p><p><strong>sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­</strong></p><p>ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼Œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡æœŸé—´æœ‰ä¼‘çœ éœ€æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; count &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;count = &quot;</span> + count++);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;çº¿ç¨‹åœæ­¢ï¼š stop thread&quot;</span>);</span><br></pre></td></tr></table></figure><img src="HTTPs://zdwtop.cn/blog/image-20230323170234536.png" alt="image-20230323170234536" style="zoom: 80%;"><p><strong>å¤„äºä¼‘çœ ä¸­çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œçº¿ç¨‹æ˜¯å¯ä»¥æ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·çš„ï¼Œå¹¶ä¸”ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedException å¼‚å¸¸ï¼ŒåŒæ—¶æ¸…é™¤ä¸­æ–­ä¿¡å·ï¼Œå°†ä¸­æ–­æ ‡è®°ä½è®¾ç½®æˆ falseã€‚</strong><font color="red">è¿™æ ·å°±ä¼šå¯¼è‡´whileæ¡ä»¶Thread.currentThread().isInterrupted()ä¸ºfalseï¼Œç¨‹åºä¼šåœ¨ä¸æ»¡è¶³count &lt; 1000è¿™ä¸ªæ¡ä»¶æ—¶é€€å‡ºã€‚å¦‚æœä¸åœ¨catchä¸­é‡æ–°æ‰‹åŠ¨æ·»åŠ ä¸­æ–­ä¿¡å·ï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œå°±ä¼šå±è”½ä¸­æ–­è¯·æ±‚ï¼Œæœ‰å¯èƒ½å¯¼è‡´çº¿ç¨‹æ— æ³•æ­£ç¡®åœæ­¢ã€‚</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€ä¸ºtrue</span></span><br><span class="line">    Thread.currentThread().interrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>sleepå¯ä»¥è¢«ä¸­æ–­ æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼šsleep interruptedï¼Œ æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</strong></p><p><strong>waitå¯ä»¥è¢«ä¸­æ–­ æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼šInterruptedExceptionï¼Œ æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</strong></p><h2 id="5-Javaçº¿ç¨‹é—´é€šä¿¡"><strong>5.Javaçº¿ç¨‹é—´é€šä¿¡</strong></h2><h3 id="volatile"><strong>volatile</strong></h3><p>volatileæœ‰ä¸¤å¤§ç‰¹æ€§ï¼Œä¸€æ˜¯å¯è§æ€§ï¼ŒäºŒæ˜¯æœ‰åºæ€§ï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œå…¶ä¸­å¯è§æ€§å°±æ˜¯å¯ä»¥è®©çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;trun on&quot;</span>);</span><br><span class="line">                        flag = <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;trun off&quot;</span>);</span><br><span class="line">                        flag = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="ç­‰å¾…å”¤é†’-ç­‰å¾…é€šçŸ¥-æœºåˆ¶"><strong>ç­‰å¾…å”¤é†’(ç­‰å¾…é€šçŸ¥)æœºåˆ¶</strong></h3><p>ç­‰å¾…å”¤é†’æœºåˆ¶å¯ä»¥åŸºäºwaitå’Œnotifyæ–¹æ³•æ¥å®ç°ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹å†…è°ƒç”¨è¯¥çº¿ç¨‹é”å¯¹è±¡çš„waitæ–¹æ³•ï¼Œçº¿ç¨‹å°†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ç›´åˆ°è¢«å”¤é†’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">                    <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;wait start .......&quot;</span>);</span><br><span class="line">                            lock.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    System.out.println(<span class="string">&quot;wait end ....... &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">                        <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">                            lock.notify();</span><br><span class="line">                            System.out.println(<span class="string">&quot;notify .......&quot;</span>);</span><br><span class="line">                            flag = <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><font color="red">LockSupportæ˜¯JDKä¸­ç”¨æ¥å®ç°çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„å·¥å…·ï¼Œçº¿ç¨‹è°ƒç”¨parkåˆ™ç­‰å¾…â€œè®¸å¯â€ï¼Œè°ƒç”¨unparkåˆ™ä¸ºæŒ‡å®šçº¿ç¨‹æä¾›â€œè®¸å¯â€ã€‚ä½¿ç”¨å®ƒå¯ä»¥åœ¨ä»»ä½•åœºåˆä½¿çº¿ç¨‹é˜»å¡ï¼Œå¯ä»¥æŒ‡å®šä»»ä½•çº¿ç¨‹è¿›è¡Œå”¤é†’ï¼Œå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒé˜»å¡å’Œå”¤é†’æ“ä½œçš„é¡ºåºï¼Œä½†è¦æ³¨æ„è¿ç»­å¤šæ¬¡å”¤é†’çš„æ•ˆæœå’Œä¸€æ¬¡å”¤é†’æ˜¯ä¸€æ ·çš„ã€‚</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockSupportTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">parkThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ParkThread</span>());</span><br><span class="line">        parkThread.start();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;å”¤é†’parkThread&quot;</span>);</span><br><span class="line">        LockSupport.unpark(parkThread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ParkThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ParkThreadå¼€å§‹æ‰§è¡Œ&quot;</span>);</span><br><span class="line">            LockSupport.park();</span><br><span class="line">            System.out.println(<span class="string">&quot;ParkThreadæ‰§è¡Œå®Œæˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="ç®¡é“è¾“å…¥è¾“å‡ºæµ"><strong>ç®¡é“è¾“å…¥è¾“å‡ºæµ</strong></h3><p><strong>ç®¡é“è¾“å…¥/è¾“å‡ºæµ</strong>å’Œæ™®é€šçš„æ–‡ä»¶è¾“å…¥/è¾“å‡ºæµæˆ–è€…ç½‘ç»œè¾“å…¥/è¾“å‡ºæµä¸åŒä¹‹å¤„åœ¨äºï¼Œ**å®ƒä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè€Œä¼ è¾“çš„åª’ä»‹ä¸ºå†…å­˜ã€‚**ç®¡é“è¾“å…¥/è¾“å‡ºæµä¸»è¦åŒ…æ‹¬äº†å¦‚ä¸‹4ç§å…·ä½“å®ç°ï¼šPipedOutputStreamã€PipedInputStreamã€PipedReaderå’ŒPipedWriterï¼Œå‰ä¸¤ç§é¢å‘å­—èŠ‚ï¼Œè€Œåä¸¤ç§é¢å‘å­—ç¬¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Piped</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">PipedWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedWriter</span>();</span><br><span class="line">        <span class="type">PipedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedReader</span>();</span><br><span class="line">        <span class="comment">// å°†è¾“å‡ºæµå’Œè¾“å…¥æµè¿›è¡Œè¿æ¥ï¼Œå¦åˆ™åœ¨ä½¿ç”¨æ—¶ä¼šæŠ›å‡ºIOException</span></span><br><span class="line">        out.connect(in);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">printThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Print</span>(in), <span class="string">&quot;PrintThread&quot;</span>);</span><br><span class="line"></span><br><span class="line">        printThread.start();</span><br><span class="line">        <span class="type">int</span> <span class="variable">receive</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> ((receive = System.in.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                out.write(receive);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Print</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> PipedReader in;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Print</span><span class="params">(PipedReader in)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.in = in;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">receive</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> ((receive = in.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    System.out.print((<span class="type">char</span>) receive);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="Thread-join"><strong>Thread.join</strong></h3><p>joinå¯ä»¥ç†è§£æˆæ˜¯çº¿ç¨‹åˆå¹¶ï¼Œå½“åœ¨ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„joinæ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹é˜»å¡ç­‰å¾…è¢«è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥joinçš„å¥½å¤„èƒ½å¤Ÿä¿è¯çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çº¿ç¨‹çš„joinæ–¹æ³•å…¶å®å·²ç»å¤±å»äº†å¹¶è¡Œçš„æ„ä¹‰ï¼Œè™½ç„¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸²è¡Œçš„ï¼Œæœ€åjoinçš„å®ç°å…¶å®æ˜¯åŸºäºç­‰å¾…é€šçŸ¥æœºåˆ¶çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;Javaçº¿ç¨‹è¯¦è§£&lt;/strong&gt;&lt;/h1&gt;
&lt;h2 id=&quot;1-Javaçº¿ç¨‹çš„å®ç°æ–¹å¼&quot;&gt;&lt;strong&gt;1 Javaçº¿ç¨‹çš„å®ç°æ–¹å¼&lt;/strong&gt;&lt;/h2&gt;
&lt;h3 id=&quot;æ–¹å¼1ï¼šä½¿ç”¨-Threadç±»æˆ–ç»§æ‰¿Threadç±»&quot;&gt;&lt;strong&gt;æ–¹å¼1ï¼š</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://eizo01.github.io/posts/0.html"/>
    <id>https://eizo01.github.io/posts/0.html</id>
    <published>2023-03-23T08:19:36.529Z</published>
    <updated>2023-03-23T08:19:36.798Z</updated>
    
    <content type="html"><![CDATA[<h1>OSï¼šçº¿ç¨‹ä¸è¿›ç¨‹</h1><h2 id="1-çº¿ç¨‹åŸºç¡€çŸ¥è¯†">1.<strong>çº¿ç¨‹åŸºç¡€çŸ¥è¯†</strong></h2><h3 id="1-1-çº¿ç¨‹å’Œè¿›ç¨‹"><strong>1.1 çº¿ç¨‹å’Œè¿›ç¨‹</strong></h3><p>è¿›ç¨‹</p><ul><li><p>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚<strong>è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ ã€‚</strong></p></li><li><p>å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚</p></li><li><p>è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰ã€‚</p></li><li><p>æ“ä½œç³»ç»Ÿä¼šä»¥è¿›ç¨‹ä¸ºå•ä½ï¼Œåˆ†é…ç³»ç»Ÿèµ„æºï¼ˆCPUæ—¶é—´ç‰‡ã€å†…å­˜ç­‰èµ„æºï¼‰ï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚</p></li></ul><p><strong>çº¿ç¨‹</strong></p><ul><li>çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„å®ä½“ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¿…é¡»æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ã€‚</li><li>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ</li><li>çº¿ç¨‹ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹(Lightweight Processï¼ŒLWPï¼‰ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼ˆCPUè°ƒåº¦ï¼‰æ‰§è¡Œçš„æœ€å°å•ä½ã€‚</li></ul><h4 id="çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼š">çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼š</h4><ol><li>è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›†</li><li>èµ„æºå ç”¨ ï¼š æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè€Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜å’Œèµ„æºï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢å¼€é”€å°ï¼Œé€šä¿¡æ›´æ–¹ä¾¿ã€‚è¿›ç¨‹ä¹‹é—´é€šä¿¡éœ€è¦æ˜¾å¼åœ°è¿›è¡Œ**IPC **å³ï¼ˆInter-process Communicationï¼‰ã€‚</li><li>å¹¶å‘é‡ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œçº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Œå› æ­¤æ¯ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œæé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸï¼šè¿›ç¨‹ç”±æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œç³»ç»Ÿä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œå¹¶ä¸”åœ¨è¿›ç¨‹ç»ˆæ­¢æ—¶å›æ”¶è¿™äº›èµ„æºã€‚è€Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸å…¶æ‰€å±çš„è¿›ç¨‹ç›¸åŒï¼Œå½“è¿›ç¨‹ç»“æŸæ—¶ï¼Œè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹ä¹Ÿä¼šè¢«è‡ªåŠ¨ç»ˆæ­¢ã€‚</li><li>å®‰å…¨æ€§ï¼šç”±äºçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œå› æ­¤çº¿ç¨‹ä¹‹é—´éœ€è¦é‡‡ç”¨åŒæ­¥æœºåˆ¶æ¥é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„æ•°æ®ç«äº‰å®‰å…¨é—®é¢˜ã€‚</li></ol><h4 id="è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼"><strong>è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼</strong></h4><ol><li>ç®¡é“ï¼ˆPipeï¼‰ï¼šç®¡é“æ˜¯ä¸€ç§åŠåŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªè¿›ç¨‹é—´é€šä¿¡çš„é€šé“ï¼Œä½†åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹æˆ–å…„å¼Ÿè¿›ç¨‹é—´ä½¿ç”¨ï¼Œä¸é€‚ç”¨äºæ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</li><li>å‘½åç®¡é“ï¼ˆNamed Pipeï¼‰ï¼šå‘½åç®¡é“ä¹Ÿæ˜¯ä¸€ç§åŠåŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œå®ƒå…è®¸ä¸åŒè¿›ç¨‹é—´é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±äº«çš„å‘½åç®¡é“è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å¯ä»¥è·¨è¶Šçˆ¶å­è¿›ç¨‹æˆ–å…„å¼Ÿè¿›ç¨‹çš„é™åˆ¶ã€‚</li><li>ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ï¼šä¿¡å·é‡æ˜¯ä¸€ç§è®¡æ•°å™¨ï¼Œå®ƒç”¨æ¥æ§åˆ¶è¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚å®ƒèƒ½å¤Ÿè·¨è¶Šä¸åŒè¿›ç¨‹å¹¶ä¿æŒåŒæ­¥ï¼Œè§£å†³äº†å¤šä¸ªè¿›ç¨‹ä¹‹é—´ç«äº‰å…±äº«èµ„æºçš„é—®é¢˜ã€‚</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—å…è®¸ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”å…è®¸éç›¸å…³è¿›ç¨‹äº¤æ¢ä¿¡æ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„æ˜¯å¼‚æ­¥çš„é€šä¿¡æœºåˆ¶ï¼Œé€šä¿¡åŒæ–¹éƒ½ä¸éœ€è¦åŒæ—¶åœ¨çº¿ã€‚</li><li>å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰ï¼šå…±äº«å†…å­˜æ˜¯ä¸€ç§æœ€å¿«çš„IPCæ–¹å¼ï¼Œå…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜åŒºåŸŸã€‚å®ƒéœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥æ§åˆ¶ä»¥é¿å…å¤šä¸ªè¿›ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«å†…å­˜æ—¶çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li>å¥—æ¥å­—ï¼ˆSocketï¼‰ï¼šå¥—æ¥å­—æ˜¯ä¸€ç§å¯ç”¨äºç½‘ç»œé€šä¿¡çš„é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹é—´è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å…è®¸è·¨è¶Šä¸åŒçš„è®¡ç®—æœºç³»ç»Ÿè¿›è¡Œé€šä¿¡ã€‚</li></ol><h3 id="1-2-çº¿ç¨‹çš„åŒæ­¥äº’æ–¥"><strong>1.2 çº¿ç¨‹çš„åŒæ­¥äº’æ–¥</strong></h3><p><strong>çº¿ç¨‹åŒæ­¥</strong>æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´æ‰€å…·æœ‰çš„ä¸€ç§åˆ¶çº¦å…³ç³»ï¼Œä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹çš„æ¶ˆæ¯ï¼Œå½“å®ƒæ²¡æœ‰å¾—åˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„æ¶ˆæ¯æ—¶åº”ç­‰å¾…ï¼Œç›´åˆ°æ¶ˆæ¯åˆ°è¾¾æ—¶æ‰è¢«å”¤é†’ã€‚</p><p><strong>çº¿ç¨‹äº’æ–¥</strong>æ˜¯**æŒ‡å¯¹äºå…±äº«çš„è¿›ç¨‹ç³»ç»Ÿèµ„æºï¼Œåœ¨å„å•ä¸ªçº¿ç¨‹è®¿é—®æ—¶çš„æ’å®ƒæ€§ã€‚**å½“æœ‰è‹¥å¹²ä¸ªçº¿ç¨‹éƒ½è¦ä½¿ç”¨æŸä¸€å…±äº«èµ„æºæ—¶ï¼Œä»»ä½•æ—¶åˆ»æœ€å¤šåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»ä½¿ç”¨ï¼Œå…¶å®ƒè¦ä½¿ç”¨è¯¥èµ„æºçš„çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°å ç”¨èµ„æºè€…é‡Šæ”¾è¯¥èµ„æºã€‚çº¿ç¨‹äº’æ–¥å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹åŒæ­¥ã€‚</p><p><strong>å››ç§çº¿ç¨‹åŒæ­¥äº’æ–¥çš„æ§åˆ¶æ–¹æ³•</strong></p><ul><li><strong>ä¸´ç•ŒåŒº</strong>:é€šè¿‡å¯¹å¤šçº¿ç¨‹çš„ä¸²è¡ŒåŒ–æ¥è®¿é—®å…¬å…±èµ„æºæˆ–ä¸€æ®µä»£ç ï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆæ§åˆ¶æ•°æ®è®¿é—®ã€‚ï¼ˆåœ¨ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„èµ„æºå°±ç§°ä¸ºä¸´ç•Œèµ„æºï¼‰ã€‚</li><li><strong>äº’æ–¥é‡</strong>:ä¸ºåè°ƒå…±åŒå¯¹ä¸€ä¸ªå…±äº«èµ„æºçš„å•ç‹¬è®¿é—®è€Œè®¾è®¡çš„ã€‚</li><li><strong>ä¿¡å·é‡</strong>:ä¸ºæ§åˆ¶ä¸€ä¸ªå…·æœ‰æœ‰é™æ•°é‡ç”¨æˆ·èµ„æºè€Œè®¾è®¡ã€‚</li><li><strong>äº‹ä»¶</strong>:ç”¨æ¥é€šçŸ¥çº¿ç¨‹æœ‰ä¸€äº›äº‹ä»¶å·²å‘ç”Ÿï¼Œä»è€Œå¯åŠ¨åç»§ä»»åŠ¡çš„å¼€å§‹</li></ul><h3 id="1-3-ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆContext-switchï¼‰"><strong>1.3 ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆContext switchï¼‰</strong></h3><p>ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡CPU(ä¸­å¤®å¤„ç†å•å…ƒ)ä»ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹çš„åˆ‡æ¢ã€‚</p><blockquote><p>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€ä¸ªæ‰§è¡Œå®ä¾‹ã€‚åœ¨Linuxä¸­ï¼Œçº¿ç¨‹æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œå¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œå¹¶ä¸çˆ¶è¿›ç¨‹(å³åˆ›å»ºçº¿ç¨‹çš„è¿›ç¨‹)å…±äº«ä¸€ä¸ªåœ°å€ç©ºé—´å’Œå…¶ä»–èµ„æºã€‚</p><p>ä¸Šä¸‹æ–‡æ˜¯CPUå¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨åœ¨ä»»ä½•æ—¶é—´ç‚¹çš„å†…å®¹ã€‚</p><p>å¯„å­˜å™¨æ˜¯CPUå†…éƒ¨çš„ä¸€å°éƒ¨åˆ†éå¸¸å¿«çš„å†…å­˜(ç›¸å¯¹äºCPUå¤–éƒ¨è¾ƒæ…¢çš„RAMä¸»å†…å­˜)ï¼Œå®ƒé€šè¿‡æä¾›å¯¹å¸¸ç”¨å€¼çš„å¿«é€Ÿè®¿é—®æ¥åŠ å¿«è®¡ç®—æœºç¨‹åºçš„æ‰§è¡Œã€‚</p><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€ç§ä¸“é—¨çš„å¯„å­˜å™¨ï¼Œå®ƒæŒ‡ç¤ºCPUåœ¨å…¶æŒ‡ä»¤åºåˆ—ä¸­çš„ä½ç½®ï¼Œå¹¶ä¿å­˜ç€æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€æˆ–ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€.</p></blockquote><p>ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ä»¥æ›´è¯¦ç»†åœ°æè¿°ä¸ºå†…æ ¸(å³æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒ)å¯¹CPUä¸Šçš„è¿›ç¨‹(åŒ…æ‹¬çº¿ç¨‹)æ‰§è¡Œä»¥ä¸‹æ´»åŠ¨:</p><ol><li>æš‚åœä¸€ä¸ªè¿›ç¨‹çš„å¤„ç†ï¼Œå¹¶å°†è¯¥è¿›ç¨‹çš„CPUçŠ¶æ€(å³ä¸Šä¸‹æ–‡)å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŸä¸ªåœ°æ–¹</li><li>ä»å†…å­˜ä¸­è·å–ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨CPUçš„å¯„å­˜å™¨ä¸­æ¢å¤å®ƒ</li><li>è¿”å›åˆ°ç¨‹åºè®¡æ•°å™¨æŒ‡ç¤ºçš„ä½ç½®(å³è¿”å›åˆ°è¿›ç¨‹è¢«ä¸­æ–­çš„ä»£ç è¡Œ)ä»¥æ¢å¤è¿›ç¨‹ã€‚</li></ol><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä»¥ä¸‹æƒ…å†µä¼šå¯¼è‡´è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</p><ol><li>è¿›ç¨‹è°ƒåº¦ï¼šå½“å½“å‰è¿è¡Œçš„è¿›ç¨‹æ—¶é—´ç‰‡è€—å°½æˆ–è€…å‘ç”ŸæŸäº›äº‹ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦æ ¹æ®æŸç§è°ƒåº¦ç­–ç•¥å°†CPUåˆ†é…ç»™å…¶ä»–è¿›ç¨‹ï¼Œæ­¤æ—¶éœ€è¦è¿›è¡Œè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li>ä¸­æ–­å¤„ç†ï¼šå½“å¤–éƒ¨è®¾å¤‡è¯·æ±‚è¿›ç¨‹æœåŠ¡æ—¶ï¼Œå¦‚IOæ“ä½œå®Œæˆã€å®šæ—¶å™¨åˆ°æœŸã€ç¡¬ä»¶å‡ºç°æ•…éšœç­‰ï¼Œä¼šäº§ç”Ÿä¸­æ–­ä¿¡å·è§¦å‘ç¡¬ä»¶ä¸­æ–­ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿéœ€è¦æš‚æ—¶æŒ‚èµ·å½“å‰è¿›ç¨‹ä»¥å“åº”ä¸­æ–­è¯·æ±‚ï¼Œå¹¶ä¿å­˜å½“å‰è¿›ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œåœ¨ä¸­æ–­æœåŠ¡ä¾‹ç¨‹æ‰§è¡Œå®Œæ¯•åå†æ¢å¤å½“å‰è¿›ç¨‹çš„æ‰§è¡Œã€‚</li><li>ç³»ç»Ÿè°ƒç”¨ï¼šå½“è¿›ç¨‹éœ€è¦è®¿é—®æ“ä½œç³»ç»Ÿæä¾›çš„èµ„æºæˆ–æœåŠ¡æ—¶ï¼Œéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼è½¬å…¥å†…æ ¸æ€ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿéœ€åˆ‡æ¢è¿›ç¨‹ä¸Šä¸‹æ–‡æ‰èƒ½å¤„ç†è¯·æ±‚å¹¶è¿”å›ç»“æœç»™è¿›ç¨‹ã€‚</li></ol><h3 id="1-4-æ“ä½œç³»ç»Ÿå±‚é¢çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ">1.4 æ“ä½œç³»ç»Ÿå±‚é¢çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</h3><p>æ“ä½œç³»ç»Ÿå±‚é¢çš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸåŸºæœ¬ä¸Šå¯ä»¥ç”¨ä¸‹å›¾è¿™ä¸ªâ€œäº”æ€æ¨¡å‹â€æ¥æè¿°ã€‚è¿™äº”æ€åˆ†åˆ«æ˜¯ï¼šåˆå§‹çŠ¶æ€ã€å¯è¿è¡ŒçŠ¶æ€ã€è¿è¡ŒçŠ¶æ€ã€ä¼‘çœ çŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323161126771.png" alt="image-20230323161126771"></p><ol><li><strong>åˆå§‹çŠ¶æ€</strong>ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜ä¸å…è®¸åˆ†é… CPU æ‰§è¡Œã€‚è¿™ä¸ªçŠ¶æ€å±äºç¼–ç¨‹è¯­è¨€ç‰¹æœ‰çš„ï¼Œä¸è¿‡è¿™é‡Œæ‰€è°“çš„è¢«åˆ›å»ºï¼Œä»…ä»…æ˜¯åœ¨ç¼–ç¨‹è¯­è¨€å±‚é¢è¢«åˆ›å»ºï¼Œè€Œåœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼ŒçœŸæ­£çš„çº¿ç¨‹è¿˜æ²¡æœ‰åˆ›å»ºã€‚</li><li><strong>å¯è¿è¡ŒçŠ¶æ€</strong>ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥åˆ†é… CPU æ‰§è¡Œã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒçœŸæ­£çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹å·²ç»è¢«æˆåŠŸåˆ›å»ºäº†ï¼Œæ‰€ä»¥å¯ä»¥åˆ†é… CPU æ‰§è¡Œã€‚</li><li>å½“æœ‰ç©ºé—²çš„ CPU æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å…¶åˆ†é…ç»™ä¸€ä¸ªå¤„äºå¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹ï¼Œè¢«åˆ†é…åˆ° CPU çš„çº¿ç¨‹çš„çŠ¶æ€å°±è½¬æ¢æˆäº†<strong>è¿è¡ŒçŠ¶æ€</strong>ã€‚</li><li><strong>è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹å¦‚æœè°ƒç”¨ä¸€ä¸ªé˜»å¡çš„ APIï¼ˆä¾‹å¦‚ä»¥é˜»å¡æ–¹å¼è¯»æ–‡ä»¶ï¼‰æˆ–è€…ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆä¾‹å¦‚æ¡ä»¶å˜é‡</strong>ï¼‰ï¼Œé‚£ä¹ˆçº¿ç¨‹çš„çŠ¶æ€å°±ä¼šè½¬æ¢åˆ°ä¼‘çœ çŠ¶æ€ï¼ŒåŒæ—¶é‡Šæ”¾ CPU ä½¿ç”¨æƒï¼Œ<strong>ä¼‘çœ çŠ¶æ€</strong>çš„çº¿ç¨‹æ°¸è¿œæ²¡æœ‰æœºä¼šè·å¾— CPU ä½¿ç”¨æƒã€‚å½“ç­‰å¾…çš„äº‹ä»¶å‡ºç°äº†ï¼Œçº¿ç¨‹å°±ä¼šä»ä¼‘çœ çŠ¶æ€è½¬æ¢åˆ°å¯è¿è¡ŒçŠ¶æ€ã€‚</li><li>çº¿ç¨‹æ‰§è¡Œå®Œæˆ–è€…å‡ºç°å¼‚å¸¸å°±ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼Œç»ˆæ­¢çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šåˆ‡æ¢åˆ°å…¶ä»–ä»»ä½•çŠ¶æ€ï¼Œè¿›å…¥ç»ˆæ­¢çŠ¶æ€ä¹Ÿå°±æ„å‘³ç€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç»“æŸäº†ã€‚</li></ol><blockquote><p>å¦‚æœçº¿ç¨‹ä¸è§„èŒƒç»ˆæ­¢ï¼Œå°±ä¼šå˜æˆâ€œåƒµå°¸çº¿ç¨‹â€ï¼ˆZombie Threadï¼‰ã€‚</p><p>åƒµå°¸çº¿ç¨‹ï¼ˆZombie Threadï¼‰æ˜¯æŒ‡ä¸€ä¸ªå·²ç»å®Œæˆæ‰§è¡Œï¼Œä½†å…¶çˆ¶çº¿ç¨‹è¿˜æœªè°ƒç”¨<code>wait()</code>æˆ–<code>join()</code>ç­‰å¾…å…¶ç»“æŸï¼Œå¹¶å›æ”¶å…¶èµ„æºçš„å­çº¿ç¨‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶è¯¥çº¿ç¨‹å·²ç»ç»“æŸè¿è¡Œï¼Œä½†å…¶å ç”¨çš„ç³»ç»Ÿèµ„æºï¼ˆå¦‚è¿›ç¨‹IDã€å †æ ˆç­‰ï¼‰ä»æœªè¢«é‡Šæ”¾ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿèµ„æºæµªè´¹å’Œå…¶ä»–é—®é¢˜ã€‚åº”è¯¥åŠæ—¶ä½¿ç”¨<code>wait()</code>æˆ–<code>join()</code>ç­‰å¾…å­çº¿ç¨‹ç»“æŸå¹¶å®Œæˆèµ„æºå›æ”¶ã€‚ã€‚</p><p>Javaä¸ä¼šå‡ºç°åƒµå°¸çº¿ç¨‹ï¼Œä½†ä¼šå‡ºç°å­¤å„¿çº¿ç¨‹ã€‚å½“ä¸€ä¸ªå­çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œï¼Œä½†å®ƒçš„çˆ¶çº¿ç¨‹å·²ç»ç»ˆæ­¢æˆ–è€…è¢«æ€æ­»æ—¶ï¼Œè¿™ä¸ªå­çº¿ç¨‹å°±æˆä¸ºå­¤å„¿çº¿ç¨‹ã€‚å­¤å„¿çº¿ç¨‹ä¸ä¼šå½±å“ä¸»è¿›ç¨‹æˆ–å…¶å®ƒè¿›ç¨‹ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶å ç”¨ç³»ç»Ÿèµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿç“¶é¢ˆå’Œæ€§èƒ½ä¸‹é™ã€‚å¯ä»¥ä½¿ç”¨Javaä¸­çš„Thread.join()æ–¹æ³•æ¥ç­‰å¾…å­çº¿ç¨‹ç»“æŸåå†é€€å‡ºçˆ¶çº¿ç¨‹ï¼Œä»è€Œé¿å…äº§ç”Ÿå­¤å„¿çº¿ç¨‹ã€‚</p></blockquote><h3 id="æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•"><strong>æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•</strong></h3><p><strong>linux</strong></p><ul><li>ps -fe æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹</li><li>ps -fT -p  æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹</li><li>kill æ€æ­»è¿›ç¨‹</li><li>top æŒ‰å¤§å†™ H åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºçº¿ç¨‹</li><li>top -H -p  æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹</li></ul><p><strong>Java</strong></p><ul><li>jps å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹</li><li>jstack  æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹çŠ¶æ€</li><li>jconsole æ¥æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ä¸­çº¿ç¨‹çš„è¿è¡Œæƒ…å†µï¼ˆå›¾å½¢ç•Œé¢ï¼‰</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;OSï¼šçº¿ç¨‹ä¸è¿›ç¨‹&lt;/h1&gt;
&lt;h2 id=&quot;1-çº¿ç¨‹åŸºç¡€çŸ¥è¯†&quot;&gt;1.&lt;strong&gt;çº¿ç¨‹åŸºç¡€çŸ¥è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;h3 id=&quot;1-1-çº¿ç¨‹å’Œè¿›ç¨‹&quot;&gt;&lt;strong&gt;1.1 çº¿ç¨‹å’Œè¿›ç¨‹&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;è¿›ç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="https://eizo01.github.io/posts/0.html"/>
    <id>https://eizo01.github.io/posts/0.html</id>
    <published>2023-01-13T12:00:00.000Z</published>
    <updated>2023-03-18T14:10:02.826Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h1><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š2PCã€3PCã€TCCã€æœ¬åœ°æ¶ˆæ¯è¡¨ã€MQ äº‹åŠ¡ï¼ˆKafka å’Œ RocketMQ éƒ½æä¾›äº†äº‹åŠ¡ç›¸å…³åŠŸèƒ½ï¼‰ ã€Saga ç­‰ç­‰ã€‚</p><p>2PCã€3PC å±äºä¸šåŠ¡ä»£ç æ— ä¾µå…¥æ–¹æ¡ˆï¼Œéƒ½æ˜¯åŸºäº XA è§„èŒƒè¡ç”Ÿå‡ºæ¥çš„å®ç°ï¼ŒXA è§„èŒƒæ˜¯ X/Open ç»„ç»‡å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼ˆDTPï¼ŒDistributed Transaction Processingï¼‰æ ‡å‡†ã€‚TCCã€Saga å±äºä¸šåŠ¡ä¾µå…¥æ–¹æ¡ˆï¼ŒMQ äº‹åŠ¡ä¾èµ–äºä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„åœºæ™¯ï¼Œæœ¬åœ°æ¶ˆæ¯è¡¨ä¸æ”¯æŒå›æ»šã€‚</p><p>å¼€å§‹ä»‹ç» 2PC å’Œ 3PC ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹ 2PC å’Œ 3PC æ¶‰åŠåˆ°çš„ä¸€äº›è§’è‰²ï¼ˆXA è§„èŒƒçš„è§’è‰²ç»„æˆï¼‰ï¼š<br><img src="HTTP://zdwtop.cn/blog/image-20230314214742411.png" alt="åˆ†å¸ƒå¼"><br>  â— APï¼ˆApplication Programï¼‰ï¼šåº”ç”¨ç¨‹åºæœ¬èº«ã€‚<br>  â— RMï¼ˆResource Managerï¼‰ ï¼šèµ„æºç®¡ç†å™¨ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡çš„å‚ä¸è€…ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹å°±æ˜¯æŒ‡æ•°æ®åº“ï¼ˆåæ–‡ä¼šä»¥å…³ç³»å‹æ•°æ®åº“ä¸ºä¾‹ï¼‰ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å¾€å¾€æ¶‰åŠåˆ°å¤šä¸ª RMã€‚<strong>DB</strong><br>â— TMï¼ˆTransaction Managerï¼‰ ï¼šäº‹åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£ç®¡ç†å…¨å±€äº‹åŠ¡ï¼Œåˆ†é…äº‹åŠ¡å”¯ä¸€æ ‡è¯†ï¼Œç›‘æ§äº‹åŠ¡çš„æ‰§è¡Œè¿›åº¦ï¼Œå¹¶è´Ÿè´£äº‹åŠ¡çš„æäº¤ã€å›æ»šã€å¤±è´¥æ¢å¤ç­‰ã€‚</p><h2 id="2PCï¼ˆä¸¤é˜¶æ®µæäº¤åè®®ï¼‰"><a href="#2PCï¼ˆä¸¤é˜¶æ®µæäº¤åè®®ï¼‰" class="headerlink" title="2PCï¼ˆä¸¤é˜¶æ®µæäº¤åè®®ï¼‰"></a>2PCï¼ˆä¸¤é˜¶æ®µæäº¤åè®®ï¼‰</h2><p><img src="HTTPs://zdwtop.cn/blog/1666839398805-8d026011-316f-497a-9c11-e5a2e4a4b669.png" alt="2pc"></p><p>2PCï¼ˆTwo-Phase Commitï¼‰è¿™ä¸‰ä¸ªå­—æ¯çš„å«ä¹‰:</p><p>â— 2 -&gt; æŒ‡ä»£äº‹åŠ¡æäº¤çš„ 2 ä¸ªé˜¶æ®µ<br>â— P-&gt; Prepare (å‡†å¤‡é˜¶æ®µ)<br>â— C -&gt;Commitï¼ˆæäº¤é˜¶æ®µï¼‰</p><p>2PC å°†äº‹åŠ¡çš„æäº¤è¿‡ç¨‹åˆ†ä¸º 2 ä¸ªé˜¶æ®µï¼š<strong>å‡†å¤‡é˜¶æ®µ</strong> å’Œ <strong>æäº¤é˜¶æ®µ</strong> ã€‚</p><h4 id="å‡†å¤‡é˜¶æ®µ-Prepare"><a href="#å‡†å¤‡é˜¶æ®µ-Prepare" class="headerlink" title="å‡†å¤‡é˜¶æ®µ(Prepare)"></a><strong>å‡†å¤‡é˜¶æ®µ(Prepare)</strong></h4><p>å‡†å¤‡é˜¶æ®µçš„æ ¸å¿ƒæ˜¯â€œè¯¢é—®â€äº‹åŠ¡å‚ä¸è€…æ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡æ“ä½œæ˜¯å¦æˆåŠŸã€‚</p><p>å‡†å¤‡é˜¶æ®µçš„å·¥ä½œæµç¨‹ï¼š</p><p>1ã€ <strong>äº‹åŠ¡åè°ƒè€…/ç®¡ç†è€…ï¼ˆåæ–‡ç®€ç§° TMï¼‰</strong>ï¼š å‘æ‰€æœ‰æ¶‰åŠåˆ°çš„ <strong>äº‹åŠ¡å‚ä¸è€…ï¼ˆåæ–‡ç®€ç§° RMï¼‰</strong> å‘é€æ¶ˆæ¯è¯¢é—®ï¼šâ€œä½ æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œå‘¢ï¼Ÿâ€ï¼Œå¹¶ç­‰å¾…å…¶ç­”å¤ã€‚<br>2 ã€<strong>RM</strong> æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œå¼€å§‹æ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡é¢„æ“ä½œæ¯”å¦‚å†™ redo log/undo log æ—¥å¿—ï¼Œ<strong>æ­¤æ—¶å¹¶ä¸ä¼šæäº¤äº‹åŠ¡ ã€‚</strong><br>3 ã€RM å¦‚æœæ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡æ“ä½œæˆåŠŸï¼Œé‚£å°±å›å¤â€œYesdbâ€è¡¨ç¤ºæˆ‘å·²å°±ç»ªï¼Œå¦åˆ™å°±å›å¤â€œNoâ€è¡¨ç¤ºæˆ‘æœªå°±ç»ªã€‚</p><h4 id="æäº¤é˜¶æ®µ-Commit"><a href="#æäº¤é˜¶æ®µ-Commit" class="headerlink" title="æäº¤é˜¶æ®µ(Commit)"></a><strong>æäº¤é˜¶æ®µ(Commit)</strong></h4><p>æäº¤é˜¶æ®µçš„æ ¸å¿ƒæ˜¯â€œè¯¢é—®â€äº‹åŠ¡å‚ä¸è€…æäº¤æœ¬åœ°äº‹åŠ¡æ˜¯å¦æˆåŠŸã€‚</p><p>å½“æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…éƒ½æ˜¯â€œå°±ç»ªâ€çŠ¶æ€çš„è¯ï¼š</p><p>1ã€<strong>TM</strong> å‘æ‰€æœ‰å‚ä¸è€…å‘é€æ¶ˆæ¯ï¼šâ€œä½ ä»¬å¯ä»¥æäº¤äº‹åŠ¡å•¦ï¼â€ï¼ˆCommit æ¶ˆæ¯ï¼‰<br>2ã€<strong>RM</strong> æ¥æ”¶åˆ° <strong>Commit æ¶ˆæ¯</strong> åæ‰§è¡Œ <strong>æäº¤æœ¬åœ°æ•°æ®åº“äº‹åŠ¡</strong> æ“ä½œï¼Œæ‰§è¡Œå®Œæˆä¹‹å <strong>é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´æ‰€å ç”¨çš„èµ„æºã€‚</strong><br>3ã€<strong>RM</strong> å›å¤ï¼šâ€œäº‹åŠ¡å·²ç»æäº¤â€ <strong>ï¼ˆACK æ¶ˆæ¯ï¼‰ã€‚</strong><br>4ã€<strong>TM</strong> æ”¶åˆ°æ‰€æœ‰ <strong>äº‹åŠ¡å‚ä¸è€…</strong> çš„ ACK æ¶ˆæ¯ ä¹‹åï¼Œæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹æ­£å¼ç»“æŸã€‚</p><p><strong>å½“ä»»ä¸€äº‹åŠ¡å‚ä¸è€…æ˜¯â€œæœªå°±ç»ªâ€çŠ¶æ€çš„è¯ï¼š</strong></p><p>1ã€<strong>TM</strong> å‘æ‰€æœ‰å‚ä¸è€…å‘é€æ¶ˆæ¯ï¼šâ€œä½ ä»¬å¯ä»¥æ‰§è¡Œå›æ»šæ“ä½œäº†ï¼â€<strong>ï¼ˆRollback æ¶ˆæ¯ï¼‰ã€‚</strong><br>2ã€<strong>RM</strong> æ¥æ”¶åˆ° Rollback æ¶ˆæ¯ åæ‰§è¡Œ <strong>æœ¬åœ°æ•°æ®åº“äº‹åŠ¡å›æ»š</strong> æ‰§è¡Œå®Œæˆä¹‹å <strong>é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´æ‰€å ç”¨çš„èµ„æºã€‚</strong><br>3ã€<strong>RM</strong> å›å¤ï¼šâ€œäº‹åŠ¡å·²ç»å›æ»šâ€ <strong>ï¼ˆACK æ¶ˆæ¯ï¼‰ã€‚</strong><br>4ã€<strong>TM</strong> æ”¶åˆ°æ‰€æœ‰ <strong>RM çš„ ACK æ¶ˆæ¯</strong> ä¹‹åï¼Œä¸­æ–­äº‹åŠ¡ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ç®€å•æ€»ç»“ä¸€ä¸‹ 2PC ä¸¤é˜¶æ®µä¸­æ¯”è¾ƒé‡è¦çš„ä¸€äº›ç‚¹ï¼š</p><p>1ã€<strong>å‡†å¤‡é˜¶æ®µ</strong> çš„ä¸»è¦ç›®çš„æ˜¯<strong>æµ‹è¯• RM</strong> èƒ½å¦æ‰§è¡Œ <strong>æœ¬åœ°æ•°æ®åº“äº‹åŠ¡</strong> æ“ä½œï¼ˆ!!!æ³¨æ„ï¼š<strong>è¿™ä¸€æ­¥å¹¶ä¸ä¼šæäº¤äº‹åŠ¡</strong>ï¼‰ã€‚<br>2ã€<strong>æäº¤é˜¶æ®µ</strong> ä¸­ <strong>TM</strong> ä¼šæ ¹æ® <strong>å‡†å¤‡é˜¶æ®µ ä¸­ RM çš„æ¶ˆæ¯</strong>æ¥å†³å®šæ˜¯æ‰§è¡Œ<strong>äº‹åŠ¡æäº¤</strong>è¿˜æ˜¯<strong>å›æ»šæ“ä½œ</strong>ã€‚<br>3ã€æäº¤é˜¶æ®µ ä¹‹åä¸€å®šä¼šç»“æŸå½“å‰çš„åˆ†å¸ƒå¼äº‹åŠ¡</p><h5 id="2PC-çš„ä¼˜ç‚¹ï¼š"><a href="#2PC-çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="2PC çš„ä¼˜ç‚¹ï¼š"></a><strong>2PC çš„ä¼˜ç‚¹ï¼š</strong></h5><p>â— å®ç°èµ·æ¥éå¸¸ç®€å•ï¼Œå„å¤§ä¸»æµæ•°æ®åº“æ¯”å¦‚ MySQLã€Oracle éƒ½æœ‰è‡ªå·±å®ç°ã€‚<br>â— é’ˆå¯¹çš„æ˜¯æ•°æ®å¼ºä¸€è‡´æ€§ã€‚ä¸è¿‡ï¼Œä»ç„¶å¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><h5 id="2PC-å­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#2PC-å­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="2PC å­˜åœ¨çš„é—®é¢˜ï¼š"></a><strong>2PC å­˜åœ¨çš„é—®é¢˜ï¼š</strong></h5><p>â— <strong>åŒæ­¥é˜»å¡</strong> ï¼šäº‹åŠ¡å‚ä¸è€…ä¼šåœ¨æ­£å¼æäº¤äº‹åŠ¡ä¹‹å‰ä¼šä¸€ç›´å ç”¨ç›¸å…³çš„èµ„æºã€‚æ¯”å¦‚ç”¨æˆ·å°æ˜è½¬è´¦ç»™å°çº¢ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¹Ÿè¦æ“ä½œç”¨æˆ·å°æ˜æˆ–å°çº¢çš„è¯ï¼Œå°±ä¼šé˜»å¡ã€‚<br>â— <strong>æ•°æ®ä¸ä¸€è‡´</strong> ï¼šç”±äºç½‘ç»œé—®é¢˜æˆ–è€…TMå®•æœºéƒ½æœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚æ¯”å¦‚åœ¨ç¬¬2é˜¶æ®µï¼ˆæäº¤é˜¶æ®µï¼‰ï¼Œéƒ¨åˆ†ç½‘ç»œå‡ºç°é—®é¢˜å¯¼è‡´éƒ¨åˆ†å‚ä¸è€…æ”¶ä¸åˆ° Commit/Rollback æ¶ˆæ¯çš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚<br>â— <strong>å•ç‚¹é—®é¢˜</strong> ï¼š TMåœ¨å…¶ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„è§’è‰²ï¼Œå¦‚æœTMåœ¨å‡†å¤‡(Prepare)é˜¶æ®µå®Œæˆä¹‹åæŒ‚æ‰çš„è¯ï¼Œäº‹åŠ¡å‚ä¸è€…å°±ä¼šä¸€ç›´å¡åœ¨æäº¤(Commit)é˜¶æ®µã€‚</p><h2 id="3PCï¼ˆä¸‰é˜¶æ®µæäº¤åè®®ï¼‰"><a href="#3PCï¼ˆä¸‰é˜¶æ®µæäº¤åè®®ï¼‰" class="headerlink" title="3PCï¼ˆä¸‰é˜¶æ®µæäº¤åè®®ï¼‰"></a>3PCï¼ˆä¸‰é˜¶æ®µæäº¤åè®®ï¼‰</h2><p>3PC æ˜¯äººä»¬åœ¨ 2PC çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–å¾—åˆ°çš„ã€‚3PC æŠŠ 2PC ä¸­çš„ å‡†å¤‡é˜¶æ®µ(Prepare) åšäº†è¿›ä¸€æ­¥ç»†åŒ–ï¼Œåˆ†ä¸º 2 ä¸ªé˜¶æ®µï¼š</p><p>â— å‡†å¤‡é˜¶æ®µ(CanCommit)<br>â— é¢„æäº¤é˜¶æ®µ(PreCommit)</p><h4 id="å‡†å¤‡é˜¶æ®µ-CanCommit"><a href="#å‡†å¤‡é˜¶æ®µ-CanCommit" class="headerlink" title="å‡†å¤‡é˜¶æ®µ(CanCommit)"></a>å‡†å¤‡é˜¶æ®µ(CanCommit)</h4><p>è¿™ä¸€æ­¥ä¸ä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œåªæ˜¯å‘ <strong>RM å‘é€ å‡†å¤‡è¯·æ±‚</strong> ï¼Œé¡ºä¾¿è¯¢é—®ä¸€äº›ä¿¡æ¯æ¯”å¦‚äº‹åŠ¡å‚ä¸è€…èƒ½å¦æ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡æ“ä½œã€‚RM å›å¤â€œYesâ€ã€â€œNoâ€æˆ–è€…ç›´æ¥è¶…æ—¶ã€‚</p><p>å¦‚æœ<strong>ä»»ä¸€ RM å›å¤â€œNoâ€æˆ–è€…ç›´æ¥è¶…æ—¶çš„è¯</strong>ï¼Œå°±ä¸­æ–­äº‹åŠ¡ï¼ˆå‘æ‰€æœ‰å‚ä¸è€…å‘é€â€œAbortâ€æ¶ˆæ¯ï¼‰ï¼Œå¦åˆ™è¿›å…¥ <strong>é¢„æäº¤é˜¶æ®µ(PreCommit) ã€‚</strong></p><h4 id="é¢„æäº¤é˜¶æ®µ-PreCommit"><a href="#é¢„æäº¤é˜¶æ®µ-PreCommit" class="headerlink" title="é¢„æäº¤é˜¶æ®µ(PreCommit)"></a>é¢„æäº¤é˜¶æ®µ(PreCommit)</h4><p><strong>TM</strong> å‘æ‰€æœ‰æ¶‰åŠåˆ°çš„ RM å‘é€ <strong>é¢„æäº¤è¯·æ±‚</strong> ï¼ŒRM å›å¤â€œYesâ€ã€â€œNoâ€ï¼ˆæœ€åçš„åæ‚”æœºä¼šï¼‰æˆ–è€…ç›´æ¥è¶…æ—¶ã€‚</p><p>å¦‚æœ<strong>ä»»ä¸€ RM å›å¤â€œNoâ€æˆ–è€…ç›´æ¥è¶…æ—¶çš„è¯</strong>ï¼Œå°±ä¸­æ–­äº‹åŠ¡ï¼ˆå‘æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…å‘é€â€œabortâ€æ¶ˆæ¯ï¼‰ï¼Œå¦åˆ™è¿›å…¥ <strong>æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µ</strong>ï¼ˆDoCommitï¼‰ ã€‚</p><p>å½“æ‰€æœ‰ RM éƒ½è¿”å›â€œYesâ€ä¹‹åï¼Œ RM æ‰ä¼šæ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡é¢„æ“ä½œæ¯”å¦‚å†™ <strong>redo log/undo log</strong> æ—¥å¿—ã€‚</p><h4 id="æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µï¼ˆDoCommitï¼‰"><a href="#æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µï¼ˆDoCommitï¼‰" class="headerlink" title="æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µï¼ˆDoCommitï¼‰"></a>æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µï¼ˆDoCommitï¼‰</h4><p>æ‰§è¡Œäº‹åŠ¡æäº¤ï¼ˆDoCommitï¼‰ é˜¶æ®µå°±å¼€å§‹è¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ã€‚</p><p>TM å‘æ‰€æœ‰æ¶‰åŠåˆ°çš„ RM å‘é€ <strong>æ‰§è¡Œäº‹åŠ¡æäº¤è¯·æ±‚</strong> ï¼Œ<strong>RM æ”¶åˆ°æ¶ˆæ¯åå¼€å§‹æ­£å¼æäº¤äº‹åŠ¡</strong>ï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤åé‡Šæ”¾å ç”¨çš„èµ„æºã€‚</p><p>å¦‚æœ TM æ”¶åˆ°æ‰€æœ‰ RM æ­£ç¡®æäº¤äº‹åŠ¡çš„æ¶ˆæ¯çš„è¯ï¼Œè¡¨ç¤ºäº‹åŠ¡æ­£å¸¸å®Œæˆã€‚å¦‚æœä»»ä¸€ RM æ²¡æœ‰æ­£ç¡®æäº¤äº‹åŠ¡æˆ–è€…è¶…æ—¶çš„è¯ï¼Œå°±ä¸­æ–­äº‹åŠ¡ï¼ŒTM å‘æ‰€æœ‰ RM å‘é€â€œAbortâ€æ¶ˆæ¯ã€‚RM æ¥æ”¶åˆ° Abort è¯·æ±‚åï¼Œæ‰§è¡Œæœ¬åœ°æ•°æ®åº“äº‹åŠ¡å›æ»šï¼Œåé¢çš„æ­¥éª¤å°±å’Œ 2PC ä¸­çš„ç±»ä¼¼äº†ã€‚</p><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong>3PC é™¤äº†å°†2PC ä¸­çš„å‡†å¤‡é˜¶æ®µ(Prepare) åšäº†è¿›ä¸€æ­¥ç»†åŒ–ä¹‹å¤–ï¼Œè¿˜åšäº†å“ªäº›æ”¹è¿›ï¼Ÿ</strong></p><p>3PC è¿˜åŒæ—¶åœ¨äº‹åŠ¡ç®¡ç†è€…å’Œäº‹åŠ¡å‚ä¸è€…ä¸­å¼•å…¥äº† <strong>è¶…æ—¶æœºåˆ¶</strong> ï¼Œå¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°äº‹åŠ¡å‚ä¸è€…çš„æ¶ˆæ¯å°±é»˜è®¤å¤±è´¥ï¼Œè¿›è€Œé¿å…äº‹åŠ¡å‚ä¸è€…ä¸€ç›´é˜»å¡å ç”¨èµ„æºã€‚2PC ä¸­åªæœ‰äº‹åŠ¡ç®¡ç†è€…æ‰æ‹¥æœ‰è¶…æ—¶æœºåˆ¶ï¼Œå½“äº‹åŠ¡å‚ä¸è€…é•¿æ—¶é—´æ— æ³•ä¸äº‹åŠ¡åè°ƒè€…é€šè®¯çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚åè°ƒè€…æŒ‚æ‰äº†ï¼‰ï¼Œå°±ä¼šå¯¼è‡´æ— æ³•é‡Šæ”¾èµ„æºé˜»å¡çš„é—®é¢˜ã€‚</p><p>ä¸è¿‡ï¼Œ3PC å¹¶æ²¡æœ‰å®Œç¾è§£å†³ 2PC çš„é˜»å¡é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€äº›æ–°é—®é¢˜æ¯”å¦‚æ€§èƒ½ç³Ÿç³•ï¼Œè€Œä¸”ï¼Œä¾ç„¶å­˜åœ¨æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œ3PC çš„å®é™…åº”ç”¨å¹¶ä¸æ˜¯å¾ˆå¹¿æ³›ï¼Œ<strong>å¤šæ•°åº”ç”¨ä¼šé€‰æ‹©é€šè¿‡å¤åˆ¶çŠ¶æ€æœºè§£å†³ 2PC çš„é˜»å¡é—®é¢˜ã€‚</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#åˆ†å¸ƒå¼äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;/a&gt;åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h1&gt;&lt;p&gt;åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š2PCã€3PCã€TCCã€æœ¬åœ°æ¶ˆæ¯è¡¨ã€MQ äº‹åŠ¡ï¼ˆKafka å’Œ RocketMQ </summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://eizo01.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://eizo01.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="https://eizo01.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç†è®º</title>
    <link href="https://eizo01.github.io/posts/41166861.html"/>
    <id>https://eizo01.github.io/posts/41166861.html</id>
    <published>2023-01-09T12:00:00.000Z</published>
    <updated>2023-03-11T14:00:04.564Z</updated>
    
    <content type="html"><![CDATA[<h1>1ã€CAP ç†è®º</h1><p>CAP ä¹Ÿå°±æ˜¯ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ è¿™ä¸‰ä¸ªå•è¯é¦–å­—æ¯ç»„åˆã€‚<br><img src="https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/2020-11/cap.png" alt="cap"><br>åœ¨ç†è®ºè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒCAP å®šç†ï¼ˆCAP theoremï¼‰æŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå½“è®¾è®¡è¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ä¸­çš„ä¸¤ä¸ªï¼š</p><ul><li><strong>ä¸€è‡´æ€§</strong>ï¼ˆConsistencyï¼‰ : æ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬</li><li><strong>å¯ç”¨æ€§</strong>ï¼ˆAvailabilityï¼‰: éæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”ï¼ˆä¸æ˜¯é”™è¯¯æˆ–è€…è¶…æ—¶çš„å“åº”ï¼‰ã€‚</li><li><strong>åˆ†åŒºå®¹é”™æ€§</strong>ï¼ˆPartition Toleranceï¼‰ : åˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚</li></ul><p>æ’å…¥ä¸€ä¸ªå°çŸ¥è¯†ï¼šç½‘ç»œåˆ†åŒº<br>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹å‰çš„ç½‘ç»œæœ¬æ¥æ˜¯è¿é€šçš„ï¼Œä½†æ˜¯å› ä¸ºæŸäº›æ•…éšœï¼ˆæ¯”å¦‚éƒ¨åˆ†èŠ‚ç‚¹ç½‘ç»œå‡ºäº†é—®é¢˜ï¼‰æŸäº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œè¿™å°±å« <strong>ç½‘ç»œåˆ†åŒº</strong>ã€‚</p><blockquote><p>å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬è¦ç»§ç»­æœåŠ¡ï¼Œé‚£ä¹ˆå¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§åªèƒ½ 2 é€‰ 1ã€‚ä¹Ÿå°±æ˜¯è¯´å½“ç½‘ç»œåˆ†åŒºä¹‹å P æ˜¯å‰æï¼Œå†³å®šäº† P ä¹‹åæ‰æœ‰ C å’Œ A çš„é€‰æ‹©ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰æˆ‘ä»¬æ˜¯å¿…é¡»è¦å®ç°çš„ã€‚<br>ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼šCAP ç†è®ºä¸­åˆ†åŒºå®¹é”™æ€§ P æ˜¯ä¸€å®šè¦æ»¡è¶³çš„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåªèƒ½æ»¡è¶³å¯ç”¨æ€§ A æˆ–è€…ä¸€è‡´æ€§Cã€‚<br>å¦‚æœç½‘ç»œåˆ†åŒºæ­£å¸¸çš„è¯ï¼ˆç³»ç»Ÿåœ¨ç»å¤§éƒ¨åˆ†æ—¶å€™æ‰€å¤„çš„çŠ¶æ€ï¼‰ï¼Œä¹Ÿå°±è¯´ä¸éœ€è¦ä¿è¯ P çš„æ—¶å€™ï¼ŒC å’Œ A èƒ½å¤ŸåŒæ—¶ä¿è¯ã€‚</p></blockquote><p>åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ï¼Œåªèƒ½é€‰æ‹© CP æˆ–è€… AP æ¶æ„ã€‚ æ¯”å¦‚ ZooKeeperã€HBase å°±æ˜¯ CP æ¶æ„ï¼ŒCassandraã€Eureka å°±æ˜¯ AP æ¶æ„ï¼ŒNacos ä¸ä»…æ”¯æŒ CP æ¶æ„ä¹Ÿæ”¯æŒ AP æ¶æ„ã€‚<br>é€‰æ‹© CP è¿˜æ˜¯ AP çš„å…³é”®åœ¨äºå½“å‰çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ²¡æœ‰å®šè®ºï¼Œæ¯”å¦‚å¯¹äºéœ€è¦ç¡®ä¿å¼ºä¸€è‡´æ€§çš„åœºæ™¯å¦‚é“¶è¡Œä¸€èˆ¬ä¼šé€‰æ‹©ä¿è¯ CP ã€‚<br>è¿™äº›ç‰¹æ€§å°†ä¼šåœ¨æ³¨å†Œä¸­å¿ƒä½“ç°ï¼šå¸¸è§çš„å¯ä»¥ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç»„ä»¶æœ‰ï¼šZooKeeperã€Eurekaã€Nacosâ€¦ã€‚</p><ol><li><strong>ZooKeeper ä¿è¯çš„æ˜¯ CP</strong>ã€‚ä»»ä½•æ—¶åˆ»å¯¹ ZooKeeper çš„è¯»è¯·æ±‚éƒ½èƒ½å¾—åˆ°ä¸€è‡´æ€§çš„ç»“æœï¼Œä½†æ˜¯ï¼Œ ZooKeeper ä¸ä¿è¯æ¯æ¬¡è¯·æ±‚çš„å¯ç”¨æ€§æ¯”å¦‚åœ¨ Leader é€‰ä¸¾è¿‡ç¨‹ä¸­æˆ–è€…åŠæ•°ä»¥ä¸Šçš„æœºå™¨ä¸å¯ç”¨çš„æ—¶å€™æœåŠ¡å°±æ˜¯ä¸å¯ç”¨çš„ã€‚</li><li><strong>Eureka ä¿è¯çš„åˆ™æ˜¯ AP</strong>ã€‚ Eureka åœ¨è®¾è®¡çš„æ—¶å€™å°±æ˜¯<strong>ä¼˜å…ˆä¿è¯ A ï¼ˆå¯ç”¨æ€§ï¼‰</strong>ã€‚åœ¨ Eureka ä¸­ä¸å­˜åœ¨ä»€ä¹ˆ Leader èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€æ ·çš„ã€å¹³ç­‰çš„ã€‚å› æ­¤ Eureka ä¸ä¼šåƒ ZooKeeper é‚£æ ·å‡ºç°é€‰ä¸¾è¿‡ç¨‹ä¸­æˆ–è€…åŠæ•°ä»¥ä¸Šçš„æœºå™¨ä¸å¯ç”¨çš„æ—¶å€™æœåŠ¡å°±æ˜¯ä¸å¯ç”¨çš„æƒ…å†µã€‚ Eureka ä¿è¯å³ä½¿å¤§éƒ¨åˆ†èŠ‚ç‚¹æŒ‚æ‰ä¹Ÿä¸ä¼šå½±å“æ­£å¸¸æä¾›æœåŠ¡ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¯ç”¨çš„å°±è¡Œäº†ã€‚åªä¸è¿‡è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å¯èƒ½å¹¶ä¸æ˜¯æœ€æ–°çš„ã€‚æ‰€ä»¥å®ƒä¸èƒ½ä¿è¯æ•°æ®åˆ°æ¥å°±èƒ½åŒæ­¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ˜¯å¼±ä¸€è‡´æ€§ã€‚</li><li><strong>Nacos ä¸ä»…æ”¯æŒ CP ä¹Ÿæ”¯æŒ AP</strong>ã€‚è¿˜å¯ä»¥ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œè¿™æ˜¯nacosæä¾›çš„æ–°ç‰¹æ€§ã€‚</li></ol><h1>2ã€BASE ç†è®º</h1><p>BASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ ã€Soft-stateï¼ˆè½¯çŠ¶æ€ï¼‰ å’Œ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§ C å’Œå¯ç”¨æ€§ A æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„æ€»ç»“ï¼Œæ˜¯åŸºäº CAP å®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ï¼Œå®ƒå¤§å¤§é™ä½äº†æˆ‘ä»¬å¯¹ç³»ç»Ÿçš„è¦æ±‚ã€‚</p><h2 id="BASE-ç†è®ºçš„æ ¸å¿ƒæ€æƒ³">BASE ç†è®ºçš„æ ¸å¿ƒæ€æƒ³</h2><p>å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚<br>ä¹Ÿå°±æ˜¯ç‰ºç‰²æ•°æ®çš„ä¸€è‡´æ€§æ¥æ»¡è¶³ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œç³»ç»Ÿä¸­ä¸€éƒ¨åˆ†æ•°æ®ä¸å¯ç”¨æˆ–è€…ä¸ä¸€è‡´æ—¶ï¼Œä»éœ€è¦ä¿æŒç³»ç»Ÿæ•´ä½“â€œä¸»è¦å¯ç”¨â€ã€‚<br>BASE ç†è®ºæœ¬è´¨ä¸Šæ˜¯å¯¹ CAP çš„å»¶ä¼¸å’Œè¡¥å……ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å¯¹ CAP ä¸­ AP æ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……ã€‚</p><h2 id="åŸºæœ¬å¯ç”¨">åŸºæœ¬å¯ç”¨</h2><p>åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ã€‚<br><strong>ä»€ä¹ˆå«å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§å‘¢ï¼Ÿ</strong></p><ul><li>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±: æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚éœ€è¦ 0.5s è¿”å›ç»“æœï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿå‡ºç°æ•…éšœï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´å˜ä¸º 3 sã€‚</li><li>ç³»ç»ŸåŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè®¿é—®é‡çªç„¶å‰§å¢ï¼Œç³»ç»Ÿçš„éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚</li></ul><h2 id="è½¯çŠ¶æ€">è½¯çŠ¶æ€</h2><p>è½¯çŠ¶æ€æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼ˆCAP ç†è®ºä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</p><h2 id="æœ€ç»ˆä¸€è‡´æ€§">æœ€ç»ˆä¸€è‡´æ€§</h2><p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚<br><strong>åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„ 3 ç§çº§åˆ«</strong>ï¼š<br><strong>å¼ºä¸€è‡´æ€§</strong>ï¼šç³»ç»Ÿå†™å…¥äº†ä»€ä¹ˆï¼Œè¯»å‡ºæ¥çš„å°±æ˜¯ä»€ä¹ˆã€‚<br><strong>å¼±ä¸€è‡´æ€§</strong> ï¼šä¸ä¸€å®šå¯ä»¥è¯»å–åˆ°æœ€æ–°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸ä¿è¯å¤šå°‘æ—¶é—´ä¹‹åè¯»å–åˆ°çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Œåªæ˜¯ä¼šå°½é‡ä¿è¯æŸä¸ªæ—¶åˆ»è¾¾åˆ°æ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚<br><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šå¼±ä¸€è‡´æ€§çš„å‡çº§ç‰ˆï¼Œç³»ç»Ÿä¼šä¿è¯åœ¨ä¸€å®šæ—¶é—´å†…è¾¾åˆ°æ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚<br>ä¸šç•Œæ¯”è¾ƒæ¨å´‡æ˜¯æœ€ç»ˆä¸€è‡´æ€§çº§åˆ«ï¼Œä½†æ˜¯æŸäº›å¯¹æ•°æ®ä¸€è‡´è¦æ±‚ååˆ†ä¸¥æ ¼çš„åœºæ™¯æ¯”å¦‚é“¶è¡Œè½¬è´¦è¿˜æ˜¯è¦ä¿è¯å¼ºä¸€è‡´æ€§ã€‚<br>é‚£å®ç°æœ€ç»ˆä¸€è‡´æ€§çš„å…·ä½“æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢? ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹open in new window ä¸­æ˜¯è¿™æ ·ä»‹ç»ï¼š<br><strong>è¯»æ—¶ä¿®å¤</strong> :  åœ¨è¯»å–æ•°æ®æ—¶ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿›è¡Œä¿®å¤ã€‚æ¯”å¦‚ Cassandra çš„ Read Repair å®ç°ï¼Œå…·ä½“æ¥è¯´ï¼Œåœ¨å‘ Cassandra ç³»ç»ŸæŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ£€æµ‹åˆ°ä¸åŒèŠ‚ç‚¹çš„å‰¯æœ¬æ•°æ®ä¸ä¸€è‡´ï¼Œç³»ç»Ÿå°±è‡ªåŠ¨ä¿®å¤æ•°æ®ã€‚<br><strong>å†™æ—¶ä¿®å¤</strong> : åœ¨å†™å…¥æ•°æ®ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´æ—¶ï¼Œè¿›è¡Œä¿®å¤ã€‚æ¯”å¦‚ Cassandra çš„ Hinted Handoff å®ç°ã€‚å…·ä½“æ¥è¯´ï¼ŒCassandra é›†ç¾¤çš„èŠ‚ç‚¹ä¹‹é—´è¿œç¨‹å†™æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå†™å¤±è´¥ å°±å°†æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œç„¶åå®šæ—¶é‡ä¼ ï¼Œä¿®å¤æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚<br><strong>å¼‚æ­¥ä¿®å¤ :</strong> è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡å®šæ—¶å¯¹è´¦æ£€æµ‹å‰¯æœ¬æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¿®å¤ã€‚</p>]]></content>
    
    
    <summary type="html">ğŸ¥§è¯¦ç»†ä»‹ç»åˆ†å¸ƒå¼é¢†åŸŸä¸­çš„ç†è®ºï¼Œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæ‰“ä¸‹åŸºç¡€</summary>
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://eizo01.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="åˆ†å¸ƒå¼ç†è®º" scheme="https://eizo01.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://eizo01.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Redisåº•å±‚æ•°æ®ç»“æ„</title>
    <link href="https://eizo01.github.io/posts/54cf796.html"/>
    <id>https://eizo01.github.io/posts/54cf796.html</id>
    <published>2022-11-07T12:00:00.000Z</published>
    <updated>2023-03-18T14:02:16.597Z</updated>
    
    <content type="html"><![CDATA[<h1>Redisåº•å±‚æ•°æ®ç»“æ„</h1><p><strong>Redis æ•°æ®ç»“æ„å¹¶ä¸æ˜¯æŒ‡ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰å¯¹è±¡ã€Listï¼ˆåˆ—è¡¨ï¼‰å¯¹è±¡ã€Hashï¼ˆå“ˆå¸Œï¼‰å¯¹è±¡ã€Setï¼ˆé›†åˆï¼‰å¯¹è±¡å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›æ˜¯ Redis é”®å€¼å¯¹ä¸­å€¼çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„ä¿å­˜å½¢å¼ï¼Œè¿™äº›å¯¹è±¡çš„åº•å±‚å®ç°çš„æ–¹å¼å°±ç”¨åˆ°äº†æ•°æ®ç»“æ„</strong>ã€‚</p><p>ç°åœ¨é™„ä¸Š3.0å’Œ6.0çš„æ•°æ®ç»“æ„å›¾</p><ul><li>åœ¨ Redis 3.0 ç‰ˆæœ¬ä¸­ List å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„ç”±ã€ŒåŒå‘é“¾è¡¨ã€æˆ–ã€Œå‹ç¼©è¡¨åˆ—è¡¨ã€å®ç°ï¼Œä½†æ˜¯åœ¨ 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”± quicklist å®ç°çš„ï¼›</li><li>åœ¨æœ€æ–°çš„ Redis ä»£ç 6.0ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚</li></ul><p><img src="https://zdwtop.cn/blog/image-20230318165759154.png" alt="image-20230318165759154"></p><p><img src="https://zdwtop.cn/blog/a9c3e7dc4ac79363d8eb8eb2290a58e6.png" alt="img"></p><p>å›¾æœ‰xiaolincodingçš„è´¡çŒ®ã€‚æ„Ÿè°¢ã€‚</p><h2 id="redisçš„key-valueç»“æ„">redisçš„key-valueç»“æ„</h2><p>æˆ‘ä»¬è¿˜æ˜¯å¾—å¤ä¹ ä¸€ä¸‹æ•´ä¸ªredisçš„key-valueç»“æ„</p><p><img src="https://zdwtop.cn/blog/3c386666e4e7638a07b230ba14b400fe.png" alt="img"></p><ul><li>redisDb ç»“æ„ï¼Œè¡¨ç¤º Redis æ•°æ®åº“çš„ç»“æ„ï¼Œç»“æ„ä½“é‡Œå­˜æ”¾äº†æŒ‡å‘äº† dict ç»“æ„çš„æŒ‡é’ˆï¼›</li><li>dict ç»“æ„ï¼Œç»“æ„ä½“é‡Œå­˜æ”¾äº† 2 ä¸ªå“ˆå¸Œè¡¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯ç”¨ã€Œå“ˆå¸Œè¡¨1ã€ï¼Œã€Œå“ˆå¸Œè¡¨2ã€åªæœ‰åœ¨ rehash çš„æ—¶å€™æ‰ç”¨ï¼Œå…·ä½“ä»€ä¹ˆæ˜¯ rehashï¼Œæˆ‘åœ¨æœ¬æ–‡çš„å“ˆå¸Œè¡¨æ•°æ®ç»“æ„ä¼šè®²ï¼›</li><li>ditctht ç»“æ„ï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨çš„ç»“æ„ï¼Œç»“æ„é‡Œå­˜æ”¾äº†å“ˆå¸Œè¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ç»“æ„ï¼ˆdictEntryï¼‰çš„æŒ‡é’ˆï¼›</li><li>dictEntry ç»“æ„ï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„ç»“æ„ï¼Œç»“æ„é‡Œå­˜æ”¾äº† *<em>void * key å’Œ void * value æŒ‡é’ˆï¼Œ <em>key æŒ‡å‘çš„æ˜¯ String å¯¹è±¡ï¼Œè€Œ *value åˆ™å¯ä»¥æŒ‡å‘ String å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘é›†åˆç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡</em></em>ã€‚</li></ul><p>void * key å’Œ void * value æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ <strong>Redis å¯¹è±¡</strong>ï¼ŒRedis ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½ç”± redisObject ç»“æ„è¡¨ç¤ºï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://zdwtop.cn/blog/58d3987af2af868dca965193fb27c464.png" alt="img"></p><p>å¯¹è±¡ç»“æ„é‡ŒåŒ…å«çš„æˆå‘˜å˜é‡ï¼š</p><ul><li>typeï¼Œæ ‡è¯†è¯¥å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼ˆString å¯¹è±¡ã€ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡ï¼‰ï¼›</li><li>encodingï¼Œæ ‡è¯†è¯¥å¯¹è±¡ä½¿ç”¨äº†å“ªç§åº•å±‚çš„æ•°æ®ç»“æ„ï¼›</li><li><strong>ptrï¼ŒæŒ‡å‘åº•å±‚æ•°æ®ç»“æ„çš„æŒ‡é’ˆ</strong>ã€‚</li></ul><h2 id="SDS">SDS</h2><p>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰æ˜¯Redisçš„å­—ç¬¦ä¸²å®ç°ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠ¨æ€å­—ç¬¦ä¸²ï¼Œå¯ä»¥è‡ªåŠ¨æ‰©å±•å’Œæ”¶ç¼©ï¼Œæ”¯æŒO(1)æ—¶é—´å¤æ‚åº¦çš„å­—ç¬¦ä¸²é•¿åº¦è·å–.</p><p>Redis æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰ç›´æ¥ä½¿ç”¨ C è¯­è¨€çš„ char* å­—ç¬¦æ•°ç»„æ¥å®ç°å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è‡ªå·±å°è£…äº†ä¸€ä¸ªåä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆsimple dynamic stringï¼ŒSDSï¼‰ çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ Redis çš„ String æ•°æ®ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ SDSã€‚</p><h3 id="C-è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·">C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·</h3><p>C è¯­è¨€çš„å­—ç¬¦ä¸²å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå³æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>åœ¨ C è¯­è¨€é‡Œï¼Œå¯¹å­—ç¬¦ä¸²æ“ä½œæ—¶ï¼Œchar * æŒ‡é’ˆåªæ˜¯æŒ‡å‘å­—ç¬¦æ•°ç»„çš„èµ·å§‹ä½ç½®ï¼Œè€Œ<strong>å­—ç¬¦æ•°ç»„çš„ç»“å°¾ä½ç½®å°±ç”¨â€œ\0â€è¡¨ç¤ºï¼Œæ„æ€æ˜¯æŒ‡å­—ç¬¦ä¸²çš„ç»“æŸ</strong>ã€‚</p><p>å› æ­¤ï¼ŒC è¯­è¨€æ ‡å‡†åº“ä¸­çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°å°±é€šè¿‡åˆ¤æ–­å­—ç¬¦æ˜¯ä¸æ˜¯ â€œ\0â€ æ¥å†³å®šè¦ä¸è¦åœæ­¢æ“ä½œï¼Œå¦‚æœå½“å‰å­—ç¬¦ä¸æ˜¯ â€œ\0â€ ï¼Œè¯´æ˜å­—ç¬¦ä¸²è¿˜æ²¡ç»“æŸï¼Œå¯ä»¥ç»§ç»­æ“ä½œï¼Œå¦‚æœå½“å‰å­—ç¬¦æ˜¯ â€œ\0â€ æ˜¯åˆ™è¯´æ˜å­—ç¬¦ä¸²ç»“æŸäº†ï¼Œå°±è¦åœæ­¢æ“ä½œã€‚</p><img src="https://zdwtop.cn/blog/bcf6bde3b647bdc343efcbc1a8f10579.png" alt="img" style="zoom:80%;"><p>å¾ˆæ˜æ˜¾ï¼Œ<strong>C è¯­è¨€è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ Oï¼ˆNï¼‰ï¼ˆ*è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹*</strong>ï¼‰</p><p>è¿˜æœ‰<strong>å­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½å«æœ‰ â€œ\0â€ å­—ç¬¦</strong>ï¼Œå¦åˆ™æœ€å…ˆè¢«ç¨‹åºè¯»å…¥çš„ â€œ\0â€ å­—ç¬¦å°†è¢«è¯¯è®¤ä¸ºæ˜¯å­—ç¬¦ä¸²ç»“å°¾ï¼Œè¿™ä¸ªé™åˆ¶ä½¿å¾— C è¯­è¨€çš„å­—ç¬¦ä¸²åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œ<strong>ä¸èƒ½ä¿å­˜åƒå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘æ–‡åŒ–è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼‰</strong></p><p><strong>C è¯­è¨€çš„å­—ç¬¦ä¸²æ˜¯ä¸ä¼šè®°å½•è‡ªèº«çš„ç¼“å†²åŒºå¤§å°çš„</strong>ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°å‡å®šç¨‹åºå‘˜åœ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°æ—¶ï¼Œå·²ç»ä¸º dest åˆ†é…äº†è¶³å¤Ÿå¤šçš„å†…å­˜ï¼Œå¯ä»¥å®¹çº³ src å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œè€Œ<strong>ä¸€æ—¦è¿™ä¸ªå‡å®šä¸æˆç«‹ï¼Œå°±ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºå°†å¯èƒ½ä¼šé€ æˆç¨‹åºè¿è¡Œç»ˆæ­¢ï¼Œï¼ˆ*è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ”¹è¿›çš„åœ°æ–¹*</strong>ï¼‰ã€‚</p><p>å¥½äº†ï¼Œ é€šè¿‡ä»¥ä¸Šçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ C è¯­è¨€çš„å­—ç¬¦ä¸²ä¸è¶³ä¹‹å¤„ä»¥åŠå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼š</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆNï¼‰ï¼›</li><li>å­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯ä»¥ â€œ\0â€ å­—ç¬¦æ ‡è¯†ï¼Œå­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½åŒ…å«æœ‰ â€œ\0â€ å­—ç¬¦ï¼Œå› æ­¤ä¸èƒ½ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼›</li><li>å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ä¸é«˜æ•ˆä¸”ä¸å®‰å…¨ï¼Œæ¯”å¦‚æœ‰ç¼“å†²åŒºæº¢å‡ºçš„é£é™©ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç¨‹åºè¿è¡Œç»ˆæ­¢ï¼›</li></ul><p>Redis å®ç°çš„ SDS çš„ç»“æ„å°±æŠŠä¸Šé¢è¿™äº›é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ Redis æ˜¯å¦‚ä½•è§£å†³çš„ã€‚</p><h3 id="SDS-ç»“æ„è®¾è®¡">SDS ç»“æ„è®¾è®¡</h3><p>ä¸‹å›¾å°±æ˜¯ Redis 5.0 çš„ SDS çš„æ•°æ®ç»“æ„ï¼š</p><img src="https://zdwtop.cn/blog/516738c4058cdf9109e40a7812ef4239.png" alt="img" style="zoom:50%;"><p>ç»“æ„ä¸­çš„æ¯ä¸ªæˆå‘˜å˜é‡åˆ†åˆ«ä»‹ç»ä¸‹ï¼š</p><ul><li><strong>lenï¼Œè®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦</strong>ã€‚è¿™æ ·è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œåªéœ€è¦è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡å€¼å°±è¡Œï¼Œæ—¶é—´å¤æ‚åº¦åªéœ€è¦ Oï¼ˆ1ï¼‰ã€‚</li><li><strong>allocï¼Œåˆ†é…ç»™å­—ç¬¦æ•°ç»„çš„ç©ºé—´é•¿åº¦</strong>ã€‚è¿™æ ·åœ¨ä¿®æ”¹å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>alloc - len</code> è®¡ç®—å‡ºå‰©ä½™çš„ç©ºé—´å¤§å°ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨å°† SDS çš„ç©ºé—´æ‰©å±•è‡³æ‰§è¡Œä¿®æ”¹æ‰€éœ€çš„å¤§å°ï¼Œç„¶åæ‰æ‰§è¡Œå®é™…çš„ä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨ SDS æ—¢ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ SDS çš„ç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡ºç°å‰é¢æ‰€è¯´çš„ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</li><li><strong>flagsï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒç±»å‹çš„ SDS</strong>ã€‚ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64ï¼Œåé¢åœ¨è¯´æ˜åŒºåˆ«ä¹‹å¤„ã€‚</li><li><strong>buf[]ï¼Œå­—ç¬¦æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å®é™…æ•°æ®</strong>ã€‚ä¸ä»…å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒRedis çš„ SDS ç»“æ„åœ¨åŸæœ¬å­—ç¬¦æ•°ç»„ä¹‹ä¸Šï¼Œå¢åŠ äº†ä¸‰ä¸ªå…ƒæ•°æ®ï¼šlenã€allocã€flagsï¼Œç”¨æ¥è§£å†³ C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·ã€‚</p><h4 id="Oï¼ˆ1ï¼‰å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦">Oï¼ˆ1ï¼‰å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</h4><p>C è¯­è¨€çš„å­—ç¬¦ä¸²é•¿åº¦è·å– strlen å‡½æ•°ï¼Œéœ€è¦é€šè¿‡éå†çš„æ–¹å¼æ¥ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ Oï¼ˆNï¼‰ã€‚</p><p>è€Œ Redis çš„ SDS ç»“æ„å› ä¸ºåŠ å…¥äº† len æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆ<strong>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼å°±è¡Œï¼Œæ‰€ä»¥å¤æ‚åº¦åªæœ‰ Oï¼ˆ1ï¼‰</strong>ã€‚</p><h4 id="äºŒè¿›åˆ¶å®‰å…¨">äºŒè¿›åˆ¶å®‰å…¨</h4><p>å› ä¸º SDS ä¸éœ€è¦ç”¨ â€œ\0â€ å­—ç¬¦æ¥æ ‡è¯†å­—ç¬¦ä¸²ç»“å°¾äº†ï¼Œè€Œæ˜¯<strong>æœ‰ä¸ªä¸“é—¨çš„ len æˆå‘˜å˜é‡æ¥è®°å½•é•¿åº¦ï¼Œæ‰€ä»¥å¯å­˜å‚¨åŒ…å« â€œ\0â€ çš„æ•°æ®</strong>ã€‚ä½†æ˜¯ SDS ä¸ºäº†å…¼å®¹éƒ¨åˆ† C è¯­è¨€æ ‡å‡†åº“çš„å‡½æ•°ï¼Œ SDS å­—ç¬¦ä¸²ç»“å°¾è¿˜æ˜¯ä¼šåŠ ä¸Š â€œ\0â€ å­—ç¬¦ã€‚</p><p>é€šè¿‡ä½¿ç”¨äºŒè¿›åˆ¶å®‰å…¨çš„ SDSï¼Œè€Œä¸æ˜¯ C å­—ç¬¦ä¸²ï¼Œä½¿å¾— Redis ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿å­˜ä»»æ„æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p><h4 id="ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º">ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º</h4><p>C è¯­è¨€çš„å­—ç¬¦ä¸²æ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°æŠŠç¼“å†²åŒºå¤§å°æ˜¯å¦æ»¡è¶³æ“ä½œéœ€æ±‚çš„å·¥ä½œäº¤ç”±å¼€å‘è€…æ¥ä¿è¯ï¼Œç¨‹åºå†…éƒ¨å¹¶ä¸ä¼šåˆ¤æ–­ç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³å¤Ÿç”¨ï¼Œå½“å‘ç”Ÿäº†ç¼“å†²åŒºæº¢å‡ºå°±æœ‰å¯èƒ½é€ æˆç¨‹åºå¼‚å¸¸ç»“æŸã€‚</p><p>Redis çš„ SDS ç»“æ„é‡Œå¼•å…¥äº† alloc å’Œ len æˆå‘˜å˜é‡ï¼Œè¿™æ · SDS API é€šè¿‡ <code>alloc - len</code> è®¡ç®—ï¼Œå¯ä»¥ç®—å‡ºå‰©ä½™å¯ç”¨çš„ç©ºé—´å¤§å°ï¼Œè¿™æ ·åœ¨å¯¹å­—ç¬¦ä¸²åšä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”±ç¨‹åºå†…éƒ¨åˆ¤æ–­ç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³å¤Ÿç”¨ã€‚</p><p>è€Œä¸”ï¼Œ<strong>å½“åˆ¤æ–­å‡ºç¼“å†²åŒºå¤§å°ä¸å¤Ÿç”¨æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨å°†æ‰©å¤§ SDS çš„ç©ºé—´å¤§å°</strong>ï¼Œä»¥æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„å¤§å°ã€‚</p><p>SDS æ‰©å®¹çš„è§„åˆ™ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hisds <span class="title function_">hi_sdsMakeRoomFor</span><span class="params">(hisds s, <span class="type">size_t</span> addlen)</span></span><br><span class="line">&#123;</span><br><span class="line">    ... ...</span><br><span class="line">    <span class="comment">// sç›®å‰çš„å‰©ä½™ç©ºé—´å·²è¶³å¤Ÿï¼Œæ— éœ€æ‰©å±•ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (avail &gt;= addlen)</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    <span class="comment">//è·å–ç›®å‰sçš„é•¿åº¦</span></span><br><span class="line">    len = hi_sdslen(s);</span><br><span class="line">    sh = (<span class="type">char</span> *)s - hi_sdsHdrSize(oldtype);</span><br><span class="line">    <span class="comment">//æ‰©å±•ä¹‹å s è‡³å°‘éœ€è¦çš„é•¿åº¦</span></span><br><span class="line">    newlen = (len + addlen);</span><br><span class="line">    <span class="comment">//æ ¹æ®æ–°é•¿åº¦ï¼Œä¸ºsåˆ†é…æ–°ç©ºé—´æ‰€éœ€è¦çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">if</span> (newlen &lt; HI_SDS_MAX_PREALLOC)</span><br><span class="line">        <span class="comment">//æ–°é•¿åº¦&lt;HI_SDS_MAX_PREALLOC åˆ™åˆ†é…æ‰€éœ€ç©ºé—´*2çš„ç©ºé—´</span></span><br><span class="line">        newlen *= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">//å¦åˆ™ï¼Œåˆ†é…é•¿åº¦ä¸ºç›®å‰é•¿åº¦+1MB</span></span><br><span class="line">        newlen += HI_SDS_MAX_PREALLOC;</span><br><span class="line">       ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>å°äº 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹æ˜¯æŒ‰ç…§<strong>ç¿»å€æ‰©å®¹</strong>æ¥æ‰§è¡Œçš„ï¼Œå³ 2 å€çš„newlen</li><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>è¶…è¿‡ 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹é•¿åº¦åº”è¯¥æ˜¯ newlen <strong>+ 1MB</strong>ã€‚</li></ul><h4 id="èŠ‚çœå†…å­˜ç©ºé—´">èŠ‚çœå†…å­˜ç©ºé—´</h4><p>SDS ç»“æ„ä¸­æœ‰ä¸ª flags æˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºçš„æ˜¯ SDS ç±»å‹ã€‚</p><p>Redis ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64ã€‚</p><p>è¿™ 5 ç§ç±»å‹çš„ä¸»è¦<strong>åŒºåˆ«å°±åœ¨äºï¼Œå®ƒä»¬æ•°æ®ç»“æ„ä¸­çš„ len å’Œ alloc æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹ä¸åŒ</strong>ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230318171838299.png" alt="image-20230318171838299"></p><p>æ¯”å¦‚ sdshdr16 å’Œ sdshdr32 è¿™ä¸¤ä¸ªç±»å‹ï¼Œå®ƒä»¬çš„å®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr16</span> &#123;</span></span><br><span class="line">    <span class="type">uint16_t</span> len;</span><br><span class="line">    <span class="type">uint16_t</span> alloc; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags; </span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr32</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> len;</span><br><span class="line">    <span class="type">uint32_t</span> alloc; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags;</span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>sdshdr16 ç±»å‹çš„ len å’Œ alloc çš„æ•°æ®ç±»å‹éƒ½æ˜¯ uint16_tï¼Œè¡¨ç¤ºå­—ç¬¦æ•°ç»„é•¿åº¦å’Œåˆ†é…ç©ºé—´å¤§å°ä¸èƒ½è¶…è¿‡ 2 çš„ 16 æ¬¡æ–¹ã€‚</li><li>sdshdr32 åˆ™éƒ½æ˜¯ uint32_tï¼Œè¡¨ç¤ºè¡¨ç¤ºå­—ç¬¦æ•°ç»„é•¿åº¦å’Œåˆ†é…ç©ºé—´å¤§å°ä¸èƒ½è¶…è¿‡ 2 çš„ 32 æ¬¡æ–¹ã€‚</li></ul><p><strong>ä¹‹æ‰€ä»¥ SDS è®¾è®¡ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼Œæ˜¯ä¸ºäº†èƒ½çµæ´»ä¿å­˜ä¸åŒå¤§å°çš„å­—ç¬¦ä¸²ï¼Œä»è€Œæœ‰æ•ˆèŠ‚çœå†…å­˜ç©ºé—´</strong>ã€‚æ¯”å¦‚ï¼Œåœ¨ä¿å­˜å°å­—ç¬¦ä¸²æ—¶ï¼Œç»“æ„å¤´å ç”¨ç©ºé—´ä¹Ÿæ¯”è¾ƒå°‘ã€‚</p><p>é™¤äº†è®¾è®¡ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼ŒRedis åœ¨ç¼–ç¨‹ä¸Šè¿˜<strong>ä½¿ç”¨äº†ä¸“é—¨çš„ç¼–è¯‘ä¼˜åŒ–æ¥èŠ‚çœå†…å­˜ç©ºé—´</strong>ï¼Œå³åœ¨ struct å£°æ˜äº† <code>__attribute__ ((packed))</code> ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>å‘Šè¯‰ç¼–è¯‘å™¨å–æ¶ˆç»“æ„ä½“åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å¯¹é½ï¼ŒæŒ‰ç…§å®é™…å ç”¨å­—èŠ‚æ•°è¿›è¡Œå¯¹é½</strong>ã€‚</p><p>ã€Œå­—èŠ‚å¯¹é½ã€çš„æ–¹å¼åˆ†é…å†…å­˜</p><h2 id="é“¾è¡¨">é“¾è¡¨</h2><p>Redis çš„ List å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€å°±æ˜¯é“¾è¡¨ã€‚C è¯­è¨€æœ¬èº«æ²¡æœ‰é“¾è¡¨è¿™ä¸ªæ•°æ®ç»“æ„çš„ï¼Œæ‰€ä»¥ Redis è‡ªå·±è®¾è®¡äº†ä¸€ä¸ªé“¾è¡¨æ•°æ®ç»“æ„ã€‚</p><p>é“¾è¡¨æ˜¯Redisçš„åˆ—è¡¨å®ç°ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸­çš„å€¼çš„æŒ‡é’ˆ.</p><h3 id="é“¾è¡¨ç»“æ„è®¾è®¡">é“¾è¡¨ç»“æ„è®¾è®¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typedef struct listNode &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">    struct listNode *prev;</span><br><span class="line">    <span class="comment">//åç½®èŠ‚ç‚¹</span></span><br><span class="line">    struct listNode *next;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    <span class="keyword">void</span> *value;</span><br><span class="line">&#125; listNode;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redis åœ¨ listNode ç»“æ„ä½“åŸºç¡€ä¸Šåˆå°è£…äº† list è¿™ä¸ªæ•°æ®ç»“æ„</span></span><br><span class="line">    typedef struct list &#123;</span><br><span class="line">    <span class="comment">//é“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">    listNode *head;</span><br><span class="line">    <span class="comment">//é“¾è¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">    listNode *tail;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°</span></span><br><span class="line">    <span class="keyword">void</span> *(*dup)(<span class="keyword">void</span> *ptr);</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°</span></span><br><span class="line">    <span class="keyword">void</span> (*free)(<span class="keyword">void</span> *ptr);</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> (*match)(<span class="keyword">void</span> *ptr, <span class="keyword">void</span> *key);</span><br><span class="line">    <span class="comment">//é“¾è¡¨èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    unsigned <span class="type">long</span> len;</span><br><span class="line">&#125; list;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/cadf797496816eb343a19c2451437f1e.png" alt="img"></p><h3 id="é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·">é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·</h3><p>Redis çš„é“¾è¡¨å®ç°ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>listNode é“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„é‡Œå¸¦æœ‰ prev å’Œ next æŒ‡é’ˆï¼Œ<strong>è·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æˆ–åç½®èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæŒ‡é’ˆéƒ½å¯ä»¥æŒ‡å‘ NULLï¼Œæ‰€ä»¥é“¾è¡¨æ˜¯æ— ç¯é“¾è¡¨</strong>ï¼›</li><li>list ç»“æ„å› ä¸ºæä¾›äº†è¡¨å¤´æŒ‡é’ˆ head å’Œè¡¨å°¾èŠ‚ç‚¹ tailï¼Œæ‰€ä»¥<strong>è·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)</strong>ï¼›</li><li>list ç»“æ„å› ä¸ºæä¾›äº†é“¾è¡¨èŠ‚ç‚¹æ•°é‡ lenï¼Œæ‰€ä»¥<strong>è·å–é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)</strong>ï¼›</li><li>listNode é“¾è¡¨èŠ‚ä½¿ç”¨ void* æŒ‡é’ˆä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ list ç»“æ„çš„ dupã€freeã€match å‡½æ•°æŒ‡é’ˆä¸ºèŠ‚ç‚¹è®¾ç½®è¯¥èŠ‚ç‚¹ç±»å‹ç‰¹å®šçš„å‡½æ•°ï¼Œå› æ­¤<strong>é“¾è¡¨èŠ‚ç‚¹å¯ä»¥ä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼</strong>ï¼›</li></ul><p>é“¾è¡¨çš„ç¼ºé™·ä¹Ÿæ˜¯æœ‰çš„ï¼š</p><ul><li>é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å†…å­˜éƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œæ„å‘³ç€<strong>æ— æ³•å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜</strong>ã€‚èƒ½å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜çš„æ•°æ®ç»“æ„å°±æ˜¯æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„çš„å†…å­˜æ˜¯è¿ç»­çš„ï¼Œè¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜æ¥åŠ é€Ÿè®¿é—®ã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹ï¼Œä¿å­˜ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹çš„å€¼éƒ½éœ€è¦ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ç»“æ„å¤´çš„åˆ†é…ï¼Œ<strong>å†…å­˜å¼€é”€è¾ƒå¤§</strong>ã€‚</li></ul><p>å› æ­¤ï¼ŒRedis 3.0 çš„ List å¯¹è±¡åœ¨æ•°æ®é‡æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä¼šé‡‡ç”¨ã€Œå‹ç¼©åˆ—è¡¨ã€ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„çš„å®ç°ï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”æ˜¯å†…å­˜ç´§å‡‘å‹çš„æ•°æ®ç»“æ„ã€‚</p><p>ä¸è¿‡ï¼Œå‹ç¼©åˆ—è¡¨å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼ˆå…·ä½“ä»€ä¹ˆé—®é¢˜ï¼Œä¸‹é¢ä¼šè¯´ï¼‰ï¼Œæ‰€ä»¥ Redis åœ¨ 3.2 ç‰ˆæœ¬è®¾è®¡äº†æ–°çš„æ•°æ®ç»“æ„ quicklistï¼Œå¹¶å°† List å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ”¹ç”± quicklist å®ç°ã€‚</p><p>ç„¶ååœ¨ Redis 5.0 è®¾è®¡äº†æ–°çš„æ•°æ®ç»“æ„ listpackï¼Œæ²¿ç”¨äº†å‹ç¼©åˆ—è¡¨ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€ï¼Œæœ€ç»ˆåœ¨æœ€æ–°çš„ Redis ç‰ˆæœ¬ï¼Œå°† Hash å¯¹è±¡å’Œ Zset å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„å®ç°ä¹‹ä¸€çš„å‹ç¼©åˆ—è¡¨ï¼Œæ›¿æ¢æˆç”± listpack å®ç°ã€‚</p><h2 id="å‹ç¼©åˆ—è¡¨ZipList">å‹ç¼©åˆ—è¡¨<strong>ZipList</strong></h2><p>å‹ç¼©åˆ—è¡¨çš„æœ€å¤§ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒè¢«è®¾è®¡æˆä¸€ç§å†…å­˜ç´§å‡‘å‹çš„æ•°æ®ç»“æ„ï¼Œå ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä¸ä»…å¯ä»¥åˆ©ç”¨ CPU ç¼“å­˜ï¼Œè€Œä¸”ä¼šé’ˆå¯¹ä¸åŒé•¿åº¦çš„æ•°æ®ï¼Œè¿›è¡Œç›¸åº”ç¼–ç ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°èŠ‚çœå†…å­˜å¼€é”€ã€‚</p><p>å‹ç¼©åˆ—è¡¨æ˜¯Redisçš„åˆ—è¡¨å’Œå“ˆå¸Œè¡¨å®ç°ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç´§å‡‘çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åœ¨å†…å­˜ä¸­å­˜å‚¨å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–ä¸€ä¸ªæ•´æ•°.</p><p>ä½†æ˜¯ï¼Œå‹ç¼©åˆ—è¡¨çš„ç¼ºé™·ä¹Ÿæ˜¯æœ‰çš„ï¼š</p><ul><li>ä¸èƒ½ä¿å­˜è¿‡å¤šçš„å…ƒç´ ï¼Œå¦åˆ™æŸ¥è¯¢æ•ˆç‡å°±ä¼šé™ä½ï¼›</li><li>æ–°å¢æˆ–ä¿®æ”¹æŸä¸ªå…ƒç´ æ—¶ï¼Œå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´éœ€è¦é‡æ–°åˆ†é…ï¼Œç”šè‡³å¯èƒ½å¼•å‘è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</li></ul><p>Redis å¯¹è±¡ï¼ˆList å¯¹è±¡ã€Hash å¯¹è±¡ã€Zset å¯¹è±¡ï¼‰åŒ…å«çš„å…ƒç´ æ•°é‡è¾ƒå°‘ï¼Œæˆ–è€…å…ƒç´ å€¼ä¸å¤§çš„æƒ…å†µæ‰ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚</p><h3 id="å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡">å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡</h3><p>å‹ç¼©åˆ—è¡¨æ˜¯ Redis ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œå®ƒæ˜¯<strong>ç”±è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„</strong>ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæ•°ç»„ã€‚</p><p><img src="https://zdwtop.cn/blog/ab0b44f557f8b5bc7acb3a53d43ebfcb.png" alt="img"></p><p>å‹ç¼©åˆ—è¡¨åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li><em><strong>zlbytes</strong></em>ï¼Œè®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨å¯¹å†…å­˜å­—èŠ‚æ•°ï¼›</li><li><em><strong>zltail</strong></em>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨ã€Œå°¾éƒ¨ã€èŠ‚ç‚¹è·ç¦»èµ·å§‹åœ°å€ç”±å¤šå°‘å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯åˆ—è¡¨å°¾çš„åç§»é‡ï¼›</li><li><em><strong>zllen</strong></em>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›</li><li><em><strong>zlend</strong></em>ï¼Œæ ‡è®°å‹ç¼©åˆ—è¡¨çš„ç»“æŸç‚¹ï¼Œå›ºå®šå€¼ 0xFFï¼ˆåè¿›åˆ¶255ï¼‰ã€‚</li></ul><p>åœ¨å‹ç¼©åˆ—è¡¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥é€šè¿‡è¡¨å¤´ä¸‰ä¸ªå­—æ®µï¼ˆzllenï¼‰çš„é•¿åº¦ç›´æ¥å®šä½ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚è€Œ<strong>æŸ¥æ‰¾å…¶ä»–å…ƒç´ æ—¶ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆäº†ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼Œæ­¤æ—¶çš„å¤æ‚åº¦å°±æ˜¯ O(N) äº†ï¼Œå› æ­¤å‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ </strong>ã€‚</p><p>å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹ï¼ˆ<strong>entry</strong>ï¼‰çš„æ„æˆå¦‚ä¸‹ï¼š</p><ul><li><em><strong>prevlen</strong></em>ï¼Œ<strong>è®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹ã€çš„é•¿åº¦ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°ä»åå‘å‰éå†ï¼›</strong></li><li><em><strong>encoding</strong></em>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹å®é™…æ•°æ®çš„ã€Œç±»å‹å’Œé•¿åº¦ã€ï¼Œç±»å‹ä¸»è¦æœ‰ä¸¤ç§ï¼šå­—ç¬¦ä¸²å’Œæ•´æ•°ã€‚</li><li><em><strong>data</strong></em>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹çš„å®é™…æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦éƒ½ç”± <code>encoding</code> å†³å®šï¼›å ç”¨1ä¸ªã€2ä¸ªæˆ–5ä¸ªå­—èŠ‚</li></ul><p><img src="https://zdwtop.cn/blog/image-20230318182627294.png" alt="image-20230318182627294"></p><p>åˆ†åˆ«è¯´ä¸‹ï¼Œprevlen å’Œ encoding æ˜¯å¦‚ä½•æ ¹æ®æ•°æ®çš„å¤§å°å’Œç±»å‹æ¥è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…ã€‚</p><p>å‹ç¼©åˆ—è¡¨é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„ prevlen å±æ€§éƒ½è®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ã€ï¼Œè€Œä¸” prevlen å±æ€§çš„ç©ºé—´å¤§å°è·Ÿå‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦å€¼æœ‰å…³ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å¦‚æœ<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å°äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li><li>å¦‚æœ<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>5 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li></ul><p>encoding å±æ€§çš„ç©ºé—´å¤§å°è·Ÿæ•°æ®æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼Œä»¥åŠå­—ç¬¦ä¸²çš„é•¿åº¦æœ‰å…³.</p><ul><li>å¦‚æœ<strong>å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯æ•´æ•°</strong>ï¼Œåˆ™ encoding ä¼šä½¿ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>è¿›è¡Œç¼–ç ï¼Œä¹Ÿå°±æ˜¯ encoding é•¿åº¦ä¸º 1 å­—èŠ‚ã€‚é€šè¿‡ encoding ç¡®è®¤äº†æ•´æ•°ç±»å‹ï¼Œå°±å¯ä»¥ç¡®è®¤æ•´æ•°æ•°æ®çš„å®é™…å¤§å°äº†ï¼Œæ¯”å¦‚å¦‚æœ encoding ç¼–ç ç¡®è®¤äº†æ•°æ®æ˜¯ int16 æ•´æ•°ï¼Œé‚£ä¹ˆ data çš„é•¿åº¦å°±æ˜¯ int16 çš„å¤§å°ã€‚</li><li>å¦‚æœ<strong>å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—ç¬¦ä¸²çš„é•¿åº¦å¤§å°</strong>ï¼Œencoding ä¼šä½¿ç”¨ <strong>1 å­—èŠ‚/2å­—èŠ‚/5å­—èŠ‚çš„ç©ºé—´</strong>è¿›è¡Œç¼–ç ï¼Œencoding ç¼–ç çš„å‰ä¸¤ä¸ª bit è¡¨ç¤ºæ•°æ®çš„ç±»å‹ï¼Œåç»­çš„å…¶ä»– bit æ ‡è¯†å­—ç¬¦ä¸²æ•°æ®çš„å®é™…é•¿åº¦ï¼Œå³ data çš„é•¿åº¦ã€‚</li></ul><p>ZipListä¸­æ‰€æœ‰å­˜å‚¨é•¿åº¦çš„æ•°å€¼å‡é‡‡ç”¨å°ç«¯å­—èŠ‚åºï¼Œå³ä½ä½å­—èŠ‚åœ¨å‰ï¼Œé«˜ä½å­—èŠ‚åœ¨åã€‚</p><h3 id="è¿é”æ›´æ–°">è¿é”æ›´æ–°</h3><p>å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹çš„ prevlen å±æ€§ä¼šæ ¹æ®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…ï¼š</p><ul><li>å¦‚æœå‰ä¸€ä¸ª<strong>èŠ‚ç‚¹çš„é•¿åº¦å°äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li><li>å¦‚æœå‰ä¸€ä¸ª<strong>èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>5 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li></ul><p><strong>å‹ç¼©åˆ—è¡¨æ–°å¢æŸä¸ªå…ƒç´ æˆ–ä¿®æ”¹æŸä¸ªå…ƒç´ æ—¶ï¼Œå¦‚æœç©ºé—´ä¸ä¸å¤Ÿï¼Œå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´å°±éœ€è¦é‡æ–°åˆ†é…ã€‚è€Œå½“æ–°æ’å…¥çš„å…ƒç´ è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´åç»­å…ƒç´ çš„ prevlen å ç”¨ç©ºé—´éƒ½å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå¼•èµ·ã€Œè¿é”æ›´æ–°ã€é—®é¢˜ï¼Œå¯¼è‡´æ¯ä¸ªå…ƒç´ çš„ç©ºé—´éƒ½è¦é‡æ–°åˆ†é…ï¼Œé€ æˆè®¿é—®å‹ç¼©åˆ—è¡¨æ€§èƒ½çš„ä¸‹é™</strong>ã€‚</p><h3 id="å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·">å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·</h3><p>ç©ºé—´æ‰©å±•æ“ä½œä¹Ÿå°±æ˜¯é‡æ–°åˆ†é…å†…å­˜ï¼Œå› æ­¤<strong>è¿é”æ›´æ–°ä¸€æ—¦å‘ç”Ÿï¼Œå°±ä¼šå¯¼è‡´å‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´è¦å¤šæ¬¡é‡æ–°åˆ†é…ï¼Œè¿™å°±ä¼šç›´æ¥å½±å“åˆ°å‹ç¼©åˆ—è¡¨çš„è®¿é—®æ€§èƒ½</strong>ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œ<strong>è™½ç„¶å‹ç¼©åˆ—è¡¨ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€èƒ½èŠ‚çœå†…å­˜å¼€é”€ï¼Œä½†æ˜¯å¦‚æœä¿å­˜çš„å…ƒç´ æ•°é‡å¢åŠ äº†ï¼Œæˆ–æ˜¯å…ƒç´ å˜å¤§äº†ï¼Œä¼šå¯¼è‡´å†…å­˜é‡æ–°åˆ†é…ï¼Œæœ€ç³Ÿç³•çš„æ˜¯ä¼šæœ‰ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜</strong>ã€‚</p><p>å› æ­¤ï¼Œ<strong>å‹ç¼©åˆ—è¡¨åªä¼šç”¨äºä¿å­˜çš„èŠ‚ç‚¹æ•°é‡ä¸å¤šçš„åœºæ™¯</strong>ï¼Œåªè¦èŠ‚ç‚¹æ•°é‡è¶³å¤Ÿå°ï¼Œå³ä½¿å‘ç”Ÿè¿é”æ›´æ–°ï¼Œä¹Ÿæ˜¯èƒ½æ¥å—çš„ã€‚</p><p>è™½è¯´å¦‚æ­¤ï¼ŒRedis é’ˆå¯¹å‹ç¼©åˆ—è¡¨åœ¨è®¾è®¡ä¸Šçš„ä¸è¶³ï¼Œåœ¨åæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæ–°å¢è®¾è®¡äº†ä¸¤ç§æ•°æ®ç»“æ„ï¼šquicklistï¼ˆRedis 3.2 å¼•å…¥ï¼‰ å’Œ listpackï¼ˆRedis 5.0 å¼•å…¥ï¼‰ã€‚è¿™ä¸¤ç§æ•°æ®ç»“æ„çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯å°½å¯èƒ½åœ°ä¿æŒå‹ç¼©åˆ—è¡¨èŠ‚çœå†…å­˜çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è§£å†³å‹ç¼©åˆ—è¡¨çš„ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜.</p><h2 id="å“ˆå¸Œè¡¨-dict">å“ˆå¸Œè¡¨ <strong>dict</strong></h2><p>å­—å…¸æ˜¯Redisçš„å“ˆå¸Œè¡¨å®ç°ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„æ— åºé›†åˆï¼Œå…¶ä¸­æ¯ä¸ªé”®éƒ½æ˜ å°„åˆ°ä¸€ä¸ªå€¼.</p><p>å“ˆå¸Œè¡¨ä¼˜ç‚¹åœ¨äºï¼Œå®ƒ<strong>èƒ½ä»¥ O(1) çš„å¤æ‚åº¦å¿«é€ŸæŸ¥è¯¢æ•°æ®</strong>ã€‚<strong>Redis é‡‡ç”¨äº†ã€Œé“¾å¼å“ˆå¸Œã€æ¥è§£å†³å“ˆå¸Œå†²çª</strong></p><h3 id="å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡">å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡</h3><p><img src="https://zdwtop.cn/blog/image-20230318183756294.png" alt="image-20230318183756294"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆdictEntry **tableï¼‰ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘ã€Œå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼ˆdictEntryï¼‰ã€çš„æŒ‡é’ˆã€‚</p><p><img src="https://zdwtop.cn/blog/dc495ffeaa3c3d8cb2e12129b3423118.png" alt="img"></p><p>è·³è·ƒè¡¨æ˜¯Redisçš„æœ‰åºé›†åˆå®ç°ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ‰åºçš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸­çš„å€¼çš„æŒ‡é’ˆã€‚è·³è·ƒè¡¨æ˜¯ä¸€ç§é«˜æ•ˆçš„æœ‰åºæ•°æ®ç»“æ„ï¼Œå¯ä»¥åœ¨O(log N)æ—¶é—´å†…æ‰§è¡Œæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œ.</p><h3 id="rehash">rehash</h3><p>å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡çš„è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ç»™å¤§å®¶ä»‹ç»äº† Redis ä½¿ç”¨ dictht ç»“æ„ä½“è¡¨ç¤ºå“ˆå¸Œè¡¨ã€‚ä¸è¿‡ï¼Œåœ¨å®é™…ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ï¼ŒRedis å®šä¹‰ä¸€ä¸ª dict ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“é‡Œå®šä¹‰äº†<strong>ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼ˆht[2]ï¼‰</strong>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dict</span> &#123;</span></span><br><span class="line">    â€¦</span><br><span class="line">    <span class="comment">//ä¸¤ä¸ªHashè¡¨ï¼Œäº¤æ›¿ä½¿ç”¨ï¼Œç”¨äºrehashæ“ä½œ</span></span><br><span class="line">    dictht ht[<span class="number">2</span>]; </span><br><span class="line">    â€¦</span><br><span class="line">&#125; dict;</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥å®šä¹‰äº† 2 ä¸ªå“ˆå¸Œè¡¨ï¼Œæ˜¯å› ä¸ºè¿›è¡Œ rehash çš„æ—¶å€™ï¼Œéœ€è¦ç”¨ä¸Š 2 ä¸ªå“ˆå¸Œè¡¨äº†ã€‚</p><p><img src="https://zdwtop.cn/blog/2fedbc9cd4cb7236c302d695686dd478.png" alt="img"></p><p>éšç€æ•°æ®é€æ­¥å¢å¤šï¼Œè§¦å‘äº† rehash æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼Œä¸€èˆ¬ä¼šæ¯”ã€Œå“ˆå¸Œè¡¨ 1ã€ å¤§ 2 å€ï¼›</li><li>å°†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸­ï¼›</li><li>è¿ç§»å®Œæˆåï¼Œã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶æŠŠã€Œå“ˆå¸Œè¡¨ 2ã€ è®¾ç½®ä¸ºã€Œå“ˆå¸Œè¡¨ 1ã€ï¼Œç„¶ååœ¨ã€Œå“ˆå¸Œè¡¨ 2ã€ æ–°åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹æ¬¡ rehash åšå‡†å¤‡ã€‚</li></ul><p><img src="https://zdwtop.cn/blog/cabce0ce7e320bc9d9b5bde947b6811b.png" alt="img"></p><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å…¶å®ç¬¬äºŒæ­¥å¾ˆæœ‰é—®é¢˜ï¼Œ<strong>å¦‚æœã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆåœ¨è¿ç§»è‡³ã€Œå“ˆå¸Œè¡¨ 2 ã€çš„æ—¶å€™ï¼Œå› ä¸ºä¼šæ¶‰åŠå¤§é‡çš„æ•°æ®æ‹·è´ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå¯¹ Redis é€ æˆé˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚</strong>ã€‚</p><h3 id="æ¸è¿›å¼-rehash">æ¸è¿›å¼ rehash</h3><p>ä¸ºäº†é¿å… rehash åœ¨æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå› æ‹·è´æ•°æ®çš„è€—æ—¶ï¼Œå½±å“ Redis æ€§èƒ½çš„æƒ…å†µï¼Œæ‰€ä»¥ Redis é‡‡ç”¨äº†<strong>æ¸è¿›å¼ rehash</strong>ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®çš„è¿ç§»çš„å·¥ä½œä¸å†æ˜¯ä¸€æ¬¡æ€§è¿ç§»å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡è¿ç§»ã€‚</p><p>æ¸è¿›å¼ rehash æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼›</li><li><strong>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å“ˆå¸Œè¡¨å…ƒç´ è¿›è¡Œæ–°å¢ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼ŒRedis é™¤äº†ä¼šæ‰§è¡Œå¯¹åº”çš„æ“ä½œä¹‹å¤–ï¼Œè¿˜ä¼šé¡ºåºå°†ã€Œå“ˆå¸Œè¡¨ 1 ã€ä¸­ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸Š</strong>ï¼›</li><li>éšç€å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„å“ˆå¸Œè¡¨æ“ä½œè¯·æ±‚æ•°é‡è¶Šå¤šï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¼šæŠŠã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ï¼Œä»è€Œå®Œæˆ rehash æ“ä½œã€‚</li></ul><p>è¿™æ ·å°±å·§å¦™åœ°æŠŠä¸€æ¬¡æ€§å¤§é‡æ•°æ®è¿ç§»å·¥ä½œçš„å¼€é”€ï¼Œåˆ†æ‘Šåˆ°äº†å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…äº†ä¸€æ¬¡æ€§ rehash çš„è€—æ—¶æ“ä½œã€‚</p><p>åœ¨è¿›è¡Œæ¸è¿›å¼ rehash çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œå“ˆå¸Œè¡¨å…ƒç´ çš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°ç­‰æ“ä½œéƒ½ä¼šåœ¨è¿™ä¸¤ä¸ªå“ˆå¸Œè¡¨è¿›è¡Œã€‚</p><blockquote><p>æ¯”å¦‚ï¼ŒæŸ¥æ‰¾ä¸€ä¸ª key çš„å€¼çš„è¯ï¼Œå…ˆä¼šåœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­åˆ°å“ˆå¸Œè¡¨ 2 é‡Œé¢è¿›è¡Œæ‰¾åˆ°ã€‚</p><p>å¦å¤–ï¼Œåœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œæ–°å¢ä¸€ä¸ª key-value æ—¶ï¼Œä¼šè¢«ä¿å­˜åˆ°ã€Œå“ˆå¸Œè¡¨ 2 ã€é‡Œé¢ï¼Œè€Œã€Œå“ˆå¸Œè¡¨ 1ã€ åˆ™ä¸å†è¿›è¡Œä»»ä½•æ·»åŠ æ“ä½œï¼Œè¿™æ ·ä¿è¯äº†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ key-value æ•°é‡åªä¼šå‡å°‘ï¼Œéšç€ rehash æ“ä½œçš„å®Œæˆï¼Œæœ€ç»ˆã€Œå“ˆå¸Œè¡¨ 1 ã€å°±ä¼šå˜æˆç©ºè¡¨ã€‚</p></blockquote><h3 id="rehash-è§¦å‘æ¡ä»¶">rehash è§¦å‘æ¡ä»¶</h3><p>rehash çš„è§¦å‘æ¡ä»¶è·Ÿ**è´Ÿè½½å› å­ï¼ˆload factorï¼‰**æœ‰å…³ç³»ã€‚</p><p>è´Ÿè½½å› å­å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªå…¬å¼è®¡ç®—ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230318184250548.png" alt="image-20230318184250548"></p><p>è§¦å‘ rehash æ“ä½œçš„æ¡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 1 ï¼Œå¹¶ä¸” Redis æ²¡æœ‰åœ¨æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€… bgrewiteaof å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ‰§è¡Œ RDB å¿«ç…§æˆ–æ²¡æœ‰è¿›è¡Œ AOF é‡å†™çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œ rehash æ“ä½œã€‚</strong></li><li><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 5 æ—¶ï¼Œæ­¤æ—¶è¯´æ˜å“ˆå¸Œå†²çªéå¸¸ä¸¥é‡äº†ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æœ‰åœ¨æ‰§è¡Œ RDB å¿«ç…§æˆ– AOF é‡å†™ï¼Œéƒ½ä¼šå¼ºåˆ¶è¿›è¡Œ rehash æ“ä½œã€‚</strong></li></ul><h2 id="æ•´æ•°é›†åˆInset">æ•´æ•°é›†åˆ<strong>Inset</strong></h2><p>æ•´æ•°é›†åˆæ˜¯ Set å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚å½“ä¸€ä¸ª Set å¯¹è±¡åªåŒ…å«æ•´æ•°å€¼å…ƒç´ ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸å¤§æ—¶ï¼Œå°±ä¼šä½¿ç”¨æ•´æ•°é›†è¿™ä¸ªæ•°æ®ç»“æ„ä½œä¸ºåº•å±‚å®ç°ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230318184640470.png" alt="image-20230318184640470"></p><h3 id="å‡çº§æ‰©å®¹">å‡çº§æ‰©å®¹</h3><p><img src="https://zdwtop.cn/blog/image-20230318184733792.png" alt="image-20230318184733792"></p><h2 id="è·³è¡¨skip-list">è·³è¡¨<strong>skip list</strong></h2><p>Redis åªæœ‰ Zset å¯¹è±¡çš„åº•å±‚å®ç°ç”¨åˆ°äº†è·³è¡¨ï¼Œè·³è¡¨çš„ä¼˜åŠ¿æ˜¯èƒ½æ”¯æŒå¹³å‡ O(logN) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ã€‚</p><p>zset ç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯è·³è¡¨ï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½è¿›è¡Œé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿèƒ½è¿›è¡Œé«˜æ•ˆå•ç‚¹æŸ¥è¯¢ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    dict *dict;</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure><p>Zset å¯¹è±¡èƒ½æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ ZRANGEBYSCORE æ“ä½œï¼‰ï¼Œè¿™æ˜¯å› ä¸ºå®ƒçš„æ•°æ®ç»“æ„è®¾è®¡é‡‡ç”¨äº†è·³è¡¨ï¼Œè€Œåˆèƒ½ä»¥å¸¸æ•°å¤æ‚åº¦è·å–å…ƒç´ æƒé‡ï¼ˆå¦‚ ZSCORE æ“ä½œï¼‰ï¼Œè¿™æ˜¯å› ä¸ºå®ƒåŒæ—¶é‡‡ç”¨äº†å“ˆå¸Œè¡¨è¿›è¡Œç´¢å¼•ã€‚</p><p>struct zset ä¸­çš„å“ˆå¸Œè¡¨åªæ˜¯ç”¨äºä»¥å¸¸æ•°å¤æ‚åº¦è·å–å…ƒç´ æƒé‡ï¼Œå¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯è·³è¡¨å®ç°çš„ã€‚</p><p>è·³è¡¨ç»“æ„é‡ŒåŒ…å«äº†ï¼š</p><ul><li>è·³è¡¨çš„å¤´å°¾èŠ‚ç‚¹ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦å†…è®¿é—®è·³è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ï¼›</li><li>è·³è¡¨çš„é•¿åº¦ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦è·å–è·³è¡¨èŠ‚ç‚¹çš„æ•°é‡ï¼›</li><li>è·³è¡¨çš„æœ€å¤§å±‚æ•°ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦è·å–è·³è¡¨ä¸­å±‚é«˜æœ€å¤§çš„é‚£ä¸ªèŠ‚ç‚¹çš„å±‚æ•°é‡ï¼›</li></ul><h3 id="è·³è¡¨ç»“æ„è®¾è®¡">è·³è¡¨ç»“æ„è®¾è®¡</h3><p><strong>è·³è¡¨æ˜¯åœ¨é“¾è¡¨åŸºç¡€ä¸Šæ”¹è¿›è¿‡æ¥çš„ï¼Œå®ç°äº†ä¸€ç§ã€Œå¤šå±‚ã€çš„æœ‰åºé“¾è¡¨</strong>ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èƒ½å¿«è¯»å®šä½æ•°æ®ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230318185333886.png" alt="image-20230318185333886"></p><p><img src="https://zdwtop.cn/blog/redis_skiplist_example.png" alt="Redis æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆäºŒï¼‰ - &quot;åœ°ç“œå“¥&quot;åšå®¢ç½‘"></p><p>é‚£æ€æ ·æ‰èƒ½ç»´æŒç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹ä¸º 2 : 1 å‘¢ï¼Ÿ</p><p><strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶å€™ï¼Œä¼šç”ŸæˆèŒƒå›´ä¸º[0-1]çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¿™ä¸ªéšæœºæ•°å°äº 0.25ï¼ˆç›¸å½“äºæ¦‚ç‡ 25%ï¼‰ï¼Œé‚£ä¹ˆå±‚æ•°å°±å¢åŠ  1 å±‚ï¼Œç„¶åç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œç›´åˆ°éšæœºæ•°çš„ç»“æœå¤§äº 0.25 ç»“æŸï¼Œæœ€ç»ˆç¡®å®šè¯¥èŠ‚ç‚¹çš„å±‚æ•°</strong>ã€‚</p><p>å…¶ä¸­ï¼ŒZSKIPLIST_MAXLEVEL å®šä¹‰çš„æ˜¯æœ€é«˜çš„å±‚æ•°ï¼ŒRedis 7.0 å®šä¹‰ä¸º 32ï¼ŒRedis 5.0 å®šä¹‰ä¸º 64ï¼ŒRedis 3.0 å®šä¹‰ä¸º 32ã€‚</p><p>è·³è¡¨çš„æŸ¥æ‰¾å¤æ‚åº¦å°±æ˜¯ O(logN)ã€‚</p><h3 id="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ">ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</h3><p>è¿™é‡Œæ’ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆ Zset çš„å®ç°ç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼ˆå¦‚ AVLæ ‘ã€çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ</p><p>ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯ä»å†…å­˜å ç”¨ã€å¯¹èŒƒå›´æŸ¥æ‰¾çš„æ”¯æŒã€å®ç°éš¾æ˜“ç¨‹åº¦è¿™ä¸‰æ–¹é¢æ€»ç»“çš„åŸå› ï¼š</p><ul><li><strong>ä»å†…å­˜å ç”¨ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›</strong>ã€‚å®ƒä»¬ä¸æ˜¯éå¸¸å†…å­˜å¯†é›†å‹çš„ã€‚åŸºæœ¬ä¸Šç”±ä½ å†³å®šã€‚æ”¹å˜å…³äºèŠ‚ç‚¹å…·æœ‰ç»™å®šçº§åˆ«æ•°çš„æ¦‚ç‡çš„å‚æ•°å°†ä½¿å…¶æ¯” btree å ç”¨æ›´å°‘çš„å†…å­˜ã€‚å¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 2 ä¸ªæŒ‡é’ˆ,è·³è¡¨å¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1.33 ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</li><li><strong>åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ“ä½œè¦ç®€å•</strong>ã€‚Zset ç»å¸¸éœ€è¦æ‰§è¡Œ ZRANGE æˆ– ZREVRANGE çš„å‘½ä»¤ï¼Œå³ä½œä¸ºé“¾è¡¨éå†è·³è¡¨ã€‚é€šè¿‡æ­¤æ“ä½œï¼Œè·³è¡¨çš„ç¼“å­˜å±€éƒ¨æ€§è‡³å°‘ä¸å…¶ä»–ç±»å‹çš„å¹³è¡¡æ ‘ä¸€æ ·å¥½ã€‚</li><li><strong>ä»ç®—æ³•å®ç°éš¾åº¦ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘è¦ç®€å•å¾—å¤š</strong>ã€‚å®ƒä»¬æ›´æ˜“äºå®ç°ã€è°ƒè¯•ç­‰ã€‚ä¾‹å¦‚ï¼Œç”±äºè·³è¡¨çš„ç®€å•æ€§ï¼Œæˆ‘æ”¶åˆ°äº†ä¸€ä¸ªè¡¥ä¸ï¼ˆå·²ç»åœ¨Redis masterä¸­ï¼‰ï¼Œå…¶ä¸­æ‰©å±•äº†è·³è¡¨ï¼Œåœ¨ O(log(N) ä¸­å®ç°äº† ZRANKã€‚å®ƒåªéœ€è¦å¯¹ä»£ç è¿›è¡Œå°‘é‡ä¿®æ”¹ã€‚</li></ul><p>å¯¹è±¡æ˜¯Redisçš„æ‰€æœ‰æ•°æ®ç±»å‹çš„åº•å±‚å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œè¡¨ã€æœ‰åºé›†åˆç­‰å¤šç§æ•°æ®ç±»å‹.</p><h2 id="quicklist">quicklist</h2><p>åœ¨ Redis 3.0 ä¹‹å‰ï¼ŒList å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨æˆ–è€…å‹ç¼©åˆ—è¡¨ã€‚ç„¶ååœ¨ Redis 3.2 çš„æ—¶å€™ï¼ŒList å¯¹è±¡çš„åº•å±‚æ”¹ç”± quicklist æ•°æ®ç»“æ„å®ç°ã€‚</p><p>å…¶å® quicklist å°±æ˜¯ã€ŒåŒå‘é“¾è¡¨ + å‹ç¼©åˆ—è¡¨ã€ç»„åˆï¼Œå› ä¸ºä¸€ä¸ª quicklist å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ã€‚</p><p>quicklist è§£å†³åŠæ³•ï¼Œ<strong>é€šè¿‡æ§åˆ¶æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­çš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿è¿é”æ›´æ–°çš„é—®é¢˜ã€‚å› ä¸ºå‹ç¼©åˆ—è¡¨å…ƒç´ è¶Šå°‘æˆ–è¶Šå°ï¼Œè¿é”æ›´æ–°å¸¦æ¥çš„å½±å“å°±è¶Šå°ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½ã€‚</strong></p><p>é—®é¢˜1ï¼šZipListè™½ç„¶èŠ‚çœå†…å­˜ï¼Œä½†ç”³è¯·å†…å­˜å¿…é¡»æ˜¯è¿ç»­ç©ºé—´ï¼Œå¦‚æœå†…å­˜å ç”¨è¾ƒå¤šï¼Œç”³è¯·å†…å­˜æ•ˆç‡å¾ˆä½ã€‚æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹ç­”ï¼šä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é™åˆ¶ZipListçš„é•¿åº¦å’Œentryå¤§å°ã€‚</p><p>é—®é¢˜2ï¼šä½†æ˜¯æˆ‘ä»¬è¦å­˜å‚¨å¤§é‡æ•°æ®ï¼Œè¶…å‡ºäº†ZipListæœ€ä½³çš„ä¸Šé™è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹ç­”ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªZipListæ¥åˆ†ç‰‡å­˜å‚¨æ•°æ®ã€‚</p><p>é—®é¢˜3ï¼šæ•°æ®æ‹†åˆ†åæ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ï¼Œè¿™å¤šä¸ªZipListå¦‚ä½•å»ºç«‹è”ç³»ï¼Ÿ</p><p>â€‹ç­”ï¼šRedisåœ¨3.2ç‰ˆæœ¬å¼•å…¥äº†æ–°çš„æ•°æ®ç»“æ„QuickListï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒç«¯é“¾è¡¨ï¼Œåªä¸è¿‡é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªZipList</p><p>å¤´å°¾æŒ‡é’ˆ-åŒç«¯é“¾è¡¨ èŠ‚ç‚¹æ˜¯ziplist</p><p><img src="https://zdwtop.cn/blog/image-20230318190615928.png" alt="image-20230318190615928"></p><p><img src="https://zdwtop.cn/blog/image-20230318190619375.png" alt="image-20230318190619375"></p><p><img src="https://zdwtop.cn/blog/f46cbe347f65ded522f1cc3fd8dba549.png" alt="img"></p><p>åœ¨å‘ quicklist æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šåƒæ™®é€šçš„é“¾è¡¨é‚£æ ·ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ã€‚è€Œæ˜¯ä¼šæ£€æŸ¥æ’å…¥ä½ç½®çš„å‹ç¼©åˆ—è¡¨æ˜¯å¦èƒ½å®¹çº³è¯¥å…ƒç´ ï¼Œå¦‚æœèƒ½å®¹çº³å°±ç›´æ¥ä¿å­˜åˆ° quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨ï¼Œå¦‚æœä¸èƒ½å®¹çº³ï¼Œæ‰ä¼šæ–°å»ºä¸€ä¸ªæ–°çš„ quicklistNode ç»“æ„ã€‚</p><p>quicklist ä¼šæ§åˆ¶ quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿æ½œåœ¨çš„è¿é”æ›´æ–°çš„é£é™©ï¼Œä½†æ˜¯è¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</p><h2 id="listpack">listpack</h2><p>Redis åœ¨ 5.0 æ–°è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„å« listpackï¼Œç›®çš„æ˜¯æ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼Œå®ƒæœ€å¤§ç‰¹ç‚¹æ˜¯ listpack ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸å†åŒ…å«å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦äº†ï¼Œå‹ç¼©åˆ—è¡¨æ¯ä¸ªèŠ‚ç‚¹æ­£å› ä¸ºéœ€è¦ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å­—æ®µï¼Œå°±ä¼šæœ‰è¿é”æ›´æ–°çš„éšæ‚£ã€‚</p><p><strong>åœ¨æœ€æ–° 6.2 å‘è¡Œç‰ˆæœ¬ä¸­ï¼ŒRedis Hash å¯¹è±¡ã€ZSet å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„çš„å‹ç¼©åˆ—è¡¨è¿˜æœªè¢«æ›¿æ¢æˆ listpackï¼Œè€Œ Redis çš„æœ€æ–°ä»£ç å·²ç»å°†æ‰€æœ‰ç”¨åˆ°å‹ç¼©åˆ—è¡¨åº•å±‚æ•°æ®ç»“æ„çš„ Redis å¯¹è±¡æ›¿æ¢æˆ listpack æ•°æ®ç»“æ„æ¥å®ç°ï¼Œä¼°è®¡ä¸ä¹…å°†æ¥ï¼ŒRedis å°±ä¼šå‘å¸ƒä¸€ä¸ªå°†å‹ç¼©åˆ—è¡¨ä¸º listpack çš„å‘è¡Œç‰ˆæœ¬</strong>ã€‚</p><h3 id="listpack-ç»“æ„è®¾è®¡">listpack ç»“æ„è®¾è®¡</h3><p>listpack é‡‡ç”¨äº†å‹ç¼©åˆ—è¡¨çš„å¾ˆå¤šä¼˜ç§€çš„è®¾è®¡ï¼Œæ¯”å¦‚è¿˜æ˜¯ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥ç´§å‡‘åœ°ä¿å­˜æ•°æ®ï¼Œå¹¶ä¸”ä¸ºäº†èŠ‚çœå†…å­˜çš„å¼€é”€ï¼Œlistpack èŠ‚ç‚¹ä¼šé‡‡ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ä¿å­˜ä¸åŒå¤§å°çš„æ•°æ®ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ listpack ç»“æ„</p><p><img src="https://zdwtop.cn/blog/4d2dc376b5fd68dae70d9284ae82b73a.png" alt="img"></p><p>stpack å¤´åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«è®°å½•äº† listpack æ€»å­—èŠ‚æ•°å’Œå…ƒç´ æ•°é‡ï¼Œç„¶å listpack æœ«å°¾ä¹Ÿæœ‰ä¸ªç»“å°¾æ ‡è¯†ã€‚å›¾ä¸­çš„ listpack entry å°±æ˜¯ listpack çš„èŠ‚ç‚¹äº†ã€‚</p><p>æ¯ä¸ª listpack èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//mysql/other/c5fb0a602d4caaca37ff0357f05b0abf.png" alt="img"></p><p>ä¸»è¦åŒ…å«ä¸‰ä¸ªæ–¹é¢å†…å®¹ï¼š</p><ul><li>encodingï¼Œå®šä¹‰è¯¥å…ƒç´ çš„ç¼–ç ç±»å‹ï¼Œä¼šå¯¹ä¸åŒé•¿åº¦çš„æ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼›</li><li>dataï¼Œå®é™…å­˜æ”¾çš„æ•°æ®ï¼›</li><li>lenï¼Œencoding+dataçš„æ€»é•¿åº¦ï¼›</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>listpack æ²¡æœ‰å‹ç¼©åˆ—è¡¨ä¸­è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦çš„å­—æ®µäº†ï¼Œlistpack åªè®°å½•å½“å‰èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå½“æˆ‘ä»¬å‘ listpack åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“å…¶ä»–èŠ‚ç‚¹çš„é•¿åº¦å­—æ®µçš„å˜åŒ–ï¼Œä»è€Œé¿å…äº†å‹ç¼©åˆ—è¡¨çš„è¿é”æ›´æ–°é—®é¢˜</strong>ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Redisåº•å±‚æ•°æ®ç»“æ„&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Redis æ•°æ®ç»“æ„å¹¶ä¸æ˜¯æŒ‡ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰å¯¹è±¡ã€Listï¼ˆåˆ—è¡¨ï¼‰å¯¹è±¡ã€Hashï¼ˆå“ˆå¸Œï¼‰å¯¹è±¡ã€Setï¼ˆé›†åˆï¼‰å¯¹è±¡å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›æ˜¯ Redis é”®å€¼å¯¹ä¸­å€¼çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„ä¿å­˜å½¢å¼</summary>
      
    
    
    
    <category term="Redis" scheme="https://eizo01.github.io/categories/Redis/"/>
    
    
    <category term="Redisæ•°æ®ç»“æ„" scheme="https://eizo01.github.io/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡</title>
    <link href="https://eizo01.github.io/posts/1cc613d0.html"/>
    <id>https://eizo01.github.io/posts/1cc613d0.html</id>
    <published>2022-11-05T12:00:00.000Z</published>
    <updated>2023-03-18T14:04:30.773Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡"><a href="#Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡" class="headerlink" title="Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡"></a>Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡</h2><h3 id="å…¨å±€å“ˆå¸Œè¡¨"><a href="#å…¨å±€å“ˆå¸Œè¡¨" class="headerlink" title="å…¨å±€å“ˆå¸Œè¡¨"></a>å…¨å±€å“ˆå¸Œè¡¨</h3><p>ä¸ºäº†å®ç°ä»é”®åˆ°å€¼çš„å¿«é€Ÿè®¿é—®ï¼ŒRedis ä½¿ç”¨äº†ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹ã€‚ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªå“ˆå¸Œæ¡¶ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸¸è¯´ï¼Œä¸€ä¸ªå“ˆå¸Œè¡¨æ˜¯ç”±å¤šä¸ªå“ˆå¸Œæ¡¶ç»„æˆçš„ï¼Œæ¯ä¸ªå“ˆå¸Œæ¡¶ä¸­ä¿å­˜äº†é”®å€¼å¯¹æ•°æ®ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/1eb5ca015a3b4389ad4ede842d98df1f.png" alt="image.png"></p><p>å“ˆå¸Œæ¡¶ä¸­çš„ entry å…ƒç´ ä¸­ä¿å­˜äº†<em>keyå’Œ</em>valueæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘äº†å®é™…çš„é”®å’Œå€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å€¼æ˜¯ä¸€ä¸ªé›†åˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡*valueæŒ‡é’ˆè¢«æŸ¥æ‰¾åˆ°ã€‚å› ä¸ºè¿™ä¸ªå“ˆå¸Œè¡¨ä¿å­˜äº†æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä¹ŸæŠŠå®ƒç§°ä¸ºå…¨å±€å“ˆå¸Œè¡¨ã€‚</p><p>å“ˆå¸Œè¡¨çš„æœ€å¤§å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„æ—¶é—´å¤æ‚åº¦æ¥å¿«é€ŸæŸ¥æ‰¾åˆ°é”®å€¼å¯¹ï¼šæˆ‘ä»¬åªéœ€è¦è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œå°±å¯ä»¥çŸ¥é“å®ƒæ‰€å¯¹åº”çš„å“ˆå¸Œæ¡¶ä½ç½®ï¼Œç„¶åå°±å¯ä»¥è®¿é—®ç›¸åº”çš„ entry å…ƒç´ ã€‚</p><p>ä½†å½“ä½ å¾€ Redis ä¸­å†™å…¥å¤§é‡æ•°æ®åï¼Œå°±å¯èƒ½å‘ç°æ“ä½œæœ‰æ—¶å€™ä¼šçªç„¶å˜æ…¢äº†ã€‚è¿™å…¶å®æ˜¯å› ä¸ºä½ å¿½ç•¥äº†ä¸€ä¸ªæ½œåœ¨<br>çš„é£é™©ç‚¹ï¼Œé‚£å°±æ˜¯å“ˆå¸Œè¡¨çš„å†²çªé—®é¢˜å’Œ rehash å¯èƒ½å¸¦æ¥çš„æ“ä½œé˜»å¡ã€‚</p><p>å½“ä½ å¾€å“ˆå¸Œè¡¨ä¸­å†™å…¥æ›´å¤šæ•°æ®æ—¶ï¼Œå“ˆå¸Œå†²çªæ˜¯ä¸å¯é¿å…çš„é—®é¢˜ã€‚è¿™é‡Œçš„å“ˆå¸Œå†²çªï¼Œä¸¤ä¸ª key çš„å“ˆå¸Œå€¼å’Œå“ˆå¸Œæ¡¶è®¡ç®—å¯¹åº”å…³ç³»æ—¶ï¼Œæ­£å¥½è½åœ¨äº†åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/f2a1f73d63f1428cad1324a7b67283b4.png" alt="image.png"></p><p>Redis è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼ï¼Œå°±æ˜¯é“¾å¼å“ˆå¸Œã€‚é“¾å¼å“ˆå¸Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯æŒ‡åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­çš„å¤šä¸ªå…ƒç´ ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ä¿å­˜ï¼Œå®ƒä»¬ä¹‹é—´ä¾æ¬¡ç”¨æŒ‡é’ˆè¿æ¥ã€‚</p><p>å½“ç„¶å¦‚æœè¿™ä¸ªæ•°ç»„ä¸€ç›´ä¸å˜ï¼Œé‚£ä¹ˆhashå†²çªä¼šå˜å¾ˆå¤šï¼Œè¿™ä¸ªæ—¶å€™æ£€ç´¢æ•ˆç‡ä¼šå¤§æ‰“æŠ˜æ‰£ï¼Œæ‰€ä»¥Rediså°±éœ€è¦æŠŠæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼ˆä¸€èˆ¬æ˜¯æ‰©å¤§åˆ°åŸæ¥çš„ä¸¤å€ï¼‰ï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œæ‰©å®¹åæ¯ä¸ªhashæ¡¶çš„æ•°æ®ä¼šåˆ†æ•£åˆ°ä¸åŒçš„ä½ç½®ï¼Œè¿™é‡Œè®¾è®¡åˆ°å…ƒç´ çš„ç§»åŠ¨ï¼Œå¿…å®šä¼šé˜»å¡IOï¼Œæ‰€ä»¥è¿™ä¸ªReHashè¿‡ç¨‹ä¼šå¯¼è‡´å¾ˆå¤šè¯·æ±‚é˜»å¡ã€‚</p><h3 id="æ¸è¿›å¼rehash"><a href="#æ¸è¿›å¼rehash" class="headerlink" title="æ¸è¿›å¼rehash"></a>æ¸è¿›å¼rehash</h3><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒRedis é‡‡ç”¨äº†æ¸è¿›å¼ rehashã€‚</p><p>é¦–å…ˆã€Redis é»˜è®¤ä½¿ç”¨äº†ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨ï¼šå“ˆå¸Œè¡¨ 1 å’Œå“ˆå¸Œè¡¨ 2ã€‚ä¸€å¼€å§‹ï¼Œå½“ä½ åˆšæ’å…¥æ•°æ®æ—¶ï¼Œé»˜è®¤ä½¿ç”¨å“ˆå¸Œè¡¨ 1ï¼Œæ­¤æ—¶çš„å“ˆå¸Œè¡¨ 2 å¹¶æ²¡æœ‰è¢«åˆ†é…ç©ºé—´ã€‚éšç€æ•°æ®é€æ­¥å¢å¤šï¼ŒRedis å¼€å§‹æ‰§è¡Œ rehashã€‚</p><p>1ã€ç»™å“ˆå¸Œè¡¨ 2 åˆ†é…æ›´å¤§çš„ç©ºé—´ï¼Œä¾‹å¦‚æ˜¯å½“å‰å“ˆå¸Œè¡¨ 1 å¤§å°çš„ä¸¤å€</p><p>2ã€æŠŠå“ˆå¸Œè¡¨ 1 ä¸­çš„æ•°æ®é‡æ–°æ˜ å°„å¹¶æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­</p><p>3ã€é‡Šæ”¾å“ˆå¸Œè¡¨ 1 çš„ç©ºé—´</p><p>åœ¨ä¸Šé¢çš„ç¬¬äºŒæ­¥æ¶‰åŠå¤§é‡çš„æ•°æ®æ‹·è´ï¼Œå¦‚æœä¸€æ¬¡æ€§æŠŠå“ˆå¸Œè¡¨ 1 ä¸­çš„æ•°æ®éƒ½è¿ç§»å®Œï¼Œä¼šé€ æˆ Redis çº¿ç¨‹é˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚ã€‚æ­¤æ—¶ï¼ŒRedis å°±æ— æ³•å¿«é€Ÿè®¿é—®æ•°æ®äº†ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/2406a8206e944d449b03f1f390bedf0d.png" alt="image.png"></p><p>åœ¨Redis å¼€å§‹æ‰§è¡Œ rehashï¼ŒRedisä»ç„¶æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œä½†æ˜¯è¦åŠ å…¥ä¸€ä¸ªé¢å¤–çš„å¤„ç†ï¼š</p><p>å¤„ç†ç¬¬1ä¸ªè¯·æ±‚æ—¶ï¼ŒæŠŠå“ˆå¸Œè¡¨ 1ä¸­çš„ç¬¬1ä¸ªç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ entries æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­</p><p>å¤„ç†ç¬¬2ä¸ªè¯·æ±‚æ—¶ï¼ŒæŠŠå“ˆå¸Œè¡¨ 1ä¸­çš„ç¬¬2ä¸ªç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ entries æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­</p><p>å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°æŠŠæ‰€æœ‰çš„ç´¢å¼•ä½ç½®çš„æ•°æ®éƒ½æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­ã€‚</p><p>è¿™æ ·å°±å·§å¦™åœ°æŠŠä¸€æ¬¡æ€§å¤§é‡æ‹·è´çš„å¼€é”€ï¼Œåˆ†æ‘Šåˆ°äº†å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…äº†è€—æ—¶æ“ä½œï¼Œä¿è¯äº†æ•°æ®çš„å¿«é€Ÿè®¿é—®ã€‚</p><p>æ‰€ä»¥è¿™é‡ŒåŸºæœ¬ä¸Šä¹Ÿå¯ä»¥ç¡®ä¿æ ¹æ®keyæ‰¾valueçš„æ“ä½œåœ¨Oï¼ˆ1ï¼‰å·¦å³ã€‚</p><p>ä¸è¿‡è¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æœRedisä¸­æœ‰æµ·é‡çš„keyå€¼çš„è¯ï¼Œè¿™ä¸ªRehashè¿‡ç¨‹ä¼šå¾ˆé•¿å¾ˆé•¿ï¼Œè™½ç„¶é‡‡ç”¨æ¸è¿›å¼Rehashï¼Œä½†åœ¨Rehashçš„è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¼šå¯¼è‡´è¯·æ±‚æœ‰ä¸å°çš„å¡é¡¿ã€‚å¹¶ä¸”åƒä¸€äº›ç»Ÿè®¡å‘½ä»¤ä¹Ÿä¼šéå¸¸å¡é¡¿ï¼šæ¯”å¦‚keys</p><p>æŒ‰ç…§Redisçš„é…ç½®æ¯ä¸ªå®ä¾‹èƒ½å­˜å‚¨çš„æœ€å¤§<em>çš„keyçš„æ•°é‡</em>ä¸º2çš„32æ¬¡æ–¹,å³2.5äº¿ï¼Œä½†æ˜¯å°½é‡æŠŠkeyçš„æ•°é‡æ§åˆ¶åœ¨åƒä¸‡ä»¥ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…Rehashå¯¼è‡´çš„å¡é¡¿é—®é¢˜ï¼Œå¦‚æœæ•°é‡ç¡®å®æ¯”è¾ƒå¤šï¼Œå»ºè®®é‡‡ç”¨åˆ†åŒºhashå­˜å‚¨ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡&quot;&gt;&lt;a href=&quot;#Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡&quot; class=&quot;headerlink&quot; title=&quot;Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„ç»„ç»‡&quot;&gt;&lt;/a&gt;Redisçš„Keyå’ŒValueçš„æ•°æ®ç»“æ„</summary>
      
    
    
    
    <category term="Redis" scheme="https://eizo01.github.io/categories/Redis/"/>
    
    
    <category term="Redisæ•°æ®ç»“æ„" scheme="https://eizo01.github.io/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>InnoDBçš„Buffer Pool</title>
    <link href="https://eizo01.github.io/posts/1eb869e1.html"/>
    <id>https://eizo01.github.io/posts/1eb869e1.html</id>
    <published>2022-11-05T12:00:00.000Z</published>
    <updated>2023-03-23T07:38:13.039Z</updated>
    
    <content type="html"><![CDATA[<h1>è°ƒèŠ‚ç£ç›˜å’ŒCPUçš„çŸ›ç›¾-InnoDBçš„Buffer Pool</h1><h2 id="ä¸ºä»€ä¹ˆè¦æœ‰-Buffer-Poolï¼Ÿ">ä¸ºä»€ä¹ˆè¦æœ‰ Buffer Poolï¼Ÿ</h2><p>å¯¹äºä½¿ç”¨ InnoDB ä½œä¸ºå­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œä¸ç®¡æ˜¯ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®çš„ç´¢å¼•ï¼ˆåŒ…æ‹¬èš ç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•ï¼‰ï¼Œè¿˜æ˜¯å„ç§ç³»ç»Ÿæ•°æ®ï¼Œéƒ½æ˜¯ä»¥ é¡µ çš„å½¢å¼å­˜æ”¾åœ¨ è¡¨ç©ºé—´ ä¸­çš„ï¼Œè€Œæ‰€è°“çš„ è¡¨ç©ºé—´ åªä¸è¿‡æ˜¯ InnoDB å¯¹æ–‡ä»¶ç³»ç»Ÿä¸Šä¸€ä¸ªæˆ–å‡ ä¸ªå®é™…æ–‡ä»¶çš„æŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„æ•°æ®è¯´åˆ°åº•è¿˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ã€‚</p><p>è¦æƒ³æå‡æŸ¥è¯¢æ€§èƒ½ï¼ŒåŠ ä¸ªç¼“å­˜å°±è¡Œäº†å˜›ã€‚æ‰€ä»¥ï¼Œå½“æ•°æ®ä»ç£ç›˜ä¸­å–å‡ºåï¼Œç¼“å­˜å†…å­˜ä¸­ï¼Œä¸‹æ¬¡æŸ¥è¯¢åŒæ ·çš„æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜ä¸­è¯»å–ã€‚</p><p>ä¸ºæ­¤ï¼ŒInnodb å­˜å‚¨å¼•æ“è®¾è®¡äº†ä¸€ä¸ª<strong>ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong>ï¼Œæ¥æé«˜æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚</p><p>æ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“åœ¨å¤„ ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œå½“éœ€è¦è®¿é—®æŸä¸ªé¡µçš„æ•°æ®æ—¶ï¼Œå°±ä¼šæŠŠå®Œæ•´çš„é¡µçš„æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´<font color="red"><strong>å³ä½¿æˆ‘ä»¬ åªéœ€è¦è®¿é—®ä¸€ä¸ªé¡µçš„ä¸€æ¡è®°å½•ï¼Œé‚£ä¹Ÿéœ€è¦å…ˆæŠŠæ•´ä¸ªé¡µçš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å°†é¡µåŠ è½½åˆ° Buffer Pool åï¼Œå†é€šè¿‡é¡µé‡Œçš„é¡µç›®å½•å»å®šä½åˆ°æŸæ¡å…·ä½“çš„è®°å½•ã€‚</strong></font></p><p>å°†æ•´ä¸ªé¡µåŠ è½½åˆ°å†…å­˜ä¸­åå°±å¯ä»¥è¿›è¡Œè¯»å†™è®¿é—®äº†ï¼Œåœ¨è¿›è¡Œå®Œè¯»å†™è®¿é—®ä¹‹åå¹¶ä¸ç€æ€¥æŠŠè¯¥é¡µå¯¹åº”çš„å†…å­˜ç©ºé—´é‡Šæ”¾æ‰ï¼Œè€Œæ˜¯å°†å…¶ ç¼“å­˜ èµ·æ¥ï¼Œè¿™æ ·å°†æ¥æœ‰ è¯·æ±‚å†æ¬¡è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œå°±å¯ä»¥çœå»ç£ç›˜ IO çš„å¼€é”€äº†ã€‚</p><h2 id="Buffer-Poolçš„å¤§å°ï¼Ÿ">Buffer Poolçš„å¤§å°ï¼Ÿ</h2><p>Buffer Pool æ˜¯åœ¨ MySQL å¯åŠ¨çš„æ—¶å€™ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé»˜è®¤é…ç½®ä¸‹ Buffer Pool åªæœ‰ <code>128MB</code> ï¼Œæœ€å°å€¼ä¸º 5M (å½“å°äºè¯¥å€¼æ—¶ä¼šè‡ªåŠ¨è®¾ç½®æˆ 5M )ã€‚</p><p>å¯ä»¥é€šè¿‡è°ƒæ•´ <code>innodb_buffer_pool_size</code> å‚æ•°æ¥è®¾ç½® Buffer Pool çš„å¤§å°ï¼Œä¸€èˆ¬å»ºè®®è®¾ç½®æˆå¯ç”¨ç‰©ç†å†…å­˜çš„ 60%~80%ã€‚</p><h2 id="Buffer-Poolå†…éƒ¨ç»„æˆ">Buffer Poolå†…éƒ¨ç»„æˆ</h2><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†è¿™äº›åœ¨ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼Œè®¾è®¡ InnoDB çš„å¤§å”ä¸ºæ¯ä¸€ä¸ªç¼“å­˜é¡µéƒ½åˆ›å»ºäº†ä¸€äº›æ‰€è°“çš„ æ§åˆ¶ä¿¡æ¯ ï¼Œè¿™äº›æ§åˆ¶ä¿¡æ¯ åŒ…æ‹¬è¯¥é¡µæ‰€å±çš„è¡¨ç©ºé—´ç¼–å·ã€é¡µå·ã€ç¼“å­˜é¡µåœ¨ Buffer Pool ä¸­çš„åœ°å€ã€é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€ä¸€äº›é”ä¿¡æ¯ä»¥åŠ LSN ä¿¡æ¯ã€‚</p><blockquote><p>åœ¨MySQLçš„ç¼“å†²æ± ä¸­ï¼ŒLSNæ˜¯ä¸€ä¸ªç”¨äºè·Ÿè¸ªæ—¥å¿—åºåˆ—å·ï¼ˆLog Sequence Numberï¼‰çš„å€¼ã€‚åœ¨InnoDBå¼•æ“ä¸­ï¼Œæ¯ä¸ªé¡µé¢éƒ½æœ‰ä¸€ä¸ªLSNå€¼ï¼Œå®ƒæŒ‡ç¤ºäº†æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹é¡µé¢æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—å·ã€‚</p><p>åœ¨è¿›è¡Œäº‹åŠ¡æäº¤å’Œå›æ»šæ—¶ï¼Œæ•°æ®åº“ä½¿ç”¨LSNæ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚æ­¤å¤–ï¼ŒLSNè¿˜åœ¨å´©æºƒæ¢å¤è¿‡ç¨‹ä¸­æ‰®æ¼”é‡è¦çš„è§’è‰²ï¼Œå®ƒç”¨äºç¡®å®šå“ªäº›æ—¥å¿—éœ€è¦è¢«åº”ç”¨åˆ°æ•°æ®åº“ä¸­ä»¥è¿›è¡Œæ•°æ®æ¢å¤ã€‚</p></blockquote><p><img src="HTTPs://zdwtop.cn/blog/image-20230323102320659.png" alt="image-20230323102320659"></p><p>Buffer Pool é™¤äº†ç¼“å­˜ã€Œç´¢å¼•é¡µã€å’Œã€Œæ•°æ®é¡µã€ï¼Œè¿˜åŒ…æ‹¬äº† undo é¡µï¼Œæ’å…¥ç¼“å­˜ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€é”ä¿¡æ¯ç­‰ç­‰ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323102429464.png" alt="image-20230323102429464"></p><p>æ¯ä¸€ä¸ªæ§åˆ¶å—éƒ½å¯¹åº”ä¸€ä¸ªç¼“å­˜é¡µï¼Œé‚£åœ¨åˆ†é… è¶³å¤Ÿå¤šçš„æ§åˆ¶å—å’Œç¼“å­˜é¡µåï¼Œå¯èƒ½å‰©ä½™çš„é‚£ç‚¹å„¿ç©ºé—´ä¸å¤Ÿä¸€å¯¹æ§åˆ¶å—å’Œç¼“å­˜é¡µçš„å¤§å°ï¼Œè¿™ä¸ªç”¨ä¸åˆ°çš„é‚£ç‚¹å„¿å†…å­˜ç©ºé—´å°±è¢«ç§°ä¸º ç¢ç‰‡ äº†ã€‚</p><h2 id="å¦‚ä½•ç®¡ç†-Buffer-Poolï¼Ÿ">å¦‚ä½•ç®¡ç† Buffer Poolï¼Ÿ</h2><h3 id="å¦‚ä½•ç®¡ç†ç©ºé—²é¡µï¼Ÿ-Free-é“¾è¡¨">å¦‚ä½•ç®¡ç†ç©ºé—²é¡µï¼Ÿ-Free é“¾è¡¨</h3><p>Buffer Pool æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå½“ MySQL è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œè¿™ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­çš„ç¼“å­˜é¡µæ—¢æœ‰ç©ºé—²çš„ï¼Œä¹Ÿæœ‰è¢«ä½¿ç”¨çš„ã€‚</p><p>é‚£å½“æˆ‘ä»¬ä»ç£ç›˜è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œæ€»ä¸èƒ½é€šè¿‡éå†è¿™ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´æ¥æ‰¾åˆ°ç©ºé—²çš„ç¼“å­˜é¡µå§ï¼Œè¿™æ ·æ•ˆç‡å¤ªä½äº†ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°ç©ºé—²çš„ç¼“å­˜é¡µï¼Œå¯ä»¥ä½¿ç”¨é“¾è¡¨ç»“æ„ï¼Œå°†ç©ºé—²ç¼“å­˜é¡µçš„ã€Œæ§åˆ¶å—ã€ä½œä¸ºé“¾è¡¨çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªé“¾è¡¨ç§°ä¸º <strong>Free é“¾è¡¨</strong>ï¼ˆç©ºé—²é“¾è¡¨ï¼‰ã€‚</p><p>åˆšåˆšå®Œæˆåˆå§‹åŒ–çš„ Buffer Pool ä¸­ æ‰€æœ‰çš„ç¼“å­˜é¡µéƒ½æ˜¯ç©ºé—²çš„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªç¼“å­˜é¡µå¯¹åº”çš„æ§åˆ¶å—éƒ½ä¼šè¢«åŠ å…¥åˆ° freeé“¾è¡¨ ä¸­ï¼Œå‡è®¾è¯¥ Buffer Pool ä¸­ å¯å®¹çº³çš„ç¼“å­˜é¡µæ•°é‡ä¸º n ï¼Œé‚£å¢åŠ äº† freeé“¾è¡¨ çš„æ•ˆæœå›¾å°±æ˜¯è¿™æ ·çš„</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323102820147.png" alt="image-20230323102820147"></p><blockquote><p>é“¾è¡¨åŸºèŠ‚ç‚¹å ç”¨çš„å†…å­˜ç©ºé—´å¹¶ä¸å¤§ï¼Œåœ¨MySQL5.7.21è¿™ä¸ªç‰ˆæœ¬é‡Œï¼Œæ¯ä¸ªåŸºèŠ‚ç‚¹åªå ç”¨40å­—èŠ‚å¤§å°ã€‚MySQLä¸­è®¸å¤šä¸åŒçš„é“¾è¡¨ï¼Œå®ƒä»¬çš„åŸºèŠ‚ç‚¹å’Œfreeé“¾è¡¨çš„åŸºèŠ‚ç‚¹çš„å†…å­˜åˆ†é…æ–¹å¼æ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ å•ç‹¬ç”³è¯·çš„ä¸€å—40å­—èŠ‚å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸åŒ…å«åœ¨ä¸ºBuffer Poolç”³è¯·çš„ä¸€å¤§ç‰‡è¿ç»­å†…å­˜ç©ºé—´ä¹‹å†…ã€‚</p></blockquote><p>æ¯å½“éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½ä¸€ä¸ªé¡µåˆ° Buffer Pool ä¸­æ—¶ï¼Œå°±ä» freeé“¾è¡¨ ä¸­ å–ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µï¼Œå¹¶ä¸”æŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„ æ§åˆ¶å— çš„ä¿¡æ¯å¡«ä¸Šï¼ˆå°±æ˜¯è¯¥é¡µæ‰€åœ¨çš„è¡¨ç©ºé—´ã€é¡µå·ä¹‹ç±»çš„ä¿¡ æ¯ï¼‰ï¼Œç„¶åæŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„ freeé“¾è¡¨ èŠ‚ç‚¹ä»é“¾è¡¨ä¸­ç§»é™¤ï¼Œè¡¨ç¤ºè¯¥ç¼“å­˜é¡µå·²ç»è¢«ä½¿ç”¨äº†</p><h3 id="ç¼“å­˜é¡µçš„å“ˆå¸Œå¤„ç†">ç¼“å­˜é¡µçš„å“ˆå¸Œå¤„ç†</h3><p>å½“æˆ‘ä»¬éœ€è¦è®¿é—®æŸä¸ªé¡µä¸­çš„æ•°æ®æ—¶ï¼Œå°±ä¼šæŠŠè¯¥é¡µä»ç£ç›˜åŠ è½½åˆ° Buffer Pool ä¸­ï¼Œå¦‚æœè¯¥é¡µå·²ç» åœ¨ Buffer Pool ä¸­çš„è¯ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚é‚£ä¹ˆé—®é¢˜ä¹Ÿå°±æ¥äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“è¯¥é¡µåœ¨ä¸åœ¨ Buffer Pool ä¸­å‘¢ï¼Ÿéš¾ ä¸æˆéœ€è¦ä¾æ¬¡éå† Buffer Pool ä¸­å„ä¸ªç¼“å­˜é¡µä¹ˆï¼Ÿä¸€ä¸ª Buffer Pool ä¸­çš„ç¼“å­˜é¡µè¿™ä¹ˆå¤šéƒ½éå†å®Œå²‚ä¸æ˜¯è¦ç´¯æ­»ï¼Ÿ</p><p>æˆ‘ä»¬å…¶å®æ˜¯æ ¹æ® è¡¨ç©ºé—´å· + é¡µå· æ¥å®šä½ä¸€ä¸ªé¡µçš„ï¼Œä¹Ÿå°±ç›¸å½“äº è¡¨ç©ºé—´å· + é¡µå· æ˜¯ä¸€ä¸ª key ï¼Œ ç¼“å­˜é¡µ å°±æ˜¯å¯¹åº”çš„ value ï¼Œæ€ä¹ˆé€šè¿‡ä¸€ä¸ª key æ¥å¿«é€Ÿæ‰¾ç€ä¸€ä¸ª value å‘¢ï¼Ÿå¦‚æœå­¦è¿‡æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬ä¼šéå¸¸ç†Ÿæ‚‰ä¼šç”¨å“ˆå¸Œè¡¨æ¥å¤„ç†ã€‚</p><p><strong>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ è¡¨ç©ºé—´å· + é¡µå· ä½œä¸º key ï¼Œ ç¼“å­˜é¡µ ä½œä¸º value åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œåœ¨éœ€è¦è®¿é—®æŸä¸ªé¡µçš„æ•°æ® æ—¶ï¼Œå…ˆä»å“ˆå¸Œè¡¨ä¸­æ ¹æ® è¡¨ç©ºé—´å· + é¡µå· çœ‹çœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜é¡µï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥ä½¿ç”¨è¯¥ç¼“å­˜é¡µå°±å¥½ï¼Œå¦‚æœæ²¡ æœ‰ï¼Œé‚£å°±ä» freeé“¾è¡¨ ä¸­é€‰ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µï¼Œç„¶åæŠŠç£ç›˜ä¸­å¯¹åº”çš„é¡µåŠ è½½åˆ°è¯¥ç¼“å­˜é¡µçš„ä½ç½®ã€‚</strong></p><h3 id="å¦‚ä½•ç®¡ç†è„é¡µï¼Ÿ-flushé“¾è¡¨">å¦‚ä½•ç®¡ç†è„é¡µï¼Ÿ-flushé“¾è¡¨</h3><p>è®¾è®¡ Buffer Pool é™¤äº†èƒ½æé«˜è¯»æ€§èƒ½ï¼Œè¿˜èƒ½æé«˜å†™æ€§èƒ½ï¼Œä¹Ÿå°±æ˜¯æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½è¦å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å°† Buffer Pool å¯¹åº”çš„ç¼“å­˜é¡µæ ‡è®°ä¸º<strong>è„é¡µ</strong>ï¼Œç„¶åå†ç”±åå°çº¿ç¨‹å°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚</p><p>å‡¡æ˜¯ä¿®æ”¹è¿‡çš„ç¼“å­˜é¡µå¯¹ åº”çš„æ§åˆ¶å—éƒ½ä¼šä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå› ä¸ºè¿™ä¸ªé“¾è¡¨èŠ‚ç‚¹å¯¹åº”çš„ç¼“å­˜é¡µéƒ½æ˜¯éœ€è¦è¢«åˆ·æ–°åˆ°ç£ç›˜ä¸Šçš„ï¼Œ æ‰€ä»¥ä¹Ÿå« flushé“¾è¡¨ ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323103506265.png" alt="image-20230323103506265"></p><p>æœ‰äº†flushé“¾è¡¨ï¼Œæ¯æ¬¡ä¿®æ”¹ç¼“å­˜é¡µåï¼Œæˆ‘ä»¬å¹¶ä¸ç€æ€¥ç«‹å³æŠŠä¿®æ”¹åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹è¿›è¡ŒåŒæ­¥ã€‚</p><h3 id="å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ-LRUé“¾è¡¨çš„ç®¡ç†">å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ-LRUé“¾è¡¨çš„ç®¡ç†</h3><p>è®¾ç«‹ Buffer Pool çš„åˆè¡·ï¼Œå°±æ˜¯æƒ³å‡å°‘å’Œç£ç›˜çš„ IO äº¤äº’ï¼Œæœ€å¥½æ¯æ¬¡åœ¨è®¿é—®æŸä¸ªé¡µçš„æ—¶å€™å®ƒéƒ½å·²ç»è¢«ç¼“å­˜åˆ° Buffer Pool ä¸­äº†ã€‚å‡è®¾æˆ‘ä»¬ä¸€å…±è®¿é—®äº† n æ¬¡é¡µï¼Œé‚£ä¹ˆè¢«è®¿é—®çš„é¡µå·²ç» åœ¨ç¼“å­˜ä¸­çš„æ¬¡æ•°é™¤ä»¥ n å°±æ˜¯æ‰€è°“çš„ <strong>ç¼“å­˜å‘½ä¸­ç‡</strong> ï¼Œæˆ‘ä»¬çš„æœŸæœ›å°±æ˜¯è®© ç¼“å­˜å‘½ä¸­ç‡ è¶Šé«˜è¶Šå¥½ï½</p><p>ä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œ å›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„å¾®ä¿¡èŠå¤©åˆ—è¡¨ï¼Œæ’åœ¨å‰è¾¹çš„éƒ½æ˜¯æœ€è¿‘å¾ˆé¢‘ç¹ä½¿ç”¨çš„ï¼Œæ’åœ¨åè¾¹çš„è‡ªç„¶å°±æ˜¯æœ€è¿‘å¾ˆå°‘ä½¿ç”¨çš„ï¼Œå‡å¦‚ åˆ—è¡¨èƒ½å®¹çº³ä¸‹çš„è”ç³»äººæœ‰é™ï¼Œä½ æ˜¯ä¼šæŠŠæœ€è¿‘å¾ˆé¢‘ç¹ä½¿ç”¨çš„ç•™ä¸‹è¿˜æ˜¯æœ€è¿‘å¾ˆå°‘ä½¿ç”¨çš„ç•™ä¸‹å‘¢ï¼ŸåºŸè¯ï¼Œå½“ç„¶æ˜¯ç•™ä¸‹æœ€ è¿‘å¾ˆé¢‘ç¹ä½¿ç”¨çš„äº†</p><p><strong>è¦å®ç°è¿™ä¸ªï¼Œæœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯ LRUï¼ˆLeast recently usedï¼‰ç®—æ³•ã€‚</strong></p><p>è¯¥ç®—æ³•çš„æ€è·¯æ˜¯ï¼Œé“¾è¡¨å¤´éƒ¨çš„èŠ‚ç‚¹æ˜¯æœ€è¿‘ä½¿ç”¨çš„ï¼Œè€Œé“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹æ˜¯æœ€ä¹…æ²¡è¢«ä½¿ç”¨çš„ã€‚é‚£ä¹ˆï¼Œå½“ç©ºé—´ä¸å¤Ÿäº†ï¼Œå°±æ·˜æ±°æœ€ä¹…æ²¡è¢«ä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œä»è€Œè…¾å‡ºç©ºé—´ã€‚</p><h4 id="ç®€å•LRU">ç®€å•LRU</h4><p>ç®€å•çš„ LRU ç®—æ³•çš„å®ç°æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å½“è®¿é—®çš„é¡µåœ¨ Buffer Pool é‡Œï¼Œå°±ç›´æ¥æŠŠè¯¥é¡µå¯¹åº”çš„ LRU é“¾è¡¨èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚</li><li>å½“è®¿é—®çš„é¡µä¸åœ¨ Buffer Pool é‡Œï¼Œé™¤äº†è¦æŠŠé¡µæ”¾å…¥åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿˜è¦æ·˜æ±° LRU é“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹ã€‚</li></ul><p>æ¯”å¦‚ä¸‹å›¾ï¼Œå‡è®¾ LRU é“¾è¡¨é•¿åº¦ä¸º 5ï¼ŒLRU é“¾è¡¨ä»å·¦åˆ°å³æœ‰ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 çš„é¡µã€‚</p><p>å¦‚æœè¯¥é¡µä¸åœ¨ Buffer Pool ä¸­ï¼Œåœ¨æŠŠè¯¥é¡µä»ç£ç›˜åŠ è½½åˆ° Buffer Pool ä¸­çš„ç¼“å­˜é¡µæ—¶ï¼Œå°±æŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„ æ§åˆ¶å— ä½œä¸ºèŠ‚ç‚¹å¡åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚</p><p>å¦‚æœè¯¥é¡µå·²ç»ç¼“å­˜åœ¨ Buffer Pool ä¸­ï¼Œåˆ™ç›´æ¥æŠŠè¯¥é¡µå¯¹åº”çš„ æ§åˆ¶å— ç§»åŠ¨åˆ° LRUé“¾è¡¨ çš„å¤´éƒ¨ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230323110557851.png" alt="image-20230323110557851"></p><ul><li>Free Pageï¼ˆç©ºé—²é¡µï¼‰ï¼Œè¡¨ç¤ºæ­¤é¡µæœªè¢«ä½¿ç”¨ï¼Œä½äº Free é“¾è¡¨ï¼›</li><li>Clean Pageï¼ˆå¹²å‡€é¡µï¼‰ï¼Œè¡¨ç¤ºæ­¤é¡µå·²è¢«ä½¿ç”¨ï¼Œä½†æ˜¯é¡µé¢æœªå‘ç”Ÿä¿®æ”¹ï¼Œä½äºLRU é“¾è¡¨ã€‚</li><li>Dirty Pageï¼ˆè„é¡µï¼‰ï¼Œè¡¨ç¤ºæ­¤é¡µã€Œå·²è¢«ä½¿ç”¨ã€ä¸”ã€Œå·²ç»è¢«ä¿®æ”¹ã€ï¼Œå…¶æ•°æ®å’Œç£ç›˜ä¸Šçš„æ•°æ®å·²ç»ä¸ä¸€è‡´ã€‚å½“è„é¡µä¸Šçš„æ•°æ®å†™å…¥ç£ç›˜åï¼Œå†…å­˜æ•°æ®å’Œç£ç›˜æ•°æ®ä¸€è‡´ï¼Œé‚£ä¹ˆè¯¥é¡µå°±å˜æˆäº†å¹²å‡€é¡µã€‚è„é¡µåŒæ—¶å­˜åœ¨äº LRU é“¾è¡¨å’Œ Flush é“¾è¡¨ã€‚</li></ul><p>ç®€å•çš„ LRU ç®—æ³•å¹¶æ²¡æœ‰è¢« MySQL ä½¿ç”¨ï¼Œå› ä¸ºç®€å•çš„ LRU ç®—æ³•æ— æ³•é¿å…ä¸‹é¢è¿™ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>é¢„è¯»å¤±æ•ˆï¼›</li><li>Buffer Pool æ±¡æŸ“ï¼›</li></ul><h4 id="åˆ’åˆ†åŒºåŸŸçš„LRUé“¾è¡¨">åˆ’åˆ†åŒºåŸŸçš„LRUé“¾è¡¨</h4><ul><li><p><strong>é¢„è¯»</strong></p><p>InnoDB æä¾›äº†ä¸€ä¸ªçœ‹èµ·æ¥æ¯”è¾ƒè´´å¿ƒçš„æœåŠ¡â€”â€” é¢„è¯» ï¼ˆè‹±æ–‡åï¼š read ahead ï¼‰ã€‚æ‰€è°“ é¢„è¯» ï¼Œå°±æ˜¯ InnoDB è®¤ä¸ºæ‰§è¡Œå½“å‰çš„è¯·æ±‚å¯èƒ½ä¹‹åä¼šè¯»å–æŸäº›é¡µé¢ï¼Œå°±é¢„å…ˆæŠŠå®ƒä»¬åŠ è½½åˆ° Buffer Pool ä¸­ã€‚æ ¹æ®è§¦å‘æ–¹å¼çš„ä¸åŒï¼Œ é¢„è¯»åˆå¯ä»¥ç»†åˆ†ä¸ºä¸‹è¾¹ä¸¤ç§ï¼š</p><ul><li><p>çº¿æ€§é¢„è¯»</p><p>MySQLæä¾›äº†ä¸€ä¸ªç³»ç»Ÿå˜é‡ <code>innodb_read_ahead_threshold </code>é»˜è®¤æ˜¯ 56ï¼Œå¦‚æœé¡ºåºè®¿é—®äº†æŸä¸ªåŒº ï¼ˆ extent ï¼‰çš„é¡µé¢è¶…è¿‡è¿™ä¸ªç³»ç»Ÿå˜é‡çš„å€¼ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å¼‚æ­¥è¯»å–**ä¸‹ä¸€ä¸ªåŒºä¸­å…¨éƒ¨çš„é¡µé¢åˆ° Buffer Pool çš„è¯·æ±‚ï¼Œæ³¨æ„ å¼‚æ­¥ è¯»å–æ„å‘³ç€ä»ç£ç›˜ä¸­åŠ è½½è¿™äº›è¢«é¢„è¯»çš„é¡µé¢å¹¶ä¸ä¼šå½±å“åˆ°å½“å‰å·¥ä½œçº¿ç¨‹çš„æ­£å¸¸ æ‰§è¡Œã€‚**çº¿æ€§é¢„è¯»ä¹Ÿæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼Œæ¯”å¦‚å¯èƒ½ä¼šå ç”¨å¤§é‡çš„å†…å­˜èµ„æºï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œæˆ–è€…ä½¿å¾—æ•°æ®åº“é•¿æ—¶é—´æ— æ³•å¯¹æŸäº›æ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</p></li><li><p>éšæœºé¢„è¯»</p><p>å½“ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æ—¶ï¼Œåœ¨è¿›è¡Œæ‰«ææ“ä½œï¼ˆä¾‹å¦‚SELECTã€UPDATEã€DELETEç­‰ï¼‰æ—¶ï¼Œ**MySQLä¼šéšæœºè¯»å–æ•°æ®é¡µåˆ°å†…å­˜ä¸­ã€‚è¿™ç§ä¼˜åŒ–ç­–ç•¥å¯ä»¥é¿å…åœ¨æ‰«ææ“ä½œæ—¶å°†æ‰€æœ‰æ•°æ®éƒ½ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‘½ä¸­ç‡ä½ä¸‹çš„é—®é¢˜ã€‚**å› æ­¤æ¯ä¸ªæ•°æ®é¡µåªæœ‰è¢«è®¿é—®ä¸€æ¬¡çš„æœºä¼šï¼Œå¯¼è‡´çº¿æ€§é¢„è¯»çš„æ•°æ®é¡µåœ¨å†…å­˜ä¸­æš‚ç•™æ—¶é—´æ›´é•¿ã€‚</p><p>é»˜è®¤ä¸å¼€å¯ï¼Œé€šè¿‡è°ƒæ•´é…ç½®å‚æ•°ï¼ˆä¾‹å¦‚innodb_random_read.ahead_ratioï¼‰å¯ä»¥è®¾ç½®é€‚å½“çš„é¢„è¯»é˜ˆå€¼æ¥å¹³è¡¡å†…å­˜å ç”¨å’Œç³»ç»Ÿæ€§èƒ½ã€‚éšæœºé¢„è¯»çš„æ•ˆæœä¸€èˆ¬ä¼˜äºçº¿æ€§é¢„è¯»ï¼Œå› ä¸ºå®ƒæ›´é€‚åˆ InnoDB å¼•æ“çš„ B+ æ ‘ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢æ¡ä»¶ç¼ºå¤±æ—¶å¯ä»¥å°†å¤šä¸ªå€¼é›†ä¸­è¿›è¡Œæ‰«æï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p></li></ul></li></ul><p>é¢„è¯» æœ¬æ¥æ˜¯ä¸ªå¥½äº‹å„¿ï¼Œå¦‚æœé¢„è¯»åˆ° Buffer Pool ä¸­çš„é¡µæˆåŠŸçš„è¢«ä½¿ç”¨åˆ°ï¼Œé‚£å°±å¯ä»¥æå¤§çš„æé«˜è¯­å¥æ‰§ è¡Œçš„æ•ˆç‡ã€‚å¯æ˜¯å¦‚æœç”¨ä¸åˆ°å‘¢ï¼Ÿè¿™äº›é¢„è¯»çš„é¡µéƒ½ä¼šæ”¾åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶ Buffer Pool çš„ å®¹é‡ä¸å¤ªå¤§è€Œä¸”å¾ˆå¤šé¢„è¯»çš„é¡µé¢éƒ½æ²¡æœ‰ç”¨åˆ°çš„è¯ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤„åœ¨ LRUé“¾è¡¨ å°¾éƒ¨çš„ä¸€äº›ç¼“å­˜é¡µä¼šå¾ˆå¿«çš„ è¢«æ·˜æ±°æ‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ <strong>åŠ£å¸é©±é€è‰¯å¸ ï¼Œä¼šå¤§å¤§é™ä½ç¼“å­˜å‘½ä¸­ç‡ã€‚</strong></p><ul><li><strong>æƒ…å†µäºŒï¼šéœ€è¦æ‰«æå…¨è¡¨çš„æŸ¥è¯¢è¯­å¥â€“Buffer Pool æ±¡æŸ“</strong></li></ul><p>â€‹æ„å‘³ç€å°†è®¿é—®åˆ°è¯¥è¡¨æ‰€åœ¨çš„æ‰€æœ‰é¡µï¼å‡è®¾è¿™ä¸ªè¡¨ä¸­è®°å½•éå¸¸å¤šçš„è¯ï¼Œé‚£è¯¥è¡¨ä¼šå ç”¨ç‰¹ åˆ«å¤šçš„ é¡µ ï¼Œå½“éœ€è¦è®¿é—®è¿™äº›é¡µæ—¶ï¼Œä¼šæŠŠå®ƒä»¬ç»Ÿç»Ÿéƒ½åŠ è½½åˆ° Buffer Pool ä¸­ï¼Œç›¸å½“äº Buffer Pool çš„ä¸œè¥¿å…¨éƒ¨æ¢ä¸€éï¼ŒåŸæœ¬åœ¨æŸ¥è¯¢çš„é¡µï¼Œä¹Ÿè¢«æ›¿æ¢å‡ºå»äº†ï¼Œä¹Ÿéœ€è¦å†æ¬¡æŸ¥è¯¢ï¼Œ<strong>åˆå¾—æ‰§è¡Œä¸€æ¬¡ä»ç£ç›˜åŠ è½½åˆ° Buffer Pool çš„æ“ä½œã€‚è€Œè¿™ç§å…¨è¡¨æ‰«æçš„è¯­å¥æ‰§è¡Œçš„é¢‘ç‡ä¹Ÿä¸é«˜ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¦æŠŠ Buffer Pool ä¸­çš„ç¼“å­˜é¡µæ¢ä¸€æ¬¡è¡€ï¼Œè¿™ ä¸¥é‡çš„å½±å“åˆ°å…¶ä»–æŸ¥è¯¢å¯¹ Buffer Pool çš„ä½¿ç”¨ï¼Œä»è€Œå¤§å¤§é™ä½äº†ç¼“å­˜å‘½ä¸­ç‡ã€‚</strong></p><p>æ€»ç»“ä¸€ä¸‹ä¸Šè¾¹è¯´çš„å¯èƒ½é™ä½ Buffer Pool çš„ä¸¤ç§æƒ…å†µï¼š</p><ul><li>åŠ è½½åˆ° Buffer Pool ä¸­çš„é¡µä¸ä¸€å®šè¢«ç”¨åˆ°ã€‚</li><li>å¦‚æœéå¸¸å¤šçš„ä½¿ç”¨é¢‘ç‡åä½çš„é¡µè¢«åŒæ—¶åŠ è½½åˆ° Buffer Pool æ—¶ï¼Œå¯èƒ½ä¼šæŠŠé‚£äº›ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„é¡µä» Buffer Pool ä¸­æ·˜æ±°æ‰ã€‚</li></ul><p>å› ä¸ºæœ‰è¿™ä¸¤ç§æƒ…å†µçš„å­˜åœ¨ï¼ŒInnoDB æŠŠè¿™ä¸ª LRUé“¾è¡¨ æŒ‰ç…§ä¸€å®šæ¯”ä¾‹åˆ†æˆä¸¤æˆªï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>ä¸€éƒ¨åˆ†å­˜å‚¨ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„ç¼“å­˜é¡µï¼Œæ‰€ä»¥è¿™ä¸€éƒ¨åˆ†é“¾è¡¨ä¹Ÿå«åš çƒ­æ•°æ® ï¼Œæˆ–è€…ç§° youngåŒºåŸŸ ã€‚</li><li>å¦ä¸€éƒ¨åˆ†å­˜å‚¨ä½¿ç”¨é¢‘ç‡ä¸æ˜¯å¾ˆé«˜çš„ç¼“å­˜é¡µï¼Œæ‰€ä»¥è¿™ä¸€éƒ¨åˆ†é“¾è¡¨ä¹Ÿå«åš å†·æ•°æ® ï¼Œæˆ–è€…ç§° oldåŒºåŸŸ ã€‚</li></ul><p><img src="HTTPs://zdwtop.cn/blog/image-20230323114021086.png" alt="image-20230323114021086"></p><p>æˆ‘ä»¬æ˜¯æŒ‰ç…§æŸä¸ªæ¯”ä¾‹å°†LRUé“¾è¡¨åˆ†æˆä¸¤åŠçš„ï¼Œä¸æ˜¯æŸäº›èŠ‚ç‚¹å›ºå®šæ˜¯youngåŒºåŸŸçš„ï¼ŒæŸ äº›èŠ‚ç‚¹å›ºå®šæ˜¯oldåŒºåŸŸçš„ï¼Œéšç€ç¨‹åºçš„è¿è¡Œï¼ŒæŸä¸ªèŠ‚ç‚¹æ‰€å±çš„åŒºåŸŸä¹Ÿå¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBçš„oldå’ŒyoungåŒºåŸŸçš„æ¯”ä¾‹ä¸º8:2ã€‚</p><p>æœ‰äº†è¿™ä¸ªè¢«åˆ’åˆ†æˆ young å’Œ old åŒºåŸŸçš„ LRU é“¾è¡¨ä¹‹åï¼Œ InnoDB å°±å¯ä»¥é’ˆå¯¹æˆ‘ä»¬ä¸Šè¾¹æåˆ°çš„ä¸¤ç§å¯èƒ½ é™ä½ç¼“å­˜å‘½ä¸­ç‡çš„æƒ…å†µè¿›è¡Œä¼˜åŒ–äº†ï¼š</p><ul><li>é’ˆå¯¹é¢„è¯»çš„é¡µé¢å¯èƒ½ä¸è¿›è¡Œåç»­è®¿æƒ…å†µçš„ä¼˜åŒ–</li></ul><p><font color="red"><strong>å½“ç£ç›˜ä¸Šçš„æŸä¸ªé¡µé¢åœ¨åˆæ¬¡åŠ è½½åˆ°Buffer Poolä¸­çš„æŸä¸ªç¼“å­˜é¡µæ—¶ï¼Œè¯¥ç¼“å­˜é¡µå¯¹åº” çš„æ§åˆ¶å—ä¼šè¢«æ”¾åˆ°oldåŒºåŸŸçš„å¤´éƒ¨ã€‚</strong></font>è¿™æ ·é’ˆå¯¹é¢„è¯»åˆ° Buffer Pool å´ä¸è¿›è¡Œåç»­è®¿é—®çš„é¡µé¢å°±ä¼šè¢«é€æ¸ä» old åŒºåŸŸé€å‡ºï¼Œè€Œä¸ä¼šå½±å“ young åŒºåŸŸä¸­è¢«ä½¿ç”¨æ¯”è¾ƒé¢‘ç¹çš„ç¼“å­˜é¡µã€‚</p><ul><li>é’ˆå¯¹å…¨è¡¨æ‰«ææ—¶ï¼ŒçŸ­æ—¶é—´å†…è®¿é—®å¤§é‡ä½¿ç”¨é¢‘ç‡éå¸¸ä½çš„é¡µé¢æƒ…å†µçš„ä¼˜åŒ–</li></ul><p>åœ¨å¯¹æŸä¸ªå¤„åœ¨ old åŒºåŸŸçš„ç¼“å­˜é¡µè¿›è¡Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°±åœ¨å®ƒå¯¹åº”çš„æ§åˆ¶å—ä¸­ è®°å½•ä¸‹æ¥è¿™ä¸ªè®¿é—®æ—¶é—´ï¼Œå¦‚æœåç»­çš„è®¿é—®æ—¶é—´ä¸ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…ï¼Œé‚£ä¹ˆè¯¥é¡µé¢å°±ä¸ä¼šè¢« ä»oldåŒºåŸŸç§»åŠ¨åˆ°youngåŒºåŸŸçš„å¤´éƒ¨ï¼Œå¦åˆ™å°†å®ƒç§»åŠ¨åˆ°youngåŒºåŸŸçš„å¤´éƒ¨ã€‚ä¸Šè¿°çš„è¿™ä¸ªé—´éš”æ—¶é—´æ˜¯ç”±ç³»ç»Ÿå˜é‡<code> innodb_old_blocks_time</code> æ§åˆ¶çš„é»˜è®¤å€¼æ˜¯ 1000 ï¼Œå®ƒçš„å•ä½æ˜¯æ¯«ç§’.</p><p><strong>ä¹Ÿå°±æ„å‘³ç€å¯¹äºä»ç£ç›˜ä¸Šè¢«åŠ è½½åˆ° LRU é“¾è¡¨çš„ old åŒºåŸŸçš„æŸä¸ªé¡µæ¥è¯´ï¼Œå¦‚æœç¬¬ä¸€æ¬¡å’Œæœ€åä¸€æ¬¡è®¿é—®è¯¥é¡µé¢çš„æ—¶é—´é—´éš”å°äº 1s ï¼ˆå¾ˆæ˜æ˜¾åœ¨ä¸€æ¬¡ å…¨è¡¨æ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œå¤šæ¬¡è®¿é—®ä¸€ä¸ªé¡µé¢ä¸­çš„æ—¶é—´ä¸ä¼šè¶…è¿‡ 1s ï¼‰ï¼Œé‚£ä¹ˆè¯¥é¡µæ˜¯ä¸ä¼šè¢«åŠ å…¥åˆ° young åŒºåŸŸçš„</strong></p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ­£æ˜¯å› ä¸ºå°† LRU é“¾è¡¨åˆ’åˆ†ä¸º young å’Œ old åŒºåŸŸè¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆæ·»åŠ äº† <code>innodb_old_blocks_time</code> è¿™ä¸ª ç³»ç»Ÿå˜é‡ï¼Œæ‰ä½¿å¾—é¢„è¯»æœºåˆ¶å’Œå…¨è¡¨æ‰«æé€ æˆçš„ç¼“å­˜å‘½ä¸­ç‡é™ä½çš„é—®é¢˜å¾—åˆ°äº†éåˆ¶ï¼Œå› ä¸ºç”¨ä¸åˆ°çš„é¢„è¯»é¡µé¢ä»¥åŠå…¨ è¡¨æ‰«æçš„é¡µé¢éƒ½åªä¼šè¢«æ”¾åˆ° old åŒºåŸŸï¼Œè€Œä¸å½±å“ young åŒºåŸŸä¸­çš„ç¼“å­˜é¡µã€‚</p><h4 id="è¿›ä¸€æ­¥ä¼˜åŒ–LRUé“¾è¡¨">è¿›ä¸€æ­¥ä¼˜åŒ–LRUé“¾è¡¨</h4><p>å¯¹äº young åŒºåŸŸçš„ç¼“å­˜é¡µæ¥è¯´ï¼Œæˆ‘ä»¬æ¯æ¬¡è®¿é—®ä¸€ä¸ªç¼“å­˜é¡µå°±è¦æŠŠå®ƒç§» åŠ¨åˆ° LRUé“¾è¡¨ çš„å¤´éƒ¨ï¼Œè¿™æ ·å¼€é”€å¤ªå¤§å•¦ï¼Œæ¯•ç«Ÿåœ¨ young åŒºåŸŸçš„ç¼“å­˜é¡µéƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½è¢«ç»å¸¸è®¿é—®çš„ã€‚</p><p>ä¸ºäº†é˜²æ­¢lruèŠ‚ç‚¹è¢«é¢‘ç¹æ“ä½œï¼Œè§„å®šäº†<strong>åªæœ‰è¢«è®¿é—®çš„ç¼“å­˜é¡µä½äº young åŒºåŸŸçš„ 1/4 çš„åè¾¹ï¼Œæ‰ä¼šè¢«ç§»åŠ¨åˆ° LRUé“¾è¡¨ å¤´éƒ¨ï¼Œè¿™æ ·å°± å¯ä»¥é™ä½è°ƒæ•´ LRUé“¾è¡¨ çš„é¢‘ç‡ï¼Œä»è€Œæå‡æ€§èƒ½ï¼ˆä¹Ÿå°±æ˜¯è¯´å¦‚æœæŸä¸ªç¼“å­˜é¡µå¯¹åº”çš„èŠ‚ç‚¹åœ¨ young åŒºåŸŸçš„ 1/4 ä¸­ï¼Œ å†æ¬¡è®¿é—®è¯¥ç¼“å­˜é¡µæ—¶ä¹Ÿä¸ä¼šå°†å…¶ç§»åŠ¨åˆ° LRU é“¾è¡¨å¤´éƒ¨ï¼‰</strong></p><p>è¿™äº›æ“ä½œéƒ½æ˜¯ä¸ºäº†<font color="red"><strong>å°½é‡é«˜æ•ˆçš„æé«˜ Buffer Pool çš„ç¼“å­˜å‘½ä¸­ç‡</strong></font></p><h2 id="åˆ·æ–°è„é¡µåˆ°ç£ç›˜">åˆ·æ–°è„é¡µåˆ°ç£ç›˜</h2><p>åå°æœ‰ä¸“é—¨çš„çº¿ç¨‹æ¯éš”ä¸€æ®µæ—¶é—´è´Ÿè´£æŠŠè„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼Œè¿™æ ·å¯ä»¥ä¸å½±å“ç”¨æˆ·çº¿ç¨‹å¤„ç†æ­£å¸¸çš„è¯·æ±‚ã€‚ä¸»è¦æœ‰ä¸¤ç§åˆ·æ–°è·¯å¾„ï¼š</p><ul><li><p><strong>ä» LRUé“¾è¡¨ çš„å†·æ•°æ®ä¸­åˆ·æ–°ä¸€éƒ¨åˆ†é¡µé¢åˆ°ç£ç›˜ã€‚</strong></p><p>åå°çº¿ç¨‹ä¼šå®šæ—¶ä» LRUé“¾è¡¨ å°¾éƒ¨å¼€å§‹æ‰«æä¸€äº›é¡µé¢ï¼Œæ‰«æçš„é¡µé¢æ•°é‡å¯ä»¥é€šè¿‡ç³»ç»Ÿå˜é‡ <code>innodb_lru_scan_depth</code> æ¥æŒ‡å®šï¼Œå¦‚æœä»é‡Œè¾¹å„¿å‘ç°è„é¡µï¼Œä¼šæŠŠå®ƒä»¬åˆ·æ–°åˆ°ç£ç›˜ã€‚è¿™ç§åˆ·æ–°é¡µé¢çš„æ–¹å¼è¢«ç§° ä¹‹ä¸º <strong>BUF_FLUSH_LRU</strong> ã€‚</p></li><li><p><strong>ä» flushé“¾è¡¨ ä¸­åˆ·æ–°ä¸€éƒ¨åˆ†é¡µé¢åˆ°ç£ç›˜ã€‚</strong></p><p>åå°çº¿ç¨‹ä¹Ÿä¼šå®šæ—¶ä» flushé“¾è¡¨ ä¸­åˆ·æ–°ä¸€éƒ¨åˆ†é¡µé¢åˆ°ç£ç›˜ï¼Œåˆ·æ–°çš„é€Ÿç‡å–å†³äºå½“æ—¶ç³»ç»Ÿæ˜¯ä¸æ˜¯å¾ˆç¹å¿™ã€‚è¿™ç§åˆ·æ–°é¡µé¢çš„æ–¹å¼è¢«ç§°ä¹‹ä¸º <strong>BUF_FLUSH_LIST</strong> ã€‚</p></li></ul><p>åœ¨ MySQL InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œåå°ä¸“é—¨çš„çº¿ç¨‹è´Ÿè´£å°†è„æ•°æ®ï¼ˆå³æœªå†™å…¥ç£ç›˜çš„æ•°æ®ï¼‰åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º Checkpointã€‚</p><p>Checkpointï¼šå®šæœŸåœ°å°†ç¼“å†²æ± ä¸­çš„æ‰€æœ‰è„é¡µåˆ·æ–°åˆ°ç£ç›˜ä¸Šï¼Œä»¥é¿å…åœ¨ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶ä¸¢å¤±é‡è¦çš„æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±InnoDBè‡ªåŠ¨å®Œæˆçš„ï¼Œå…¶é¢‘ç‡ç”±<code>innodb_checkpoint_interval</code>å‚æ•°æ§åˆ¶ã€‚</p><p>åœ¨ Checkpoint è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸¤ç§åˆ·æ–°è·¯å¾„ï¼š</p><ul><li><strong>Master thread å†™è·¯å¾„</strong></li></ul><p>Master thread æ˜¯è´Ÿè´£ <strong>LRU List</strong> ç®¡ç†ã€ç¼“å­˜æ± å¤§å°æ§åˆ¶ä»¥åŠå‘¨æœŸæ€§åœ°è§¦å‘ Checkpoint çš„çº¿ç¨‹ã€‚Master thread åœ¨æ‰§è¡Œ Checkpoint çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šå°†è„æ•°æ®å†™å›åˆ° redo log é‡Œé¢ã€‚ç„¶åå°† checkpoint ä¿¡æ¯å†™åˆ° redo log æ–‡ä»¶å¤´éƒ¨ï¼Œå¹¶å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡ log flushã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒInnoDB å¼•æ“ä½¿ç”¨ async IO æ¨¡å‹ï¼Œå› æ­¤ä¸ä¼šé˜»å¡ä¸»è¦çš„ç”¨æˆ·çº¿ç¨‹è¯·æ±‚ã€‚</p><ul><li><strong>Background page cleaner åˆ·è·¯å¾„</strong></li></ul><p>Background page cleaner æ˜¯å¦ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯å¼‚æ­¥æ‰§è¡Œ <strong>Flush</strong> æ“ä½œï¼ˆ**å³å°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼‰ã€‚**æ¯å½“ Master thread æ‰§è¡Œä¸€æ¬¡ Checkpoint æ—¶ï¼Œéƒ½ä¼šé€šçŸ¥ Background page cleaner æ‰§è¡Œ Flushæ“ä½œã€‚åœ¨ Flush è¿‡ç¨‹ä¸­ï¼ŒBackground page cleaner ä¹Ÿæ˜¯é‡‡ç”¨ async IO æ¨¡å‹ï¼Œä¹Ÿä¸ä¼šé˜»å¡ç”¨æˆ·çº¿ç¨‹è¯·æ±‚ã€‚</p><h2 id="æ€»çš„æ¥è¯´ï¼ŒMaster-thread-å†™è·¯å¾„æ˜¯è´Ÿè´£ç®¡ç†è½¦ç«™è¿›å‡ºå£é“é—¸æœºå™¨äººçš„ã€å½±å“ä¾èµ–æ€§æ¯”è¾ƒå¤§çš„é€»è¾‘ï¼Œè€Œ-Background-page-cleaner-åˆ·è·¯å¾„åˆ™æ˜¯è´Ÿè´£æ‰§è¡Œè„é¡µåˆ·æ–°çš„å·¥ä½œï¼Œä¸¤è€…å„è‡ªå‘æŒ¥å…¶æ‰€é•¿ï¼ŒååŒå®Œæˆæ•°æ®åº“è¿ä½œã€‚">æ€»çš„æ¥è¯´ï¼Œ<strong>Master thread å†™è·¯å¾„æ˜¯è´Ÿè´£ç®¡ç†è½¦ç«™è¿›å‡ºå£é“é—¸æœºå™¨äººçš„ã€å½±å“ä¾èµ–æ€§æ¯”è¾ƒå¤§çš„é€»è¾‘ï¼Œè€Œ Background page cleaner åˆ·è·¯å¾„åˆ™æ˜¯è´Ÿè´£æ‰§è¡Œè„é¡µåˆ·æ–°çš„å·¥ä½œï¼Œä¸¤è€…å„è‡ªå‘æŒ¥å…¶æ‰€é•¿ï¼ŒååŒå®Œæˆæ•°æ®åº“è¿ä½œã€‚</strong></h2><h1>è¡¥å……-åå°çº¿ç¨‹</h1><p>åœ¨ MySQL ä¸­ï¼Œä¸åŒçš„åå°çº¿ç¨‹æ‰§è¡Œçš„åˆ·æ–°æˆ–æ¸…ç†æ“ä½œçš„æ—¶é—´é—´éš”æ˜¯ä¸åŒçš„ã€‚ä¸€äº›å¸¸è§çš„åå°çº¿ç¨‹åŠå…¶æ‰§è¡Œå‘¨æœŸå¦‚ä¸‹ï¼š</p><ol><li>åˆ·æ–°çº¿ç¨‹ï¼šåˆ·æ–°ç¼“å†²æ± ä¸­çš„è¢«ä¿®æ”¹è¿‡çš„æ•°æ®åˆ°ç£ç›˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªäº‹åŠ¡æäº¤åéƒ½ä¼šå°†æ—¥å¿—ç¼“å†²åŒºä¸­çš„æ—¥å¿—å†™å…¥ç£ç›˜ã€‚å¯ä»¥é€šè¿‡ <code>innodb_flush_log_at_trx_commit</code> å‚æ•°çš„å€¼æ¥æ§åˆ¶åˆ·æ–°æ—¥å¿—çš„æ—¶é—´ã€‚ï¼ˆå³ 0-æ¯ç§’/1-æ¯æ¬¡æäº¤/2-æ•´ä¸ªäº‹åŠ¡æäº¤åï¼‰ã€‚</li><li>LRU åˆ·æ–°çº¿ç¨‹ï¼šæ ¹æ® InnoDB ç¼“å†²æ± ä½¿ç”¨ç‡å’Œç©ºé—²çŠ¶æ€ï¼Œå®šæœŸå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®åˆ·å›ç£ç›˜ï¼Œä¿è¯ç¼“å†²æ± ä¸­å§‹ç»ˆæœ‰å¯ç”¨çš„ç©ºé—´ä¾›æ–°è¯»å–çš„æ•°æ®ä½¿ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒLRU åˆ·æ–°çº¿ç¨‹æ¯ç§’åˆ·æ–°ä¸€æ¬¡ã€‚</li><li>æ£€æŸ¥ç‚¹æ‰§è¡Œçº¿ç¨‹ï¼šä½¿ç”¨â€œè„é¡µâ€æœºåˆ¶ï¼ˆInnoDB ä¸­æŒ‡æš‚æœªå†™å…¥ç£ç›˜çš„ä¿®æ”¹æ•°æ®é¡µï¼‰ï¼Œå®šæœŸæ‰§è¡Œæ£€æŸ¥ç‚¹æ¥å°†æ‰€æœ‰è„é¡µæŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚æ£€æŸ¥ç‚¹æ‰§è¡Œçº¿ç¨‹çš„æ‰§è¡Œå‘¨æœŸç”±å†…éƒ¨ç®—æ³•æ¥å†³å®šã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;è°ƒèŠ‚ç£ç›˜å’ŒCPUçš„çŸ›ç›¾-InnoDBçš„Buffer Pool&lt;/h1&gt;
&lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦æœ‰-Buffer-Poolï¼Ÿ&quot;&gt;ä¸ºä»€ä¹ˆè¦æœ‰ Buffer Poolï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¯¹äºä½¿ç”¨ InnoDB ä½œä¸ºå­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œä¸ç®¡æ˜¯ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®çš„ç´¢å¼•ï¼ˆåŒ…æ‹¬èš ç°‡ç´¢å¼•</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="innodb" scheme="https://eizo01.github.io/tags/innodb/"/>
    
  </entry>
  
  <entry>
    <title>Redisé«˜çº§æ•°æ®ç»“æ„</title>
    <link href="https://eizo01.github.io/posts/c9e7ec61.html"/>
    <id>https://eizo01.github.io/posts/c9e7ec61.html</id>
    <published>2022-11-03T12:00:00.000Z</published>
    <updated>2023-03-18T14:08:50.721Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redisé«˜çº§æ•°æ®ç»“æ„"><a href="#Redisé«˜çº§æ•°æ®ç»“æ„" class="headerlink" title="Redisé«˜çº§æ•°æ®ç»“æ„"></a>Redisé«˜çº§æ•°æ®ç»“æ„</h2><h3 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h3><p>ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶(ä½)ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ1ä¸ªå­—èŠ‚ç­‰äº8ä½ï¼Œä¾‹å¦‚â€œbigâ€å­—ç¬¦ä¸²æ˜¯ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼Œä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤º,â€œbigâ€åˆ†åˆ«å¯¹åº”çš„ASCIIç åˆ†åˆ«æ˜¯98ã€105ã€103ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯01100010ã€01101001å’Œ 01100111ã€‚</p><p><img src="https://zdwtop.cn/blog/bitmap.png" alt="img"></p><p>è®¸å¤šå¼€å‘è¯­è¨€éƒ½æä¾›äº†æ“ä½œä½çš„åŠŸèƒ½ï¼Œåˆç†åœ°ä½¿ç”¨ä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚Redisæä¾›äº†Bitmapsè¿™ä¸ªâ€œæ•°æ®ç»“æ„â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œã€‚æŠŠæ•°æ®ç»“æ„åŠ ä¸Šå¼•å·ä¸»è¦å› ä¸º:</p><p>Bitmap æœ¬èº«æ˜¯ç”¨ String ç±»å‹ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„å®ç°çš„ä¸€ç§ç»Ÿè®¡äºŒå€¼çŠ¶æ€çš„æ•°æ®ç±»å‹ã€‚</p><p>String ç±»å‹æ˜¯ä¼šä¿å­˜ä¸ºäºŒè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥ï¼ŒRedis å°±æŠŠå­—èŠ‚æ•°ç»„çš„æ¯ä¸ª bit ä½åˆ©ç”¨èµ·æ¥ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„äºŒå€¼çŠ¶æ€ï¼Œä½ å¯ä»¥æŠŠ Bitmap çœ‹ä½œæ˜¯ä¸€ä¸ª bit æ•°ç»„ã€‚</p><h4 id="setbit-è®¾ç½®å€¼"><a href="#setbit-è®¾ç½®å€¼" class="headerlink" title="setbit è®¾ç½®å€¼"></a>setbit è®¾ç½®å€¼</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setbit key <span class="built_in">offset</span> value</span><br></pre></td></tr></table></figure><p>è®¾ç½®é”®çš„ç¬¬ offset ä¸ªä½çš„å€¼(ä»0ç®—èµ·)ã€‚</p><p>å‡è®¾ç°åœ¨æœ‰20ä¸ªç”¨æˆ·ï¼Œuserid=0,2,4,6,8çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œå­˜å‚¨é”®åä¸ºæ—¥æœŸã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/faf895f88aa940ea854dba440b8030e7.png" alt="image.png"></p><h4 id="getbit-è·å–å€¼"><a href="#getbit-è·å–å€¼" class="headerlink" title="getbit è·å–å€¼"></a>getbit è·å–å€¼</h4><p><code>getbit key offset</code></p><p>è·å–é”®çš„ç¬¬ offsetä½çš„å€¼(ä»0å¼€å§‹ç®—)ï¼Œæ¯”å¦‚<strong>è·å–userid=8çš„ç”¨æˆ·æ˜¯å¦åœ¨2022ï¼ˆå¹´/è¿™å¤©ï¼‰è®¿é—®è¿‡,è¿”å›0è¯´æ˜æ²¡æœ‰è®¿é—®è¿‡:</strong></p><p>å½“ç„¶offsetæ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿä¼šè¿”å›0ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/a32b45af412f4ab6a0345447cd7c4ea7.png" alt="image.png"></p><h4 id="bitcount-è·å–BitmapsæŒ‡å®šèŒƒå›´å€¼ä¸º1çš„ä¸ªæ•°"><a href="#bitcount-è·å–BitmapsæŒ‡å®šèŒƒå›´å€¼ä¸º1çš„ä¸ªæ•°" class="headerlink" title="bitcount è·å–BitmapsæŒ‡å®šèŒƒå›´å€¼ä¸º1çš„ä¸ªæ•°"></a>bitcount è·å–BitmapsæŒ‡å®šèŒƒå›´å€¼ä¸º1çš„ä¸ªæ•°</h4><p><code>bitcount [start] [end]</code></p><p>ä¸‹é¢æ“ä½œè®¡ç®—26å·å’Œ27å·è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°é‡</p><p><strong>[start]å’Œ[end]ä»£è¡¨èµ·å§‹å’Œç»“æŸå­—èŠ‚æ•°</strong></p><p><img src="HTTPs://zdwtop.cn/blog/6f10ab793dfa4e4bb9cc297344544f17.png" alt="image.png"></p><h4 id="bitop-Bitmaps-é—´çš„è¿ç®—"><a href="#bitop-Bitmaps-é—´çš„è¿ç®—" class="headerlink" title="bitop Bitmaps é—´çš„è¿ç®—"></a>bitop Bitmaps é—´çš„è¿ç®—</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># BitMapé—´çš„è¿ç®—</span><br><span class="line"># operations ä½ç§»æ“ä½œç¬¦ï¼Œæšä¸¾å€¼</span><br><span class="line">  <span class="keyword">AND</span> ä¸è¿ç®— <span class="operator">&amp;</span></span><br><span class="line">  <span class="keyword">OR</span> æˆ–è¿ç®— <span class="operator">|</span></span><br><span class="line">  XOR å¼‚æˆ– <span class="operator">^</span></span><br><span class="line">  <span class="keyword">NOT</span> å–å <span class="operator">~</span></span><br><span class="line"># <span class="keyword">result</span> è®¡ç®—çš„ç»“æœï¼Œä¼šå­˜å‚¨åœ¨è¯¥keyä¸­</span><br><span class="line"># key1 â€¦ keyn å‚ä¸è¿ç®—çš„keyï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç©ºæ ¼åˆ†å‰²ï¼Œ<span class="keyword">not</span>è¿ç®—åªèƒ½ä¸€ä¸ªkey</span><br><span class="line"># å½“ BITOP å¤„ç†ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²æ—¶ï¼Œè¾ƒçŸ­çš„é‚£ä¸ªå­—ç¬¦ä¸²æ‰€ç¼ºå°‘çš„éƒ¨åˆ†ä¼šè¢«çœ‹ä½œ <span class="number">0</span>ã€‚è¿”å›å€¼æ˜¯ä¿å­˜åˆ° destkey çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚byteä¸ºå•ä½ï¼‰ï¼Œå’Œè¾“å…¥ key ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²é•¿åº¦ç›¸ç­‰ã€‚</span><br><span class="line">BITOP [operations] [<span class="keyword">result</span>] [key1] [keynâ€¦]</span><br><span class="line"></span><br><span class="line"># è¿”å›æŒ‡å®škeyä¸­ç¬¬ä¸€æ¬¡å‡ºç°æŒ‡å®š<span class="keyword">value</span>(<span class="number">0</span><span class="operator">/</span><span class="number">1</span>)çš„ä½ç½®</span><br><span class="line">BITPOS [key] [<span class="keyword">value</span>]</span><br></pre></td></tr></table></figure><p>bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œå®ƒå¯ä»¥åšå¤šä¸ªBitmaps çš„ and(äº¤é›†)or(å¹¶é›†)not(é)xor(å¼‚æˆ–ï¼‰æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚</p><h4 id="bitpos"><a href="#bitpos" class="headerlink" title="bitpos"></a>bitpos</h4><p>-è®¡ç®—Bitmapsä¸­ç¬¬ä¸€ä¸ªå€¼ä¸ºtargetBit çš„åç§»é‡</p><p><code>bitpos key targetBit [start] [end]</code></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œbitopsæœ‰ä¸¤ä¸ªé€‰é¡¹[start]å’Œ[end]ï¼Œåˆ†åˆ«ä»£è¡¨èµ·å§‹å­—èŠ‚å’Œç»“æŸå­—èŠ‚ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/6cc67c513009442a9ecf29beed3188af.png" alt="image.png"></p><h4 id="Bitmapsä¼˜åŠ¿"><a href="#Bitmapsä¼˜åŠ¿" class="headerlink" title="Bitmapsä¼˜åŠ¿"></a>Bitmapsä¼˜åŠ¿</h4><p>å‡è®¾ç½‘ç«™æœ‰1äº¿ç”¨æˆ·ï¼Œæ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰5åƒä¸‡ï¼Œå¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’Œ Bitmapsåˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·ï¼Œå¾ˆæ˜æ˜¾ï¼Œå‡å¦‚ç”¨æˆ·idæ˜¯Longå‹ï¼Œ64ä½ï¼Œåˆ™é›†åˆç±»å‹å æ®çš„ç©ºé—´ä¸º64ä½x50 000 000= 400MBï¼Œè€ŒBitmapsåˆ™éœ€è¦1ä½Ã—100 000 000=12.5MBï¼Œå¯è§Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ã€‚</p><h5 id="é¢è¯•é¢˜å’Œåœºæ™¯"><a href="#é¢è¯•é¢˜å’Œåœºæ™¯" class="headerlink" title="é¢è¯•é¢˜å’Œåœºæ™¯"></a>é¢è¯•é¢˜å’Œåœºæ™¯</h5><p>1ã€ç›®å‰æœ‰10äº¿æ•°é‡çš„è‡ªç„¶æ•°ï¼Œä¹±åºæ’åˆ—ï¼Œéœ€è¦å¯¹å…¶æ’åºã€‚é™åˆ¶æ¡ä»¶-åœ¨32ä½æœºå™¨ä¸Šé¢å®Œæˆï¼Œå†…å­˜é™åˆ¶ä¸º 2Gã€‚å¦‚ä½•å®Œæˆï¼Ÿ</p><p>2ã€å¦‚ä½•å¿«é€Ÿåœ¨äº¿çº§é»‘åå•ä¸­å¿«é€Ÿå®šä½URLåœ°å€æ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Ÿ(æ¯æ¡URLå¹³å‡64å­—èŠ‚)</p><p>3ã€éœ€è¦è¿›è¡Œç”¨æˆ·ç™»é™†è¡Œä¸ºåˆ†æï¼Œæ¥ç¡®å®šç”¨æˆ·çš„æ´»è·ƒæƒ…å†µï¼Ÿ</p><p>4ã€ç½‘ç»œçˆ¬è™«-å¦‚ä½•åˆ¤æ–­URLæ˜¯å¦è¢«çˆ¬è¿‡ï¼Ÿ</p><p>5ã€å¿«é€Ÿå®šä½ç”¨æˆ·å±æ€§ï¼ˆé»‘åå•ã€ç™½åå•ç­‰ï¼‰</p><p>6ã€æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå¦‚ä½•é¿å…å¤§é‡çš„æ— æ•ˆIOï¼Ÿ</p><h5 id="ä¼ ç»Ÿæ•°æ®ç»“æ„çš„ä¸è¶³"><a href="#ä¼ ç»Ÿæ•°æ®ç»“æ„çš„ä¸è¶³" class="headerlink" title="ä¼ ç»Ÿæ•°æ®ç»“æ„çš„ä¸è¶³"></a>ä¼ ç»Ÿæ•°æ®ç»“æ„çš„ä¸è¶³</h5><p>å½“ç„¶æœ‰äººä¼šæƒ³ï¼Œæˆ‘ç›´æ¥å°†ç½‘é¡µURLå­˜å…¥æ•°æ®åº“è¿›è¡ŒæŸ¥æ‰¾ä¸å°±å¥½äº†ï¼Œæˆ–è€…å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨è¿›è¡ŒæŸ¥æ‰¾ä¸å°±OKäº†ã€‚</p><p>å½“æ•°æ®é‡å°çš„æ—¶å€™ï¼Œè¿™ä¹ˆæ€è€ƒæ˜¯å¯¹çš„ï¼Œ</p><p>ç¡®å®å¯ä»¥å°†å€¼æ˜ å°„åˆ° HashMap çš„ Keyï¼Œç„¶åå¯ä»¥åœ¨ O(1) çš„æ—¶é—´å¤æ‚åº¦å†…è¿”å›ç»“æœï¼Œæ•ˆç‡å¥‡é«˜ã€‚ä½†æ˜¯ HashMap çš„å®ç°ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œä¾‹å¦‚å­˜å‚¨å®¹é‡å æ¯”é«˜ï¼Œè€ƒè™‘åˆ°è´Ÿè½½å› å­çš„å­˜åœ¨ï¼Œé€šå¸¸ç©ºé—´æ˜¯ä¸èƒ½è¢«ç”¨æ»¡çš„ï¼Œä¸¾ä¸ªä¾‹å­å¦‚æœä¸€ä¸ª1000ä¸‡HashMapï¼ŒKey=Stringï¼ˆé•¿åº¦ä¸è¶…è¿‡16å­—ç¬¦ï¼Œä¸”é‡å¤æ€§æå°ï¼‰ï¼ŒValue=Integerï¼Œä¼šå æ®å¤šå°‘ç©ºé—´å‘¢ï¼Ÿ1.2ä¸ªGã€‚å®é™…ä¸Šï¼Œ1000ä¸‡ä¸ªintå‹ï¼Œåªéœ€è¦40Må·¦å³ç©ºé—´ï¼Œå æ¯”3%ï¼Œ1000ä¸‡ä¸ªIntegerï¼Œéœ€è¦161Må·¦å³ç©ºé—´ï¼Œå æ¯”13.3%ã€‚å¯è§ä¸€æ—¦ä½ çš„å€¼å¾ˆå¤šä¾‹å¦‚ä¸Šäº¿çš„æ—¶å€™ï¼Œé‚£HashMap å æ®çš„å†…å­˜å¤§å°å°±å˜å¾—å¾ˆå¯è§‚äº†ã€‚</p><p>ä½†å¦‚æœæ•´ä¸ªç½‘é¡µé»‘åå•ç³»ç»ŸåŒ…å«100äº¿ä¸ªç½‘é¡µURLï¼Œåœ¨æ•°æ®åº“æŸ¥æ‰¾æ˜¯å¾ˆè´¹æ—¶çš„ï¼Œå¹¶ä¸”å¦‚æœæ¯ä¸ªURLç©ºé—´ä¸º64Bï¼Œé‚£ä¹ˆéœ€è¦å†…å­˜ä¸º640GBï¼Œä¸€èˆ¬çš„æœåŠ¡å™¨å¾ˆéš¾è¾¾åˆ°è¿™ä¸ªéœ€æ±‚ã€‚</p><h2 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h2><h3 id="å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹"><a href="#å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹"></a>å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹</h3><p><strong>1970 å¹´å¸ƒéš†æå‡ºäº†ä¸€ç§å¸ƒéš†è¿‡æ»¤å™¨çš„ç®—æ³•ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚<br>è¿™ç§ç®—æ³•ç”±ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„å’Œä¸€ä¸ª Hash ç®—æ³•ç»„æˆã€‚</strong></p><p>æœ¬è´¨ä¸Šå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ¯”è¾ƒå·§å¦™çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆprobabilistic data structureï¼‰ï¼Œç‰¹ç‚¹æ˜¯é«˜æ•ˆåœ°æ’å…¥å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨æ¥å‘Šè¯‰ä½  â€œæŸæ ·ä¸œè¥¿ä¸€å®šä¸å­˜åœ¨æˆ–è€…å¯èƒ½å­˜åœ¨â€ã€‚</p><p>ç›¸æ¯”äºä¼ ç»Ÿçš„ Listã€Setã€Map ç­‰æ•°æ®ç»“æ„ï¼Œå®ƒæ›´é«˜æ•ˆã€å ç”¨ç©ºé—´æ›´å°‘ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å…¶è¿”å›çš„ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œè€Œä¸æ˜¯ç¡®åˆ‡çš„ã€‚</p><p>å®é™…ä¸Šï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¹¿æ³›åº”ç”¨äºç½‘é¡µé»‘åå•ç³»ç»Ÿã€åƒåœ¾é‚®ä»¶è¿‡æ»¤ç³»ç»Ÿã€çˆ¬è™«ç½‘å€åˆ¤é‡ç³»ç»Ÿç­‰ï¼ŒGoogle è‘—åçš„åˆ†å¸ƒå¼æ•°æ®åº“ Bigtable ä½¿ç”¨äº†å¸ƒéš†è¿‡æ»¤å™¨æ¥æŸ¥æ‰¾ä¸å­˜åœ¨çš„è¡Œæˆ–åˆ—ï¼Œä»¥å‡å°‘ç£ç›˜æŸ¥æ‰¾çš„IOæ¬¡æ•°ï¼ŒGoogle Chromeæµè§ˆå™¨ä½¿ç”¨äº†å¸ƒéš†è¿‡æ»¤å™¨åŠ é€Ÿå®‰å…¨æµè§ˆæœåŠ¡ã€‚</p><p><img src="https://zdwtop.cn/blog/801f60ff2d28436faaaab3007dd7d893.png" alt="image.png"></p><h3 id="å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤é—®é¢˜"><a href="#å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤é—®é¢˜" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤é—®é¢˜"></a>å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤é—®é¢˜</h3><p>Ã˜é€šè¿‡hashè®¡ç®—åœ¨æ•°ç»„ä¸Šä¸ä¸€å®šåœ¨é›†åˆ</p><p>Ã˜æœ¬è´¨æ˜¯hashå†²çª</p><p>Ã˜é€šè¿‡hashè®¡ç®—ä¸åœ¨æ•°ç»„çš„ä¸€å®šä¸åœ¨é›†åˆï¼ˆè¯¯åˆ¤ï¼‰</p><p><img src="https://zdwtop.cn/blog/d31bbeaf5a8742d2b15ce65bbc5a4537.png" alt="image.png"></p><p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong></p><p>å¢å¤§æ•°ç»„(é¢„ä¼°é€‚åˆå€¼)</p><p>å¢åŠ hashå‡½æ•°</p><p><img src="HTTPs://zdwtop.cn/blog/84b1457186f44856b6ad56561ba64229.png" alt="image.png"></p><h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>HyperLogLogå¹¶ä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„(å®é™…ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹)ï¼Œè€Œæ˜¯ä¸€ç§åŸºæ•°ç®—æ³•,é€šè¿‡HyperLogLogå¯ä»¥åˆ©ç”¨æå°çš„å†…å­˜ç©ºé—´å®Œæˆç‹¬ç«‹æ€»æ•°çš„ç»Ÿè®¡ï¼Œæ•°æ®é›†å¯ä»¥æ˜¯IPã€Emailã€IDç­‰ã€‚</p><p>å¦‚æœä½ è´Ÿè´£å¼€å‘ç»´æŠ¤ä¸€ä¸ªå¤§å‹çš„ç½‘ç«™ï¼Œæœ‰ä¸€å¤©äº§å“ç»ç†è¦ç½‘ç«™æ¯ä¸ªç½‘é¡µæ¯å¤©çš„ UV æ•°æ®ï¼Œç„¶åè®©ä½ æ¥å¼€å‘è¿™ä¸ªç»Ÿè®¡æ¨¡å—ï¼Œä½ ä¼šå¦‚ä½•å®ç°ï¼Ÿ</p><p>å¦‚æœç»Ÿè®¡ PV é‚£éå¸¸å¥½åŠï¼Œç»™æ¯ä¸ªç½‘é¡µä¸€ä¸ªç‹¬ç«‹çš„ Redis è®¡æ•°å™¨å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªè®¡æ•°å™¨çš„ key åç¼€åŠ ä¸Šå½“å¤©çš„æ—¥æœŸã€‚è¿™æ ·æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œincrby ä¸€æ¬¡ï¼Œæœ€ç»ˆå°±å¯ä»¥ç»Ÿè®¡å‡ºæ‰€æœ‰çš„ PV æ•°æ®ã€‚</p><p>ä½†æ˜¯ UV ä¸ä¸€æ ·ï¼Œå®ƒè¦å»é‡ï¼ŒåŒä¸€ä¸ªç”¨æˆ·ä¸€å¤©ä¹‹å†…çš„å¤šæ¬¡è®¿é—®è¯·æ±‚åªèƒ½è®¡æ•°ä¸€æ¬¡ã€‚è¿™å°±è¦æ±‚æ¯ä¸€ä¸ªç½‘é¡µè¯·æ±‚éƒ½éœ€è¦å¸¦ä¸Šç”¨æˆ·çš„ IDï¼Œæ— è®ºæ˜¯ç™»é™†ç”¨æˆ·è¿˜æ˜¯æœªç™»é™†ç”¨æˆ·éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€ ID æ¥æ ‡è¯†ã€‚</p><p>ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ä¸ºæ¯ä¸€ä¸ªé¡µé¢ä¸€ä¸ªç‹¬ç«‹çš„ set é›†åˆæ¥å­˜å‚¨æ‰€æœ‰å½“å¤©è®¿é—®è¿‡æ­¤é¡µé¢çš„ç”¨æˆ· IDã€‚å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ sadd å°†ç”¨æˆ· ID å¡è¿›å»å°±å¯ä»¥äº†ã€‚é€šè¿‡ scard å¯ä»¥å–å‡ºè¿™ä¸ªé›†åˆçš„å¤§å°ï¼Œè¿™ä¸ªæ•°å­—å°±æ˜¯è¿™ä¸ªé¡µé¢çš„ UV æ•°æ®ã€‚</p><p>ç™¾ä¸‡çº§ç”¨æˆ·è®¿é—®ç½‘ç«™</p><p><img src="HTTPs://zdwtop.cn/blog/494d8e7c3cbc464db90935208fa20d44.png" alt="image.png"></p><h3 id="æ“ä½œå‘½ä»¤"><a href="#æ“ä½œå‘½ä»¤" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h3><p>HyperLogLogæä¾›äº†3ä¸ªå‘½ä»¤: pfaddã€pfcountã€pfmergeã€‚</p><h4 id="pfadd"><a href="#pfadd" class="headerlink" title="pfadd"></a>pfadd</h4><p><code>pfadd key element [element â€¦]</code></p><p>pfaddç”¨äºå‘HyperLogLog æ·»åŠ å…ƒç´ ,å¦‚æœæ·»åŠ æˆåŠŸè¿”å›1:</p><p>pfadd u-9-30 u1 u2 u3 u4 u5 u6 u7 u8</p><p><img src="HTTPs://zdwtop.cn/blog/c6de0b04ae7b43e69528a24301d7920b.png" alt="image.png"></p><h4 id="pfcount"><a href="#pfcount" class="headerlink" title="pfcount"></a>pfcount</h4><p><code>pfcount key [key â€¦]</code></p><p>pfcountç”¨äºè®¡ç®—ä¸€ä¸ªæˆ–å¤šä¸ªHyperLogLogçš„ç‹¬ç«‹æ€»æ•°ï¼Œä¾‹å¦‚u-9-30 çš„ç‹¬ç«‹æ€»æ•°ä¸º8:</p><p><img src="HTTPs://zdwtop.cn/blog/a86c5c198cef4717864fd2794eaf3624.png" alt="image.png"></p><p>å¦‚æœæ­¤æ—¶å‘æ’å…¥ä¸€äº›ç”¨æˆ·ï¼Œç”¨æˆ·å¹¶ä¸”æœ‰é‡å¤</p><p><img src="HTTPs://zdwtop.cn/blog/689ddb0df4164a98bb7d078e45af9fda.png" alt="image.png"></p><p>å¦‚æœæˆ‘ä»¬ç»§ç»­å¾€é‡Œé¢æ’å…¥æ•°æ®ï¼Œæ¯”å¦‚æ’å…¥100ä¸‡æ¡ç”¨æˆ·è®°å½•ã€‚å†…å­˜å¢åŠ éå¸¸å°‘ï¼Œä½†æ˜¯pfcount çš„ç»Ÿè®¡ç»“æœä¼šå‡ºç°è¯¯å·®ã€‚</p><h4 id="pfmerge"><a href="#pfmerge" class="headerlink" title="pfmerge"></a>pfmerge</h4><p><code>pfmerge destkey sourcekey [sourcekey ... ]</code></p><p>pfmergeå¯ä»¥æ±‚å‡ºå¤šä¸ªHyperLogLogçš„å¹¶é›†å¹¶èµ‹å€¼ç»™destkeyï¼Œè¯·è‡ªè¡Œæµ‹è¯•ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒHyperLogLogå†…å­˜å ç”¨é‡å°å¾—æƒŠäººï¼Œä½†æ˜¯ç”¨å¦‚æ­¤å°ç©ºé—´æ¥ä¼°ç®—å¦‚æ­¤å·¨å¤§çš„æ•°æ®ï¼Œå¿…ç„¶ä¸æ˜¯100%çš„æ­£ç¡®ï¼Œå…¶ä¸­ä¸€å®šå­˜åœ¨è¯¯å·®ç‡ã€‚å‰é¢è¯´è¿‡ï¼ŒRediså®˜æ–¹ç»™å‡ºçš„æ•°å­—æ˜¯0.81%çš„å¤±è¯¯ç‡ã€‚</p><h3 id="åŸç†æ¦‚è¿°"><a href="#åŸç†æ¦‚è¿°" class="headerlink" title="åŸç†æ¦‚è¿°"></a>åŸç†æ¦‚è¿°</h3><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>HyperLogLogåŸºäºæ¦‚ç‡è®ºä¸­ä¼¯åŠªåˆ©è¯•éªŒå¹¶ç»“åˆäº†æå¤§ä¼¼ç„¶ä¼°ç®—æ–¹æ³•ï¼Œå¹¶åšäº†åˆ†æ¡¶ä¼˜åŒ–ã€‚</p><p>å®é™…ä¸Šç›®å‰è¿˜æ²¡æœ‰å‘ç°æ›´å¥½çš„åœ¨å¤§æ•°æ®åœºæ™¯ä¸­å‡†ç¡®è®¡ç®—åŸºæ•°çš„é«˜æ•ˆç®—æ³•ï¼Œå› æ­¤åœ¨ä¸è¿½æ±‚ç»å¯¹å‡†ç¡®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ¦‚ç‡ç®—æ³•ç®—æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚æ¦‚ç‡ç®—æ³•ä¸ç›´æ¥å­˜å‚¨æ•°æ®é›†åˆæœ¬èº«ï¼Œé€šè¿‡ä¸€å®šçš„æ¦‚ç‡ç»Ÿè®¡æ–¹æ³•é¢„ä¼°å€¼ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥å¤§å¤§èŠ‚çœå†…å­˜ï¼ŒåŒæ—¶ä¿è¯è¯¯å·®æ§åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ã€‚ç›®å‰ç”¨äºåŸºæ•°è®¡æ•°çš„æ¦‚ç‡ç®—æ³•åŒ…æ‹¬:</p><p>ä¸¾ä¸ªä¾‹å­æ¥ç†è§£HyperLogLog<br>ç®—æ³•ï¼Œæœ‰ä¸€å¤©æç‘¾è€å¸ˆå’Œé©¬è€å¸ˆç©æ‰“èµŒçš„æ¸¸æˆã€‚</p><p>è§„åˆ™å¦‚ä¸‹: æŠ›ç¡¬å¸çš„æ¸¸æˆï¼Œæ¯æ¬¡æŠ›çš„ç¡¬å¸å¯èƒ½æ­£é¢ï¼Œå¯èƒ½åé¢ï¼Œæ²¡å›åˆä¸€ç›´æŠ›ï¼Œç›´åˆ°æ¯å½“æŠ›åˆ°æ­£é¢å›åˆç»“æŸã€‚</p><p>ç„¶åæˆ‘è·Ÿé©¬è€å¸ˆè¯´ï¼ŒæŠ›åˆ°æ­£é¢æœ€é•¿çš„å›åˆç”¨åˆ°äº†7æ¬¡ï¼Œä½ æ¥çŒœä¸€çŒœï¼Œæˆ‘ç”¨åˆ°äº†å¤šå°‘ä¸ªå›åˆåšåˆ°çš„ï¼Ÿ</p><p><img src="https://zdwtop.cn/blog/b908ff160cdd4eed858e76b248fd880e.png" alt="image.png"></p><p>è¿›è¡Œäº†næ¬¡å®éªŒï¼Œæ¯”å¦‚ä¸Šå›¾ï¼š</p><p>ç¬¬ä¸€æ¬¡è¯•éªŒ: æŠ›äº†3æ¬¡æ‰å‡ºç°æ­£é¢ï¼Œæ­¤æ—¶ k=3ï¼Œn=1</p><p>ç¬¬äºŒæ¬¡è¯•éªŒ: æŠ›äº†2æ¬¡æ‰å‡ºç°æ­£é¢ï¼Œæ­¤æ—¶ k=2ï¼Œn=2</p><p>ç¬¬ä¸‰æ¬¡è¯•éªŒ: æŠ›äº†4æ¬¡æ‰å‡ºç°æ­£é¢ï¼Œæ­¤æ—¶ k=4ï¼Œn=3</p><p>â€¦â€¦â€¦â€¦</p><p>ç¬¬n æ¬¡è¯•éªŒï¼šæŠ›äº†7æ¬¡æ‰å‡ºç°æ­£é¢ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼°ç®—ï¼Œk=7</p><p>é©¬è€å¸ˆè¯´å¤§æ¦‚ä½ æŠ›äº†128ä¸ªå›åˆã€‚è¿™ä¸ªæ˜¯æ€ä¹ˆç®—çš„ã€‚</p><p>kæ˜¯æ¯å›åˆæŠ›åˆ°1æ‰€ç”¨çš„æ¬¡æ•°ï¼Œæˆ‘ä»¬å·²çŸ¥çš„æ˜¯æœ€å¤§çš„kå€¼ï¼Œå¯ä»¥ç”¨kmaxè¡¨ç¤ºã€‚ç”±äºæ¯æ¬¡æŠ›ç¡¬å¸çš„ç»“æœåªæœ‰0å’Œ1ä¸¤ç§æƒ…å†µï¼Œå› æ­¤ï¼Œèƒ½å¤Ÿæ¨æµ‹å‡ºkmaxåœ¨ä»»æ„å›åˆå‡ºç°çš„æ¦‚ç‡ ï¼Œå¹¶ç”±kmaxç»“åˆæå¤§ä¼¼ç„¶ä¼°ç®—çš„æ–¹æ³•æ¨æµ‹å‡ºnçš„æ¬¡æ•°n =<br>2^(k_max) ã€‚æ¦‚ç‡å­¦æŠŠè¿™ç§é—®é¢˜å«åšä¼¯åŠªåˆ©å®éªŒã€‚</p><p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œè¿™ç§æœ¬èº«å°±æ˜¯æ¦‚ç‡çš„é—®é¢˜ï¼Œæˆ‘è·Ÿé©¬è€å¸ˆè¯´ï¼Œæˆ‘åªç”¨åˆ°12æ¬¡ï¼Œå¹¶ä¸”æœ‰è§†é¢‘ä¸ºè¯ã€‚</p><p>æ‰€ä»¥è¿™ç§é¢„ä¼°æ–¹æ³•å­˜åœ¨è¾ƒå¤§è¯¯å·®ï¼Œä¸ºäº†æ”¹å–„è¯¯å·®æƒ…å†µï¼ŒHLLä¸­å¼•å…¥åˆ†æ¡¶å¹³å‡çš„æ¦‚å¿µã€‚</p><p>åŒæ ·ä¸¾æŠ›ç¡¬å¸çš„ä¾‹å­ï¼Œå¦‚æœåªæœ‰ä¸€ç»„æŠ›ç¡¬å¸å®éªŒï¼Œæ˜¾ç„¶æ ¹æ®å…¬å¼æ¨å¯¼å¾—åˆ°çš„å®éªŒæ¬¡æ•°çš„ä¼°è®¡è¯¯å·®è¾ƒå¤§ï¼›å¦‚æœ100ä¸ªç»„åŒæ—¶è¿›è¡ŒæŠ›ç¡¬å¸å®éªŒï¼Œå—è¿æ°”å½±å“çš„æ¦‚ç‡å°±å¾ˆä½äº†ï¼Œæ¯ç»„åˆ†åˆ«è¿›è¡Œå¤šæ¬¡æŠ›ç¡¬å¸å®éªŒï¼Œå¹¶ä¸ŠæŠ¥å„è‡ªå®éªŒè¿‡ç¨‹ä¸­æŠ›åˆ°æ­£é¢çš„æŠ›æ·æ¬¡æ•°çš„æœ€å¤§å€¼ï¼Œå°±èƒ½æ ¹æ®100ç»„çš„å¹³å‡å€¼é¢„ä¼°æ•´ä½“çš„å®éªŒæ¬¡æ•°äº†ã€‚</p><p>åˆ†æ¡¶å¹³å‡çš„åŸºæœ¬åŸç†æ˜¯å°†ç»Ÿè®¡æ•°æ®åˆ’åˆ†ä¸ºmä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶åˆ†åˆ«ç»Ÿè®¡å„è‡ªçš„kmax,å¹¶èƒ½å¾—åˆ°å„è‡ªçš„åŸºæ•°é¢„ä¼°å€¼ï¼Œæœ€ç»ˆå¯¹è¿™äº›åŸºæ•°é¢„ä¼°å€¼æ±‚å¹³å‡å¾—åˆ°æ•´ä½“çš„åŸºæ•°ä¼°è®¡å€¼ã€‚LLCä¸­ä½¿ç”¨å‡ ä½•å¹³å‡æ•°é¢„ä¼°æ•´ä½“çš„åŸºæ•°å€¼ï¼Œä½†æ˜¯å½“ç»Ÿè®¡æ•°æ®é‡è¾ƒå°æ—¶è¯¯å·®è¾ƒå¤§ï¼›HLLåœ¨LLCåŸºç¡€ä¸Šåšäº†æ”¹è¿›ï¼Œ<strong>é‡‡ç”¨è°ƒå’Œå¹³å‡æ•°è¿‡æ»¤æ‰ä¸å¥åº·çš„ç»Ÿè®¡å€¼</strong>ã€‚</p><p>ä»€ä¹ˆå«è°ƒå’Œå¹³å‡æ•°å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­</p><p>æ±‚å¹³å‡å·¥èµ„ï¼šAçš„æ˜¯1000/æœˆï¼ŒBçš„30000/æœˆã€‚é‡‡ç”¨å¹³å‡æ•°çš„æ–¹å¼å°±æ˜¯ï¼š<br>(1000 + 30000) / 2 = 15500</p><p>é‡‡ç”¨è°ƒå’Œå¹³å‡æ•°çš„æ–¹å¼å°±æ˜¯ï¼š<br>2/(1/1000 + 1/30000) â‰ˆ 1935.484</p><p>å¯è§è°ƒå’Œå¹³å‡æ•°æ¯”å¹³å‡æ•°çš„å¥½å¤„å°±æ˜¯ä¸å®¹æ˜“å—åˆ°å¤§çš„æ•°å€¼çš„å½±å“ï¼Œæ¯”å¹³å‡æ•°çš„æ•ˆæœæ˜¯è¦æ›´å¥½çš„ã€‚</p><h4 id="ç»“åˆRedisçš„å®ç°ç†è§£åŸç†"><a href="#ç»“åˆRedisçš„å®ç°ç†è§£åŸç†" class="headerlink" title="ç»“åˆRedisçš„å®ç°ç†è§£åŸç†"></a>ç»“åˆRedisçš„å®ç°ç†è§£åŸç†</h4><p>ç°åœ¨æˆ‘ä»¬å’Œå‰é¢çš„ä¸šåŠ¡åœºæ™¯è¿›è¡ŒæŒ‚é’©ï¼šç»Ÿè®¡ç½‘é¡µæ¯å¤©çš„ UV æ•°æ®ã€‚</p><h4 id="1-è½¬ä¸ºæ¯”ç‰¹ä¸²"><a href="#1-è½¬ä¸ºæ¯”ç‰¹ä¸²" class="headerlink" title="1.è½¬ä¸ºæ¯”ç‰¹ä¸²"></a><strong>1.è½¬ä¸ºæ¯”ç‰¹ä¸²</strong></h4><p>é€šè¿‡hashå‡½æ•°ï¼Œå°†æ•°æ®è½¬ä¸ºäºŒè¿›åˆ¶çš„æ¯”ç‰¹ä¸²ï¼Œä¾‹å¦‚è¾“å…¥5ï¼Œä¾¿è½¬ä¸ºï¼š101ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·è½¬åŒ–å‘¢ï¼Ÿ</p><p>æ˜¯å› ä¸ºè¦å’ŒæŠ›ç¡¬å¸å¯¹åº”ä¸Šï¼Œæ¯”ç‰¹ä¸²ä¸­ï¼Œ0 ä»£è¡¨äº†åé¢ï¼Œ1 ä»£è¡¨äº†æ­£é¢ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®æœ€ç»ˆè¢«è½¬åŒ–äº† 10010000ï¼Œé‚£ä¹ˆä»å³å¾€å·¦ï¼Œä»ä½ä½å¾€é«˜ä½çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œé¦–æ¬¡å‡ºç° 1 çš„æ—¶å€™ï¼Œå°±æ˜¯æ­£é¢ã€‚</p><p>é‚£ä¹ˆåŸºäºä¸Šé¢çš„ä¼°ç®—ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šæ¬¡æŠ›ç¡¬å¸å®éªŒçš„æœ€å¤§æŠ›åˆ°æ­£é¢çš„æ¬¡æ•°æ¥é¢„ä¼°æ€»å…±è¿›è¡Œäº†å¤šå°‘æ¬¡å®éªŒï¼ŒåŒæ ·ä¹Ÿå°±å¯ä»¥æ ¹æ®å­˜å…¥æ•°æ®ä¸­ï¼Œè½¬åŒ–åçš„å‡ºç°äº† 1 çš„æœ€å¤§çš„ä½ç½® k_max æ¥ä¼°ç®—å­˜å…¥äº†å¤šå°‘æ•°æ®ã€‚</p><h4 id="2-åˆ†æ¡¶"><a href="#2-åˆ†æ¡¶" class="headerlink" title="2.åˆ†æ¡¶"></a><strong>2.åˆ†æ¡¶</strong></h4><p>åˆ†æ¡¶å°±æ˜¯åˆ†å¤šå°‘è½®ã€‚æŠ½è±¡åˆ°è®¡ç®—æœºå­˜å‚¨ä¸­å»ï¼Œå°±æ˜¯å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä»¥å•ä½æ˜¯æ¯”ç‰¹(bit)ï¼Œé•¿åº¦ä¸º L çš„å¤§æ•°ç»„ S ï¼Œå°† S å¹³å‡åˆ†ä¸º m ç»„ï¼Œæ³¨æ„è¿™ä¸ª m ç»„ï¼Œå°±æ˜¯å¯¹åº”å¤šå°‘è½®ï¼Œç„¶åæ¯ç»„æ‰€å æœ‰çš„æ¯”ç‰¹ä¸ªæ•°æ˜¯å¹³å‡çš„ï¼Œè®¾ä¸º Pã€‚å®¹æ˜“å¾—å‡ºä¸‹é¢çš„å…³ç³»ï¼š</p><p>æ¯”å¦‚æœ‰4ä¸ªæ¡¶çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥æˆªå–ä½2ä½ä½œä¸ºåˆ†æ¡¶çš„ä¾æ®ã€‚</p><p>æ¯”å¦‚</p><p>10010000   è¿›å…¥0å·æ¡¶</p><p>10010001   è¿›å…¥1å·æ¡¶</p><p>10010010   è¿›å…¥2å·æ¡¶</p><p>10010011   è¿›å…¥3å·æ¡¶</p><h5 id="Redis-ä¸­çš„-HyperLogLog-å®ç°"><a href="#Redis-ä¸­çš„-HyperLogLog-å®ç°" class="headerlink" title="Redis ä¸­çš„ HyperLogLog å®ç°"></a>Redis ä¸­çš„ HyperLogLog å®ç°</h5><p><strong>pfadd</strong></p><p><img src="HTTPs://zdwtop.cn/blog/116ef8fb48584cc5910184aaf50092a1.png" alt="image.png"></p><p>å½“æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œlijinè¿™ä¸ªå­—ç¬¦ä¸²å°±ä¼šè¢«è½¬åŒ–æˆ64ä¸ªbitçš„äºŒè¿›åˆ¶æ¯”ç‰¹ä¸²ã€‚</p><p>0010â€¦.0001  64ä½</p><p>ç„¶ååœ¨Redisä¸­è¦åˆ†åˆ°16384ä¸ªæ¡¶ä¸­ï¼ˆä¸ºä»€ä¹ˆæ˜¯è¿™ä¹ˆå¤šæ¡¶ï¼šç¬¬ä¸€é™ä½è¯¯åˆ¤ï¼Œç¬¬äºŒï¼Œç”¨åˆ°äº†14ä½äºŒè¿›åˆ¶ï¼š2çš„14æ¬¡æ–¹=16384ï¼‰</p><p>æ€ä¹ˆåˆ†ï¼Ÿæ ¹æ®å¾—åˆ°çš„æ¯”ç‰¹ä¸²çš„å14ä½æ¥åšåˆ¤æ–­å³å¯ã€‚</p><p><img src="https://zdwtop.cn/blog/bd71287e85294b14b95e3fcb82243fab.png" alt="image.png"></p><p>æ ¹æ®ä¸Šè¿°çš„è§„åˆ™ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªæ•°æ®è¦åˆ†åˆ° 1å·æ¡¶ï¼ŒåŒæ—¶ä»å·¦å¾€å³ï¼ˆä½ä½åˆ°é«˜ä½ï¼‰è®¡ç®—ç¬¬1ä¸ªå‡ºç°çš„1çš„ä½ç½®ï¼Œè¿™é‡Œæ˜¯ç¬¬4ä½ï¼Œé‚£ä¹ˆå°±å¾€è¿™ä¸ª1å·æ¡¶æ’å…¥4çš„æ•°æ®ï¼ˆè½¬æˆäºŒè¿›åˆ¶ï¼‰</p><p>å¦‚æœæœ‰ç¬¬äºŒä¸ªæ•°æ®æ¥äº†ï¼ŒæŒ‰ç…§ä¸Šè¿°çš„è§„åˆ™è¿›è¡Œè®¡ç®—ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœåˆ†åˆ°æ¡¶çš„æ•°æ®æœ‰é‡å¤äº†ï¼ˆè¿™é‡Œæ¯”å¤§å°ï¼Œå¤§çš„æ›¿æ¢å°çš„ï¼‰ï¼š</p><p>è§„åˆ™å¦‚ä¸‹ï¼Œæ¯”å¤§å°ï¼ˆæ¯”å‡ºç°ä½ç½®çš„å¤§å°ï¼‰ï¼Œæ¯”å¦‚æœ‰ä¸ªæ•°æ®æ˜¯æœ€é«˜ä½æ‰å‡ºç°1ï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®ç®—å‡ºæ¥å°±æ˜¯50ï¼Œ50æ¯”4å¤§ï¼Œåˆ™è¿›è¡Œæ›¿æ¢ã€‚1å·æ¡¶çš„æ•°æ®å°±å˜æˆäº†50ï¼ˆäºŒè¿›åˆ¶æ˜¯110010ï¼‰</p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ¡¶çš„æ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹6ä½å­˜å‚¨å³å¯ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥æ¨ç®—ä¸€ä¸‹ä¸€ä¸ªkeyçš„HyperLogLogåªå æ®å¤šå°‘çš„å­˜å‚¨ã€‚</p><p>16384*6 /8/1024=12kã€‚å¹¶ä¸”è¿™é‡Œæœ€å¤šå¯ä»¥å­˜å‚¨å¤šå°‘æ•°æ®ï¼Œå› ä¸ºæ˜¯64ä½å—ï¼Œæ‰€ä»¥å°±æ˜¯2çš„64æ¬¡æ–¹çš„æ•°æ®ï¼Œè¿™ä¸ªå­˜å‚¨çš„æ•°æ®éå¸¸éå¸¸å¤§çš„ï¼Œä¸€èˆ¬ç”¨æˆ·ç”¨longæ¥å®šä¹‰ï¼Œæœ€å¤§å€¼ä¹Ÿåªæœ‰è¿™ä¹ˆå¤šã€‚</p><p><strong>pfcount</strong></p><p>è¿›è¡Œç»Ÿè®¡çš„æ—¶å€™ï¼Œå°±æ˜¯æŠŠ16384æ¡¶ï¼ŒæŠŠæ¯ä¸ªæ¡¶çš„å€¼æ‹¿å‡ºæ¥ï¼Œæ¯”å¦‚å–å‡ºæ˜¯ n,é‚£ä¹ˆè®¿é—®æ¬¡æ•°å°±æ˜¯2çš„næ¬¡æ–¹ã€‚</p><p><img src="https://zdwtop.cn/blog/37ea459470614e8fad06c5eab8a009ca.png" alt="image.png"></p><p>ç„¶åæŠŠæ¯ä¸ªæ¡¶çš„å€¼åšè°ƒå’Œå¹³å‡æ•°ï¼Œå°±å¯ä»¥ç®—å‡ºä¸€ä¸ªç®—æ³•å€¼ã€‚</p><p>åŒæ—¶ï¼Œåœ¨å…·ä½“çš„ç®—æ³•å®ç°ä¸Šï¼ŒHLLè¿˜æœ‰ä¸€ä¸ªåˆ†é˜¶æ®µåå·®ä¿®æ­£ç®—æ³•ã€‚æˆ‘ä»¬å°±ä¸åšæ›´æ·±å…¥çš„äº†è§£äº†ã€‚</p><p><img src="https://zdwtop.cn/blog/50bed8f5a0394a93aa8033ee9f847672.png" alt="image.png"></p><p>constå’Œméƒ½æ˜¯Redisé‡Œé¢æ ¹æ®æ•°æ®åšçš„è°ƒå’Œå¹³å‡æ•°ã€‚</p><h2 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h2><p>Redis GEO æ˜¯ Redis 3.2 ç‰ˆæœ¬æ–°å¢çš„æ•°æ®ç±»å‹ï¼Œä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶å¯¹å­˜å‚¨çš„ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚</p><p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šä¾èµ–æœç´¢â€œé™„è¿‘çš„é¤é¦†â€ã€åœ¨æ‰“è½¦è½¯ä»¶ä¸Šå«è½¦ï¼Œè¿™äº›éƒ½ç¦»ä¸å¼€åŸºäºä½ç½®ä¿¡æ¯æœåŠ¡ï¼ˆLocation-Based Serviceï¼ŒLBSï¼‰çš„åº”ç”¨ã€‚LBS åº”ç”¨è®¿é—®çš„æ•°æ®æ˜¯å’Œäººæˆ–ç‰©å…³è”çš„ä¸€ç»„ç»çº¬åº¦ä¿¡æ¯ï¼Œè€Œä¸”è¦èƒ½æŸ¥è¯¢ç›¸é‚»çš„ç»çº¬åº¦èŒƒå›´ï¼ŒGEO å°±éå¸¸é€‚åˆåº”ç”¨åœ¨ LBS æœåŠ¡çš„åœºæ™¯ä¸­ã€‚</p><h3 id="å†…éƒ¨å®ç°"><a href="#å†…éƒ¨å®ç°" class="headerlink" title="å†…éƒ¨å®ç°"></a>å†…éƒ¨å®ç°</h3><p>GEO æœ¬èº«å¹¶æ²¡æœ‰è®¾è®¡æ–°çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº† Sorted Set é›†åˆç±»å‹ã€‚</p><p>GEO ç±»å‹ä½¿ç”¨ GeoHash ç¼–ç æ–¹æ³•å®ç°äº†ç»çº¬åº¦åˆ° Sorted Set ä¸­å…ƒç´ æƒé‡åˆ†æ•°çš„è½¬æ¢ï¼Œè¿™å…¶ä¸­çš„ä¸¤ä¸ªå…³é”®æœºåˆ¶å°±æ˜¯ã€Œå¯¹äºŒç»´åœ°å›¾åšåŒºé—´åˆ’åˆ†ã€å’Œã€Œå¯¹åŒºé—´è¿›è¡Œç¼–ç ã€ã€‚ä¸€ç»„ç»çº¬åº¦è½åœ¨æŸä¸ªåŒºé—´åï¼Œå°±ç”¨åŒºé—´çš„ç¼–ç å€¼æ¥è¡¨ç¤ºï¼Œå¹¶æŠŠç¼–ç å€¼ä½œä¸º Sorted Set å…ƒç´ çš„æƒé‡åˆ†æ•°ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç»çº¬åº¦ä¿å­˜åˆ° Sorted Set ä¸­ï¼Œåˆ©ç”¨ Sorted Set æä¾›çš„â€œæŒ‰æƒé‡è¿›è¡Œæœ‰åºèŒƒå›´æŸ¥æ‰¾â€çš„ç‰¹æ€§ï¼Œå®ç° LBS æœåŠ¡ä¸­é¢‘ç¹ä½¿ç”¨çš„â€œæœç´¢é™„è¿‘â€çš„éœ€æ±‚ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜å‚¨æŒ‡å®šçš„åœ°ç†ç©ºé—´ä½ç½®ï¼Œå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªç»åº¦(longitude)ã€çº¬åº¦(latitude)ã€ä½ç½®åç§°(member)æ·»åŠ åˆ°æŒ‡å®šçš„ key ä¸­ã€‚</span></span><br><span class="line">GEOADD key longitude latitude member [longitude latitude member ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»ç»™å®šçš„ key é‡Œè¿”å›æ‰€æœ‰æŒ‡å®šåç§°(member)çš„ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ï¼Œä¸å­˜åœ¨çš„è¿”å› nilã€‚</span></span><br><span class="line">GEOPOS key member [member ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚</span></span><br><span class="line">GEODIST key member1 member2 [m|km|ft|mi]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®ç”¨æˆ·ç»™å®šçš„ç»çº¬åº¦åæ ‡æ¥è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆã€‚</span></span><br><span class="line">GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><h4 id="æ»´æ»´å«è½¦"><a href="#æ»´æ»´å«è½¦" class="headerlink" title="æ»´æ»´å«è½¦"></a>æ»´æ»´å«è½¦</h4><p>è¿™é‡Œä»¥æ»´æ»´å«è½¦çš„åœºæ™¯ä¸ºä¾‹ï¼Œä»‹ç»ä¸‹å…·ä½“å¦‚ä½•ä½¿ç”¨ GEO å‘½ä»¤ï¼šGEOADD å’Œ GEORADIUS è¿™ä¸¤ä¸ªå‘½ä»¤ã€‚</p><p>å‡è®¾è½¦è¾† ID æ˜¯ 33ï¼Œç»çº¬åº¦ä½ç½®æ˜¯ï¼ˆ116.034579ï¼Œ39.030452ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª GEO é›†åˆä¿å­˜æ‰€æœ‰è½¦è¾†çš„ç»çº¬åº¦ï¼Œé›†åˆ key æ˜¯ cars:locationsã€‚</p><p>æ‰§è¡Œä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥æŠŠ ID å·ä¸º 33 çš„è½¦è¾†çš„å½“å‰ç»çº¬åº¦ä½ç½®å­˜å…¥ GEO é›†åˆä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD cars:locations 116.034579 39.030452 33</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·æƒ³è¦å¯»æ‰¾è‡ªå·±é™„è¿‘çš„ç½‘çº¦è½¦æ—¶ï¼ŒLBS åº”ç”¨å°±å¯ä»¥ä½¿ç”¨ GEORADIUS å‘½ä»¤ã€‚</p><p>ä¾‹å¦‚ï¼ŒLBS åº”ç”¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ï¼ŒRedis ä¼šæ ¹æ®è¾“å…¥çš„ç”¨æˆ·çš„ç»çº¬åº¦ä¿¡æ¯ï¼ˆ116.054579ï¼Œ39.030452 ï¼‰ï¼ŒæŸ¥æ‰¾ä»¥è¿™ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ƒçš„ 5 å…¬é‡Œå†…çš„è½¦è¾†ä¿¡æ¯ï¼Œå¹¶è¿”å›ç»™ LBS åº”ç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10</span><br></pre></td></tr></table></figure><h2 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h2><h3 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>Redis Stream æ˜¯ Redis 5.0 ç‰ˆæœ¬æ–°å¢åŠ çš„æ•°æ®ç±»å‹ï¼ŒRedis ä¸“é—¨ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„æ•°æ®ç±»å‹ã€‚</p><p>åœ¨ Redis 5.0 Stream æ²¡å‡ºæ¥ä¹‹å‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼éƒ½æœ‰ç€å„è‡ªçš„ç¼ºé™·ï¼Œä¾‹å¦‚ï¼š</p><ul><li>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸èƒ½æŒä¹…åŒ–ä¹Ÿå°±æ— æ³•å¯é çš„ä¿å­˜æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯¹äºç¦»çº¿é‡è¿çš„å®¢æˆ·ç«¯ä¸èƒ½è¯»å–å†å²æ¶ˆæ¯çš„ç¼ºé™·ï¼›</li><li>List å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ä¸èƒ½é‡å¤æ¶ˆè´¹ï¼Œä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹å®Œå°±ä¼šè¢«åˆ é™¤ï¼Œè€Œä¸”ç”Ÿäº§è€…éœ€è¦è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDã€‚</li></ul><p>åŸºäºä»¥ä¸Šé—®é¢˜ï¼ŒRedis 5.0 ä¾¿æ¨å‡ºäº† Stream ç±»å‹ä¹Ÿæ˜¯æ­¤ç‰ˆæœ¬æœ€é‡è¦çš„åŠŸèƒ½ï¼Œç”¨äºå®Œç¾åœ°å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ”¯æŒæ¶ˆæ¯çš„æŒä¹…åŒ–ã€æ”¯æŒè‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ IDã€æ”¯æŒ ack ç¡®è®¤æ¶ˆæ¯çš„æ¨¡å¼ã€æ”¯æŒæ¶ˆè´¹ç»„æ¨¡å¼ç­‰ï¼Œè®©æ¶ˆæ¯é˜Ÿåˆ—æ›´åŠ çš„ç¨³å®šå’Œå¯é ã€‚</p><h3 id="å¸¸è§å‘½ä»¤"><a href="#å¸¸è§å‘½ä»¤" class="headerlink" title="å¸¸è§å‘½ä»¤"></a>å¸¸è§å‘½ä»¤</h3><p>Stream æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œå‘½ä»¤ï¼š</p><ul><li>XADDï¼šæ’å…¥æ¶ˆæ¯ï¼Œä¿è¯æœ‰åºï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼›</li><li>XLEN ï¼šæŸ¥è¯¢æ¶ˆæ¯é•¿åº¦ï¼›</li><li>XREADï¼šç”¨äºè¯»å–æ¶ˆæ¯ï¼Œå¯ä»¥æŒ‰ ID è¯»å–æ•°æ®ï¼›</li><li>XDEL ï¼š æ ¹æ®æ¶ˆæ¯ ID åˆ é™¤æ¶ˆæ¯ï¼›</li><li>DEL ï¼šåˆ é™¤æ•´ä¸ª Streamï¼›</li><li>XRANGE ï¼šè¯»å–åŒºé—´æ¶ˆæ¯</li><li>XREADGROUPï¼šæŒ‰æ¶ˆè´¹ç»„å½¢å¼è¯»å–æ¶ˆæ¯ï¼›</li><li>XPENDING å’Œ XACKï¼š<ul><li>XPENDING å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥è¯¢æ¯ä¸ªæ¶ˆè´¹ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…ã€Œå·²è¯»å–ã€ä½†å°šæœªç¡®è®¤ã€çš„æ¶ˆæ¯ï¼›</li><li>XACK å‘½ä»¤ç”¨äºå‘æ¶ˆæ¯é˜Ÿåˆ—ç¡®è®¤æ¶ˆæ¯å¤„ç†å·²å®Œæˆï¼›</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Redisé«˜çº§æ•°æ®ç»“æ„&quot;&gt;&lt;a href=&quot;#Redisé«˜çº§æ•°æ®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;Redisé«˜çº§æ•°æ®ç»“æ„&quot;&gt;&lt;/a&gt;Redisé«˜çº§æ•°æ®ç»“æ„&lt;/h2&gt;&lt;h3 id=&quot;Bitmaps&quot;&gt;&lt;a href=&quot;#Bitmaps&quot; c</summary>
      
    
    
    
    <category term="Redis" scheme="https://eizo01.github.io/categories/Redis/"/>
    
    
    <category term="Redisæ•°æ®ç»“æ„" scheme="https://eizo01.github.io/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Rediså¸¸ç”¨æ•°æ®ç»“æ„</title>
    <link href="https://eizo01.github.io/posts/a765d482.html"/>
    <id>https://eizo01.github.io/posts/a765d482.html</id>
    <published>2022-11-02T12:00:00.000Z</published>
    <updated>2023-03-17T14:20:13.981Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Rediså¸¸ç”¨æ•°æ®ç»“æ„"><a href="#Rediså¸¸ç”¨æ•°æ®ç»“æ„" class="headerlink" title="Rediså¸¸ç”¨æ•°æ®ç»“æ„"></a>Rediså¸¸ç”¨æ•°æ®ç»“æ„</h1><p>Redisæä¾›äº†ä¸€äº›æ•°æ®ç»“æ„ä¾›æˆ‘ä»¬å¾€Redisä¸­å­˜å–æ•°æ®ï¼Œæœ€å¸¸ç”¨çš„çš„æœ‰5ç§ï¼Œ<strong>å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€å“ˆå¸Œ(Hash)ã€åˆ—è¡¨ï¼ˆlistï¼‰ã€é›†åˆï¼ˆsetï¼‰ã€æœ‰åºé›†åˆï¼ˆZSETï¼‰</strong>ã€‚</p><h2 id="å­—ç¬¦ä¸²ï¼ˆStringï¼‰"><a href="#å­—ç¬¦ä¸²ï¼ˆStringï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ï¼ˆStringï¼‰"></a>å­—ç¬¦ä¸²ï¼ˆStringï¼‰</h2><p>å­—ç¬¦ä¸²ç±»å‹æ˜¯Redisæœ€åŸºç¡€çš„æ•°æ®ç»“æ„ã€‚é¦–å…ˆé”®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œä¸”å…¶ä»–å‡ ç§æ•°æ®ç»“æ„éƒ½æ˜¯åœ¨å­—ç¬¦ä¸²ç±»å‹åŸºç¡€ä¸Šæ„å»ºçš„ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ç±»å‹èƒ½ä¸ºå…¶ä»–å››ç§æ•°æ®ç»“æ„çš„å­¦ä¹ å¥ å®šåŸºç¡€ã€‚å­—ç¬¦ä¸²ç±»å‹çš„å€¼å®é™…å¯ä»¥æ˜¯å­—ç¬¦ä¸²(ç®€å•çš„å­—ç¬¦ä¸²ã€å¤æ‚çš„å­—ç¬¦ä¸²(ä¾‹å¦‚JSONã€XML))ã€æ•°å­—(æ•´æ•°ã€æµ®ç‚¹æ•°)ï¼Œç”šè‡³æ˜¯äºŒè¿›åˆ¶(å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘)ï¼Œä½†æ˜¯<strong>å€¼æœ€å¤§ä¸èƒ½è¶…è¿‡512MB</strong>ã€‚</p><p>ï¼ˆè™½ç„¶Redisæ˜¯Cå†™çš„ï¼ŒCé‡Œé¢æœ‰å­—ç¬¦ä¸²&#x3c;æœ¬è´¨ä½¿ç”¨charæ•°ç»„æ¥å®ç°&gt;ï¼Œä½†æ˜¯å¤„äºç§ç§è€ƒè™‘ï¼ŒRedisè¿˜æ˜¯è‡ªå·±å®ç°äº†å­—ç¬¦ä¸²ç±»å‹ï¼‰</p><h3 id="æ“ä½œå‘½ä»¤"><a href="#æ“ä½œå‘½ä»¤" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h3><h4 id="set-è®¾ç½®å€¼"><a href="#set-è®¾ç½®å€¼" class="headerlink" title="set è®¾ç½®å€¼"></a>set è®¾ç½®å€¼</h4><p><code>set key value</code><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/1dab86326fa249cd9d1ab118b48e9c6a.png" alt="image.png"></p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">emos:3&gt;set name zdw</span><br><span class="line"></span><br><span class="line">&quot;OK&quot;</span><br><span class="line"></span><br><span class="line">emos:3&gt;get name</span><br><span class="line"></span><br><span class="line">&quot;zdw&quot;</span><br></pre></td></tr></table></figure><p>setå‘½ä»¤æœ‰å‡ ä¸ªé€‰é¡¹:</p><ul><li>ex seconds: ä¸ºé”®è®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´ã€‚</li></ul><ul><li>px milliseconds: ä¸ºé”®è®¾ç½®æ¯«ç§’çº§è¿‡æœŸæ—¶é—´ã€‚</li></ul><ul><li>nx: é”®å¿…é¡»ä¸å­˜åœ¨,æ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ·»åŠ ï¼ˆåˆ†å¸ƒå¼é”å¸¸ç”¨ï¼‰ã€‚</li></ul><ul><li>xx: ä¸nxç›¸å,é”®å¿…é¡»å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸ,ç”¨äºæ›´æ–°ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®è¿‡æœŸæ—¶é—´</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> name zdw ex <span class="number">10</span></span><br><span class="line">&quot;OK&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>ttl name</span><br><span class="line">&quot;5&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>ttl name</span><br><span class="line">&quot;4&quot;</span><br><span class="line">#è®¾ç½®æ¯«ç§’æ•°</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> name zdw px <span class="number">100</span></span><br><span class="line">&quot;OK</span><br></pre></td></tr></table></figure><p><strong>ä»æ‰§è¡Œæ•ˆæœä¸Šçœ‹ï¼Œexå‚æ•°å’Œexpireå‘½ä»¤åŸºæœ¬ä¸€æ ·ã€‚è¿˜æœ‰ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„åœ°æ–¹æ˜¯å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œç„¶åä½ è°ƒç”¨äº†set æ–¹æ³•ä¿®æ”¹äº†å®ƒï¼Œå®ƒçš„è¿‡æœŸæ—¶é—´ä¼šæ¶ˆå¤±ã€‚</strong></p><p>è€Œnxå’Œxxæ‰§è¡Œæ•ˆæœå¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#é”®å¿…é¡»ä¸å­˜åœ¨,æ‰å¯ä»¥è®¾ç½®æˆåŠŸ</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> nx<span class="operator">-</span>name</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> nx<span class="operator">-</span>name zdw nx</span><br><span class="line">&quot;OK&quot;</span><br><span class="line"># è®¾ç½®xx é”®å¿…é¡»å­˜åœ¨æ‰èƒ½è®¾ç½®</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> xx<span class="operator">-</span>name zdw xx</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> xx<span class="operator">-</span>name zdw nx</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> xx<span class="operator">-</span>name zdw xx</span><br><span class="line">&quot;OK&quot;</span><br></pre></td></tr></table></figure><p>é™¤äº†seté€‰é¡¹ï¼ŒRedis è¿˜æä¾›äº†setexå’Œ setnxä¸¤ä¸ªå‘½ä»¤:</p><p><code>setex key seconds value</code></p><p><code>setnx key value</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># é”®å¿…é¡»ä¸å­˜åœ¨ setnxæˆåŠŸ,è¿”å›ç»“æœä¸º<span class="number">1</span>ã€‚setnxå¤±è´¥,è¿”å›ç»“æœä¸º<span class="number">0</span>ï¼Œ</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>setnx zdw01 zdw</span><br><span class="line">&quot;1&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>setnx zdw01 zdw</span><br><span class="line">&quot;0&quot;</span><br><span class="line">#è®¾ç½®keyè¿‡æœŸæ—¶é—´</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>setex zdw <span class="number">10</span> zdw</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>ttl zdw</span><br><span class="line">&quot;7&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>ttl zdw</span><br><span class="line">&quot;4&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>setexå’Œ setnxçš„ä½œç”¨å’Œexå’Œnxé€‰é¡¹æ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯ï¼Œsetexä¸ºé”®è®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´ï¼Œsetnxè®¾ç½®æ—¶é”®å¿…é¡»ä¸å­˜åœ¨,æ‰å¯ä»¥è®¾ç½®æˆåŠŸã€‚</strong></p><p>æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯å—?ä»¥setnxå‘½ä»¤ä¸ºä¾‹å­ï¼Œç”±äºRedisçš„å•çº¿ç¨‹å‘½ä»¤å¤„ç†æœºåˆ¶ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶æ‰§è¡Œsetnx key valueï¼Œæ ¹æ®setnxçš„ç‰¹æ€§åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½è®¾ç½®æˆåŠŸï¼Œsetnxå¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼é”çš„ä¸€ç§å®ç°æ–¹æ¡ˆã€‚å½“ç„¶åˆ†å¸ƒå¼é”ä¸æ˜¯åªæœ‰ä¸€ä¸ªå‘½ä»¤å°±OKäº†ï¼Œå…¶ä¸­è¿˜æœ‰å¾ˆå¤šçš„ä¸œè¥¿è¦æ³¨æ„ï¼Œæˆ‘ä»¬åé¢ä¼šç”¨å•ç‹¬çš„åˆ†ææ¥è®²è¿°åŸºäºRedisçš„åˆ†å¸ƒå¼é”ã€‚</p><h4 id="get-è·å–å€¼"><a href="#get-è·å–å€¼" class="headerlink" title="get è·å–å€¼"></a>get è·å–å€¼</h4><p>å¦‚æœè¦è·å–çš„é”®ä¸å­˜åœ¨,åˆ™è¿”å›nil(ç©º):</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> zdw01</span><br><span class="line">&quot;zdw&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> zdw02</span><br><span class="line"><span class="keyword">null</span></span><br></pre></td></tr></table></figure><h4 id="mset-æ‰¹é‡è®¾ç½®å€¼"><a href="#mset-æ‰¹é‡è®¾ç½®å€¼" class="headerlink" title="mset æ‰¹é‡è®¾ç½®å€¼"></a>mset æ‰¹é‡è®¾ç½®å€¼</h4><p>é€šè¿‡msetå‘½ä»¤ä¸€æ¬¡æ€§è®¾ç½®4ä¸ªé”®å€¼å¯¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>mset a <span class="number">1</span> b <span class="number">2</span> c <span class="number">3</span> d <span class="number">4</span></span><br><span class="line">&quot;OK&quot;</span><br></pre></td></tr></table></figure><h4 id="mget-æ‰¹é‡è·å–å€¼"><a href="#mget-æ‰¹é‡è·å–å€¼" class="headerlink" title="mget æ‰¹é‡è·å–å€¼"></a>mget æ‰¹é‡è·å–å€¼</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>mget a a1 b c c1 d</span><br><span class="line"><span class="number">1</span>) &quot;1&quot;</span><br><span class="line"><span class="number">2</span>) <span class="keyword">null</span></span><br><span class="line"><span class="number">3</span>) &quot;2&quot;</span><br><span class="line"><span class="number">4</span>) &quot;3&quot;</span><br><span class="line"><span class="number">5</span>) <span class="keyword">null</span></span><br><span class="line"><span class="number">6</span>) &quot;4&quot;</span><br></pre></td></tr></table></figure><p>æ‰¹é‡è·å–äº†é”®aã€bã€cã€dçš„å€¼:</p><p>å¦‚æœæœ‰äº›é”®ä¸å­˜åœ¨,é‚£ä¹ˆå®ƒçš„å€¼ä¸ºnil(ç©º)ï¼Œç»“æœæ˜¯æŒ‰ç…§ä¼ å…¥é”®çš„é¡ºåºè¿”å›ã€‚</p><p>æ‰¹é‡æ“ä½œå‘½ä»¤å¯ä»¥æœ‰æ•ˆæé«˜æ•ˆç‡ï¼Œå‡å¦‚æ²¡æœ‰mgetè¿™æ ·çš„å‘½ä»¤ï¼Œè¦æ‰§è¡Œnæ¬¡getå‘½ä»¤å…·ä½“è€—æ—¶å¦‚ä¸‹:</p><p><strong>næ¬¡ getæ—¶é—´=næ¬¡ç½‘ç»œæ—¶é—´+næ¬¡å‘½ä»¤æ—¶é—´</strong></p><p>ä½¿ç”¨mgetå‘½ä»¤åï¼Œè¦æ‰§è¡Œnæ¬¡getå‘½ä»¤æ“ä½œå…·ä½“è€—æ—¶å¦‚ä¸‹:</p><p><strong>næ¬¡getæ—¶é—´=1æ¬¡ç½‘ç»œæ—¶é—´+næ¬¡å‘½ä»¤æ—¶é—´</strong></p><p>Rediså¯ä»¥æ”¯æ’‘æ¯ç§’æ•°ä¸‡çš„è¯»å†™æ“ä½œï¼Œä½†æ˜¯è¿™æŒ‡çš„æ˜¯<strong>RedisæœåŠ¡ç«¯çš„å¤„ç†èƒ½åŠ›</strong>ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œ<strong>ä¸€æ¬¡å‘½ä»¤é™¤äº†å‘½ä»¤æ—¶é—´è¿˜æ˜¯æœ‰ç½‘ç»œæ—¶é—´ï¼Œå‡è®¾ç½‘ç»œæ—¶é—´ä¸º1æ¯«ç§’ï¼Œå‘½ä»¤æ—¶é—´ä¸º0.1æ¯«ç§’(æŒ‰ç…§æ¯ç§’å¤„ç†1ä¸‡æ¡å‘½ä»¤ç®—)ï¼Œé‚£ä¹ˆæ‰§è¡Œ1000æ¬¡ getå‘½ä»¤éœ€è¦1.1ç§’(1000<em>1+1000</em>0.1=1100ms)ï¼Œ1æ¬¡mgetå‘½ä»¤çš„éœ€è¦0.101ç§’(1<em>1+1000</em>0.1=101ms)ã€‚</strong></p><h4 id="Incr-æ•°å­—è¿ç®—"><a href="#Incr-æ•°å­—è¿ç®—" class="headerlink" title="Incr æ•°å­—è¿ç®—"></a>Incr æ•°å­—è¿ç®—</h4><p>incrå‘½ä»¤ç”¨äºå¯¹å€¼åšè‡ªå¢æ“ä½œ,è¿”å›ç»“æœåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ul><li>å€¼ä¸æ˜¯æ•´æ•°,è¿”å›é”™è¯¯ã€‚</li></ul><ul><li>å€¼æ˜¯æ•´æ•°ï¼Œè¿”å›è‡ªå¢åçš„ç»“æœã€‚</li></ul><ul><li>é”®ä¸å­˜åœ¨ï¼ŒæŒ‰ç…§å€¼ä¸º0è‡ªå¢,è¿”å›ç»“æœä¸º1ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># é”®ä¸å­˜åœ¨ï¼ŒæŒ‰ç…§å€¼ä¸º<span class="number">0</span>è‡ªå¢,è¿”å›ç»“æœä¸º<span class="number">1</span>ã€‚</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">exists</span> incr<span class="operator">-</span>key</span><br><span class="line">&quot;0&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>incr incr<span class="operator">-</span>key</span><br><span class="line">&quot;1&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>incr incr<span class="operator">-</span>key</span><br><span class="line">&quot;2&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> hello zdw</span><br><span class="line">&quot;OK&quot;</span><br><span class="line"># å€¼ä¸æ˜¯æ•´æ•°,è¿”å›é”™è¯¯ã€‚</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>incr hello</span><br><span class="line">&quot;ERR value is not an integer or out of range&quot;</span><br></pre></td></tr></table></figure><p>é™¤äº†incrå‘½ä»¤ï¼ŒRedisæä¾›äº†<code>decr</code>(è‡ªå‡)ã€ <code>incrby</code>(è‡ªå¢æŒ‡å®šæ•°å­—)ã€<code>decrby</code>(è‡ªå‡æŒ‡å®šæ•°å­—)ã€<code>incrbyfloat</code>ï¼ˆè‡ªå¢æµ®ç‚¹æ•°)ï¼Œå…·ä½“æ•ˆæœè¯·å¤§å®¶è‡ªè¡Œå°è¯•ã€‚</p><h4 id="appendè¿½åŠ æŒ‡ä»¤"><a href="#appendè¿½åŠ æŒ‡ä»¤" class="headerlink" title="appendè¿½åŠ æŒ‡ä»¤"></a>appendè¿½åŠ æŒ‡ä»¤</h4><p>appendå¯ä»¥å‘å­—ç¬¦ä¸²å°¾éƒ¨è¿½åŠ å€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> hello </span><br><span class="line">&quot;zdw&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>append hello good</span><br><span class="line">&quot;7&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> hello </span><br><span class="line">&quot;zdwgood&quot;</span><br></pre></td></tr></table></figure><h4 id="strlen-å­—ç¬¦ä¸²é•¿åº¦"><a href="#strlen-å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="strlen å­—ç¬¦ä¸²é•¿åº¦"></a>strlen å­—ç¬¦ä¸²é•¿åº¦</h4><p>è¿”å›å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>strlen hello</span><br><span class="line">&quot;7&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">set</span> k1 &quot;ä¸­æ–‡&quot;</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>strlen k1</span><br><span class="line">&quot;6&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> k1</span><br><span class="line">&quot;ä¸­æ–‡&quot;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ¯ä¸ªä¸­æ–‡å 3ä¸ªå­—èŠ‚</p><h4 id="getset-è®¾ç½®å¹¶è¿”å›åŸå€¼"><a href="#getset-è®¾ç½®å¹¶è¿”å›åŸå€¼" class="headerlink" title="getset è®¾ç½®å¹¶è¿”å›åŸå€¼"></a>getset è®¾ç½®å¹¶è¿”å›åŸå€¼</h4><p>å®¢æˆ·ç«¯æµ‹è¯•ä¸å‡ºæ¥ï¼Œåœ¨linuxæµ‹è¯•å‡ºæ¥</p><p>getsetå’Œsetä¸€æ ·ä¼šè®¾ç½®å€¼,ä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œå®ƒåŒæ—¶ä¼šè¿”å›é”®åŸæ¥çš„å€¼</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/d568dc6e0a6c4adeae13d8f63a8fd0d8.png" alt="image.png"></p><h4 id="setrange-è®¾ç½®æŒ‡å®šä½ç½®çš„å­—ç¬¦"><a href="#setrange-è®¾ç½®æŒ‡å®šä½ç½®çš„å­—ç¬¦" class="headerlink" title="setrange è®¾ç½®æŒ‡å®šä½ç½®çš„å­—ç¬¦"></a>setrange è®¾ç½®æŒ‡å®šä½ç½®çš„å­—ç¬¦</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> hello</span><br><span class="line">&quot;zdwgood&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>setrange hello <span class="number">4</span> d</span><br><span class="line">&quot;7&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> hello</span><br><span class="line">&quot;zdwgdod&quot;</span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡ä»0å¼€å§‹è®¡ç®—ã€‚</p><h4 id="getrange-æˆªå–å­—ç¬¦ä¸²"><a href="#getrange-æˆªå–å­—ç¬¦ä¸²" class="headerlink" title="getrange æˆªå–å­—ç¬¦ä¸²"></a>getrange æˆªå–å­—ç¬¦ä¸²</h4><p>getrange æˆªå–å­—ç¬¦ä¸²ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå½¢æˆä¸€ä¸ªå­ä¸²ï¼Œéœ€è¦æŒ‡æ˜å¼€å§‹å’Œç»“æŸçš„åç§»é‡ï¼Œæˆªå–çš„èŒƒå›´æ˜¯ä¸ªé—­åŒºé—´ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span><span class="keyword">get</span> hello</span><br><span class="line">&quot;zdwgood&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>getrange hello <span class="number">0</span> <span class="number">2</span></span><br><span class="line">&quot;zdw&quot;</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦"><a href="#å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦" class="headerlink" title="å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦"></a>å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦</h4><p>å­—ç¬¦ä¸²è¿™äº›å‘½ä»¤ä¸­ï¼Œé™¤äº†del ã€msetã€ mgetæ”¯æŒå¤šä¸ªé”®çš„æ‰¹é‡æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å’Œé”®çš„ä¸ªæ•°ç›¸å…³ï¼Œä¸ºO(n)ï¼Œgetrangeå’Œå­—ç¬¦ä¸²é•¿åº¦ç›¸å…³ï¼Œä¹Ÿæ˜¯O(n)ï¼Œå…¶ä½™çš„å‘½ä»¤åŸºæœ¬ä¸Šéƒ½æ˜¯O(1)çš„æ—¶é—´å¤æ‚åº¦ï¼Œåœ¨é€Ÿåº¦ä¸Šè¿˜æ˜¯éå¸¸å¿«çš„ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å­—ç¬¦ä¸²ç±»å‹çš„ä½¿ç”¨åœºæ™¯å¾ˆå¹¿æ³›ï¼š</p><p><strong>ç¼“å­˜åŠŸèƒ½</strong></p><p>Redis ä½œä¸ºç¼“å­˜å±‚ï¼ŒMySQLä½œä¸ºå­˜å‚¨å±‚ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚çš„æ•°æ®éƒ½æ˜¯ä»Redisä¸­è·å–ã€‚ç”±äºRediså…·æœ‰æ”¯æ’‘é«˜å¹¶å‘çš„ç‰¹æ€§,æ‰€ä»¥ç¼“å­˜é€šå¸¸èƒ½èµ·åˆ°åŠ é€Ÿè¯»å†™å’Œé™ä½åç«¯å‹åŠ›çš„ä½œç”¨ã€‚</p><p><strong>è®¡æ•°</strong></p><p>ä½¿ç”¨Redis ä½œä¸ºè®¡æ•°çš„åŸºç¡€å·¥å…·ï¼Œå®ƒå¯ä»¥å®ç°å¿«é€Ÿè®¡æ•°ã€æŸ¥è¯¢ç¼“å­˜çš„åŠŸèƒ½,åŒæ—¶æ•°æ®å¯ä»¥å¼‚æ­¥è½åœ°åˆ°å…¶ä»–æ•°æ®æºã€‚</p><p><strong>å…±äº«Session</strong></p><p>ä¸€ä¸ªåˆ†å¸ƒå¼WebæœåŠ¡å°†ç”¨æˆ·çš„Sessionä¿¡æ¯ï¼ˆä¾‹å¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯)ä¿å­˜åœ¨å„è‡ªæœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼Œå‡ºäºè´Ÿè½½å‡è¡¡çš„è€ƒè™‘ï¼Œåˆ†å¸ƒå¼æœåŠ¡ä¼šå°†ç”¨æˆ·çš„è®¿é—®å‡è¡¡åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·åˆ·æ–°ä¸€æ¬¡è®¿é—®å¯èƒ½ä¼šå‘ç°éœ€è¦é‡æ–°ç™»å½•ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ç”¨æˆ·æ— æ³•å®¹å¿çš„ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,å¯ä»¥ä½¿ç”¨Rediså°†ç”¨æˆ·çš„Sessionè¿›è¡Œé›†ä¸­ç®¡ç†,ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹åªè¦ä¿è¯Redisæ˜¯é«˜å¯ç”¨å’Œæ‰©å±•æ€§çš„,æ¯æ¬¡ç”¨æˆ·æ›´æ–°æˆ–è€…æŸ¥è¯¢ç™»å½•ä¿¡æ¯éƒ½ç›´æ¥ä»Redisä¸­é›†ä¸­è·å–ã€‚</p><p><strong>é™é€Ÿ</strong></p><p>æ¯”å¦‚ï¼Œå¾ˆå¤šåº”ç”¨å‡ºäºå®‰å…¨çš„è€ƒè™‘,ä¼šåœ¨æ¯æ¬¡è¿›è¡Œç™»å½•æ—¶,è®©ç”¨æˆ·è¾“å…¥æ‰‹æœºéªŒè¯ç ,ä»è€Œç¡®å®šæ˜¯å¦æ˜¯ç”¨æˆ·æœ¬äººã€‚ä½†æ˜¯ä¸ºäº†çŸ­ä¿¡æ¥å£ä¸è¢«é¢‘ç¹è®¿é—®,ä¼šé™åˆ¶ç”¨æˆ·æ¯åˆ†é’Ÿè·å–éªŒè¯ç çš„é¢‘ç‡ï¼Œä¾‹å¦‚ä¸€åˆ†é’Ÿä¸èƒ½è¶…è¿‡5æ¬¡ã€‚ä¸€äº›ç½‘ç«™é™åˆ¶ä¸€ä¸ªIPåœ°å€ä¸èƒ½åœ¨ä¸€ç§’é’Ÿä¹‹å†…æ–¹é—®è¶…è¿‡næ¬¡ä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„æ€è·¯ã€‚</p><h2 id="å“ˆå¸Œ-Hash"><a href="#å“ˆå¸Œ-Hash" class="headerlink" title="å“ˆå¸Œ(Hash)"></a>å“ˆå¸Œ(Hash)</h2><p>Javaé‡Œæä¾›äº†HashMapï¼ŒRedisä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ•°æ®ç»“æ„ï¼Œå°±æ˜¯å“ˆå¸Œç±»å‹ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œå“ˆå¸Œç±»å‹ä¸­çš„æ˜ å°„å…³ç³»å«ä½œfield-valueï¼Œæ³¨æ„è¿™é‡Œçš„valueæ˜¯æŒ‡fieldå¯¹åº”çš„å€¼ï¼Œä¸æ˜¯é”®å¯¹åº”çš„å€¼ã€‚</p><h3 id="æ“ä½œå‘½ä»¤-1"><a href="#æ“ä½œå‘½ä»¤-1" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h3><p>åŸºæœ¬ä¸Šï¼Œå“ˆå¸Œçš„æ“ä½œå‘½ä»¤å’Œå­—ç¬¦ä¸²çš„æ“ä½œå‘½ä»¤å¾ˆç±»ä¼¼ï¼Œå¾ˆå¤šå‘½ä»¤åœ¨å­—ç¬¦ä¸²ç±»å‹çš„å‘½ä»¤å‰é¢åŠ ä¸Šäº†hå­—æ¯ï¼Œä»£è¡¨æ˜¯æ“ä½œå“ˆå¸Œç±»å‹ï¼ŒåŒæ—¶è¿˜è¦æŒ‡æ˜è¦æ“ä½œçš„fieldçš„å€¼ã€‚</p><h4 id="hsetè®¾å€¼"><a href="#hsetè®¾å€¼" class="headerlink" title="hsetè®¾å€¼"></a>hsetè®¾å€¼</h4><p>hset user:1 name lijin</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hset <span class="keyword">user</span>:<span class="number">1</span> name zdw</span><br><span class="line">&quot;1&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœè®¾ç½®æˆåŠŸä¼šè¿”å›1ï¼Œåä¹‹ä¼šè¿”å›0ã€‚æ­¤å¤–Redisæä¾›äº†hsetnxå‘½ä»¤ï¼Œå®ƒä»¬çš„å…³ç³»å°±åƒsetå’Œsetnxå‘½ä»¤ä¸€æ ·,åªä¸è¿‡ä½œç”¨åŸŸç”±é”®å˜ä¸ºfieldã€‚</p><h4 id="hgetå–å€¼"><a href="#hgetå–å€¼" class="headerlink" title="hgetå–å€¼"></a>hgetå–å€¼</h4><p>hget user:1 name</p><p>å¦‚æœé”®æˆ–fieldä¸å­˜åœ¨ï¼Œä¼šè¿”å›nilã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hset <span class="keyword">user</span>:<span class="number">1</span> name zdw</span><br><span class="line">&quot;1&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hget <span class="keyword">user</span>:<span class="number">1</span> name </span><br><span class="line">&quot;zdw&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hget <span class="keyword">user</span>:<span class="number">1</span> name1</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hget <span class="keyword">user</span>:<span class="number">2</span> name1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="hdelåˆ é™¤field"><a href="#hdelåˆ é™¤field" class="headerlink" title="hdelåˆ é™¤field"></a>hdelåˆ é™¤field</h4><p>hdelä¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªfieldï¼Œè¿”å›ç»“æœä¸ºæˆåŠŸåˆ é™¤fieldçš„ä¸ªæ•°ã€‚</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/45ed460d37c04b31bbd5122cd964a0e3.png" alt="image.png"></p><h4 id="hlenè®¡ç®—fieldä¸ªæ•°"><a href="#hlenè®¡ç®—fieldä¸ªæ•°" class="headerlink" title="hlenè®¡ç®—fieldä¸ªæ•°"></a>hlenè®¡ç®—fieldä¸ªæ•°</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hlen <span class="keyword">user</span>:<span class="number">1</span> </span><br><span class="line">&quot;1&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hset <span class="keyword">user</span>:<span class="number">1</span> name zzz</span><br><span class="line">&quot;0&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hset <span class="keyword">user</span>:<span class="number">1</span> name1 zdw</span><br><span class="line">&quot;1&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>hlen <span class="keyword">user</span>:<span class="number">1</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="hmsetæ‰¹é‡è®¾å€¼"><a href="#hmsetæ‰¹é‡è®¾å€¼" class="headerlink" title="hmsetæ‰¹é‡è®¾å€¼"></a>hmsetæ‰¹é‡è®¾å€¼</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/dbad743d5eed4f7eb98c39e345ba2687.png" alt="image.png"></p><h4 id="hmgetæ‰¹é‡å–å€¼"><a href="#hmgetæ‰¹é‡å–å€¼" class="headerlink" title="hmgetæ‰¹é‡å–å€¼"></a>hmgetæ‰¹é‡å–å€¼</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/04c34b6e61004b32835ff377a05a5586.png" alt="image.png"></p><h4 id="hexistsåˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨"><a href="#hexistsåˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨" class="headerlink" title="hexistsåˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨"></a>hexistsåˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/7a182a0b69dc43c7a76f2119eca3910e.png" alt="image.png"></p><p>è‹¥å­˜åœ¨è¿”å›1ï¼Œä¸å­˜åœ¨è¿”å›0</p><h4 id="hkeysè·å–æ‰€æœ‰field"><a href="#hkeysè·å–æ‰€æœ‰field" class="headerlink" title="hkeysè·å–æ‰€æœ‰field"></a>hkeysè·å–æ‰€æœ‰field</h4><p>å®ƒè¿”å›æŒ‡å®šå“ˆå¸Œé”®æ‰€æœ‰çš„field</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/7f84f9381fcf48a0ac43af16dbea6b6c.png" alt="image.png"></p><h4 id="hvalsè·å–æ‰€æœ‰value"><a href="#hvalsè·å–æ‰€æœ‰value" class="headerlink" title="hvalsè·å–æ‰€æœ‰value"></a>hvalsè·å–æ‰€æœ‰value</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/d4e3825c1bd446da9973b971834c37be.png" alt="image.png"></p><h4 id="hgetallè·å–æ‰€æœ‰fieldä¸value"><a href="#hgetallè·å–æ‰€æœ‰fieldä¸value" class="headerlink" title="hgetallè·å–æ‰€æœ‰fieldä¸value"></a>hgetallè·å–æ‰€æœ‰fieldä¸value</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/338a05689b304021aa9b1cd6b601ffd9.png" alt="image.png"></p><p>åœ¨ä½¿ç”¨hgetallæ—¶ï¼Œå¦‚æœå“ˆå¸Œå…ƒç´ ä¸ªæ•°æ¯”è¾ƒå¤šï¼Œä¼šå­˜åœ¨é˜»å¡Redisçš„å¯èƒ½ã€‚å¦‚æœåªéœ€è¦è·å–éƒ¨åˆ†fieldï¼Œå¯ä»¥ä½¿ç”¨hmgetï¼Œå¦‚æœä¸€å®šè¦è·å–å…¨éƒ¨field-valueï¼Œå¯ä»¥ä½¿ç”¨hscanå‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šæ¸è¿›å¼éå†å“ˆå¸Œç±»å‹ï¼Œhscanå°†åœ¨åé¢çš„ç« èŠ‚ä»‹ç»ã€‚</p><h4 id="hincrbyå¢åŠ "><a href="#hincrbyå¢åŠ " class="headerlink" title="hincrbyå¢åŠ "></a>hincrbyå¢åŠ </h4><p>hincrbyå’Œ hincrbyfloatï¼Œå°±åƒincrbyå’Œincrbyfloatå‘½ä»¤ä¸€æ ·ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½œç”¨åŸŸæ˜¯filedã€‚</p><h4 id="hstrlen-è®¡ç®—valueçš„å­—ç¬¦ä¸²é•¿åº¦"><a href="#hstrlen-è®¡ç®—valueçš„å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="hstrlen è®¡ç®—valueçš„å­—ç¬¦ä¸²é•¿åº¦"></a>hstrlen è®¡ç®—valueçš„å­—ç¬¦ä¸²é•¿åº¦</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/4c52aa4d0f0c4841afa87011982c2151.png" alt="image.png"></p><h4 id="å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦-1"><a href="#å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦"></a>å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦</h4><p>å“ˆå¸Œç±»å‹çš„æ“ä½œå‘½ä»¤ä¸­ï¼Œhdel,hmget,hmsetçš„æ—¶é—´å¤æ‚åº¦å’Œå‘½ä»¤æ‰€å¸¦çš„fieldçš„ä¸ªæ•°ç›¸å…³O(k)ï¼Œhkeys,hgetall,hvalså’Œå­˜å‚¨çš„fieldçš„æ€»æ•°ç›¸å…³ï¼ŒO(N)ã€‚å…¶ä½™çš„å‘½ä»¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>ä»å‰é¢çš„æ“ä½œå¯ä»¥çœ‹å‡ºï¼ŒStringå’ŒHashçš„æ“ä½œéå¸¸ç±»ä¼¼ï¼Œé‚£ä¸ºä»€ä¹ˆè¦å¼„ä¸€ä¸ªhashå‡ºæ¥å­˜å‚¨ã€‚</p><p>å“ˆå¸Œç±»å‹æ¯”è¾ƒé€‚å®œå­˜æ”¾å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒä¸‹ï¼Œå¦‚æœæ•°æ®åº“ä¸­è¡¨è®°å½•userä¸ºï¼š</p><div class="table-container"><table><thead><tr><th>id</th><th>name</th><th>age</th></tr></thead><tbody><tr><td>1</td><td>zdw</td><td>18</td></tr><tr><td>2</td><td>msb</td><td>20</td></tr></tbody></table></div><p><strong>1ã€ä½¿ç”¨Stringç±»å‹</strong></p><p>éœ€è¦ä¸€æ¡æ¡å»æ’å…¥è·å–ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">user</span>:<span class="number">1</span>:name zdw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">user</span>:<span class="number">1</span>:age  <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">user</span>:<span class="number">2</span>:name msb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">user</span>:<span class="number">2</span>:age  <span class="number">20</span>;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚ï¼Œæ¯ä¸ªé”®å¯¹åº”ä¸€ä¸ªå€¼</strong></p><p><strong>ç¼ºç‚¹ï¼šé”®æ•°è¿‡å¤šï¼Œå ç”¨å†…å­˜å¤šï¼Œç”¨æˆ·ä¿¡æ¯è¿‡äºåˆ†æ•£ï¼Œä¸ç”¨äºç”Ÿäº§ç¯å¢ƒ</strong></p><p><strong>2ã€å°†å¯¹è±¡åºåˆ—åŒ–å­˜å…¥redis</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="keyword">user</span>:<span class="number">1</span> serialize(<span class="keyword">user</span>Info);</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹ï¼šç¼–ç¨‹ç®€å•ï¼Œè‹¥ä½¿ç”¨åºåˆ—åŒ–åˆç†å†…å­˜ä½¿ç”¨ç‡é«˜</strong></p><p><strong>ç¼ºç‚¹ï¼šåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æœ‰ä¸€å®šå¼€é”€ï¼Œæ›´æ–°å±æ€§æ—¶éœ€è¦æŠŠuserInfoå…¨å–å‡ºæ¥è¿›è¡Œååºåˆ—åŒ–ï¼Œæ›´æ–°åå†åºåˆ—åŒ–åˆ°redis</strong></p><p><strong>3ã€ä½¿ç”¨hashç±»å‹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hmset <span class="keyword">user</span>:<span class="number">1</span> name zdw age <span class="number">18</span></span><br><span class="line"></span><br><span class="line">hmset <span class="keyword">user</span>:<span class="number">2</span> name msb age <span class="number">20</span></span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚ï¼Œä½¿ç”¨åˆç†å¯å‡å°‘å†…å­˜ç©ºé—´æ¶ˆè€—</strong></p><p><strong>ç¼ºç‚¹ï¼šè¦æ§åˆ¶å†…éƒ¨ç¼–ç æ ¼å¼ï¼Œä¸æ°å½“çš„æ ¼å¼ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜</strong></p><h2 id="åˆ—è¡¨ï¼ˆlistï¼‰"><a href="#åˆ—è¡¨ï¼ˆlistï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆlistï¼‰"></a>åˆ—è¡¨ï¼ˆlistï¼‰</h2><p>åˆ—è¡¨( list)ç±»å‹æ˜¯ç”¨æ¥å­˜å‚¨å¤šä¸ªæœ‰åºçš„å­—ç¬¦ä¸²ï¼Œaã€bã€cã€cã€bå››ä¸ªå…ƒç´ ä»å·¦åˆ°å³ç»„æˆäº†ä¸€ä¸ªæœ‰åºçš„åˆ—è¡¨,åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²ç§°ä¸ºå…ƒç´ (element)ï¼Œä¸€ä¸ªåˆ—è¡¨æœ€å¤šå¯ä»¥å­˜å‚¨(2^32-1)ä¸ªå…ƒç´ (<em>4294967295</em>)ã€‚</p><p><img src="https://zdwtop.cn/blog/b2c5e0d8bd6243e59b0c32aa5caa49f1.png" alt="image.png"></p><p>åœ¨Redis ä¸­ï¼Œå¯ä»¥å¯¹åˆ—è¡¨ä¸¤ç«¯æ’å…¥( push)å’Œå¼¹å‡º(pop)ï¼Œè¿˜å¯ä»¥è·å–æŒ‡å®šèŒƒå›´çš„å…ƒç´ åˆ—è¡¨ã€è·å–æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ ç­‰ã€‚åˆ—è¡¨æ˜¯ä¸€ç§æ¯”è¾ƒçµæ´»çš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥å……å½“æ ˆå’Œé˜Ÿåˆ—çš„è§’è‰²ï¼Œåœ¨å®é™…å¼€å‘ä¸Šæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ã€‚</p><p><strong>åˆ—è¡¨ç±»å‹æœ‰ä¸¤ä¸ªç‰¹ç‚¹:</strong></p><p>ç¬¬ä¸€ã€åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œè¿™å°±æ„å‘³ç€å¯ä»¥é€šè¿‡ç´¢å¼•ä¸‹æ ‡è·å–æŸä¸ªå…ƒç´ æˆ–è€…æŸä¸ªèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨ã€‚</p><p>ç¬¬äºŒã€åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯é‡å¤çš„ã€‚</p><h3 id="æ“ä½œå‘½ä»¤-2"><a href="#æ“ä½œå‘½ä»¤-2" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h3><h4 id="lrange-è·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨ï¼ˆä¸ä¼šåˆ é™¤å…ƒç´ ï¼‰"><a href="#lrange-è·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨ï¼ˆä¸ä¼šåˆ é™¤å…ƒç´ ï¼‰" class="headerlink" title="lrange è·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨ï¼ˆä¸ä¼šåˆ é™¤å…ƒç´ ï¼‰"></a>lrange è·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨ï¼ˆä¸ä¼šåˆ é™¤å…ƒç´ ï¼‰</h4><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lrange</span> key start end</span><br></pre></td></tr></table></figure><p>ç´¢å¼•ä¸‹æ ‡ç‰¹ç‚¹ï¼šä»å·¦åˆ°å³ä¸º0åˆ°N-1</p><p><code>lrange 0 -1</code>å‘½ä»¤å¯ä»¥ä»å·¦åˆ°å³è·å–åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ </p><h4 id="rpush-å‘å³æ’å…¥"><a href="#rpush-å‘å³æ’å…¥" class="headerlink" title="rpush å‘å³æ’å…¥"></a>rpush å‘å³æ’å…¥</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>rpush demolist a</span><br><span class="line">&quot;1&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>rpush demolist b</span><br><span class="line">&quot;2&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>rpush demolist c</span><br><span class="line">&quot;3&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>rpush demolist d</span><br><span class="line">&quot;4&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>lrange demolist <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;a&quot;</span><br><span class="line"><span class="number">2</span>) &quot;b&quot;</span><br><span class="line"><span class="number">3</span>) &quot;c&quot;</span><br><span class="line"><span class="number">4</span>) &quot;d&quot;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/33e03ce96b3248ceaac60ccb4fc0b1d8.png" alt="image.png"></p><h4 id="lpush-å‘å·¦æ’å…¥"><a href="#lpush-å‘å·¦æ’å…¥" class="headerlink" title="lpush å‘å·¦æ’å…¥"></a>lpush å‘å·¦æ’å…¥</h4><p><img src="https://zdwtop.cn/blog/302233f9f0284e46ae26930ac8be1cd2.png" alt="image.png"></p><p><img src="https://zdwtop.cn/blog/abba1d7c8aea4e42a83ca17476c4b9cd.png" alt="image.png"></p><h4 id="linsert-åœ¨æŸä¸ªå…ƒç´ å‰æˆ–åæ’å…¥æ–°å…ƒç´ "><a href="#linsert-åœ¨æŸä¸ªå…ƒç´ å‰æˆ–åæ’å…¥æ–°å…ƒç´ " class="headerlink" title="linsert åœ¨æŸä¸ªå…ƒç´ å‰æˆ–åæ’å…¥æ–°å…ƒç´ "></a>linsert åœ¨æŸä¸ªå…ƒç´ å‰æˆ–åæ’å…¥æ–°å…ƒç´ </h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">LINSERT key BEFORE<span class="operator">|</span>AFTER pivot <span class="keyword">value</span></span><br><span class="line"># aä¹‹åæŸ¥ä¸ªg</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>LINSERT list before a g</span><br><span class="line">&quot;5&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>lrange list <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;g&quot;</span><br><span class="line"><span class="number">2</span>) &quot;a&quot;</span><br><span class="line"><span class="number">3</span>) &quot;b&quot;</span><br><span class="line"><span class="number">4</span>) &quot;c&quot;</span><br><span class="line"><span class="number">5</span>) &quot;d&quot;</span><br><span class="line"># aä¹‹åæ’ä¸ªf</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>LINSERT list after a f</span><br><span class="line">&quot;6&quot;</span><br><span class="line">emos:<span class="number">3</span><span class="operator">&gt;</span>lrange list <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;g&quot;</span><br><span class="line"><span class="number">2</span>) &quot;a&quot;</span><br><span class="line"><span class="number">3</span>) &quot;f&quot;</span><br><span class="line"><span class="number">4</span>) &quot;b&quot;</span><br><span class="line"><span class="number">5</span>) &quot;c&quot;</span><br><span class="line"><span class="number">6</span>) &quot;d&quot;</span><br></pre></td></tr></table></figure><h4 id="lpop-ä»åˆ—è¡¨å·¦ä¾§å¼¹å‡ºï¼ˆä¼šåˆ é™¤å…ƒç´ ï¼‰"><a href="#lpop-ä»åˆ—è¡¨å·¦ä¾§å¼¹å‡ºï¼ˆä¼šåˆ é™¤å…ƒç´ ï¼‰" class="headerlink" title="lpop ä»åˆ—è¡¨å·¦ä¾§å¼¹å‡ºï¼ˆä¼šåˆ é™¤å…ƒç´ ï¼‰"></a>lpop ä»åˆ—è¡¨å·¦ä¾§å¼¹å‡ºï¼ˆä¼šåˆ é™¤å…ƒç´ ï¼‰</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/cf3b7a2f1d85434689734dea9d467c0f.png" alt="image.png">r</p><p>è¯·æ³¨æ„ï¼Œå¼¹å‡ºæ¥å…ƒç´ å°±æ²¡äº†ã€‚</p><h4 id="rpop-ä»åˆ—è¡¨å³ä¾§å¼¹å‡º"><a href="#rpop-ä»åˆ—è¡¨å³ä¾§å¼¹å‡º" class="headerlink" title="rpop ä»åˆ—è¡¨å³ä¾§å¼¹å‡º"></a>rpop ä»åˆ—è¡¨å³ä¾§å¼¹å‡º</h4><p>rpopå°†ä¼šæŠŠåˆ—è¡¨æœ€å³ä¾§çš„å…ƒç´ då¼¹å‡ºã€‚</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/6f55895f739b4a32a1e1c8fde0649031.png" alt="image.png"></p><h4 id="lrem-å¯¹æŒ‡å®šå…ƒç´ è¿›è¡Œåˆ é™¤"><a href="#lrem-å¯¹æŒ‡å®šå…ƒç´ è¿›è¡Œåˆ é™¤" class="headerlink" title="lrem å¯¹æŒ‡å®šå…ƒç´ è¿›è¡Œåˆ é™¤"></a>lrem å¯¹æŒ‡å®šå…ƒç´ è¿›è¡Œåˆ é™¤</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/e533d9a779074c3286d81031ca408450.png" alt="image.png"></p><p>lremå‘½ä»¤ä¼šä»åˆ—è¡¨ä¸­æ‰¾åˆ°ç­‰äºvalueçš„å…ƒç´ è¿›è¡Œåˆ é™¤ï¼Œæ ¹æ®countçš„ä¸åŒåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ul><li>count&gt;0ï¼Œä»å·¦åˆ°å³,åˆ é™¤æœ€å¤šcountä¸ªå…ƒç´ ã€‚</li></ul><ul><li>count&#x3c;0ï¼Œä»å³åˆ°å·¦,åˆ é™¤æœ€å¤šcountç»å¯¹å€¼ä¸ªå…ƒç´ ã€‚</li></ul><ul><li>count=0ï¼Œåˆ é™¤æ‰€æœ‰ã€‚</li></ul><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/ad2833b4c011453f91928891e8a0e036.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/584b9986d80c46668f3fda91c466e340.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/ba19aa483a884537a687051f80967ebb.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/0480e571bc1e44f79b2e80b376ec288e.png" alt="image.png"></p><p>è¿”å›å€¼æ˜¯å®é™…åˆ é™¤å…ƒç´ çš„ä¸ªæ•°ã€‚</p><h4 id="ltirm-æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨"><a href="#ltirm-æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨" class="headerlink" title="ltirm æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨"></a>ltirm æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨</h4><p>ä¾‹å¦‚æƒ³ä¿ç•™åˆ—è¡¨ä¸­ç¬¬0ä¸ªåˆ°ç¬¬1ä¸ªå…ƒç´ </p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/8e52841e88f34a05888da5df0a8a4121.png" alt="image.png">ls</p><h4 id="lsetä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ "><a href="#lsetä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ " class="headerlink" title="lsetä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ "></a>lsetä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ </h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/663c682ce56444e382fc3f1b4da4253c.png" alt="image.png"></p><h4 id="lindex-è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ "><a href="#lindex-è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ " class="headerlink" title="lindex è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ "></a>lindex è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ </h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/f0b6ab8eca224305bcd97a4916c33947.png" alt="image.png">l</p><h4 id="llen-è·å–åˆ—è¡¨é•¿åº¦"><a href="#llen-è·å–åˆ—è¡¨é•¿åº¦" class="headerlink" title="llen è·å–åˆ—è¡¨é•¿åº¦"></a>llen è·å–åˆ—è¡¨é•¿åº¦</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/31f34b4b3ec24f2e89d42b958dc3f343.png" alt="image.png"></p><h4 id="blpopå’Œbrpopé˜»å¡å¼å¼¹å‡ºå…ƒç´ "><a href="#blpopå’Œbrpopé˜»å¡å¼å¼¹å‡ºå…ƒç´ " class="headerlink" title="blpopå’Œbrpopé˜»å¡å¼å¼¹å‡ºå…ƒç´ "></a>blpopå’Œbrpopé˜»å¡å¼å¼¹å‡ºå…ƒç´ </h4><p>blpopå’Œbrpopæ˜¯lpopå’Œrpopçš„é˜»å¡ç‰ˆæœ¬ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æ”¯æŒå¤šä¸ªåˆ—è¡¨ç±»å‹ï¼Œä¹Ÿæ”¯æŒè®¾å®šé˜»å¡æ—¶é—´ï¼Œå•ä½ç§’ï¼Œå¦‚æœé˜»å¡æ—¶é—´ä¸º0ï¼Œè¡¨ç¤ºä¸€ç›´é˜»å¡ä¸‹å»ã€‚æˆ‘ä»¬ä»¥brpopä¸ºä¾‹è¯´æ˜ã€‚</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/a83e89040af7495da20b56ef826e6520.png" alt="image.png"></p><p>Aå®¢æˆ·ç«¯é˜»å¡äº†ï¼ˆå› ä¸ºæ²¡æœ‰å…ƒç´ å°±ä¼šé˜»å¡ï¼‰</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/c11fe0ec650c401cbd69500d99805f85.png" alt="image.png"></p><p>Aå®¢æˆ·ç«¯ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚æ­¤æ—¶æˆ‘ä»¬ä»å¦ä¸€ä¸ªå®¢æˆ·ç«¯Bæ‰§è¡Œ</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/c4c83e7fe2ac4f6385ac04b1ecbcf231.png" alt="image.png"></p><p>Aå®¢æˆ·ç«¯åˆ™è¾“å‡º</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/4b2c7c7b95da4190ab6c772075faec7c.png" alt="image.png"></p><p>æ³¨æ„ï¼šbrpopåé¢å¦‚æœæ˜¯å¤šä¸ªé”®ï¼Œé‚£ä¹ˆbrpopä¼šä»å·¦è‡³å³éå†é”®ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªé”®èƒ½å¼¹å‡ºå…ƒç´ ï¼Œå®¢æˆ·ç«¯ç«‹å³è¿”å›ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯-2"><a href="#ä½¿ç”¨åœºæ™¯-2" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>åˆ—è¡¨ç±»å‹å¯ä»¥ç”¨äºæ¯”å¦‚ï¼š</p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒRedis çš„ lpush+brpopå‘½ä»¤ç»„åˆå³å¯å®ç°é˜»å¡é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å®¢æˆ·ç«¯ä½¿ç”¨lrpushä»åˆ—è¡¨å·¦ä¾§æ’å…¥å…ƒç´ ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å®¢æˆ·ç«¯ä½¿ç”¨brpopå‘½ä»¤é˜»å¡å¼çš„â€œæŠ¢â€åˆ—è¡¨å°¾éƒ¨çš„å…ƒç´ ,å¤šä¸ªå®¢æˆ·ç«¯ä¿è¯äº†æ¶ˆè´¹çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚</p><p><strong>æ–‡ç« åˆ—è¡¨</strong></p><p>æ¯ä¸ªç”¨æˆ·æœ‰å±äºè‡ªå·±çš„æ–‡ç« åˆ—è¡¨ï¼Œç°éœ€è¦åˆ†é¡µå±•ç¤ºæ–‡ç« åˆ—è¡¨ã€‚æ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ—è¡¨,å› ä¸ºåˆ—è¡¨ä¸ä½†æ˜¯æœ‰åºçš„,åŒæ—¶æ”¯æŒæŒ‰ç…§ç´¢å¼•èŒƒå›´è·å–å…ƒç´ ã€‚</p><p><strong>å®ç°å…¶ä»–æ•°æ®ç»“æ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lpush <span class="operator">+</span>lpop <span class="operator">=</span>Stackï¼ˆæ ˆ)</span><br><span class="line"></span><br><span class="line">lpush <span class="operator">+</span> rpop <span class="operator">=</span>Queue(é˜Ÿåˆ—)</span><br><span class="line"></span><br><span class="line">lpsh <span class="operator">+</span> ltrim <span class="operator">=</span>Capped Collectionï¼ˆæœ‰é™é›†åˆ)</span><br><span class="line"></span><br><span class="line">lpush <span class="operator">+</span> brpop<span class="operator">=</span>Message Queue(æ¶ˆæ¯é˜Ÿåˆ—)</span><br></pre></td></tr></table></figure><h2 id="é›†åˆï¼ˆsetï¼‰"><a href="#é›†åˆï¼ˆsetï¼‰" class="headerlink" title="é›†åˆï¼ˆsetï¼‰"></a>é›†åˆï¼ˆsetï¼‰</h2><p><img src="https://zdwtop.cn/blog/4b28f3a2aa6b4d4f9c5dd09317508102.png" alt="image.png"></p><p>é›†åˆ( setï¼‰ç±»å‹ä¹Ÿæ˜¯ç”¨æ¥ä¿å­˜å¤šä¸ªçš„å­—ç¬¦ä¸²å…ƒç´ ,ä½†å’Œåˆ—è¡¨ç±»å‹ä¸ä¸€æ ·çš„æ˜¯ï¼Œ<strong>é›†åˆä¸­ä¸å…è®¸æœ‰é‡å¤å…ƒç´ ,å¹¶ä¸”é›†åˆä¸­çš„å…ƒç´ æ˜¯æ— åºçš„,ä¸èƒ½é€šè¿‡ç´¢å¼•ä¸‹æ ‡è·å–å…ƒç´ ã€‚</strong></p><p>ä¸€ä¸ªé›†åˆæœ€å¤šå¯ä»¥å­˜å‚¨2çš„32æ¬¡æ–¹-1ä¸ªå…ƒç´ ã€‚Redisé™¤äº†æ”¯æŒé›†åˆå†…çš„å¢åˆ æ”¹æŸ¥ï¼ŒåŒæ—¶è¿˜æ”¯æŒå¤šä¸ªé›†åˆå–<strong>äº¤é›†ã€å¹¶é›†ã€å·®é›†</strong>ï¼Œåˆç†åœ°ä½¿ç”¨å¥½é›†åˆç±»å‹,èƒ½åœ¨å®é™…å¼€å‘ä¸­è§£å†³å¾ˆå¤šå®é™…é—®é¢˜ã€‚</p><h3 id="é›†åˆå†…æ“ä½œå‘½ä»¤"><a href="#é›†åˆå†…æ“ä½œå‘½ä»¤" class="headerlink" title="é›†åˆå†…æ“ä½œå‘½ä»¤"></a>é›†åˆå†…æ“ä½œå‘½ä»¤</h3><h4 id="sadd-æ·»åŠ å…ƒç´ "><a href="#sadd-æ·»åŠ å…ƒç´ " class="headerlink" title="sadd æ·»åŠ å…ƒç´ "></a>sadd æ·»åŠ å…ƒç´ </h4><p>å…è®¸æ·»åŠ å¤šä¸ªï¼Œè¿”å›ç»“æœä¸ºæ·»åŠ æˆåŠŸçš„å…ƒç´ ä¸ªæ•°</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/d94f1e8871054f6dad9dad1d245d3dfb.png" alt="image.png"></p><h4 id="srem-åˆ é™¤å…ƒç´ "><a href="#srem-åˆ é™¤å…ƒç´ " class="headerlink" title="srem åˆ é™¤å…ƒç´ "></a>srem åˆ é™¤å…ƒç´ </h4><p>å…è®¸åˆ é™¤å¤šä¸ªï¼Œè¿”å›ç»“æœä¸ºæˆåŠŸåˆ é™¤å…ƒç´ ä¸ªæ•°</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/fdcc39ccdf4c4ca1bb26003e65d40ec7.png" alt="image.png"></p><h4 id="scard-è®¡ç®—å…ƒç´ ä¸ªæ•°"><a href="#scard-è®¡ç®—å…ƒç´ ä¸ªæ•°" class="headerlink" title="scard è®¡ç®—å…ƒç´ ä¸ªæ•°"></a>scard è®¡ç®—å…ƒç´ ä¸ªæ•°</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/292819f68b294180ad037dc590e8c562.png" alt="image.png"></p><h4 id="sismember-åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­"><a href="#sismember-åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­" class="headerlink" title="sismember åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­"></a>sismember åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</h4><p>å¦‚æœç»™å®šå…ƒç´ elementåœ¨é›†åˆå†…è¿”å›1ï¼Œåä¹‹è¿”å›0</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/94148d18517a44d99cd6c7716d07f9b1.png" alt="image.png"></p><h4 id="srandmember-éšæœºä»é›†åˆè¿”å›æŒ‡å®šä¸ªæ•°å…ƒç´ "><a href="#srandmember-éšæœºä»é›†åˆè¿”å›æŒ‡å®šä¸ªæ•°å…ƒç´ " class="headerlink" title="srandmember éšæœºä»é›†åˆè¿”å›æŒ‡å®šä¸ªæ•°å…ƒç´ "></a>srandmember éšæœºä»é›†åˆè¿”å›æŒ‡å®šä¸ªæ•°å…ƒç´ </h4><p>æŒ‡å®šä¸ªæ•°å¦‚æœä¸å†™é»˜è®¤ä¸º1</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/2b386e0de6df44c685dc69e95bf4e7a2.png" alt="image.png"></p><h4 id="spop-ä»é›†åˆéšæœºå¼¹å‡ºå…ƒç´ "><a href="#spop-ä»é›†åˆéšæœºå¼¹å‡ºå…ƒç´ " class="headerlink" title="spop ä»é›†åˆéšæœºå¼¹å‡ºå…ƒç´ "></a>spop ä»é›†åˆéšæœºå¼¹å‡ºå…ƒç´ </h4><p>åŒæ ·å¯ä»¥æŒ‡å®šä¸ªæ•°ï¼Œå¦‚æœä¸å†™é»˜è®¤ä¸º1ï¼Œæ³¨æ„ï¼Œæ—¢ç„¶æ˜¯å¼¹å‡ºï¼Œspopå‘½ä»¤æ‰§è¡Œå,å…ƒç´ ä¼šä»é›†åˆä¸­åˆ é™¤,è€Œsrandmemberä¸ä¼šã€‚</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/172580272c8b4413908328fad51e0537.png" alt="image.png"></p><h4 id="smembers-è·å–æ‰€æœ‰å…ƒç´ -ä¸ä¼šå¼¹å‡ºå…ƒç´ "><a href="#smembers-è·å–æ‰€æœ‰å…ƒç´ -ä¸ä¼šå¼¹å‡ºå…ƒç´ " class="headerlink" title="smembers è·å–æ‰€æœ‰å…ƒç´ (ä¸ä¼šå¼¹å‡ºå…ƒç´ )"></a>smembers è·å–æ‰€æœ‰å…ƒç´ (ä¸ä¼šå¼¹å‡ºå…ƒç´ )</h4><p>è¿”å›ç»“æœæ˜¯æ— åºçš„</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/f16f1615505b49a2aa5198a75168c4b2.png" alt="image.png"></p><h4 id="é›†åˆé—´æ“ä½œå‘½ä»¤"><a href="#é›†åˆé—´æ“ä½œå‘½ä»¤" class="headerlink" title="é›†åˆé—´æ“ä½œå‘½ä»¤"></a>é›†åˆé—´æ“ä½œå‘½ä»¤</h4><p>ç°åœ¨æœ‰ä¸¤ä¸ªé›†åˆ,å®ƒä»¬åˆ†åˆ«æ˜¯set1å’Œset2</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/8546a5e8eff348bd8c4879fbc37db67b.png" alt="image.png"></p><h4 id="sinter-æ±‚å¤šä¸ªé›†åˆçš„äº¤é›†"><a href="#sinter-æ±‚å¤šä¸ªé›†åˆçš„äº¤é›†" class="headerlink" title="sinter æ±‚å¤šä¸ªé›†åˆçš„äº¤é›†"></a>sinter æ±‚å¤šä¸ªé›†åˆçš„äº¤é›†</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/80dd47f94b06433daa0b1f19be6a684f.png" alt="image.png"></p><h4 id="suinon-æ±‚å¤šä¸ªé›†åˆçš„å¹¶é›†"><a href="#suinon-æ±‚å¤šä¸ªé›†åˆçš„å¹¶é›†" class="headerlink" title="suinon æ±‚å¤šä¸ªé›†åˆçš„å¹¶é›†"></a>suinon æ±‚å¤šä¸ªé›†åˆçš„å¹¶é›†</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/614e67ffe97646389a781099b6e074fd.png" alt="image.png"></p><h4 id="sdiff-æ±‚å¤šä¸ªé›†åˆçš„å·®é›†"><a href="#sdiff-æ±‚å¤šä¸ªé›†åˆçš„å·®é›†" class="headerlink" title="sdiff æ±‚å¤šä¸ªé›†åˆçš„å·®é›†"></a>sdiff æ±‚å¤šä¸ªé›†åˆçš„å·®é›†</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/4c0e783c37e64c15866bb08ccc0abbf8.png" alt="image.png"></p><h4 id="å°†äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜"><a href="#å°†äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜" class="headerlink" title="å°†äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜"></a>å°†äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜</h4><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sinterstore destination <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br><span class="line">suionstore destination <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br><span class="line">sdiffstore destination <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br></pre></td></tr></table></figure><p>é›†åˆé—´çš„è¿ç®—åœ¨å…ƒç´ è¾ƒå¤šçš„æƒ…å†µä¸‹ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥ Redisæä¾›äº†ä¸Šé¢ä¸‰ä¸ªå‘½ä»¤(åŸå‘½ä»¤+store)å°†é›†åˆé—´äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜åœ¨destination keyä¸­ï¼Œä¾‹å¦‚ï¼š</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/450fcb6c2e2342b39925c1779a4ba369.png" alt="image.png"></p><h4 id="ä½¿ç”¨åœºæ™¯-3"><a href="#ä½¿ç”¨åœºæ™¯-3" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>é›†åˆç±»å‹æ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯<strong>æ ‡ç­¾(tag)</strong>ã€‚ä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·å¯èƒ½å¯¹å¨±ä¹ã€ä½“è‚²æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¦ä¸€ä¸ªç”¨æˆ·å¯èƒ½å¯¹å†å²ã€æ–°é—»æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œè¿™äº›å…´è¶£ç‚¹å°±æ˜¯æ ‡ç­¾ã€‚æœ‰äº†è¿™äº›æ•°æ®å°±å¯ä»¥å¾—åˆ°å–œæ¬¢åŒä¸€ä¸ªæ ‡ç­¾çš„äººï¼Œä»¥åŠç”¨æˆ·çš„å…±åŒå–œå¥½çš„æ ‡ç­¾ï¼Œè¿™äº›æ•°æ®å¯¹äºç”¨æˆ·ä½“éªŒä»¥åŠå¢å¼ºç”¨æˆ·é»åº¦æ¯”è¾ƒé‡è¦ã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªç”µå­å•†åŠ¡çš„ç½‘ç«™ä¼šå¯¹ä¸åŒæ ‡ç­¾çš„ç”¨æˆ·åšä¸åŒç±»å‹çš„æ¨èï¼Œæ¯”å¦‚å¯¹æ•°ç äº§å“æ¯”è¾ƒæ„Ÿå…´è¶£çš„äººï¼Œåœ¨å„ä¸ªé¡µé¢æˆ–è€…é€šè¿‡é‚®ä»¶çš„å½¢å¼ç»™ä»–ä»¬æ¨èæœ€æ–°çš„æ•°ç äº§å“ï¼Œé€šå¸¸ä¼šä¸ºç½‘ç«™å¸¦æ¥æ›´å¤šçš„åˆ©ç›Šã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œé›†åˆè¿˜å¯ä»¥é€šè¿‡ç”Ÿæˆéšæœºæ•°è¿›è¡Œæ¯”å¦‚æŠ½å¥–æ´»åŠ¨ï¼Œä»¥åŠç¤¾äº¤å›¾è°±ç­‰ç­‰ã€‚</p><h2 id="æœ‰åºé›†åˆï¼ˆZSETï¼‰"><a href="#æœ‰åºé›†åˆï¼ˆZSETï¼‰" class="headerlink" title="æœ‰åºé›†åˆï¼ˆZSETï¼‰"></a>æœ‰åºé›†åˆï¼ˆZSETï¼‰</h2><p><img src="https://zdwtop.cn/blog/fe24d4258f4b4dd99ad52a6752a840ae.png" alt="image.png"></p><p>æœ‰åºé›†åˆç›¸å¯¹äºå“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆæ¥è¯´ä¼šæœ‰ä¸€ç‚¹ç‚¹é™Œç”Ÿ,ä½†æ—¢ç„¶å«æœ‰åºé›†åˆ,é‚£ä¹ˆå®ƒå’Œé›†åˆå¿…ç„¶æœ‰ç€è”ç³»,<strong>å®ƒä¿ç•™äº†é›†åˆä¸èƒ½æœ‰é‡å¤æˆå‘˜çš„ç‰¹æ€§,ä½†ä¸åŒçš„æ˜¯,æœ‰åºé›†åˆä¸­çš„å…ƒç´ å¯ä»¥æ’åºã€‚</strong>ä½†æ˜¯å®ƒå’Œåˆ—è¡¨ä½¿ç”¨ç´¢å¼•ä¸‹æ ‡ä½œä¸ºæ’åºä¾æ®ä¸åŒçš„æ˜¯,å®ƒ<strong>ç»™æ¯ä¸ªå…ƒç´ è®¾ç½®ä¸€ä¸ªåˆ†æ•°( score)ä½œä¸ºæ’åºçš„ä¾æ®ã€‚</strong></p><p>æœ‰åºé›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œä½†æ˜¯<strong>scoreå¯ä»¥é‡å¤</strong>ï¼Œå°±å’Œä¸€ä¸ªç­é‡Œçš„åŒå­¦å­¦å·ä¸èƒ½é‡å¤,ä½†æ˜¯è€ƒè¯•æˆç»©å¯ä»¥ç›¸åŒã€‚</p><p>æœ‰åºé›†åˆæä¾›äº†è·å–æŒ‡å®šåˆ†æ•°å’Œå…ƒç´ èŒƒå›´æŸ¥è¯¢ã€è®¡ç®—æˆå‘˜æ’åç­‰åŠŸèƒ½ï¼Œåˆç†çš„åˆ©ç”¨æœ‰åºé›†åˆï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­è§£å†³å¾ˆå¤šé—®é¢˜ã€‚</p><h3 id="é›†åˆå†…æ“ä½œå‘½ä»¤-1"><a href="#é›†åˆå†…æ“ä½œå‘½ä»¤-1" class="headerlink" title="é›†åˆå†…æ“ä½œå‘½ä»¤"></a>é›†åˆå†…æ“ä½œå‘½ä»¤</h3><h4 id="zaddæ·»åŠ æˆå‘˜"><a href="#zaddæ·»åŠ æˆå‘˜" class="headerlink" title="zaddæ·»åŠ æˆå‘˜"></a>zaddæ·»åŠ æˆå‘˜</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/353cb7b71ca04daab3cf7fb99ceb36f6.png" alt="image.png"></p><p>è¿”å›ç»“æœä»£è¡¨æˆåŠŸæ·»åŠ æˆå‘˜çš„ä¸ªæ•°</p><p>è¦æ³¨æ„:</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/a8a349c237304f6c94f0a16f5ae3ed24.png" alt="image.png"></p><p>zaddå‘½ä»¤è¿˜æœ‰å››ä¸ªé€‰é¡¹nxã€xxã€chã€incr å››ä¸ªé€‰é¡¹</p><ul><li>nx: memberå¿…é¡»ä¸å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ·»åŠ ã€‚</li></ul><ul><li>xx: memberå¿…é¡»å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸ,ç”¨äºæ›´æ–°ã€‚</li></ul><ul><li>ch: è¿”å›æ­¤æ¬¡æ“ä½œå,æœ‰åºé›†åˆå…ƒç´ å’Œåˆ†æ•°å‘ç”Ÿå˜åŒ–çš„ä¸ªæ•°</li></ul><ul><li>incr: å¯¹scoreåšå¢åŠ ï¼Œç›¸å½“äºåé¢ä»‹ç»çš„<code>zincrby</code></li></ul><h4 id="zcard-è®¡ç®—æˆå‘˜ä¸ªæ•°"><a href="#zcard-è®¡ç®—æˆå‘˜ä¸ªæ•°" class="headerlink" title="zcard è®¡ç®—æˆå‘˜ä¸ªæ•°"></a>zcard è®¡ç®—æˆå‘˜ä¸ªæ•°</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/9eb0d86663fd45e6a3032c05c1870339.png" alt="image.png"></p><h4 id="zscore-è®¡ç®—æŸä¸ªæˆå‘˜çš„åˆ†æ•°"><a href="#zscore-è®¡ç®—æŸä¸ªæˆå‘˜çš„åˆ†æ•°" class="headerlink" title="zscore è®¡ç®—æŸä¸ªæˆå‘˜çš„åˆ†æ•°"></a>zscore è®¡ç®—æŸä¸ªæˆå‘˜çš„åˆ†æ•°</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/7da7b741030b4b2b9863d569198f001d.png" alt="image.png"></p><p>å¦‚æœæˆå‘˜ä¸å­˜åœ¨åˆ™è¿”å›nil</p><h4 id="zrankè®¡ç®—æˆå‘˜çš„æ’å"><a href="#zrankè®¡ç®—æˆå‘˜çš„æ’å" class="headerlink" title="zrankè®¡ç®—æˆå‘˜çš„æ’å"></a>zrankè®¡ç®—æˆå‘˜çš„æ’å</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/7395eb62a4fa4e669cf201799aca069e.png" alt="image.png"></p><p>zrankæ˜¯ä»åˆ†æ•°ä»ä½åˆ°é«˜è¿”å›æ’å</p><p><code>zrevrank</code>åä¹‹å¾ˆæ˜æ˜¾ï¼Œæ’åä»0å¼€å§‹è®¡ç®—ã€‚</p><h4 id="zrem-åˆ é™¤æˆå‘˜"><a href="#zrem-åˆ é™¤æˆå‘˜" class="headerlink" title="zrem åˆ é™¤æˆå‘˜"></a>zrem åˆ é™¤æˆå‘˜</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/d4e23637dda8461abba76c303cfbfbad.png" alt="image.png"></p><p>å…è®¸ä¸€æ¬¡åˆ é™¤å¤šä¸ªæˆå‘˜ã€‚</p><p>è¿”å›ç»“æœä¸ºæˆåŠŸåˆ é™¤çš„ä¸ªæ•°ã€‚</p><h4 id="zincrby-å¢åŠ æˆå‘˜çš„åˆ†æ•°"><a href="#zincrby-å¢åŠ æˆå‘˜çš„åˆ†æ•°" class="headerlink" title="zincrby å¢åŠ æˆå‘˜çš„åˆ†æ•°"></a>zincrby å¢åŠ æˆå‘˜çš„åˆ†æ•°</h4><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/b1a0193040334a0f90ddb66bce53fe0c.png" alt="image.png"></p><h4 id="zrangeå’Œzrevrangeè¿”å›æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜"><a href="#zrangeå’Œzrevrangeè¿”å›æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜" class="headerlink" title="zrangeå’Œzrevrangeè¿”å›æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜"></a>zrangeå’Œzrevrangeè¿”å›æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜</h4><p>æœ‰åºé›†åˆæ˜¯æŒ‰ç…§åˆ†å€¼æ’åçš„ï¼Œzrangeæ˜¯ä»ä½åˆ°é«˜è¿”å›,zrevrangeåä¹‹ã€‚å¦‚æœåŠ ä¸Š<br>withscoresé€‰é¡¹ï¼ŒåŒæ—¶ä¼šè¿”å›æˆå‘˜çš„åˆ†æ•°</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/d2a8d64fce484b64bf95f0a886fa1f45.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/a17fc90c48dd498f9539f5b834ada3bb.png" alt="image.png"></p><h4 id="zrangebyscoreè¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜"><a href="#zrangebyscoreè¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜" class="headerlink" title="zrangebyscoreè¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜"></a>zrangebyscoreè¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜</h4><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zrangebyscore key <span class="built_in">min</span> <span class="built_in">max</span> [withscores] [limit <span class="built_in">offset</span> <span class="built_in">count</span>]</span><br><span class="line">zrevrangebyscore key <span class="built_in">max</span> <span class="built_in">min</span> [withscores][limit <span class="built_in">offset</span> <span class="built_in">count</span>]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>zrangebyscore</code>æŒ‰ç…§åˆ†æ•°ä»ä½åˆ°é«˜è¿”å›ï¼Œ<code>zrevrangebyscore</code>åä¹‹ã€‚ä¾‹å¦‚ä¸‹é¢æ“ä½œä»ä½åˆ°é«˜è¿”å›200åˆ°221åˆ†çš„æˆå‘˜ï¼Œ<code>withscores</code>é€‰é¡¹ä¼šåŒæ—¶è¿”å›æ¯ä¸ªæˆå‘˜çš„åˆ†æ•°ã€‚</p><p>åŒæ—¶<code>min</code>å’Œ<code>max</code>è¿˜æ”¯æŒå¼€åŒºé—´(å°æ‹¬å·ï¼‰å’Œé—­åŒºé—´(ä¸­æ‹¬å·)ï¼Œ-infå’Œ+infåˆ†åˆ«ä»£è¡¨æ— é™å°å’Œæ— é™å¤§:</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/de92b2a82134468ab69bbb8718ccfd1f.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/92edbaef3b2c4c4c9a7ee0daac41ad0a.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/e5dc53cdbff941c9814590973ac96499.png" alt="image.png"></p><h4 id="zcount-è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´æˆå‘˜ä¸ªæ•°"><a href="#zcount-è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´æˆå‘˜ä¸ªæ•°" class="headerlink" title="zcount è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´æˆå‘˜ä¸ªæ•°"></a>zcount è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´æˆå‘˜ä¸ªæ•°</h4><p>zcount key min max</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/82a1a39c69bf4c8395411312fd276515.png" alt="image.png"></p><h4 id="zremrangebyrank-æŒ‰å‡åºåˆ é™¤æŒ‡å®šæ’åå†…çš„å…ƒç´ "><a href="#zremrangebyrank-æŒ‰å‡åºåˆ é™¤æŒ‡å®šæ’åå†…çš„å…ƒç´ " class="headerlink" title="zremrangebyrank æŒ‰å‡åºåˆ é™¤æŒ‡å®šæ’åå†…çš„å…ƒç´ "></a>zremrangebyrank æŒ‰å‡åºåˆ é™¤æŒ‡å®šæ’åå†…çš„å…ƒç´ </h4><p>zremrangebyrank key start end</p><h4 id="zremrangebyscore-åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜"><a href="#zremrangebyscore-åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜" class="headerlink" title="zremrangebyscore åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜"></a>zremrangebyscore åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜</h4><p>zremrangebyscore key min max</p><h3 id="é›†åˆé—´æ“ä½œå‘½ä»¤-1"><a href="#é›†åˆé—´æ“ä½œå‘½ä»¤-1" class="headerlink" title="é›†åˆé—´æ“ä½œå‘½ä»¤"></a>é›†åˆé—´æ“ä½œå‘½ä»¤</h3><h4 id="zinterstore-äº¤é›†"><a href="#zinterstore-äº¤é›†" class="headerlink" title="zinterstore äº¤é›†"></a>zinterstore äº¤é›†</h4><p><code>zinterstore</code><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/0e0688f60b404126895ffbbf4c6ae290.png" alt="image.png"></p><p>è¿™ä¸ªå‘½ä»¤å‚æ•°è¾ƒå¤šï¼Œä¸‹é¢åˆ†åˆ«è¿›è¡Œè¯´æ˜</p><ul><li>destination:äº¤é›†è®¡ç®—ç»“æœä¿å­˜åˆ°è¿™ä¸ªé”®ã€‚</li></ul><ul><li>numkeys:éœ€è¦åšäº¤é›†è®¡ç®—é”®çš„ä¸ªæ•°ã€‚</li></ul><ul><li>key [key â€¦]:éœ€è¦åšäº¤é›†è®¡ç®—çš„é”®ã€‚</li></ul><ul><li><p>weights weight</p></li><li><p>[weight â€¦]:æ¯ä¸ªé”®çš„æƒé‡ï¼Œåœ¨åšäº¤é›†è®¡ç®—æ—¶ï¼Œæ¯ä¸ªé”®ä¸­çš„æ¯ä¸ªmember ä¼šå°†è‡ªå·±åˆ†æ•°ä¹˜ä»¥è¿™ä¸ªæƒé‡,æ¯ä¸ªé”®çš„æƒé‡é»˜è®¤æ˜¯1ã€‚</p></li><li><p>aggregate sum | min |max:è®¡ç®—æˆå‘˜äº¤é›†åï¼Œåˆ†å€¼å¯ä»¥æŒ‰ç…§sum(å’Œ)ã€min(æœ€å°å€¼)ã€max(æœ€å¤§å€¼)åšæ±‡æ€»,é»˜è®¤å€¼æ˜¯sumã€‚</p></li></ul><p>ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚ï¼ˆç®—å¹³å‡åˆ†ï¼‰</p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/cfc3967b70cb4dcea41057c3708d8616.png" alt="image.png"></p><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1663252342001/65f2bee807e1446989277c0fadff86cf.png" alt="image.png"></p><h4 id="zunionstore-å¹¶é›†"><a href="#zunionstore-å¹¶é›†" class="headerlink" title="zunionstore å¹¶é›†"></a>zunionstore å¹¶é›†</h4><p>è¯¥å‘½ä»¤çš„æ‰€æœ‰å‚æ•°å’Œzinterstoreæ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡æ˜¯åšå¹¶é›†è®¡ç®—ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå®éªŒã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯-4"><a href="#ä½¿ç”¨åœºæ™¯-4" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>æœ‰åºé›†åˆæ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯æ’è¡Œæ¦œç³»ç»Ÿã€‚ä¾‹å¦‚è§†é¢‘ç½‘ç«™éœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„è§†é¢‘åšæ’è¡Œæ¦œï¼Œæ¦œå•çš„ç»´åº¦å¯èƒ½æ˜¯å¤šä¸ªæ–¹é¢çš„:æŒ‰ç…§æ—¶é—´ã€æŒ‰ç…§æ’­æ”¾æ•°é‡ã€æŒ‰ç…§è·å¾—çš„èµæ•°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Rediså¸¸ç”¨æ•°æ®ç»“æ„&quot;&gt;&lt;a href=&quot;#Rediså¸¸ç”¨æ•°æ®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;Rediså¸¸ç”¨æ•°æ®ç»“æ„&quot;&gt;&lt;/a&gt;Rediså¸¸ç”¨æ•°æ®ç»“æ„&lt;/h1&gt;&lt;p&gt;Redisæä¾›äº†ä¸€äº›æ•°æ®ç»“æ„ä¾›æˆ‘ä»¬å¾€Redisä¸­å­˜å–æ•°æ®ï¼Œæœ€å¸¸ç”¨çš„çš„</summary>
      
    
    
    
    <category term="Redis" scheme="https://eizo01.github.io/categories/Redis/"/>
    
    
    <category term="Redisæ•°æ®ç»“æ„" scheme="https://eizo01.github.io/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Rediså…¥é—¨</title>
    <link href="https://eizo01.github.io/posts/6a343b7f.html"/>
    <id>https://eizo01.github.io/posts/6a343b7f.html</id>
    <published>2022-11-01T12:00:00.000Z</published>
    <updated>2022-11-12T14:32:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redisçš„æŠ€æœ¯å…¨æ™¯"><a href="#Redisçš„æŠ€æœ¯å…¨æ™¯" class="headerlink" title="Redisçš„æŠ€æœ¯å…¨æ™¯"></a>Redisçš„æŠ€æœ¯å…¨æ™¯</h2><p>æœ¬è´¨ä¸Šå°±æ˜¯ï¼ŒRedis çš„çŸ¥è¯†éƒ½åŒ…æ‹¬ä»€ä¹ˆå‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯â€œä¸¤å¤§ç»´åº¦ï¼Œä¸‰å¤§ä¸»çº¿â€</p><p><img src="https://zdwtop.cn/blog/ba2269e45c1b4a77bf097ff40de3aa8e.png" alt="image.png"></p><h3 id="ä¸¤å¤§ç»´åº¦"><a href="#ä¸¤å¤§ç»´åº¦" class="headerlink" title="ä¸¤å¤§ç»´åº¦"></a>ä¸¤å¤§ç»´åº¦</h3><p>ä¸¤å¤§ç»´åº¦ï¼š<strong>åº”ç”¨ç»´åº¦ã€åº•å±‚åŸç†ç»´åº¦</strong></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œç¼“å­˜å’Œé›†ç¾¤æ˜¯Redis çš„ä¸¤å¤§å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚åŒæ—¶Redis ä¸°å¯Œçš„æ•°æ®æ¨¡å‹ï¼Œå°±å¯¼è‡´å®ƒæœ‰å¾ˆå¤šé›¶ç¢çš„åº”ç”¨åœºæ™¯ï¼Œå¾ˆå¤šå¾ˆæ‚ã€‚è€Œä¸”ï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜éšè—å¾—æ¯”è¾ƒæ·±ï¼Œåªæœ‰ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚äº¿çº§è®¿é—®å‹åŠ›åœºæ™¯ï¼‰æ‰ä¼šå‡ºç°ï¼Œæ‰€ä»¥åŒæ—¶è¿˜å¿…é¡»ç²¾é€šRedisçš„æ•°æ®ç»“æ„ã€‚</p><h3 id="Redisåº”ç”¨åœºæ™¯"><a href="#Redisåº”ç”¨åœºæ™¯" class="headerlink" title="Redisåº”ç”¨åœºæ™¯"></a><strong>Redisåº”ç”¨åœºæ™¯</strong></h3><h4 id="1-ç¼“å­˜"><a href="#1-ç¼“å­˜" class="headerlink" title="1.ç¼“å­˜"></a>1.ç¼“å­˜</h4><p>ç¼“å­˜æœºåˆ¶å‡ ä¹åœ¨æ‰€æœ‰çš„å¤§å‹ç½‘ç«™éƒ½æœ‰ä½¿ç”¨ï¼Œåˆç†åœ°ä½¿ç”¨ç¼“å­˜ä¸ä»…å¯ä»¥åŠ å¿«æ•°æ®çš„è®¿é—®é€Ÿåº¦ï¼Œè€Œä¸”èƒ½å¤Ÿæœ‰æ•ˆåœ°é™ä½åç«¯æ•°æ®æºçš„å‹åŠ›ã€‚Redisæä¾›äº†é”®å€¼è¿‡æœŸæ—¶é—´è®¾ç½®,å¹¶ä¸”ä¹Ÿæä¾›äº†çµæ´»æ§åˆ¶æœ€å¤§å†…å­˜å’Œå†…å­˜æº¢å‡ºåçš„æ·˜æ±°ç­–ç•¥ã€‚å¯ä»¥è¿™ä¹ˆè¯´,ä¸€ä¸ªåˆç†çš„ç¼“å­˜è®¾è®¡èƒ½å¤Ÿä¸ºä¸€ä¸ªç½‘ç«™çš„ç¨³å®šä¿é©¾æŠ¤èˆªã€‚</p><p>ä¸€èˆ¬MySQLæ•°æ®åº“å†™çš„å¹¶å‘æ˜¯600/sï¼Œè¯»çš„2000/s,å¯¹äºå¤§å‹äº’è”ç½‘é¡¹ç›®çš„ç™¾ä¸‡å¹¶å‘ï¼Œæ ¹æœ¬æ‰›ä¸ä½ï¼ŒRedisçš„å®˜æ–¹æ˜¾ç¤ºRedisèƒ½å¤Ÿå•å°è¾¾åˆ°10W+/sçš„å¹¶å‘ã€‚</p><h4 id="2-æ’è¡Œæ¦œç³»ç»Ÿ"><a href="#2-æ’è¡Œæ¦œç³»ç»Ÿ" class="headerlink" title="2.æ’è¡Œæ¦œç³»ç»Ÿ"></a>2.æ’è¡Œæ¦œç³»ç»Ÿ</h4><p>æ’è¡Œæ¦œç³»ç»Ÿå‡ ä¹å­˜åœ¨äºæ‰€æœ‰çš„ç½‘ç«™ï¼Œä¾‹å¦‚æŒ‰ç…§çƒ­åº¦æ’åçš„æ’è¡Œæ¦œï¼ŒæŒ‰ç…§å‘å¸ƒæ—¶é—´çš„æ’è¡Œæ¦œï¼ŒæŒ‰ç…§å„ç§å¤æ‚ç»´åº¦è®¡ç®—å‡ºçš„æ’è¡Œæ¦œï¼ŒRedisæä¾›äº†åˆ—è¡¨å’Œæœ‰åºé›†åˆæ•°æ®ç»“æ„ï¼Œåˆç†åœ°ä½¿ç”¨è¿™äº›æ•°æ®ç»“æ„å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ„å»ºå„ç§æ’è¡Œæ¦œç³»ç»Ÿã€‚</p><h4 id="3-è®¡æ•°å™¨åº”ç”¨"><a href="#3-è®¡æ•°å™¨åº”ç”¨" class="headerlink" title="3.è®¡æ•°å™¨åº”ç”¨"></a>3.è®¡æ•°å™¨åº”ç”¨</h4><p>è®¡æ•°å™¨åœ¨ç½‘ç«™ä¸­çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œä¾‹å¦‚è§†é¢‘ç½‘ç«™æœ‰æ’­æ”¾æ•°ã€ç”µå•†ç½‘ç«™æœ‰æµè§ˆæ•°ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å®æ—¶æ€§ï¼Œæ¯ä¸€æ¬¡æ’­æ”¾å’Œæµè§ˆéƒ½è¦åšåŠ 1çš„æ“ä½œï¼Œå¦‚æœå¹¶å‘é‡å¾ˆå¤§å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®çš„æ€§èƒ½æ˜¯ä¸€ç§æŒ‘æˆ˜ã€‚Rediså¤©ç„¶æ”¯æŒè®¡æ•°åŠŸèƒ½è€Œä¸”è®¡æ•°çš„æ€§èƒ½ä¹Ÿéå¸¸å¥½,å¯ä»¥è¯´æ˜¯è®¡æ•°å™¨ç³»ç»Ÿçš„é‡è¦é€‰æ‹©ã€‚</p><h4 id="4-ç¤¾äº¤ç½‘ç»œ"><a href="#4-ç¤¾äº¤ç½‘ç»œ" class="headerlink" title="4.ç¤¾äº¤ç½‘ç»œ"></a>4.ç¤¾äº¤ç½‘ç»œ</h4><p>èµ/è¸©ã€ç²‰ä¸ã€å…±åŒå¥½å‹/å–œå¥½ã€æ¨é€ã€ä¸‹æ‹‰åˆ·æ–°ç­‰æ˜¯ç¤¾äº¤ç½‘ç«™çš„å¿…å¤‡åŠŸèƒ½ï¼Œç”±äºç¤¾äº¤ç½‘ç«™è®¿é—®é‡é€šå¸¸æ¯”è¾ƒå¤§,è€Œä¸”ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®ä¸å¤ªé€‚åˆä¿å­˜è¿™ç§ç±»å‹çš„æ•°æ®ï¼ŒRedisæä¾›çš„æ•°æ®ç»“æ„å¯ä»¥ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“åœ°å®ç°è¿™äº›åŠŸèƒ½ã€‚</p><h4 id="5-æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ"><a href="#5-æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ" class="headerlink" title="5.æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ"></a>5.æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ</h4><p>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¤§å‹ç½‘ç«™çš„å¿…å¤‡åŸºç¡€ç»„ä»¶ï¼Œå› ä¸ºå…¶å…·æœ‰ä¸šåŠ¡è§£è€¦ã€éå®æ—¶ä¸šåŠ¡å‰Šå³°ç­‰ç‰¹æ€§ã€‚Redisæä¾›äº†å‘å¸ƒè®¢é˜…åŠŸèƒ½å’Œé˜»å¡é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œè™½ç„¶å’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—æ¯”è¿˜ä¸å¤Ÿè¶³å¤Ÿå¼ºå¤§,ä½†æ˜¯å¯¹äºä¸€èˆ¬çš„æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½åŸºæœ¬å¯ä»¥æ»¡è¶³ã€‚è¿™ä¸ªæ˜¯Redisçš„ä½œè€…å‚è€ƒäº†Kafkaåšçš„æ‹“å±•ã€‚</p><h3 id="ä¸‰å¤§ä¸»çº¿"><a href="#ä¸‰å¤§ä¸»çº¿" class="headerlink" title="ä¸‰å¤§ä¸»çº¿"></a>ä¸‰å¤§ä¸»çº¿</h3><p>ä¸‰å¤§ä¸»çº¿ï¼šé«˜æ€§èƒ½ã€é«˜å¯é å’Œé«˜å¯æ‰©å±•</p><p>é«˜æ€§èƒ½ï¼šåŒ…æ‹¬çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ã€ç½‘ç»œæ¡†æ¶ï¼›<br>é«˜å¯é ï¼šåŒ…æ‹¬ä¸»ä»å¤åˆ¶ã€å“¨å…µæœºåˆ¶ï¼›<br>é«˜å¯æ‰©ï¼šåŒ…æ‹¬æ•°æ®åˆ†ç‰‡ã€è´Ÿè½½å‡è¡¡ã€‚</p><p>å› ä¸ºRedisçš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œä¸åŒçš„å…¬å¸æœ‰ä¸åŒçš„ç©æ³•ï¼Œä½†å¦‚ä½•ä¸æŒæ¡ä¸‰é«˜è¿™æ¡ä¸»çº¿çš„è¯ï¼Œä½ ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p><p>1ã€æ•°æ®ç»“æ„çš„å¤æ‚åº¦ã€è·¨ CPU æ ¸çš„è®¿é—®ä¼šå¯¼è‡´CPUé£™å‡çš„é—®é¢˜</p><p>2ã€ä¸»ä»åŒæ­¥å’Œ AOF çš„å†…å­˜ç«äº‰ï¼Œè¿™äº›ä¼šå¯¼è‡´å†…å­˜é—®é¢˜</p><p>3ã€åœ¨ SSD ä¸Šåšå¿«ç…§çš„æ€§èƒ½æŠ–åŠ¨ï¼Œè¿™äº›ä¼šå¯¼è‡´å­˜å‚¨æŒä¹…åŒ–çš„é—®é¢˜</p><p>4ã€å¤šå®ä¾‹æ—¶çš„å¼‚å¸¸ç½‘ç»œä¸¢åŒ…çš„é—®é¢˜</p><h2 id="Rediså…¨å±€å‘½ä»¤"><a href="#Rediså…¨å±€å‘½ä»¤" class="headerlink" title="Rediså…¨å±€å‘½ä»¤"></a>Rediså…¨å±€å‘½ä»¤</h2><p>å¯¹äºé”®å€¼æ•°æ®åº“è€Œè¨€ï¼ŒåŸºæœ¬çš„æ•°æ®æ¨¡å‹æ˜¯ key-value æ¨¡å‹ï¼ŒRedis æ”¯æŒçš„ value ç±»å‹åŒ…æ‹¬äº† Stringã€å“ˆå¸Œè¡¨ã€åˆ—è¡¨ã€é›†åˆç­‰ï¼Œè€ŒMemcachedæ”¯æŒçš„ value ç±»å‹ä»…ä¸º String ç±»å‹ã€‚</p><p>Redisé‡Œé¢æœ‰16ä¸ªåº“ï¼Œä½†æ˜¯Redisçš„åˆ†åº“åŠŸèƒ½æ²¡å•¥æ„ä¹‰ï¼ˆé»˜è®¤å°±æ˜¯0å·åº“ï¼Œå°¤å…¶æ˜¯é›†ç¾¤æ“ä½œçš„æ—¶å€™ï¼‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤ä½¿ç”¨0å·åº“è¿›è¡Œæ“ä½œã€‚</p><p>åœ¨äº†è§£Rediskey-value æ¨¡å‹ä¹‹å‰ï¼ŒRedisçš„æœ‰ä¸€äº›å…¨å±€å‘½ä»¤ï¼Œéœ€è¦æˆ‘ä»¬æå‰äº†è§£ã€‚</p><h4 id="keyså‘½ä»¤"><a href="#keyså‘½ä»¤" class="headerlink" title="keyså‘½ä»¤"></a><strong>keyså‘½ä»¤</strong></h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">keys</span> *</span><br><span class="line"><span class="built_in">keys</span> L*</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰é”®(æ”¯æŒé€šé…ç¬¦)ï¼š</p><p><img src="HTTPs://zdwtop.cn/blog/a38baeb051bd46dab430d3037bedc48b.png" alt="image.png"></p><p>ä½†æ˜¯è¿™ä¸ªå‘½ä»¤è¯·æ…ç”¨ï¼Œå› ä¸ºkeyså‘½ä»¤è¦æŠŠæ‰€æœ‰çš„key-valueå¯¹å…¨éƒ¨æ‹‰å‡ºå»ï¼Œå¦‚æœç”Ÿäº§ç¯å¢ƒçš„é”®å€¼å¯¹ç‰¹åˆ«å¤šçš„è¯ï¼Œä¼šå¯¹Redisçš„æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ï¼Œæ¨èä½¿ç”¨<code>dbsize</code>ã€‚</p><p><strong>keyså‘½ä»¤ä¼šéå†æ‰€æœ‰é”®ï¼Œæ‰€ä»¥å®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯o(n)ï¼Œå½“Redisä¿å­˜äº†å¤§é‡é”®æ—¶çº¿ä¸Šç¯å¢ƒç¦æ­¢ä½¿ç”¨keyså‘½ä»¤ã€‚</strong></p><h4 id="dbsizeå‘½ä»¤"><a href="#dbsizeå‘½ä»¤" class="headerlink" title="dbsizeå‘½ä»¤"></a><strong>dbsizeå‘½ä»¤</strong></h4><p>dbsizeå‘½ä»¤ä¼šè¿”å›å½“å‰æ•°æ®åº“ä¸­é”®çš„æ€»æ•°ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/21ed59cad4e84610869308640d57718c.png" alt="image.png"></p><p>dbsizeå‘½ä»¤åœ¨è®¡ç®—é”®æ€»æ•°æ—¶ä¸ä¼šéå†æ‰€æœ‰é”®,è€Œæ˜¯ç›´æ¥è·å– Rediså†…ç½®çš„é”®æ€»æ•°å˜é‡,æ‰€ä»¥dbsizeå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯<strong>O(1)</strong>ã€‚</p><h4 id="exists"><a href="#exists" class="headerlink" title="exists"></a><strong>exists</strong></h4><p>æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å›1ï¼Œä¸å­˜åœ¨è¿”å›0ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/706705c0c9d7418b8b72eb0be7228f85.png" alt="image.png"></p><h4 id="del"><a href="#del" class="headerlink" title="del"></a><strong>del</strong></h4><p>åˆ é™¤é”®ï¼Œæ— è®ºå€¼æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„ç±»å‹,delå‘½ä»¤éƒ½å¯ä»¥å°†å…¶åˆ é™¤ã€‚<strong>è¿”å›åˆ é™¤é”®ä¸ªæ•°ï¼Œåˆ é™¤ä¸å­˜åœ¨é”®è¿”å›0ã€‚</strong>åŒæ—¶delå‘½ä»¤å¯ä»¥æ”¯æŒåˆ é™¤å¤šä¸ªé”®ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/2865421882494708bb0f78fd458a3a59.png" alt="image.png"></p><p><img src="HTTPs://zdwtop.cn/blog/5d304a87b9d44633893581107f0d310a.png" alt="image.png"></p><h4 id="é”®è¿‡æœŸ"><a href="#é”®è¿‡æœŸ" class="headerlink" title="é”®è¿‡æœŸ"></a><strong>é”®è¿‡æœŸ</strong></h4><h5 id="expire"><a href="#expire" class="headerlink" title="expire"></a><strong>expire</strong></h5><p>Redisæ”¯æŒå¯¹é”®æ·»åŠ è¿‡æœŸæ—¶é—´,å½“è¶…è¿‡è¿‡æœŸæ—¶é—´å,ä¼šè‡ªåŠ¨åˆ é™¤é”®ï¼Œæ—¶é—´å•ä½ç§’ã€‚</p><p>ttlå‘½ä»¤ä¼šè¿”å›é”®çš„å‰©ä½™è¿‡æœŸæ—¶é—´,å®ƒæœ‰3ç§è¿”å›å€¼:</p><p>å¤§äºç­‰äº0çš„æ•´æ•°:é”®å‰©ä½™çš„è¿‡æœŸæ—¶é—´ã€‚</p><p>-1:é”®æ²¡è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p><p>-2:é”®ä¸å­˜åœ¨</p><p>é™¤äº†expireã€ttlå‘½ä»¤ä»¥å¤–ï¼ŒRedisè¿˜æä¾›äº†expireatã€pexpire,pexpireatã€pttlã€persistç­‰ä¸€ç³»åˆ—å‘½ä»¤ã€‚</p><h5 id="expireat-key"><a href="#expireat-key" class="headerlink" title="expireat key"></a><strong>expireat key</strong></h5><p>timestamp: é”®åœ¨ç§’çº§æ—¶é—´æˆªtimestampåè¿‡æœŸã€‚</p><p>ttlå‘½ä»¤å’Œpttléƒ½å¯ä»¥æŸ¥è¯¢é”®çš„å‰©ä½™è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯pttlç²¾åº¦æ›´é«˜å¯ä»¥è¾¾åˆ°æ¯«ç§’çº§åˆ«ï¼Œæœ‰3ç§è¿”å›å€¼:</p><p>å¤§äºç­‰äº0çš„æ•´æ•°:é”®å‰©ä½™çš„è¿‡æœŸæ—¶é—´(ttlæ˜¯ç§’ï¼Œpttlæ˜¯æ¯«ç§’)ã€‚</p><p>-1:é”®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p><p>-2:é”®ä¸å­˜åœ¨ã€‚</p><h5 id="pexpire-key"><a href="#pexpire-key" class="headerlink" title="pexpire key"></a><strong>pexpire key</strong></h5><p>milliseconds:é”®åœ¨millisecondsæ¯«ç§’åè¿‡æœŸã€‚</p><h5 id="pexpireat-key"><a href="#pexpireat-key" class="headerlink" title="pexpireat key"></a><strong>pexpireat key</strong></h5><p>milliseconds-timestampé”®åœ¨æ¯«ç§’çº§æ—¶é—´æˆ³timestampåè¿‡æœŸã€‚</p><p><strong>åœ¨ä½¿ç”¨Redisç›¸å…³è¿‡æœŸå‘½ä»¤æ—¶,éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚</strong></p><p>1)å¦‚æœexpire key çš„é”®ä¸å­˜åœ¨,è¿”å›ç»“æœä¸º0:</p><p>2ï¼‰å¦‚æœè¿‡æœŸæ—¶é—´ä¸ºè´Ÿå€¼,é”®ä¼šç«‹å³è¢«åˆ é™¤ï¼ŒçŠ¹å¦‚ä½¿ç”¨delå‘½ä»¤ä¸€æ ·:</p><p>3 ) persistå‘½ä»¤å¯ä»¥å°†é”®çš„è¿‡æœŸæ—¶é—´æ¸…é™¤:</p><p><img src="HTTPs://zdwtop.cn/blog/e288cca51dd446a19384a29adcc1faf7.png" alt="image.png"></p><p>4ï¼‰å¯¹äºå­—ç¬¦ä¸²ç±»å‹é”®ï¼Œæ‰§è¡Œsetå‘½ä»¤ä¼šå»æ‰è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå®¹æ˜“åœ¨å¼€å‘ä¸­è¢«å¿½è§†ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/5b749a4fd43248ce9af261080058ebaf.png" alt="image.png"></p><p>5 ) Redisä¸æ”¯æŒäºŒçº§æ•°æ®ç»“æ„(ä¾‹å¦‚å“ˆå¸Œã€åˆ—è¡¨)å†…éƒ¨å…ƒç´ çš„è¿‡æœŸåŠŸèƒ½ï¼Œä¸èƒ½å¯¹äºŒçº§æ•°æ®ç»“æ„åšè¿‡æœŸæ—¶é—´è®¾ç½®ã€‚</p><h5 id="type"><a href="#type" class="headerlink" title="type"></a><strong>type</strong></h5><p>è¿”å›é”®çš„æ•°æ®ç»“æ„ç±»å‹ï¼Œä¾‹å¦‚<strong>é”®lijinæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿”å›ç»“æœä¸ºstringã€‚é”®mylistæ˜¯åˆ—è¡¨ç±»å‹ï¼Œè¿”å›ç»“æœä¸ºlistï¼Œé”®ä¸å­˜åœ¨è¿”å›none</strong></p><p><img src="HTTPs://zdwtop.cn/blog/a5cf8aefd7b2414b9e1fb6ad96f24b47.png" alt="image.png"></p><h5 id="randomkey"><a href="#randomkey" class="headerlink" title="randomkey"></a><strong>randomkey</strong></h5><p>éšæœºè¿”å›ä¸€ä¸ªé”®ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œè¯·è‡ªè¡Œå®éªŒã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/41c50a66594e42f98755f4ca70814050.png" alt="image.png"></p><p><strong>rename</strong></p><p>é”®é‡å‘½å</p><p>ä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœåœ¨renameä¹‹å‰,æ–°é”®å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒçš„å€¼ä¹Ÿå°†è¢«è¦†ç›–ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/ec04e5381693497b9d85040317c25d74.png" alt="image.png"></p><p>ä¸ºäº†é˜²æ­¢è¢«å¼ºè¡Œrenameï¼ŒRedisæä¾›äº†renamenxå‘½ä»¤ï¼Œç¡®ä¿åªæœ‰newKeyä¸å­˜åœ¨æ—¶å€™æ‰è¢«è¦†ç›–ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/41644a5ba52048e9a4b2d8b130d211a0.png" alt="image.png"></p><p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç”±äºé‡å‘½åé”®æœŸé—´ä¼šæ‰§è¡Œdelå‘½ä»¤åˆ é™¤æ—§çš„é”®ï¼Œå¦‚æœé”®å¯¹åº”çš„å€¼æ¯”è¾ƒå¤§ï¼Œä¼šå­˜åœ¨é˜»å¡Redisçš„å¯èƒ½æ€§ã€‚</p><h3 id="é”®åçš„ç”Ÿäº§å®è·µ"><a href="#é”®åçš„ç”Ÿäº§å®è·µ" class="headerlink" title="é”®åçš„ç”Ÿäº§å®è·µ"></a>é”®åçš„ç”Ÿäº§å®è·µ</h3><p>Redisæ²¡æœ‰å‘½ä»¤ç©ºé—´ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å¯¹é”®åæœ‰å¼ºåˆ¶è¦æ±‚ã€‚ä½†è®¾è®¡åˆç†çš„é”®åï¼Œæœ‰åˆ©äºé˜²æ­¢é”®å†²çªå’Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ï¼Œæ¯”è¾ƒæ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨<strong>â€œä¸šåŠ¡å:å¯¹è±¡å: id : [å±æ€§]â€ä½œä¸ºé”®å</strong>   (ä¹Ÿå¯ä»¥ä¸æ˜¯åˆ†å·)ã€‚</p><p>ä¾‹å¦‚MySQL çš„æ•°æ®åº“åä¸ºmallï¼Œç”¨æˆ·è¡¨åä¸ºorderï¼Œé‚£ä¹ˆå¯¹åº”çš„é”®å¯ä»¥ç”¨â€mall:order:1â€,<br>â€œmall:order:1:nameâ€æ¥è¡¨ç¤ºï¼Œå¦‚æœå½“å‰Redis åªè¢«ä¸€ä¸ªä¸šåŠ¡ä½¿ç”¨ï¼Œç”šè‡³å¯ä»¥å»æ‰â€œorder:â€ã€‚</p><p><img src="HTTPs://zdwtop.cn/blog/46d96dd72a2943ceba09f109f563c243.png" alt="image.png"></p><p>åœ¨èƒ½æè¿°é”®å«ä¹‰çš„å‰æä¸‹é€‚å½“å‡å°‘é”®çš„é•¿åº¦ï¼Œä»è€Œå‡å°‘ç”±äºé”®è¿‡é•¿çš„å†…å­˜æµªè´¹ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>æ¨èdockerå®‰è£…ï¼Œå¦‚æœå–œæ¬¢windowæ“ä½œå¯ä»¥ä¸‹è½½GitHubçš„äººå¼€å‘çš„exeç¨‹åºï¼Œä¸è¿‡ç‰ˆæœ¬ä¸€èˆ¬æ¯”è¾ƒè€</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Redisçš„æŠ€æœ¯å…¨æ™¯&quot;&gt;&lt;a href=&quot;#Redisçš„æŠ€æœ¯å…¨æ™¯&quot; class=&quot;headerlink&quot; title=&quot;Redisçš„æŠ€æœ¯å…¨æ™¯&quot;&gt;&lt;/a&gt;Redisçš„æŠ€æœ¯å…¨æ™¯&lt;/h2&gt;&lt;p&gt;æœ¬è´¨ä¸Šå°±æ˜¯ï¼ŒRedis çš„çŸ¥è¯†éƒ½åŒ…æ‹¬ä»€ä¹ˆå‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯â€œä¸¤å¤§ç»´åº¦ï¼Œä¸‰å¤§ä¸»</summary>
      
    
    
    
    <category term="Redis" scheme="https://eizo01.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>è¿æ¥çš„åŸç†</title>
    <link href="https://eizo01.github.io/posts/a1120601.html"/>
    <id>https://eizo01.github.io/posts/a1120601.html</id>
    <published>2022-10-30T12:00:00.000Z</published>
    <updated>2023-03-23T01:59:51.387Z</updated>
    
    <content type="html"><![CDATA[<h1>ä¸¤ä¸ªè¡¨çš„äº²å¯†æ¥è§¦-è¿æ¥çš„åŸç†</h1><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸¤ä¸ªè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (m1 <span class="type">int</span>, n1 <span class="type">char</span>(<span class="number">1</span>));</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t2 (m2 <span class="type">int</span>, n2 <span class="type">char</span>(<span class="number">1</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>), (<span class="number">3</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t2 <span class="keyword">VALUES</span>(<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>), (<span class="number">3</span>, <span class="string">&#x27;c&#x27;</span>), (<span class="number">4</span>, <span class="string">&#x27;d&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿æ¥ çš„æœ¬è´¨å°±æ˜¯æŠŠå„ä¸ªè¿æ¥è¡¨ä¸­çš„è®°å½•éƒ½å–å‡ºæ¥ä¾æ¬¡åŒ¹é…çš„ç»„åˆåŠ å…¥ç»“æœé›†å¹¶è¿”å›ç»™ç”¨æˆ·ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠ t1 å’Œ t2 ä¸¤ä¸ªè¡¨è¿æ¥èµ·æ¥çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230320161856926.png" alt="image-20230320161856926"></p><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å°±æ˜¯æŠŠ t1 è¡¨çš„è®°å½•å’Œ t2 çš„è®°å½•è¿èµ·æ¥ç»„æˆæ–°çš„æ›´å¤§çš„è®°å½•ï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ç§°ä¹‹ä¸ºè¿æ¥æŸ¥ è¯¢ã€‚è¿æ¥æŸ¥è¯¢çš„ç»“æœé›†ä¸­åŒ…å«ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ä¸å¦ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ç›¸äº’åŒ¹é…çš„ç»„åˆï¼Œåƒè¿™æ ·çš„ç»“æœ é›†å°±å¯ä»¥ç§°ä¹‹ä¸º ç¬›å¡å°”ç§¯ ã€‚</p><h2 id="è¿æ¥è¿‡ç¨‹ç®€ä»‹">è¿æ¥è¿‡ç¨‹ç®€ä»‹</h2><p>æˆ‘ä»¬å¯ä»¥è¿æ¥ä»»æ„æ•°é‡å¼ è¡¨ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ä»»ä½•é™åˆ¶æ¡ä»¶çš„è¯ï¼Œè¿™äº›è¡¨è¿æ¥èµ·æ¥äº§ç”Ÿçš„ ç¬›å¡å°” ç§¯ å¯èƒ½æ˜¯éå¸¸å·¨å¤§çš„ã€‚æ¯”æ–¹è¯´3ä¸ª100è¡Œè®°å½•çš„è¡¨è¿æ¥èµ·æ¥äº§ç”Ÿçš„ ç¬›å¡å°”ç§¯ å°±æœ‰ 100Ã—100Ã—100=1000000 è¡Œæ•° æ®ï¼æ‰€ä»¥åœ¨è¿æ¥çš„æ—¶å€™è¿‡æ»¤æ‰ç‰¹å®šè®°å½•ç»„åˆæ˜¯æœ‰å¿…è¦çš„ï¼Œåœ¨è¿æ¥æŸ¥è¯¢ä¸­çš„è¿‡æ»¤æ¡ä»¶å¯ä»¥åˆ†æˆä¸¤ç§ï¼š</p><ul><li><p>æ¶‰åŠå•è¡¨çš„æ¡ä»¶</p></li><li><p>è¿™ç§åªè®¾è®¡å•è¡¨çš„è¿‡æ»¤æ¡ä»¶æˆ‘ä»¬ä¹‹å‰éƒ½æåˆ°è¿‡ä¸€ä¸‡éäº†ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿä¸€ç›´ç§°ä¸º æœç´¢æ¡ä»¶ ï¼Œæ¯”å¦‚ t1.m1 &gt; 1 æ˜¯åªé’ˆå¯¹ t1 è¡¨çš„è¿‡æ»¤æ¡ä»¶ï¼Œ t2.n2 &lt; â€˜dâ€™ æ˜¯åªé’ˆå¯¹ t2 è¡¨çš„è¿‡æ»¤æ¡ä»¶ã€‚</p></li><li><p>æ¶‰åŠä¸¤è¡¨çš„æ¡ä»¶</p><ul><li>è¿™ç§è¿‡æ»¤æ¡ä»¶æˆ‘ä»¬ä¹‹å‰æ²¡è§è¿‡ï¼Œæ¯”å¦‚ t1.m1 = t2.m2 ã€ t1.n1 &gt; t2.n2 ç­‰ï¼Œè¿™äº›æ¡ä»¶ä¸­æ¶‰åŠåˆ°äº†ä¸¤ä¸ªè¡¨ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼š</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1, t2 <span class="keyword">WHERE</span> t1.m1 <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">AND</span> t1.m1 <span class="operator">=</span> t2.m2 <span class="keyword">AND</span> t2.n2 <span class="operator">&lt;</span> <span class="string">&#x27;d&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­æˆ‘ä»¬æŒ‡æ˜äº†è¿™ä¸‰ä¸ªè¿‡æ»¤æ¡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t1.m1 <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">t1.m1 <span class="operator">=</span> t2.m2</span><br><span class="line">t2.n2 <span class="operator">&lt;</span> <span class="string">&#x27;d&#x27;</span></span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆç¡®å®šç¬¬ä¸€ä¸ªéœ€è¦æŸ¥è¯¢çš„è¡¨ï¼Œè¿™ä¸ªè¡¨ç§°ä¹‹ä¸º é©±åŠ¨è¡¨ ã€‚</li></ol><p>æ­¤å¤„å‡è®¾ä½¿ç”¨ t1 ä½œä¸ºé©±åŠ¨è¡¨ï¼Œé‚£ä¹ˆå°±éœ€ è¦åˆ° t1 è¡¨ä¸­æ‰¾æ»¡è¶³ t1.m1 &gt; 1 çš„è®°å½•ï¼Œå› ä¸ºè¡¨ä¸­çš„æ•°æ®å¤ªå°‘ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡åœ¨è¡¨ä¸Šå»ºç«‹äºŒçº§ç´¢å¼•ã€‚æˆ‘ä»¬è‚¯å®šå¾—å…¨è¡¨æŸ¥è¯¢</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230320162234271.png" alt="image-20230320162234271"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ t1 è¡¨ä¸­ç¬¦åˆ t1.m1 &gt; 1 çš„è®°å½•æœ‰ä¸¤æ¡ã€‚</p><ol start="2"><li>é’ˆå¯¹ä¸Šä¸€æ­¥éª¤ä¸­ä»é©±åŠ¨è¡¨äº§ç”Ÿçš„ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•ï¼Œåˆ†åˆ«éœ€è¦åˆ° t2 è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„è®°å½•ï¼Œæ‰€è°“ åŒ¹é…çš„ è®°å½• ï¼ŒæŒ‡çš„æ˜¯ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„è®°å½•ã€‚å› ä¸ºæ˜¯æ ¹æ® t1 è¡¨ä¸­çš„è®°å½•å»æ‰¾ t2 è¡¨ä¸­çš„è®°å½•ï¼Œæ‰€ä»¥ t2 è¡¨ä¹Ÿå¯ä»¥è¢« ç§°ä¹‹ä¸º è¢«é©±åŠ¨è¡¨ ã€‚<ul><li>å½“ t1.m1 = 2 æ—¶ï¼Œè¿‡æ»¤æ¡ä»¶ t1.m1 = t2.m2 å°±ç›¸å½“äº t2.m2 = 2 ï¼Œæ‰€ä»¥æ­¤æ—¶ t2 è¡¨ç›¸å½“äºæœ‰äº† t2.m2 = 2 ã€ t2.n2 &lt; â€˜dâ€™ è¿™ä¸¤ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œç„¶ååˆ° t2 è¡¨ä¸­æ‰§è¡Œå•è¡¨æŸ¥è¯¢ã€‚</li><li>å½“ t1.m1 = 3 æ—¶ï¼Œè¿‡æ»¤æ¡ä»¶ t1.m1 = t2.m2 å°±ç›¸å½“äº t2.m2 = 3 ï¼Œæ‰€ä»¥æ­¤æ—¶ t2 è¡¨ç›¸å½“äºæœ‰äº† t2.m2 = 3 ã€ t2.n2 &lt; â€˜dâ€™ è¿™ä¸¤ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œç„¶ååˆ° t2 è¡¨ä¸­æ‰§è¡Œå•è¡¨æŸ¥è¯¢ã€‚</li></ul></li></ol><p>æ‰€ä»¥æ•´ä¸ªè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230320162516886.png" alt="image-20230320162516886"></p><p>æ‰€ä»¥æœ€åå¾—æŸ¥è¯¢ç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m1n1m2n2</span><br><span class="line"><span class="number">2</span>b<span class="number">2</span>b</span><br><span class="line"><span class="number">3</span>c<span class="number">3</span>c</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»è¿™ä¸ªä¾‹å­ä¸­çœ‹å‡ºï¼Œæˆ‘ä»¬t1åªè¢«è®¿é—®ä¸€æ¬¡ï¼Œt2å¯ä»¥èƒ½è¢«è®¿é—®å¤šæ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨<strong>ä¸¤è¡¨è¿æ¥æŸ¥è¯¢ä¸­ï¼Œé©±åŠ¨è¡¨åªéœ€è¦è®¿é—®ä¸€æ¬¡ï¼Œè¢«é©±åŠ¨è¡¨å¯èƒ½è¢«è®¿é—®å¤šæ¬¡ã€‚</strong></p><h3 id="å†…è¿æ¥å’Œå¤–è¿æ¥">å†…è¿æ¥å’Œå¤–è¿æ¥</h3><p>åˆ›å»ºä¸¤ä¸ªè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line"> number <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;å­¦å·&#x27;</span>,</span><br><span class="line"> name <span class="type">VARCHAR</span>(<span class="number">5</span>) COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line"> major <span class="type">VARCHAR</span>(<span class="number">30</span>) COMMENT <span class="string">&#x27;ä¸“ä¸š&#x27;</span>,</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (number)</span><br><span class="line">) Engine<span class="operator">=</span>InnoDB CHARSET<span class="operator">=</span>utf8 COMMENT <span class="string">&#x27;å­¦ç”Ÿä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> score (</span><br><span class="line"> number <span class="type">INT</span> COMMENT <span class="string">&#x27;å­¦å·&#x27;</span>,</span><br><span class="line"> subject <span class="type">VARCHAR</span>(<span class="number">30</span>) COMMENT <span class="string">&#x27;ç§‘ç›®&#x27;</span>,</span><br><span class="line"> score TINYINT COMMENT <span class="string">&#x27;æˆç»©&#x27;</span>,</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (number, score)</span><br><span class="line">) Engine<span class="operator">=</span>InnoDB CHARSET<span class="operator">=</span>utf8 COMMENT <span class="string">&#x27;å­¦ç”Ÿæˆç»©è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ·»åŠ æ•°æ®å¦‚ä¸‹å›¾ï¼š</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230320163711859.png" alt="image-20230320163711859"></p><p>ç°åœ¨æˆ‘ä»¬æƒ³æŠŠæ¯ä¸ªå­¦ç”Ÿçš„è€ƒè¯•æˆç»©éƒ½æŸ¥è¯¢å‡ºæ¥å°±éœ€è¦è¿›è¡Œä¸¤è¡¨è¿æ¥äº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student, score <span class="keyword">WHERE</span> student.number <span class="operator">=</span> score.number;</span><br></pre></td></tr></table></figure><p><img src="HTTPs://zdwtop.cn/blog/image-20230320163355527.png" alt="image-20230320163355527"></p><p>ä½†å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå²çé¦™åŒå­¦ä¹Ÿå°±æ˜¯å­¦å·ä¸º 20220103 çš„åŒå­¦å› ä¸ºæŸäº›åŸå› æ²¡æœ‰å‚åŠ è€ƒè¯•ï¼Œæ‰€ä»¥åœ¨ score è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æˆç»©è®°å½•ã€‚åœ¨æˆç»©ç»Ÿè®¡æ—¶å²çé¦™å³ä½¿æ²¡æœ‰æˆç»©ä¹Ÿè¦å‡ºç°åœ¨è¡¨ä¸­ã€‚æˆ‘ä»¬ä»‹ç»çš„ è¿æ¥æŸ¥è¯¢ æ˜¯æ— æ³• å®Œæˆè¿™æ ·çš„éœ€æ±‚çš„ã€‚æˆ‘ä»¬ç¨å¾®æ€è€ƒä¸€ä¸‹è¿™ä¸ªéœ€æ±‚ï¼Œå…¶æœ¬è´¨æ˜¯æƒ³ï¼š<strong>é©±åŠ¨è¡¨ä¸­çš„è®°å½•å³ä½¿åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®° å½•ï¼Œä¹Ÿä»ç„¶éœ€è¦åŠ å…¥åˆ°ç»“æœé›†ã€‚</strong></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æœ‰äº† å†…è¿æ¥ å’Œ å¤–è¿æ¥ çš„æ¦‚å¿µï¼š</p><p>å¯¹äº å†…è¿æ¥ çš„ä¸¤ä¸ªè¡¨ï¼Œé©±åŠ¨è¡¨ä¸­çš„è®°å½•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾ä¸åˆ°åŒ¹é…çš„è®°å½•ï¼Œè¯¥è®°å½•ä¸ä¼šåŠ å…¥åˆ°æœ€åçš„ç»“æœé›†ï¼Œæˆ‘ä»¬ä¸Šè¾¹æåˆ°çš„è¿æ¥éƒ½æ˜¯æ‰€è°“çš„ å†…è¿æ¥ ã€‚</p><p>å¯¹äº å¤–è¿æ¥ çš„ä¸¤ä¸ªè¡¨ï¼Œé©±åŠ¨è¡¨ä¸­çš„è®°å½•å³ä½¿åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œä¹Ÿä»ç„¶éœ€è¦åŠ å…¥åˆ°ç»“æœé›†ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œæ ¹æ®é€‰å–é©±åŠ¨è¡¨çš„ä¸åŒï¼Œå¤–è¿æ¥ä»ç„¶å¯ä»¥ç»†åˆ†ä¸º2ç§ï¼š</p><ul><li>å·¦å¤–è¿æ¥ é€‰å–å·¦ä¾§çš„è¡¨ä¸ºé©±åŠ¨è¡¨ã€‚</li><li>å³å¤–è¿æ¥ é€‰å–å³ä¾§çš„è¡¨ä¸ºé©±åŠ¨è¡¨ã€‚</li></ul><p>æ³¨æ„ï¼š</p><p>WHERE å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶ä¸è®ºæ˜¯å†…è¿æ¥è¿˜æ˜¯å¤–è¿æ¥ï¼Œå‡¡æ˜¯ä¸ç¬¦åˆ WHERE å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶çš„è®°å½•éƒ½ä¸ä¼šè¢«åŠ å…¥æœ€åçš„ç»“æœé›†ã€‚</p><p>ON å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶å¯¹äºå¤–è¿æ¥çš„é©±åŠ¨è¡¨çš„è®°å½•æ¥è¯´ï¼Œå¦‚æœæ— æ³•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾åˆ°åŒ¹é… ON å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶çš„è®°å½•ï¼Œé‚£ä¹ˆè¯¥è®° å½•ä»ç„¶ä¼šè¢«åŠ å…¥åˆ°ç»“æœé›†ä¸­ï¼Œå¯¹åº”çš„è¢«é©±åŠ¨è¡¨è®°å½•çš„å„ä¸ªå­—æ®µä½¿ç”¨ NULL å€¼å¡«å……ã€‚</p><p>è¿™ä¸ª ON å­å¥æ˜¯ä¸“é—¨**ä¸ºå¤–è¿æ¥é©±åŠ¨è¡¨ä¸­çš„è®°å½•åœ¨è¢«é©±åŠ¨è¡¨æ‰¾ä¸åˆ°åŒ¹é…è®°å½•æ—¶åº”ä¸åº”è¯¥æŠŠè¯¥è®° å½•åŠ å…¥ç»“æœé›†è¿™ä¸ªåœºæ™¯ä¸‹æå‡ºçš„ï¼Œ**æ‰€ä»¥å¦‚æœæŠŠ ON å­å¥æ”¾åˆ°å†…è¿æ¥ä¸­ï¼Œ MySQL ä¼šæŠŠå®ƒå’Œ WHERE å­å¥ä¸€æ ·å¯¹ å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š<strong>å†…è¿æ¥ä¸­çš„WHEREå­å¥å’ŒONå­å¥æ˜¯ç­‰ä»·çš„ã€‚</strong></p><p><font color="red"><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æŠŠåªæ¶‰åŠå•è¡¨çš„è¿‡æ»¤æ¡ä»¶æ”¾åˆ° WHERE å­å¥ä¸­ï¼ŒæŠŠæ¶‰åŠä¸¤è¡¨çš„è¿‡æ»¤æ¡ä»¶éƒ½æ”¾åˆ° ON å­å¥ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸€èˆ¬æŠŠæ”¾åˆ° ON å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶ä¹Ÿç§°ä¹‹ä¸º è¿æ¥æ¡ä»¶ ã€‚</strong></font></p><p>è¿æ¥è¯­æ³•è¿™é‡Œå°±ä¸å¤šè®²äº†ã€‚</p><h2 id="è¿æ¥çš„åŸç†">è¿æ¥çš„åŸç†</h2><h3 id="åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆNested-Loop-Joinï¼‰">åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆNested-Loop Joinï¼‰</h3><p>å¯¹äºä¸¤è¡¨è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨åªä¼šè¢«è®¿é—®ä¸€éï¼Œä½†è¢«é©±åŠ¨è¡¨å´è¦è¢«è®¿é—®åˆ°å¥½å¤šéï¼Œå…·ä½“è®¿é—®å‡ éå– å†³äºå¯¹é©±åŠ¨è¡¨æ‰§è¡Œå•è¡¨æŸ¥è¯¢åçš„ç»“æœé›†ä¸­çš„è®°å½•æ¡æ•°ã€‚å¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œé€‰å–å“ªä¸ªè¡¨ä¸ºé©±åŠ¨è¡¨éƒ½æ²¡å…³ç³»ï¼Œè€Œå¤–è¿ æ¥çš„é©±åŠ¨è¡¨æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„é©±åŠ¨è¡¨å°±æ˜¯å·¦è¾¹çš„é‚£ä¸ªè¡¨ï¼Œå³ï¼ˆå¤–ï¼‰è¿æ¥çš„é©±åŠ¨è¡¨å°±æ˜¯å³è¾¹çš„é‚£ä¸ªè¡¨ã€‚</p><p>é€šç”¨çš„ä¸¤è¡¨è¿æ¥è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="HTTPs://zdwtop.cn/blog/image-20230320165448593.png" alt="image-20230320165448593" style="zoom:150%;"><p>å¦‚æœæœ‰3ä¸ªè¡¨è¿›è¡Œè¿æ¥çš„è¯ï¼Œé‚£ä¹ˆ æ­¥éª¤2 ä¸­å¾—åˆ°çš„ç»“æœé›†å°±åƒæ˜¯æ–°çš„é©±åŠ¨è¡¨ï¼Œç„¶åç¬¬ä¸‰ä¸ªè¡¨å°±æˆä¸ºäº†è¢«é©±åŠ¨è¡¨ï¼Œ é‡å¤ä¸Šè¾¹è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ æ­¥éª¤2 ä¸­å¾—åˆ°çš„ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•éƒ½éœ€è¦åˆ° t3 è¡¨ä¸­æ‰¾ä¸€æ‰¾æœ‰æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œç”¨ä¼ª ä»£ç è¡¨ç¤ºä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> each row in t1 &#123; #æ­¤å¤„è¡¨ç¤ºéå†æ»¡è¶³å¯¹t1å•è¡¨æŸ¥è¯¢ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•</span><br><span class="line"> <span class="keyword">for</span> each row in t2 &#123; #æ­¤å¤„è¡¨ç¤ºå¯¹äºæŸæ¡t1è¡¨çš„è®°å½•æ¥è¯´ï¼Œéå†æ»¡è¶³å¯¹t2å•è¡¨æŸ¥è¯¢ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•</span><br><span class="line"> <span class="keyword">for</span> each row in t3 &#123; #æ­¤å¤„è¡¨ç¤ºå¯¹äºæŸæ¡t1å’Œt2è¡¨çš„è®°å½•ç»„åˆæ¥è¯´ï¼Œå¯¹t3è¡¨è¿›è¡Œå•è¡¨æŸ¥è¯¢</span><br><span class="line"> <span class="keyword">if</span> row satisfies join conditions, send to client</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ä¸€ä¸ªåµŒå¥—çš„å¾ªç¯ï¼Œæ‰€ä»¥è¿™ç§<font color="red"><strong>é©±åŠ¨è¡¨åªè®¿é—®ä¸€æ¬¡ï¼Œä½†è¢«é©±åŠ¨è¡¨å´å¯èƒ½è¢«å¤šæ¬¡è®¿é—®ï¼Œè®¿é—®æ¬¡æ•°å–å†³äº å¯¹é©±åŠ¨è¡¨æ‰§è¡Œå•è¡¨æŸ¥è¯¢åçš„ç»“æœé›†ä¸­çš„è®°å½•æ¡æ•°çš„è¿æ¥æ‰§è¡Œæ–¹å¼ç§°ä¹‹ä¸º åµŒå¥—å¾ªç¯è¿æ¥</strong> </font>ï¼Œ è¿™æ˜¯æœ€ç®€å•ä¸€ç§è¿æ¥æŸ¥è¯¢ç®—æ³•ã€‚</p><h3 id="ä½¿ç”¨ç´¢å¼•åŠ å¿«è¿æ¥é€Ÿåº¦">ä½¿ç”¨ç´¢å¼•åŠ å¿«è¿æ¥é€Ÿåº¦</h3><p>ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“æŸ¥è¯¢ t2 è¡¨å…¶å®å°±ç›¸å½“äºä¸€æ¬¡å•è¡¨æ‰«æï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç´¢å¼• æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦å“¦ã€‚å›é¡¾ä¸€ä¸‹æœ€å¼€å§‹ä»‹ç»çš„ t1 è¡¨å’Œ t2 è¡¨è¿›è¡Œå†…è¿æ¥çš„ä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1, t2 <span class="keyword">WHERE</span> t1.m1 <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">AND</span> t1.m1 <span class="operator">=</span> t2.m2 <span class="keyword">AND</span> t2.n2 <span class="operator">&lt;</span> <span class="string">&#x27;d&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢é©±åŠ¨è¡¨ t1 åçš„ç»“æœé›†ä¸­æœ‰ä¸¤æ¡è®°å½•ï¼Œ åµŒå¥—å¾ªç¯è¿æ¥ ç®—æ³•éœ€è¦å¯¹è¢«é©±åŠ¨è¡¨æŸ¥è¯¢2æ¬¡ï¼š</p><ul><li>å½“ t1.m1 = 2 æ—¶ï¼Œå»æŸ¥è¯¢ä¸€é t2 è¡¨ï¼Œå¯¹ t2 è¡¨çš„æŸ¥è¯¢è¯­å¥ç›¸å½“äºï¼š<ul><li>SELECT * FROM t2 WHERE t2.m2 = 2 AND t2.n2 &lt; â€˜dâ€™;</li></ul></li><li>å½“ t1.m1 = 3 æ—¶ï¼Œå†å»æŸ¥è¯¢ä¸€é t2 è¡¨ï¼Œæ­¤æ—¶å¯¹ t2 è¡¨çš„æŸ¥è¯¢è¯­å¥ç›¸å½“äºï¼š<ul><li>SELECT * FROM t2 WHERE t2.m2 = 3 AND t2.n2 &lt; â€˜dâ€™;</li></ul></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸæ¥çš„ t1.m1 = t2.m2 è¿™ä¸ªæ¶‰åŠä¸¤ä¸ªè¡¨çš„è¿‡æ»¤æ¡ä»¶åœ¨é’ˆå¯¹ t2 è¡¨åšæŸ¥è¯¢æ—¶å…³äº t1 è¡¨çš„æ¡ä»¶å°±å·²ç»ç¡® å®šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å•å•ä¼˜åŒ–å¯¹ t2 è¡¨çš„æŸ¥è¯¢äº†ï¼Œä¸Šè¿°ä¸¤ä¸ªå¯¹ t2 è¡¨çš„æŸ¥è¯¢è¯­å¥ä¸­åˆ©ç”¨åˆ°çš„åˆ—æ˜¯ m2 å’Œ n2 åˆ—ï¼Œ æˆ‘ä»¬å¯ä»¥ï¼š</p><ul><li>åœ¨ m2 åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºå¯¹ m2 åˆ—çš„æ¡ä»¶æ˜¯ç­‰å€¼æŸ¥æ‰¾ï¼Œæ‰€ä»¥å¯èƒ½ä½¿ç”¨åˆ° ref çš„è®¿é—®æ–¹æ³•ï¼Œå‡è®¾ä½¿ç”¨ ref çš„è®¿é—®æ–¹æ³•å»æ‰§è¡Œå¯¹ t2 è¡¨çš„æŸ¥è¯¢çš„è¯ï¼Œéœ€è¦å›è¡¨ä¹‹åå†åˆ¤æ–­ t2.n2 &lt; d è¿™ ä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</li></ul><blockquote><p>å‡è®¾ m2 åˆ—æ˜¯ t2 è¡¨çš„ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆä½¿ç”¨ t2.m2 = å¸¸æ•° å€¼ è¿™æ ·çš„æ¡ä»¶ä» t2 è¡¨ä¸­æŸ¥æ‰¾è®°å½•çš„è¿‡ç¨‹çš„ä»£ä»·å°±æ˜¯å¸¸æ•°çº§åˆ«çš„ã€‚</p><p>æŠŠåœ¨è¿æ¥æŸ¥è¯¢ä¸­å¯¹è¢«é©±åŠ¨è¡¨ä½¿ç”¨ä¸»é”® å€¼æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—çš„å€¼è¿›è¡Œç­‰å€¼æŸ¥æ‰¾çš„æŸ¥è¯¢æ‰§è¡Œæ–¹å¼ç§°ä¹‹ä¸ºï¼š eq_ref ã€‚</p></blockquote><h3 id="åŸºäºå—çš„åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆBlock-Nested-Loop-Joinï¼‰">åŸºäºå—çš„åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆBlock Nested-Loop Joinï¼‰</h3><p>æ‰«æä¸€ä¸ªè¡¨çš„è¿‡ç¨‹å…¶å®æ˜¯å…ˆæŠŠè¿™ä¸ªè¡¨ä»ç£ç›˜ä¸ŠåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åä»å†…å­˜ä¸­æ¯”è¾ƒåŒ¹é…æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚é‚£ä¹ˆå½“è¡¨ä¸­æ•°æ®ä¸€å¤šçš„æ—¶å€™ï¼Œå†…å­˜ä¸å¯èƒ½å­˜çš„åˆ°é‚£ä¹ˆå¤šæ•°æ®ï¼Œæ‰€ä»¥å°±è¦æ·˜æ±°å‰é¢çš„æ•°æ®ã€‚æˆ‘ä»¬å‰è¾¹åˆè¯´è¿‡ï¼Œé‡‡ç”¨ åµŒ å¥—å¾ªç¯è¿æ¥ ç®—æ³•çš„ä¸¤è¡¨è¿æ¥è¿‡ç¨‹ä¸­ï¼Œè¢«é©±åŠ¨è¡¨å¯æ˜¯è¦è¢«è®¿é—®å¥½å¤šæ¬¡çš„ï¼Œå¦‚æœè¿™ä¸ªè¢«é©±åŠ¨è¡¨ä¸­çš„æ•°æ®ç‰¹åˆ«å¤šè€Œä¸”ä¸ èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ï¼Œé‚£å°±ç›¸å½“äºè¦ä»ç£ç›˜ä¸Šè¯»å¥½å‡ æ¬¡è¿™ä¸ªè¡¨ï¼Œè¿™ä¸ª I/O ä»£ä»·å°±éå¸¸å¤§äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æƒ³åŠæ³•ï¼š <strong>å°½é‡å‡å°‘è®¿é—®è¢«é©±åŠ¨è¡¨çš„æ¬¡æ•°ã€‚</strong></p><p>æˆ‘ä»¬åœ¨æŠŠè¢«é©±åŠ¨è¡¨çš„è®°å½•åŠ è½½åˆ°å†…å­˜çš„æ—¶å€™ï¼Œå¯ä¸å¯ä»¥ä¸€æ¬¡æ€§å’Œå¤šæ¡é©±åŠ¨è¡¨ä¸­ çš„è®°å½•åšåŒ¹é…ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§å‡å°‘é‡å¤ä»ç£ç›˜ä¸ŠåŠ è½½è¢«é©±åŠ¨è¡¨çš„ä»£ä»·äº†ã€‚</p><p>æ‰€ä»¥MySQL é‡Œé¢æœ‰ä¸ªjoin buffer çš„æ¦‚å¿µï¼Œ **join buffer å°±æ˜¯æ‰§è¡Œè¿æ¥æŸ¥è¯¢å‰ç”³è¯·çš„ä¸€å—å›ºå®šå¤§å°çš„å†…å­˜ï¼Œå…ˆæŠŠè‹¥å¹²æ¡é©±åŠ¨è¡¨ç»“æœé›† ä¸­çš„è®°å½•è£…åœ¨è¿™ä¸ª join buffer ä¸­ï¼Œç„¶åå¼€å§‹æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œæ¯ä¸€æ¡è¢«é©±åŠ¨è¡¨çš„è®°å½•ä¸€æ¬¡æ€§å’Œ join buffer ä¸­çš„ å¤šæ¡é©±åŠ¨è¡¨è®°å½•åšåŒ¹é…ï¼Œå› ä¸ºåŒ¹é…çš„è¿‡ç¨‹éƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆçš„ï¼Œæ‰€ä»¥è¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘è¢«é©±åŠ¨è¡¨çš„ I/O ä»£ä»·ã€‚**ä½¿ ç”¨ join buffer çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="HTTPs://zdwtop.cn/blog/image-20230320170527848.png" alt="image-20230320170527848"></p><p>æœ€å¥½çš„æƒ…å†µæ˜¯ join buffer è¶³å¤Ÿå¤§ï¼Œèƒ½å®¹çº³é©±åŠ¨è¡¨ç»“æœé›†ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œè¿™æ ·åªéœ€è¦è®¿é—®ä¸€æ¬¡è¢«é©±åŠ¨è¡¨å°±å¯ä»¥å®Œ æˆè¿æ¥æ“ä½œäº†ã€‚</p><p>è¿™ç§åŠ å…¥äº† join buffer çš„åµŒå¥—å¾ªç¯è¿æ¥ç®—æ³•ç§°ä¹‹ä¸º åŸºäºå—çš„åµŒå¥—è¿æ¥ ï¼ˆBlock Nested-Loop Joinï¼‰ç®—æ³•ã€‚</p><p>è¿™ä¸ª join buffer çš„å¤§å°æ˜¯å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°æˆ–è€…ç³»ç»Ÿå˜é‡<code>join_buffer_size</code>è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å¤§å°ä¸º 262144å­— èŠ‚ ï¼ˆä¹Ÿå°±æ˜¯ 256KB ï¼‰ï¼Œæœ€å°å¯ä»¥è®¾ç½®ä¸º 128å­—èŠ‚ ã€‚</p><p>é©±åŠ¨è¡¨çš„è®°å½•å¹¶ä¸æ˜¯æ‰€æœ‰åˆ—éƒ½ä¼šè¢«æ”¾åˆ°<code> join buffe</code>r ä¸­ï¼Œåªæœ‰æŸ¥è¯¢åˆ—è¡¨ä¸­çš„åˆ—å’Œè¿‡æ»¤æ¡ä»¶ä¸­ çš„åˆ—æ‰ä¼šè¢«æ”¾åˆ° join buffer ä¸­ï¼Œæ‰€ä»¥å†æ¬¡æé†’æˆ‘ä»¬ï¼Œ<strong>æœ€å¥½ä¸è¦æŠŠ * ä½œä¸ºæŸ¥è¯¢åˆ—è¡¨</strong>ï¼Œåªéœ€è¦æŠŠæˆ‘ä»¬å…³å¿ƒçš„åˆ—æ”¾åˆ° æŸ¥è¯¢åˆ—è¡¨å°±å¥½äº†ï¼Œè¿™æ ·è¿˜å¯ä»¥åœ¨ join buffer ä¸­æ”¾ç½®æ›´å¤šçš„è®°å½•å‘¢å“ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ä¸¤ä¸ªè¡¨çš„äº²å¯†æ¥è§¦-è¿æ¥çš„åŸç†&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆåˆ›å»ºä¸¤ä¸ªè¡¨&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;spa</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="innodb" scheme="https://eizo01.github.io/tags/innodb/"/>
    
    <category term="è¿æ¥" scheme="https://eizo01.github.io/tags/%E8%BF%9E%E6%8E%A5/"/>
    
  </entry>
  
  <entry>
    <title>MySQLä¸­çš„é”</title>
    <link href="https://eizo01.github.io/posts/484a2385.html"/>
    <id>https://eizo01.github.io/posts/484a2385.html</id>
    <published>2022-10-20T12:00:00.000Z</published>
    <updated>2023-03-16T15:22:32.664Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>MySQLä¸­çš„é”</strong></h1><p>InnoDBä¸­é”éå¸¸å¤šï¼Œæ€»çš„æ¥è¯´ï¼Œå¯ä»¥å¦‚ä¸‹åˆ†ç±»ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316215836060.png" alt></p><p>è¿™äº›é”éƒ½æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶å¯èƒ½å¸¦æ¥çš„å„ç§é—®é¢˜ï¼Œæœ€å¤§çš„ä¸€ä¸ªéš¾ç‚¹æ˜¯ï¼šä¸€æ–¹é¢è¦æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œå¦å¤–ä¸€æ–¹é¢è¿˜è¦ç¡®ä¿æ¯ä¸ªç”¨æˆ·èƒ½ä»¥ä¸€è‡´çš„æ–¹å¼è¯»å–å’Œä¿®æ”¹æ•°æ®ï¼Œå°¤å…¶æ˜¯ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªåŒæ—¶è¿›è¡Œæ”¹åŠ¨æ“ä½œçš„æƒ…å†µä¸‹ã€‚</p><h2 id="1-é”å¹¶å‘äº‹åŠ¡é—®é¢˜">**1.**é”å¹¶å‘äº‹åŠ¡é—®é¢˜</h2><p>ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªè¿›è¡Œæ”¹åŠ¨æ“ä½œ,æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»çš„é—®é¢˜ã€‚</p><p>æ€ä¹ˆè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™äº›é—®é¢˜å‘¢ï¼Ÿå…¶å®æœ‰ä¸¤ç§å¯é€‰çš„è§£å†³æ–¹æ¡ˆï¼š</p><h3 id="1-1-æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œMVCCï¼Œå†™æ“ä½œè¿›è¡ŒåŠ é”"><strong>1.1.æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œMVCCï¼Œå†™æ“ä½œè¿›è¡ŒåŠ é”</strong></h3><p><strong>äº‹åŠ¡åˆ©ç”¨MVCCè¿›è¡Œçš„è¯»å–æ“ä½œç§°ä¹‹ä¸ºä¸€è‡´æ€§è¯»ï¼Œæˆ–è€…ä¸€è‡´æ€§æ— é”è¯»ï¼Œä¹Ÿç§°ä¹‹ä¸ºå¿«ç…§è¯»</strong>ï¼Œä½†æ˜¯å¾€å¾€è¯»å–çš„æ˜¯å†å²ç‰ˆæœ¬æ•°æ®ã€‚æ‰€æœ‰æ™®é€šçš„SELECTè¯­å¥ï¼ˆplain SELECTï¼‰åœ¨READ COMMITTEDã€REPEATABLE READéš”ç¦»çº§åˆ«ï¼ˆRC,RRï¼‰ä¸‹éƒ½ç®—æ˜¯ä¸€è‡´æ€§è¯»ã€‚</p><p>ä¸€è‡´æ€§è¯»å¹¶ä¸ä¼šå¯¹è¡¨ä¸­çš„ä»»ä½•è®°å½•åšåŠ é”æ“ä½œï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥è‡ªç”±çš„å¯¹è¡¨ä¸­çš„è®°å½•åšæ”¹åŠ¨ã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œé‡‡ç”¨MVCCæ–¹å¼çš„è¯ï¼Œ<strong>è¯»-å†™æ“ä½œå½¼æ­¤å¹¶ä¸å†²çªï¼Œæ€§èƒ½æ›´é«˜</strong>ï¼Œ<strong>é‡‡ç”¨åŠ é”æ–¹å¼çš„è¯ï¼Œè¯»-å†™æ“ä½œå½¼æ­¤éœ€è¦æ’é˜Ÿæ‰§è¡Œï¼Œå½±å“æ€§èƒ½</strong>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å½“ç„¶æ„¿æ„é‡‡ç”¨MVCCæ¥è§£å†³è¯»-å†™æ“ä½œå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯ä¸šåŠ¡åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¦æ±‚å¿…é¡»é‡‡ç”¨åŠ é”çš„æ–¹å¼æ‰§è¡Œã€‚</p><h3 id="1-2æ–¹æ¡ˆäºŒï¼šè¯»ã€å†™æ“ä½œéƒ½é‡‡ç”¨åŠ é”çš„æ–¹å¼"><strong>1.2æ–¹æ¡ˆäºŒï¼šè¯»ã€å†™æ“ä½œéƒ½é‡‡ç”¨åŠ é”çš„æ–¹å¼</strong></h3><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p><p>ä¸šåŠ¡åœºæ™¯ä¸å…è®¸è¯»å–è®°å½•çš„æ—§ç‰ˆæœ¬ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å¿…é¡»å»è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œ</p><p>æ¯”æ–¹åœ¨é“¶è¡Œå­˜æ¬¾çš„äº‹åŠ¡ä¸­ï¼Œä½ éœ€è¦å…ˆæŠŠè´¦æˆ·çš„ä½™é¢è¯»å‡ºæ¥ï¼Œç„¶åå°†å…¶åŠ ä¸Šæœ¬æ¬¡å­˜æ¬¾çš„æ•°é¢ï¼Œæœ€åå†å†™åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨å°†è´¦æˆ·ä½™é¢è¯»å–å‡ºæ¥åï¼Œå°±ä¸æƒ³è®©åˆ«çš„äº‹åŠ¡å†è®¿é—®è¯¥ä½™é¢ï¼Œç›´åˆ°æœ¬æ¬¡å­˜æ¬¾äº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œå…¶ä»–äº‹åŠ¡æ‰å¯ä»¥è®¿é—®è´¦æˆ·çš„ä½™é¢ã€‚è¿™æ ·åœ¨è¯»å–è®°å½•çš„æ—¶å€™ä¹Ÿå°±éœ€è¦å¯¹å…¶è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¿™æ ·ä¹Ÿå°±æ„å‘³ç€è¯»æ“ä½œå’Œå†™æ“ä½œä¹Ÿåƒå†™-å†™æ“ä½œé‚£æ ·æ’é˜Ÿæ‰§è¡Œã€‚</p><p><strong>è„è¯»</strong>çš„äº§ç”Ÿæ˜¯ å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡å†™çš„ä¸€æ¡è®°å½•ï¼Œå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡åœ¨å†™è®°å½•çš„æ—¶å€™å°±ç»™è¿™æ¡è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡å°±æ— æ³•ç»§ç»­è¯»å–è¯¥è®°å½•äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šæœ‰è„è¯»é—®é¢˜çš„äº§ç”Ÿäº†ã€‚</p><p><strong>ä¸å¯é‡å¤è¯»</strong>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡å…ˆè¯»å–ä¸€æ¡è®°å½•ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯¹è¯¥è®°å½•åšäº†æ”¹åŠ¨ä¹‹åå¹¶æäº¤ä¹‹åï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–æ—¶ä¼šè·å¾—ä¸åŒçš„å€¼ï¼Œå¦‚æœåœ¨å½“å‰äº‹åŠ¡è¯»å–è®°å½•æ—¶å°±ç»™è¯¥è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±æ— æ³•ä¿®æ”¹è¯¥è®°å½•ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»äº†ã€‚</p><p><strong>å¹»è¯»é—®é¢˜</strong>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œç„¶åå¦å¤–çš„äº‹åŠ¡å‘è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è®°å½•ï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶å‘ç°äº†æ–°æ’å…¥çš„æ–°è®°å½•ï¼Œæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„é‚£äº›è®°å½•ç§°ä¹‹ä¸ºå¹»å½±è®°å½•ã€‚é‡‡ç”¨åŠ é”çš„æ–¹å¼è§£å†³å¹»è¯»é—®é¢˜å°±æœ‰ä¸å¤ªå®¹æ˜“äº†ï¼Œå› ä¸ºå½“å‰äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»å–è®°å½•æ—¶é‚£äº›å¹»å½±è®°å½•å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¯»å–çš„æ—¶å€™åŠ é”å°±æœ‰ç‚¹éº»çƒ¦â€”â€” å› ä¸ºå¹¶ä¸çŸ¥é“ç»™è°åŠ é”ã€‚</p><h2 id="2-é”å®šè¯»ï¼ˆLockingReadsï¼‰-LBCC"><strong>2.é”å®šè¯»ï¼ˆLockingReadsï¼‰/LBCC</strong></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">for</span>  <span class="keyword">update</span>   <span class="comment">-- é”å®šè¯» å±äºxé”</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿç§°å½“å‰è¯», è¯»å–çš„æ˜¯æœ€æ–°ç‰ˆæœ¬, å¹¶ä¸”å¯¹è¯»å–çš„è®°å½•åŠ é”, é˜»å¡å…¶ä»–äº‹åŠ¡åŒæ—¶æ”¹åŠ¨ç›¸åŒè®°å½•ï¼Œé¿å…å‡ºç°å®‰å…¨é—®é¢˜ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span>   lock <span class="keyword">in</span> share mode <span class="comment">-- (å…±äº«é”) Sé”</span></span><br></pre></td></tr></table></figure><p>å“ªäº›æ˜¯å½“å‰è¯»å‘¢ï¼Ÿ</p><p><strong>select lock in share mode (å…±äº«é”)ã€select for update (æ’ä»–é”)ã€è¯»æ“ä½œ</strong></p><p><strong>update (æ’ä»–é”)ã€insert (æ’ä»–é”/ç‹¬å é”)ã€delete (æ’ä»–é”)ã€å†™æ“ä½œ</strong></p><p><strong>ä¸²è¡ŒåŒ–äº‹åŠ¡éš”ç¦»çº§åˆ«</strong>éƒ½æ˜¯å½“å‰è¯»ã€‚</p><h3 id="2-1-å…±äº«é”å’Œç‹¬å é”"><strong>2.1. å…±äº«é”å’Œç‹¬å é”</strong></h3><p>åœ¨ä½¿ç”¨åŠ é”çš„æ–¹å¼è§£å†³é—®é¢˜æ—¶ï¼Œç”±äºæ—¢è¦å…è®¸è¯»-è¯»æƒ…å†µä¸å—å½±å“ï¼Œåˆè¦ä½¿å†™-å†™ã€è¯»-å†™æˆ–å†™-è¯»æƒ…å†µä¸­çš„æ“ä½œç›¸äº’é˜»å¡ï¼ŒMySQLä¸­çš„é”æœ‰å¥½å‡ ç±»ï¼š</p><p><strong>å…±äº«é”</strong>è‹±æ–‡åï¼šShared Locksï¼Œ<strong>ç®€ç§°Sé”</strong>ã€‚åœ¨äº‹åŠ¡è¦è¯»å–ä¸€æ¡è®°å½•æ—¶ï¼Œéœ€è¦å…ˆè·å–è¯¥è®°å½•çš„Sé”ã€‚</p><p>å‡å¦‚äº‹åŠ¡E1é¦–å…ˆè·å–äº†ä¸€æ¡è®°å½•çš„Sé”ä¹‹åï¼Œäº‹åŠ¡E2æ¥ç€ä¹Ÿè¦è®¿é—®è¿™æ¡è®°å½•ï¼š</p><p>å¦‚æœäº‹åŠ¡E2æƒ³è¦å†è·å–ä¸€ä¸ªè®°å½•çš„Sé”ï¼Œé‚£ä¹ˆäº‹åŠ¡E2ä¹Ÿä¼šè·å¾—è¯¥é”ï¼Œä¹Ÿå°±æ„å‘³ç€äº‹åŠ¡E1å’ŒE2åœ¨è¯¥è®°å½•ä¸ŠåŒæ—¶æŒæœ‰Sé”ã€‚</p><p><strong>ç‹¬å é”ï¼Œ<strong>ä¹Ÿå¸¸ç§°</strong>æ’ä»–é”</strong>ï¼Œè‹±æ–‡åï¼šExclusive Locksï¼Œ<strong>ç®€ç§°Xé”</strong>ã€‚</p><p>åœ¨ äº‹åŠ¡è¦æ”¹åŠ¨ä¸€æ¡è®°å½•æ—¶ï¼ŒE1éœ€è¦å…ˆè·å–è¯¥è®°å½•çš„Xé”ã€‚</p><p>å¦‚æœäº‹åŠ¡E2æƒ³è¦å†è·å–ä¸€ä¸ªè®°å½•çš„Xé”ï¼Œé‚£ä¹ˆæ­¤æ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡E1æäº¤ä¹‹åå°†Sé”é‡Šæ”¾æ‰ã€‚</p><p>å¦‚æœäº‹åŠ¡E1é¦–å…ˆè·å–äº†ä¸€æ¡è®°å½•çš„Xé”ä¹‹åï¼Œé‚£ä¹ˆä¸ç®¡äº‹åŠ¡E2æ¥ç€æƒ³è·å–è¯¥è®°å½•çš„Sé”è¿˜æ˜¯Xé”éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡E1æäº¤ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¯´Sé”å’ŒSé”æ˜¯å…¼å®¹çš„ï¼ŒSé”å’ŒXé”æ˜¯ä¸å…¼å®¹çš„ï¼ŒXé”å’ŒXé”ä¹Ÿæ˜¯ä¸å…¼å®¹çš„ï¼Œè¡¨ç¤ºä¸€ä¸‹å°±æ˜¯è¿™æ ·ï¼š</p><table><thead><tr><th><strong>X</strong></th><th><strong>ä¸å…¼å®¹S</strong></th><th><strong>ä¸å…¼å®¹X</strong></th></tr></thead><tbody><tr><td><strong>S</strong></td><td><strong>å…¼å®¹S</strong></td><td><strong>ä¸å…¼å®¹X</strong></td></tr></tbody></table><h3 id="2-2-é”å®šè¯»çš„SELECTè¯­å¥"><strong>2.2.é”å®šè¯»çš„SELECTè¯­å¥</strong></h3><p>MySQæœ‰ä¸¤ç§æ¯”è¾ƒç‰¹æ®Šçš„SELECTè¯­å¥æ ¼å¼ï¼š</p><h4 id="å¯¹è¯»å–çš„è®°å½•åŠ Sé”ï¼š">å¯¹è¯»å–çš„è®°å½•åŠ Sé”ï¼š</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> test LOCK <span class="keyword">IN</span> SHARE MODE;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªäº‹åŠ¡ä¸­å¼€å¯Sé”</p><p><img src="https://zdwtop.cn/blog/image-20230316224750706.png" alt="image-20230316224750706"></p><p>ä¹Ÿå°±æ˜¯åœ¨æ™®é€šçš„SELECTè¯­å¥åè¾¹åŠ LOCK IN SHARE MODEï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œäº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå®ƒä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ Sé”ï¼Œè¿™æ ·å…è®¸åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¿™äº›è®°å½•çš„Sé”ï¼ˆæ¯”æ–¹è¯´åˆ«çš„äº‹åŠ¡ä¹Ÿä½¿ç”¨SELECT â€¦ LOCK IN SHARE MODEè¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½è·å–è¿™äº›è®°å½•çš„Xé”ï¼ˆæ¯”æ–¹è¯´ä½¿ç”¨SELECT â€¦ FOR UPDATEè¯­å¥æ¥è¯»å–è¿™äº›è®°å½•ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹è¿™äº›è®°å½•ï¼‰ã€‚</p><p>å¦‚æœåˆ«çš„äº‹åŠ¡æƒ³è¦è·å–è¿™äº›è®°å½•çš„Xé”ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤ä¹‹åå°†è¿™äº›è®°å½•ä¸Šçš„Sé”é‡Šæ”¾æ‰ã€‚</p><h4 id="å¯¹è¯»å–çš„è®°å½•åŠ Xé”ï¼š">å¯¹è¯»å–çš„è®°å½•åŠ Xé”ï¼š</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><img src="https://zdwtop.cn/blog/image-20230316225958920.png" alt="image-20230316225958920" style="zoom: 80%;"><p>å¦‚æœåˆ«çš„äº‹åŠ¡æƒ³è¦è·å–è¿™äº›è®°å½•çš„Sé”æˆ–è€…Xé”ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤ä¹‹åå°†è¿™äº›è®°å½•ä¸Šçš„Xé”é‡Šæ”¾æ‰ã€‚</p><h3 id="2-3-å†™æ“ä½œçš„é”"><strong>2.3. å†™æ“ä½œçš„é”</strong></h3><p>å¹³å¸¸æ‰€ç”¨åˆ°çš„å†™æ“ä½œæ— éæ˜¯DELETEã€UPDATEã€INSERTè¿™ä¸‰ç§ï¼š</p><h5 id="DELETEï¼š"><strong>DELETEï¼š</strong></h5><p>å¯¹ä¸€æ¡è®°å½•åšDELETEæ“ä½œçš„è¿‡ç¨‹å…¶å®æ˜¯å…ˆåœ¨B+æ ‘ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–ä¸€ä¸‹è¿™æ¡è®°å½•çš„Xæ’ä»–é”å®šè¯»ï¼Œç„¶åå†æ‰§è¡Œdelete markæ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…åˆ é™¤è®°å½•åœ¨B+æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–Xé”çš„é”å®šè¯»ã€‚</p><h5 id="INSERTï¼š"><strong>INSERTï¼š</strong></h5><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°æ’å…¥ä¸€æ¡è®°å½•çš„æ“ä½œå¹¶ä¸åŠ é”ï¼ŒInnoDBé€šè¿‡ä¸€ç§ç§°ä¹‹ä¸ºéšå¼é”æ¥ä¿æŠ¤è¿™æ¡æ–°æ’å…¥çš„è®°å½•åœ¨æœ¬äº‹åŠ¡æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—®ã€‚å½“ç„¶ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹INSERTæ“ä½œä¹Ÿæ˜¯ä¼šè·å–é”çš„ï¼Œå…·ä½“æƒ…å†µæˆ‘ä»¬åè¾¹å†è¯´ã€‚</p><h5 id="UPDATEï¼š"><strong>UPDATEï¼š</strong></h5><p>åœ¨å¯¹ä¸€æ¡è®°å½•åšUPDATEæ“ä½œæ—¶åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ol><li><p>å¦‚æœæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼å¹¶ä¸”è¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨<strong>ä¿®æ”¹å‰åæœªå‘ç”Ÿå˜åŒ–</strong>ï¼Œåˆ™å…ˆåœ¨B+æ ‘ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åå†è·å–ä¸€ä¸‹è®°å½•çš„Xé”ï¼Œæœ€ååœ¨åŸè®°å½•çš„ä½ç½®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+æ ‘ ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ª<strong>è·å–Xé”çš„é”å®šè¯»</strong>ã€‚</p></li><li><p>å¦‚æœæœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼å¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªè¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨<strong>ä¿®æ”¹å‰åå‘ç”Ÿå˜åŒ–</strong>ï¼Œåˆ™å…ˆåœ¨B+æ ‘ä¸­å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–ä¸€ä¸‹è®°å½•çš„Xé”ï¼Œå°†è¯¥è®°å½•å½»åº•åˆ é™¤æ‰ï¼ˆå°±æ˜¯æŠŠè®°å½•å½»åº•ç§»å…¥åƒåœ¾é“¾è¡¨ï¼‰ï¼Œæœ€åå†æ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚è¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ª<strong>è·å–Xé”çš„é”å®šè¯»</strong>ï¼Œæ–°æ’å…¥çš„è®°å½•ç”±INSERTæ“ä½œæä¾›çš„<strong>éšå¼é”è¿›è¡Œä¿æŠ¤</strong>ã€‚</p></li><li><p>å¦‚æœä¿®æ”¹äº†è¯¥è®°å½•çš„é”®å€¼ï¼Œåˆ™ç›¸å½“äºåœ¨åŸè®°å½•ä¸ŠåšDELETEæ“ä½œä¹‹åå†æ¥ä¸€æ¬¡INSERTæ“ä½œï¼ŒåŠ é”æ“ä½œå°±éœ€è¦æŒ‰ç…§DELETEå’ŒINSERTçš„è§„åˆ™è¿›è¡Œäº†ã€‚</p></li></ol><h2 id="3-é”çš„ç²’åº¦"><strong>3.é”çš„ç²’åº¦</strong></h2><p>æˆ‘ä»¬å‰è¾¹æåˆ°çš„é”éƒ½æ˜¯é’ˆå¯¹è®°å½•çš„ï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¹‹ä¸ºè¡Œçº§é”æˆ–è€…è¡Œé”ï¼Œå¯¹ä¸€æ¡è®°å½•åŠ é”å½±å“çš„ä¹Ÿåªæ˜¯è¿™æ¡è®°å½•è€Œå·²ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç»†ï¼›å…¶å®ä¸€ä¸ªäº‹åŠ¡ä¹Ÿå¯ä»¥åœ¨è¡¨çº§åˆ«è¿›è¡ŒåŠ é”ï¼Œè‡ªç„¶å°±è¢«ç§°ä¹‹ä¸ºè¡¨çº§é”æˆ–è€…è¡¨é”ï¼Œå¯¹ä¸€ä¸ªè¡¨åŠ é”å½±å“æ•´ä¸ªè¡¨ä¸­çš„è®°å½•ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç²—ã€‚ç»™è¡¨åŠ çš„é”ä¹Ÿå¯ä»¥åˆ†ä¸ºå…±äº«é”ï¼ˆSé”ï¼‰å’Œç‹¬å é”ï¼ˆXé”ï¼‰</p><h3 id="3-1-è¡¨é”ä¸è¡Œé”çš„æ¯”è¾ƒ"><strong>3.1.è¡¨é”ä¸è¡Œé”çš„æ¯”è¾ƒ</strong></h3><p><strong>é”å®šç²’åº¦ï¼šè¡¨é” &gt; è¡Œé”</strong></p><p><strong>åŠ é”æ•ˆç‡ï¼šè¡¨é” &gt; è¡Œé”</strong></p><p><strong>å†²çªæ¦‚ç‡ï¼šè¡¨é” &gt; è¡Œé”</strong></p><p><strong>å¹¶å‘æ€§èƒ½ï¼šè¡¨é” &lt; è¡Œé”</strong></p><h3 id="3-2-ç»™è¡¨åŠ Sé”"><strong>3.2.ç»™è¡¨åŠ Sé”</strong></h3><p><strong>å¦‚æœä¸€ä¸ªäº‹åŠ¡ç»™è¡¨åŠ äº†Sé”ï¼Œé‚£ä¹ˆï¼š</strong></p><p>åˆ«çš„äº‹åŠ¡å¯ä»¥ç»§ç»­è·å¾—è¯¥è¡¨çš„Sé”</p><p>åˆ«çš„äº‹åŠ¡å¯ä»¥ç»§ç»­è·å¾—è¯¥è¡¨ä¸­çš„æŸäº›è®°å½•çš„Sé”</p><p>åˆ«çš„äº‹åŠ¡<strong>ä¸å¯ä»¥ç»§ç»­è·å¾—è¯¥è¡¨çš„Xé”</strong></p><p>åˆ«çš„äº‹åŠ¡<strong>ä¸å¯ä»¥ç»§ç»­è·å¾—è¯¥è¡¨ä¸­çš„æŸäº›è®°å½•çš„Xé”</strong></p><h3 id="3-3-ç»™è¡¨åŠ Xé”"><strong>3.3.ç»™è¡¨åŠ Xé”</strong></h3><p><strong>å¦‚æœä¸€ä¸ªäº‹åŠ¡ç»™è¡¨åŠ äº†Xé”ï¼ˆæ„å‘³ç€è¯¥äº‹åŠ¡è¦ç‹¬å è¿™ä¸ªè¡¨ï¼‰ï¼Œé‚£ä¹ˆï¼š</strong></p><p>åˆ«çš„äº‹åŠ¡<strong>ä¸å¯ä»¥</strong>ç»§ç»­è·å¾—è¯¥è¡¨çš„Sé”</p><p>åˆ«çš„äº‹åŠ¡<strong>ä¸å¯ä»¥</strong>ç»§ç»­è·å¾—è¯¥è¡¨ä¸­çš„æŸäº›è®°å½•çš„Sé”</p><p>åˆ«çš„äº‹åŠ¡<strong>ä¸å¯ä»¥</strong>ç»§ç»­è·å¾—è¯¥è¡¨çš„Xé”</p><p>åˆ«çš„äº‹åŠ¡<strong>ä¸å¯ä»¥</strong>ç»§ç»­è·å¾—è¯¥è¡¨ä¸­çš„æŸäº›è®°å½•çš„Xé”ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ç†è§£è¿™ä¸ªè¡¨çº§åˆ«çš„Sé”å’ŒXé”å’Œåé¢çš„æ„å‘é”ï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­ã€‚æˆ‘ä»¬ç”¨æ›¾ç»å¾ˆç«çˆ†çš„äº’è”ç½‘é£å£é¡¹ç›®å…±äº«Officeæ¥è¯´æ˜åŠ é”ï¼š</p><p>å…±äº«Officeæœ‰æ ‹å¤§æ¥¼ï¼Œæ¥¼è‡ªç„¶æœ‰å¾ˆå¤šå±‚ã€‚åŠå…¬å®¤éƒ½æ˜¯å…±äº«çš„ï¼Œå®¢æˆ·å¯ä»¥éšä¾¿é€‰åŠå…¬å®¤åŠå…¬ã€‚æ¯å±‚æ¥¼å¯ä»¥å®¹çº³å®¢æˆ·åŒæ—¶åŠå…¬ï¼Œæ¯å½“ä¸€ä¸ªå®¢æˆ·è¿›å»åŠå…¬ï¼Œå°±ç›¸å½“äºåœ¨æ¯å±‚çš„å…¥å£å¤„æŒ‚äº†ä¸€æŠŠSé”ï¼Œå¦‚æœå¾ˆå¤šå®¢æˆ·è¿›å»åŠå…¬ï¼Œç›¸å½“äºæ¯å±‚çš„å…¥å£å¤„æŒ‚äº†å¾ˆå¤šæŠŠSé”ï¼ˆç±»ä¼¼è¡Œçº§åˆ«çš„Sé”ï¼‰ã€‚</p><p>æœ‰çš„æ—¶å€™æ¥¼å±‚ä¼šè¿›è¡Œæ£€ä¿®ï¼Œæ¯”æ–¹è¯´æ¢åœ°æ¿ï¼Œæ¢å¤©èŠ±æ¿ï¼Œæ£€æŸ¥æ°´ç”µå•¥çš„ï¼Œè¿™äº›ç»´ä¿®é¡¹ç›®å¹¶ä¸èƒ½åŒæ—¶å¼€å±•ã€‚å¦‚æœæ¥¼å±‚é’ˆå¯¹æŸä¸ªé¡¹ç›®è¿›è¡Œæ£€ä¿®ï¼Œå°±ä¸å…è®¸å®¢æˆ·æ¥åŠå…¬ï¼Œä¹Ÿä¸å…è®¸å…¶ä»–ç»´ä¿®é¡¹ç›®è¿›è¡Œï¼Œæ­¤æ—¶ç›¸å½“äºæ¥¼å±‚é—¨å£ä¼šæŒ‚ä¸€æŠŠXé”ï¼ˆç±»ä¼¼è¡Œçº§åˆ«çš„Xé”ï¼‰ã€‚</p><p>ä¸Šè¾¹æåˆ°çš„è¿™ä¸¤ç§é”éƒ½æ˜¯é’ˆå¯¹æ¥¼å±‚è€Œè¨€çš„ï¼Œä¸è¿‡æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316230243710.png" alt="image-20230316230243710"></p><p>Aã€æœ‰æŠ•èµ„äººè¦æ¥è€ƒå¯ŸOfficeçš„ç¯å¢ƒã€‚</p><p>æŠ•èµ„äººå’Œå…¬å¸å¹¶ä¸æƒ³å½±å“å®¢æˆ·è¿›å»åŠå…¬ï¼Œä½†æ˜¯æ­¤æ—¶ä¸èƒ½æœ‰æ¥¼å±‚è¿›è¡Œæ£€ä¿®ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤§æ¥¼é—¨å£æ”¾ç½®ä¸€æŠŠSé”ï¼ˆç±»ä¼¼è¡¨çº§åˆ«çš„Sé”ï¼‰ã€‚æ­¤æ—¶ï¼š</p><p>æ¥åŠå…¬çš„å®¢æˆ·ä»¬çœ‹åˆ°å¤§æ¥¼é—¨å£æœ‰Sé”ï¼Œå¯ä»¥ç»§ç»­è¿›å…¥å¤§æ¥¼åŠå…¬ã€‚</p><p>ä¿®ç†å·¥çœ‹åˆ°å¤§æ¥¼é—¨å£æœ‰Sé”ï¼Œåˆ™å…ˆåœ¨å¤§æ¥¼é—¨å£ç­‰ç€ï¼Œå•¥æ—¶å€™æŠ•èµ„äººèµ°äº†ï¼ŒæŠŠå¤§æ¥¼çš„Sé”æ’¤æ‰å†è¿›å…¥å¤§æ¥¼ç»´ä¿®ã€‚</p><p>Bã€å…¬å¸è¦å’Œæˆ¿ä¸œè°ˆæ¡ä»¶ã€‚</p><p>æ­¤æ—¶ä¸å…è®¸å¤§æ¥¼ä¸­æœ‰æ­£åœ¨åŠå…¬çš„æ¥¼å±‚ï¼Œä¹Ÿä¸å…è®¸å¯¹æ¥¼å±‚è¿›è¡Œç»´ä¿®ã€‚æ‰€ä»¥å¯ä»¥åœ¨å¤§æ¥¼é—¨å£æ”¾ç½®ä¸€æŠŠXé”ï¼ˆç±»ä¼¼è¡¨çº§åˆ«çš„Xé”ï¼‰ã€‚æ­¤æ—¶ï¼š</p><p>æ¥åŠå…¬çš„å®¢æˆ·ä»¬çœ‹åˆ°å¤§æ¥¼é—¨å£æœ‰Xé”ï¼Œåˆ™éœ€è¦åœ¨å¤§æ¥¼é—¨å£ç­‰ç€ï¼Œå•¥æ—¶å€™æ¡ä»¶è°ˆå¥½ï¼ŒæŠŠå¤§æ¥¼çš„Xé”æ’¤æ‰å†è¿›å…¥å¤§æ¥¼åŠå…¬ã€‚</p><p>ä¿®ç†å·¥çœ‹åˆ°å¤§æ¥¼é—¨å£æœ‰Xé”ï¼Œåˆ™å…ˆåœ¨å¤§æ¥¼é—¨å£ç­‰ç€ï¼Œå•¥æ—¶å€™è°ˆåˆ¤ç»“æŸï¼ŒæŠŠå¤§æ¥¼çš„Xé”æ’¤æ‰å†è¿›å…¥å¤§æ¥¼ç»´ä¿®ã€‚</p><h2 id="4-æ„å‘é”"><strong>4.æ„å‘é”</strong></h2><p>ä½†æ˜¯åœ¨ä¸Šé¢çš„ä¾‹å­è¿™é‡Œå¤´æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>å¦‚æœæˆ‘ä»¬æƒ³å¯¹å¤§æ¥¼æ•´ä½“ä¸ŠSé”ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿å¤§æ¥¼ä¸­çš„æ²¡æœ‰æ­£åœ¨ç»´ä¿®çš„æ¥¼å±‚ï¼Œå¦‚æœæœ‰æ­£åœ¨ç»´ä¿®çš„æ¥¼å±‚ï¼Œéœ€è¦ç­‰åˆ°ç»´ä¿®ç»“æŸæ‰å¯ä»¥å¯¹å¤§æ¥¼æ•´ä½“ä¸ŠSé”ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³å¯¹å¤§æ¥¼æ•´ä½“ä¸ŠXé”ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿å¤§æ¥¼ä¸­çš„æ²¡æœ‰åŠå…¬çš„æ¥¼å±‚ä»¥åŠæ­£åœ¨ç»´ä¿®çš„æ¥¼å±‚ï¼Œå¦‚æœæœ‰åŠå…¬çš„æ¥¼å±‚æˆ–è€…æ­£åœ¨ç»´ä¿®çš„æ¥¼å±‚ï¼Œéœ€è¦ç­‰åˆ°å…¨éƒ¨åŠå…¬çš„åŒå­¦éƒ½åŠå…¬ç¦»å¼€ï¼Œä»¥åŠç»´ä¿®å·¥ç»´ä¿®å®Œæ¥¼å±‚ç¦»å¼€åæ‰å¯ä»¥å¯¹å¤§æ¥¼æ•´ä½“ä¸ŠXé”ã€‚</p><p>æˆ‘ä»¬åœ¨å¯¹å¤§æ¥¼æ•´ä½“ä¸Šé”ï¼ˆè¡¨é”ï¼‰æ—¶ï¼Œæ€ä¹ˆçŸ¥é“å¤§æ¥¼ä¸­æœ‰æ²¡æœ‰æ¥¼å±‚å·²ç»è¢«ä¸Šé”ï¼ˆè¡Œé”ï¼‰äº†å‘¢ï¼Ÿ</p><p>ä¾æ¬¡æ£€æŸ¥æ¯ä¸€æ¥¼å±‚é—¨å£æœ‰æ²¡æœ‰ä¸Šé”ï¼Ÿé‚£è¿™æ•ˆç‡ä¹Ÿå¤ªæ…¢äº†å§ï¼</p><p>äºæ˜¯InnoDBæå‡ºäº†ä¸€ç§<strong>æ„å‘é”</strong>ï¼ˆè‹±æ–‡åï¼šIntention Locksï¼‰ï¼š</p><p><strong>æ„å‘å…±äº«é”</strong> ï¼Œè‹±æ–‡åï¼šIntention Shared Lockï¼Œ<strong>ç®€ç§°ISé”</strong>ã€‚å½“äº‹åŠ¡å‡†å¤‡åœ¨æŸæ¡è®°å½•ä¸ŠåŠ Sé”æ—¶ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªISé”ã€‚</p><p><strong>æ„å‘ç‹¬å é”</strong> ï¼Œè‹±æ–‡åï¼šIntention Exclusive Lockï¼Œ<strong>ç®€ç§°IXé”</strong>ã€‚å½“äº‹åŠ¡å‡†å¤‡åœ¨æŸæ¡è®°å½•ä¸ŠåŠ Xé”æ—¶ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªIXé”ã€‚</p><p>è§†è§’å›åˆ°å¤§æ¥¼å’Œæ¥¼å±‚ä¸Šæ¥ï¼š</p><p>â€‹    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAQAAAH7CAYAAABbm02EAAAAAXNSR0IArs4c6QAAIABJREFUeF7s3Qn8VmP+//FPRTLSaimjSFFomSZMRMoakzI1k0IjPylKZUuUSisJbdZkRIMwWSoU2UWUJZUKiTBla1OIqf6PzzX/657zPZ37vs99f+/lLK/zePQwvt+zXNfzOv1+rve5ljI7d+7cKRwIIIAAAggggAACCCCAAAIIIBArgTIEArFqbyqLAAIIIIAAAggggAACCCCAgBEgEOBFQAABBBBAAAEEEEAAAQQQQCCGAgQCMWx0qowAAggggAACCCCAAAIIIIAAgQDvAAIIIIAAAggggAACCCCAAAIxFCAQiGGjU2UEEEAAAQQQQAABBBBAAAEECAR4BxBAAAEEEEAAAQQQQAABBBCIoQCBQAwbnSojgAACCCCAAAIIIIAAAgggQCDAO4AAAggggAACCCCAAAIIIIBADAUIBGLY6FQZAQQQQAABBBBAAAEEEEAAAQIB3gEEEEAAAQQQQAABBBBAAAEEYihAIBDDRqfKCCCAAAIIIIAAAggggAACCBAI8A4ggAACCCCAAAIIIIAAAgggEEMBAoEYNjpVRgABBBBAAAEEEEAAAQQQQIBAgHcAAQQQQAABBBBAAAEEEEAAgRgKEAjEsNGpMgIIIIAAAggggAACCCCAAAIEArwDCCCAAAIIIIAAAggggAACCMRQgEAgho1OlRFAAAEEEEAAAQQQQAABBBAgEOAdQAABBBBAAAEEEEAAAQQQQCCGAgQCMWx0qowAAggggAACCCCAAAIIIIAAgQDvAAIIIIAAAggggAACCCCAAAIxFCAQiGGjU2UEEEAAAQQQQAABBBBAAAEECAR4BxBAAAEEEEAAAQQQQAABBBCIoQCBQAwbnSojgAACCCCAAAIIIIAAAgggQCDAO4AAAggggAACCCCAAAIIIIBADAUIBGLY6FQZAQQQQAABBBBAAAEEEEAAAQIB3gEEEEAAAQQQQAABBBBAAAEEYihAIBDDRqfKCCCAAAIIIIAAAggggAACCBAI8A4ggAACCCCAAAIIIIAAAgggEEMBAoEYNjpVRgABBBBAAAEEEEAAAQQQQIBAgHcAAQQQQAABBBBAAAEEEEAAgRgKEAjEsNGpMgIIIIAAAggggAACCCCAAAIEArwDCCCAAAIIIIAAAggggAACCMRQgEAgho1OlRFAAIEoCGzdulWefvpp2bx5s/z+97+XNm3ayO67756Xqu3cuVN+++03KV++fMb3d5azUqVK0r59e9lrr73S3kefN2fOHPn666+lfv360rp1a89rPvjgA1mwYIFkcu+0Dy/FCb/++qvcfvvtouX6wx/+IJdddllWbqUoApcigAACCCCAgE8BAgGfUJyGAAIIIBAsgY0bN0q/fv1k6dKl0rlzZ7nyyiulXLlyWRVy06ZNMmTIEKlXr5507NhRDjjgAHOfHTt2yOLFi2Xq1Kny008/yU033STVq1fP6BnOcjZs2FAmTJggVapUSXuPX375RUaMGGFCgW7dukmfPn3MNVrWiRMnymmnnSbHHHOMzJw5U4YPHy723hpajBs3Tho0aCBnn3121ia2gBpMaKihhwYZ6UIXZ7k1pBk8eLBUqFAhZX0zfUZaPE5AAAEEEEAAAV8CBAK+mDgJAQQQQCBoAs6OtrPDnE05582bJ4MGDZL//Oc/5gv+tddea75qb9++3XS+//nPf5rb9u/fX8455xwpU6aM78c4y/mnP/1JxowZI3vvvXfa670CAQ0oZsyYIbfccov87ne/M+XU82wgcPPNN8v06dPlwQcflIMOOkhuu+02Ofjgg9M+K9kJGoJoeWfPni1t27aVAQMGmOe+++670qNHj6zvay+cPHmyNGvWzIQtI0eOlLlz58pZZ51l6pUuRCj1w7kBAggggAACCAiBAC8BAggggEDgBfQL9YoVK0yH3R5btmyRO+64Q7744gs5/fTTTUfe6zjssMOkatWqSev43XffmY6ujgTQzq4Od2/SpEni/NWrV5uv82vXrpWaNWuaL/x169b1beYMBPx+MdebJxshoCHFvffeK/fff790795dqlWrJqNHjzYjBPTftQOvh44uaNq0qe9yuk/UaRI6JUPvo+HC2LFjE/XOdSCgz161apUZ8aHtoeGMBgOZBC9ZV5QLEUAAAQQQiLEAgUCMG5+qI4AAAmERcHbKMy2z/QrtdZ12ru+66y7TudZDpwtcffXVJea8a8dYpwxoUKCHhg/XX3+9CQ/8HN9++61cfvnlsnLlSrPOQboh9DolQKcmfPXVV+aPrpGg0xRq1KhhRifoegk//vijLFu2TBo1aiQLFy6UadOmmU5779695ZtvvpFt27bJEUccYUYi6PoD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O+ww8/OPP/5YPvnkE/PnjTfekE2bNpmfayjQuXPnSPkQCESqOakMAukFCATSG3EGAggggAAChRYgECi0OM+Lo0Dfvn0TowLatm0r3bp1kzp16qSkWL16tUydOlVmz55tztPRAhMnTowMH4FAZJqSiiDgT4BAwJ8TZyGAAAIIIFBIAQKBQmrzrDgK3H///XL77bfLwQcfLJdccomceuqpGTG88MILcvfdd8vnn38ul112mVx44YUZXR/UkwkEgtoylAuBPAkcffTRsmPHDmHKQJ6AuS0CCCCAAAJZCNhAYOHChVK2LFP6siDkEgSSCsyaNUtuuOEGKVeunEyZMkUaN26cldaHH34o3bt3l+3bt5v7nXXWWVndJ0gXEQgEqTUoCwIFECAQKAAyj0AAAQQQQCBDAQKBDME4HQGfAqtWrZJOnTqZs4cOHSrt2rXzeaX3aTNnzpRhw4aZXz722GNSt27dUt2v2BcTCBS7BXg+AgUWIBAoMDiPQwABBBBAwIcAgYAPJE5BIAuBO++8U+677z4544wzZOTIkVncYddLrr/+ennuuefkoosukl69euXknsW6CYFAseR5LgJFEiAQKBI8j0UAAQQQQCCFAIEArwcC+RFo3769fPXVVzJq1Chp06ZNTh4yZ84cGTRokBx44IHy9NNP5+SexboJgUCx5HkuAkUSIBAoEjyPRQABBBBAgECAdwCBggosWrRIevbsKZUqVZKXX345p89u3bq1bN68We655x456qijcnrvQt6MQKCQ2jwLgQAIEAgEoBEoAgIIIIAAAi4BRgjwSiCQewG7mOBJJ50kY8eOzekD+vfvLy+99FLoFxckEMjpa8HNEAi+AIFA8NuIEiKAAAIIxE+AQCB+bU6N8y8wefJk8wX/ggsukL59++b0gRMnTpQHHnjAjEDo0aNHTu9dyJsRCBRSm2chEAABAoEANAJFQAABBBBAwCVAIMArgUDuBXRrQB0lMHjwYDn77LNz+oCnnnpKRowYYbYe1OeE9SAQCGvLUW4EshQgEMgSjssQQAABBBDIowCBQB5xuXVsBfTL/bvvvpuXef52fYJmzZqJjkQI60EgENaWo9wIZClAIJAlHJchgAACCCCQRwECgTzicuvYCjBCIH3TEwikN+IMBCIlQCAQqeakMggggAACEREgEIhIQ1KNQAmwhkD65iAQSG/EGQhE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" alt="0"></p><p>å¦‚æœæœ‰å®¢æˆ·åˆ°æ¥¼å±‚ä¸­åŠå…¬ï¼Œé‚£ä¹ˆä»–å…ˆåœ¨æ•´æ ‹å¤§æ¥¼é—¨å£æ”¾ä¸€æŠŠISé”ï¼ˆè¡¨çº§é”ï¼‰ï¼Œç„¶åå†åˆ°æ¥¼å±‚é—¨å£æ”¾ä¸€æŠŠSé”ï¼ˆè¡Œé”ï¼‰ã€‚</p><p>å¦‚æœæœ‰ç»´ä¿®å·¥åˆ°æ¥¼å±‚ä¸­ç»´ä¿®ï¼Œé‚£ä¹ˆå®ƒå…ˆåœ¨æ•´æ ‹å¤§æ¥¼é—¨å£æ”¾ä¸€æŠŠIXé”ï¼ˆè¡¨çº§é”ï¼‰ï¼Œç„¶åå†åˆ°æ¥¼å±‚é—¨å£æ”¾ä¸€æŠŠXé”ï¼ˆè¡Œé”ï¼‰ã€‚</p><p>ä¹‹åï¼š</p><p>å¦‚æœæœ‰æŠ•èµ„äººè¦å‚è§‚å¤§æ¥¼ï¼Œä¹Ÿå°±æ˜¯æƒ³åœ¨å¤§æ¥¼é—¨å£å‰æ”¾Sé”ï¼ˆè¡¨é”ï¼‰æ—¶ï¼Œé¦–å…ˆè¦çœ‹ä¸€ä¸‹å¤§æ¥¼é—¨å£æœ‰æ²¡æœ‰IXé”ï¼Œå¦‚æœæœ‰ï¼Œæ„å‘³ç€æœ‰æ¥¼å±‚åœ¨ç»´ä¿®ï¼Œéœ€è¦ç­‰åˆ°ç»´ä¿®ç»“æŸæŠŠIXé”æ’¤æ‰åæ‰å¯ä»¥åœ¨æ•´æ ‹å¤§æ¥¼ä¸ŠåŠ Sé”ã€‚</p><p>å¦‚æœæœ‰è°ˆæ¡ä»¶è¦å ç”¨å¤§æ¥¼ï¼Œä¹Ÿå°±æ˜¯æƒ³åœ¨å¤§æ¥¼é—¨å£å‰æ”¾Xé”ï¼ˆè¡¨é”ï¼‰æ—¶ï¼Œé¦–å…ˆè¦çœ‹ä¸€ä¸‹å¤§æ¥¼é—¨å£æœ‰æ²¡æœ‰ISé”æˆ–IXé”ï¼Œå¦‚æœæœ‰ï¼Œæ„å‘³ç€æœ‰æ¥¼å±‚åœ¨åŠå…¬æˆ–è€…ç»´ä¿®ï¼Œéœ€è¦ç­‰åˆ°å®¢æˆ·ä»¬åŠå®Œå…¬ä»¥åŠç»´ä¿®ç»“æŸæŠŠISé”å’ŒIXé”æ’¤æ‰åæ‰å¯ä»¥åœ¨æ•´æ ‹å¤§æ¥¼ä¸ŠåŠ Xé”ã€‚</p><p>æ³¨æ„ï¼š å®¢æˆ·åœ¨å¤§æ¥¼é—¨å£åŠ ISé”æ—¶ï¼Œæ˜¯ä¸å…³å¿ƒå¤§æ¥¼é—¨å£æ˜¯å¦æœ‰IXé”çš„ï¼Œç»´ä¿®å·¥åœ¨å¤§æ¥¼é—¨å£åŠ IXé”æ—¶ï¼Œæ˜¯ä¸å…³å¿ƒå¤§æ¥¼é—¨å£æ˜¯å¦æœ‰ISé”æˆ–è€…å…¶ä»–IXé”çš„ã€‚ISå’ŒIXé”åªæ˜¯ä¸ºäº†åˆ¤æ–­å½“å‰æ—¶é—´å¤§æ¥¼é‡Œæœ‰æ²¡æœ‰è¢«å ç”¨çš„æ¥¼å±‚ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¹å¤§æ¥¼åŠ Sé”æˆ–è€…Xé”æ—¶æ‰ä¼šç”¨åˆ°ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼š<strong>ISã€IXé”æ˜¯è¡¨çº§é”ï¼Œå®ƒä»¬çš„æå‡ºä»…ä»…ä¸ºäº†åœ¨ä¹‹ååŠ è¡¨çº§åˆ«çš„Sé”å’ŒXé”æ—¶å¯ä»¥å¿«é€Ÿåˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ˜¯å¦è¢«ä¸Šé”ï¼Œä»¥é¿å…ç”¨éå†çš„æ–¹å¼æ¥æŸ¥çœ‹è¡¨ä¸­æœ‰æ²¡æœ‰ä¸Šé”çš„è®°å½•</strong>ã€‚å°±æ˜¯è¯´å…¶å®ISé”å’ŒIXé”æ˜¯å…¼å®¹çš„ï¼ŒIXé”å’ŒIXé”æ˜¯å…¼å®¹çš„ã€‚æˆ‘ä»¬ç”»ä¸ªè¡¨æ¥çœ‹ä¸€ä¸‹<strong>è¡¨çº§åˆ«</strong>çš„å„ç§é”çš„å…¼å®¹æ€§ï¼š</p><table><thead><tr><th>å…¼å®¹æ€§</th><th>X</th><th>IX</th><th>S</th><th>IS</th></tr></thead><tbody><tr><td>X</td><td>ä¸å…¼å®¹</td><td>ä¸å…¼å®¹</td><td>ä¸å…¼å®¹</td><td>ä¸å…¼å®¹</td></tr><tr><td>IX</td><td>ä¸å…¼å®¹</td><td></td><td>ä¸å…¼å®¹</td><td></td></tr><tr><td>S</td><td>ä¸å…¼å®¹</td><td>ä¸å…¼å®¹</td><td></td><td></td></tr><tr><td>IS</td><td>ä¸å…¼å®¹</td><td></td><td></td><td></td></tr></tbody></table><table><thead><tr><th>ç»„åˆæ€§</th><th>X</th><th>IX</th><th>S</th><th>IS</th></tr></thead><tbody><tr><td>è¡¨é”</td><td>æœ‰</td><td>æœ‰</td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>è¡Œé”</td><td>æœ‰</td><td></td><td>æœ‰</td><td></td></tr></tbody></table><h1><strong>InnoDBå­˜å‚¨å¼•æ“ä¸­çš„é”</strong></h1><h2 id="1-è¡¨çº§é”"><strong>1.è¡¨çº§é”</strong></h2><p><strong>1.è¡¨çº§åˆ«çš„Sé”ã€Xé”ã€å…ƒæ•°æ®é”</strong></p><p>åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„Sé”æˆ–è€…Xé”çš„ã€‚</p><p>å¦å¤–ï¼Œåœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡Œä¸€äº›è¯¸å¦‚<code>ALTER TABLEã€DROP TABLE</code>è¿™ç±»çš„<strong>DDL</strong>è¯­å¥æ—¶ï¼Œå…¶ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨å¹¶å‘æ‰§è¡Œè¯¸å¦‚SELECTã€INSERTã€DELETEã€UPDATEçš„è¯­å¥ä¼šå‘ç”Ÿé˜»å¡ï¼ŒåŒç†ï¼Œ<strong>æŸä¸ªäº‹åŠ¡ä¸­å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼Œåœ¨å…¶ä»–ä¼šè¯ä¸­å¯¹è¿™ä¸ªè¡¨æ‰§è¡ŒDDLè¯­å¥ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡åœ¨serverå±‚ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸ºå…ƒæ•°æ®é”</strong>ï¼ˆè‹±æ–‡åï¼šMetadata Locksï¼Œç®€ç§°MDLï¼‰æ¥å®ç°çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“è‡ªå·±æä¾›çš„è¡¨çº§åˆ«çš„Sé”å’ŒXé”ã€‚</p><p>å…¶å®è¿™ä¸ªInnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨çº§Sé”æˆ–è€…Xé”æ˜¯ç›¸å½“é¸¡è‚‹ï¼Œåªä¼šåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”æ–¹è¯´å´©æºƒæ¢å¤è¿‡ç¨‹ä¸­ç”¨åˆ°ã€‚ä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æ‰‹åŠ¨è·å–ä¸€ä¸‹çš„ï¼Œæ¯”æ–¹è¯´åœ¨ç³»ç»Ÿå˜é‡autocommit=0ï¼Œinnodb_table_locks = 1æ—¶ï¼Œæ‰‹åŠ¨è·å–InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨tçš„Sé”æˆ–è€…Xé”å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><p>LOCK TABLES t READï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„Sé”ã€‚</p><p>LOCK TABLES t WRITEï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„Xé”ã€‚</p><p><strong>è¯·å°½é‡é¿å…åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨ä¸Šä½¿ç”¨LOCK TABLESè¿™æ ·çš„æ‰‹åŠ¨é”è¡¨è¯­å¥ï¼Œå®ƒä»¬å¹¶ä¸ä¼šæä¾›ä»€ä¹ˆé¢å¤– çš„ä¿æŠ¤ï¼Œåªæ˜¯ä¼šé™ä½å¹¶å‘èƒ½åŠ›è€Œå·²ã€‚</strong></p><p><strong>2.è¡¨çº§åˆ«çš„ISé”ã€IXé”</strong></p><p>å½“æˆ‘ä»¬åœ¨å¯¹ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨çš„æŸäº›è®°å½•åŠ Sé”ä¹‹å‰ï¼Œé‚£å°±éœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªISé”ï¼Œå½“æˆ‘ä»¬åœ¨å¯¹ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨çš„æŸäº›è®°å½•åŠ Xé”ä¹‹å‰ï¼Œé‚£å°±éœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸€ä¸ªIXé”ã€‚</p><p>ISé”å’ŒIXé”çš„ä½¿å‘½åªæ˜¯ä¸ºäº†åç»­åœ¨åŠ è¡¨çº§åˆ«çš„Sé”å’ŒXé”æ—¶åˆ¤æ–­è¡¨ä¸­æ˜¯å¦æœ‰å·²ç»è¢«åŠ é”çš„è®°å½•ï¼Œä»¥é¿å…ç”¨éå†çš„æ–¹å¼æ¥æŸ¥çœ‹è¡¨ä¸­æœ‰æ²¡æœ‰ä¸Šé”çš„è®°å½•ã€‚æˆ‘ä»¬å¹¶ä¸èƒ½æ‰‹åŠ¨æ·»åŠ æ„å‘é”ï¼Œåªèƒ½ç”±InnoDBå­˜å‚¨å¼•æ“è‡ªè¡Œæ·»åŠ ã€‚</p><p><strong>1.3.è¡¨çº§åˆ«çš„AUTO-INCé”</strong></p><p>AUTO-INC é”æ˜¯ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼Œé”<strong>ä¸æ˜¯å†ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰é‡Šæ”¾ï¼Œè€Œæ˜¯å†æ‰§è¡Œå®Œæ’å…¥è¯­å¥åå°±ä¼šç«‹å³é‡Šæ”¾</strong>ã€‚</p><p><strong>åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„ AUTO-INC é”</strong>ï¼Œç„¶åä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µèµ‹å€¼é€’å¢çš„å€¼ï¼Œç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šæŠŠ AUTO-INC é”é‡Šæ”¾æ‰ã€‚</p><p>å› æ­¤ï¼Œ åœ¨ MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸€ç§<strong>è½»é‡çº§çš„é”</strong>æ¥å®ç°è‡ªå¢ã€‚</p><p>ä¸€æ ·ä¹Ÿæ˜¯åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µåŠ ä¸Šè½»é‡çº§é”ï¼Œ<strong>ç„¶åç»™è¯¥å­—æ®µèµ‹å€¼ä¸€ä¸ªè‡ªå¢çš„å€¼ï¼Œå°±æŠŠè¿™ä¸ªè½»é‡çº§é”é‡Šæ”¾äº†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥æ‰§è¡Œå®Œåæ‰é‡Šæ”¾é”</strong>ã€‚</p><h2 id="2-InnoDBä¸­çš„è¡Œçº§é”">2.InnoDBä¸­çš„è¡Œçº§é”</h2><p>â€“ <strong>åªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼ŒInnoDB æ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDB å°†ä½¿ç”¨è¡¨é”ã€‚</strong></p><ul><li>Record Lockï¼Œè®°å½•é”ï¼Œä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ä¸Šï¼›</li><li>Gap Lockï¼Œé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯ä¸åŒ…å«è®°å½•æœ¬èº«ï¼›</li><li>Next-Key Lockï¼šRecord Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</li></ul><p>ä¸è®ºæ˜¯ä½¿ç”¨ä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•æˆ–æ™®é€šç´¢å¼•ï¼ŒInnoDBéƒ½ä¼šä½¿ç”¨è¡Œé”æ¥å¯¹æ•°æ®åŠ é”ã€‚</p><p>åªæœ‰æ‰§è¡Œè®¡åˆ’çœŸæ­£ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ‰èƒ½ä½¿ç”¨è¡Œé”ï¼š<strong>å³ä¾¿åœ¨æ¡ä»¶ä¸­ä½¿ç”¨äº†ç´¢å¼•å­—æ®µï¼Œä½†æ˜¯å¦ä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢æ•°æ®æ˜¯ç”± MySQL é€šè¿‡åˆ¤æ–­ä¸åŒæ‰§è¡Œè®¡åˆ’çš„ä»£ä»·æ¥å†³å®šçš„ï¼Œå¦‚æœ MySQLè®¤ä¸ºå…¨è¡¨æ‰«ææ•ˆç‡æ›´é«˜ï¼Œæ¯”å¦‚å¯¹ä¸€äº›å¾ˆå°çš„è¡¨ï¼Œå®ƒå°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µä¸‹ InnoDB</strong> <strong>å°†ä½¿ç”¨è¡¨é”ï¼Œè€Œä¸æ˜¯è¡Œé”ã€‚</strong></p><p>åŒæ—¶å½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ã€‚</p><p>ä¸è¿‡å³ä½¿æ˜¯è¡Œé”ï¼ŒInnoDBé‡Œä¹Ÿæ˜¯åˆ†æˆäº†å„ç§ç±»å‹çš„ã€‚æ¢å¥è¯è¯´å³ä½¿å¯¹åŒä¸€æ¡è®°å½•åŠ è¡Œé”ï¼Œå¦‚æœç±»å‹ä¸åŒï¼Œèµ·åˆ°çš„åŠŸæ•ˆä¹Ÿæ˜¯ä¸åŒçš„ã€‚æˆ‘ä»¬ä½¿ç”¨å‰é¢çš„teacherï¼Œå¢åŠ ä¸€ä¸ªç´¢å¼•ï¼Œå¹¶æ’å…¥å‡ æ¡è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INDEX  `idx_number`(`number`)</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316231101579.png" alt="image-20230316231101579"></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹éƒ½æœ‰å“ªäº›å¸¸ç”¨çš„è¡Œé”ç±»å‹ã€‚</p><p><strong>Record Locks</strong>ä¹Ÿå«è®°å½•é”ï¼Œå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ä¸Šï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼šLOCK_REC_NOT_GAPã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æŠŠnumberå€¼ä¸º6çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªè®°å½•é”çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316231114641.png" alt="image-20230316231114641"></p><p>è®°å½•é”æ˜¯æœ‰Sé”å’ŒXé”ä¹‹åˆ†çš„ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Så‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä½†ä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ï¼›å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Xå‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä¹Ÿä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ï¼›</p><h3 id="Gap-Locks-é—´éš™é”"><strong>Gap Locks é—´éš™é”</strong></h3><p>æˆ‘ä»¬è¯´MySQLåœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨MVCCæ–¹æ¡ˆè§£å†³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨åŠ é”æ–¹æ¡ˆè§£å†³ã€‚**ä½†æ˜¯åœ¨ä½¿ç”¨åŠ é”æ–¹æ¡ˆè§£å†³æ—¶æœ‰é—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œé‚£äº›å¹»å½±è®°å½•å°šä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ— æ³•ç»™è¿™äº›å¹»å½±è®°å½•åŠ ä¸Šè®°å½•é”ã€‚**InnoDBæå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸ºGap Locksçš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼šLOCK_GAPï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€ç§°ä¸ºgapé”ã€‚</p><p><strong>é—´éš™é”å®è´¨ä¸Šæ˜¯å¯¹ç´¢å¼•å‰åçš„é—´éš™ä¸Šé”ï¼Œä¸å¯¹ç´¢å¼•æœ¬èº«ä¸Šé”ã€‚</strong></p><p>ä¼šè¯1å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>; </span><br><span class="line"><span class="keyword">update</span> teacher <span class="keyword">set</span> domain <span class="operator">=</span><span class="string">&#x27;JVM&#x27;</span> <span class="keyword">where</span> number<span class="operator">=</span><span class="string">&#x27;6&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316231159581.png" alt="image-20230316231159581"></p><p>å¦‚å›¾ä¸­ä¸º2~6å’Œ  6  ~ 10çš„è®°å½•åŠ äº†gapé”ï¼Œæ„å‘³ç€ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨è¿™æ¡è®°å½•å‰åé—´éš™æ’å…¥æ–°è®°å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">value</span>(<span class="number">7</span>,<span class="string">&#x27;æ›¾&#x27;</span>,<span class="string">&#x27;docker&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¸èƒ½æ’å…¥ï¼Ÿå› ä¸ºè®°å½•ï¼ˆ7,â€˜æ›¾â€™,â€˜dockerâ€™ï¼‰è¦ æ’å…¥çš„è¯ï¼Œåœ¨ç´¢å¼•idx_numberä¸Šï¼Œåˆšå¥½è½åœ¨6  ~ 10ä¹‹é—´ï¼Œæ˜¯æœ‰é”çš„ï¼Œå½“ç„¶ä¸å…è®¸æ’å…¥ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;MySQLä¸­çš„é”&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;InnoDBä¸­é”éå¸¸å¤šï¼Œæ€»çš„æ¥è¯´ï¼Œå¯ä»¥å¦‚ä¸‹åˆ†ç±»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://zdwtop.cn/blog/image-20230316215836060.png&quot; alt&gt;&lt;/p&gt;</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="é”" scheme="https://eizo01.github.io/tags/%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>MVCCå¤šå¹¶å‘ç‰ˆæœ¬æ§åˆ¶</title>
    <link href="https://eizo01.github.io/posts/484a2385.html"/>
    <id>https://eizo01.github.io/posts/484a2385.html</id>
    <published>2022-10-16T12:00:00.000Z</published>
    <updated>2023-03-16T15:21:20.389Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>MVCCå¤šå¹¶å‘ç‰ˆæœ¬æ§åˆ¶</strong></h1><p>å‰æçŸ¥è¯†ï¼šrowidï¼šæ²¡æœ‰ä¸»é”®çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚trx_idæ˜¯äº‹åŠ¡IDï¼›</p><p>å…¨ç§°Multi-Version Concurrency Controlï¼Œå³<strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong>ï¼Œ<strong>ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½</strong>ã€‚</p><p>åŒä¸€è¡Œæ•°æ®å¹³æ—¶å‘ç”Ÿè¯»å†™è¯·æ±‚æ—¶ï¼Œä¼šä¸Šé”é˜»å¡ä½ã€‚ä½†MVCCç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†è¯»â€”å†™è¯·æ±‚ï¼Œåšåˆ°åœ¨å‘ç”Ÿè¯»â€”å†™è¯·æ±‚å†²çªæ—¶ä¸ç”¨åŠ é”ã€‚</p><p>**è¿™ä¸ªè¯»æ˜¯æŒ‡çš„å¿«ç…§è¯»ï¼Œè€Œä¸æ˜¯å½“å‰è¯»ï¼Œå½“å‰è¯»æ˜¯ä¸€ç§åŠ é”æ“ä½œï¼Œæ˜¯æ‚²è§‚é”ã€‚**é‚£å®ƒåˆ°åº•æ˜¯æ€ä¹ˆåšåˆ°è¯»â€”å†™ä¸ç”¨åŠ é”çš„ï¼Œå¿«ç…§è¯»å’Œå½“å‰è¯»æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä¼šåœ¨é”æ–‡ç« é‡Œå­¦ä¹ åˆ°ã€‚</p><h2 id="1-MVCCåŸç†"><strong>1.MVCCåŸç†</strong></h2><h3 id="1-1-å¤ä¹ äº‹åŠ¡éš”ç¦»çº§åˆ«â€“â¤ï¸"><strong>1.1.å¤ä¹ äº‹åŠ¡éš”ç¦»çº§åˆ«â€“â¤ï¸</strong></h3><p><img src="https://zdwtop.cn/blog/image-20230316174006249.png" alt="image-20230316174006249"></p><p>MySQLåœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯å¯ä»¥å¾ˆå¤§ç¨‹åº¦é¿å…å¹»è¯»é—®é¢˜çš„å‘ç”Ÿçš„ï¼ˆ<strong>å¥½åƒè§£å†³äº†ï¼Œä½†æ˜¯åˆæ²¡å®Œå…¨è§£å†³</strong>ï¼‰ï¼ŒMySQLæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p><p>é‚£ä¹ˆå°±è¦æ‹¿å‡ºMVCCä¸­çš„<strong>ReadView</strong>å’Œ<strong>ReadView</strong>äº†ï¼Œå¯ä»¥è¯´å®ƒè§£å†³äº†äº‹åŠ¡å¤§éƒ¨åˆ†çš„é—®é¢˜ï¼Œè€Œä¸”ä¸ç”¨åŠ é”å‡å°‘æ€§èƒ½ã€‚é‡ç‚¹è§£å†³çš„æ˜¯RC RR</p><h3 id="1-2-ç‰ˆæœ¬é“¾"><strong>1.2.ç‰ˆæœ¬é“¾</strong></h3><p><strong>å¿…é¡»è¦çŸ¥é“çš„æ¦‚å¿µï¼ˆæ¯ä¸ªç‰ˆæœ¬é“¾é’ˆå¯¹çš„ä¸€æ¡æ•°æ®ï¼‰ï¼š</strong></p><p><font color="\#87CEFA"><strong>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­éƒ½åŒ…å«ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ï¼š</strong></font></p><p><font color="\#87CEFA"><strong>trx_idï¼šæ¯æ¬¡ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠè¯¥äº‹åŠ¡çš„äº‹åŠ¡idèµ‹å€¼ç»™trx_idéšè—åˆ—ã€‚</strong></font></p><p><font color="\#87CEFA"><strong>roll_pointerï¼šæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§çš„ç‰ˆæœ¬å†™å…¥åˆ°undoæ—¥å¿—ä¸­ï¼Œç„¶åè¿™ä¸ªéšè—åˆ—å°±ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è¯¥è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</strong></font></p><p>ï¼ˆrow_idå¹¶ä¸æ˜¯å¿…è¦çš„ï¼Œæˆ‘ä»¬åˆ›å»ºçš„è¡¨ä¸­æœ‰ä¸»é”®æˆ–è€…éNULLçš„UNIQUEé”®æ—¶éƒ½ä¸ä¼šåŒ…å«row_idåˆ—ï¼‰</p><blockquote><p>è¡¥å……ç‚¹ï¼šundoæ—¥å¿—ï¼šä¸ºäº†å®ç°äº‹åŠ¡çš„åŸå­æ€§ï¼ŒInnoDBå­˜å‚¨å¼•æ“åœ¨å®é™…è¿›è¡Œå¢ã€åˆ ã€æ”¹ä¸€æ¡è®°å½•æ—¶ï¼Œéƒ½éœ€è¦å…ˆæŠŠå¯¹åº”çš„undoæ—¥å¿—è®°ä¸‹æ¥ã€‚<strong>ä¸€èˆ¬æ¯å¯¹ä¸€æ¡è®°å½•åšä¸€æ¬¡æ”¹åŠ¨ï¼Œå°±å¯¹åº”ç€ä¸€æ¡undoæ—¥å¿—</strong>ï¼Œä½†åœ¨æŸäº›æ›´æ–°è®°å½•çš„æ“ä½œä¸­ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¹åº”ç€2æ¡undoæ—¥å¿—ã€‚ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½æ–°å¢ã€åˆ é™¤ã€æ›´æ–°è‹¥å¹²æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦è®°å½•å¾ˆå¤šæ¡å¯¹åº”çš„undoæ—¥å¿—ï¼Œè¿™äº›undoæ—¥å¿—ä¼šè¢«ä»0å¼€å§‹ç¼–å·ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æ®ç”Ÿæˆçš„é¡ºåºåˆ†åˆ«è¢«ç§°ä¸ºç¬¬0å·undoæ—¥å¿—ã€ç¬¬1å·undoæ—¥å¿—ã€â€¦ã€ç¬¬nå·undoæ—¥å¿—ç­‰ï¼Œè¿™ä¸ªç¼–å·ä¹Ÿè¢«ç§°ä¹‹ä¸ºundo noã€‚</p></blockquote><p>ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¼”ç¤ºè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> teacher (</span><br><span class="line">number <span class="type">INT</span>,</span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">domain <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (number)</span><br><span class="line">) Engine<span class="operator">=</span>InnoDB CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¡¨é‡Œçš„æ•°æ®å°±æ˜¯è¿™æ ·çš„ï¼š(1,æç‘¾,jvmç³»åˆ—)</p><p><img src="https://zdwtop.cn/blog/image-20230316175208518.png" alt="image-20230316175208518"></p><p>å‡è®¾ä¹‹åä¸¤ä¸ªäº‹åŠ¡idåˆ†åˆ«ä¸º80ã€120çš„äº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡ŒUPDATEæ“ä½œï¼Œæ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316175306968.png" alt="image-20230316175306968"></p><p><strong>æ¯æ¬¡å¯¹è®°å½•è¿›è¡Œæ”¹åŠ¨ï¼Œéƒ½ä¼šè®°å½•ä¸€æ¡undoæ—¥å¿—ï¼Œæ¯æ¡undoæ—¥å¿—ä¹Ÿéƒ½æœ‰ä¸€ä¸ªroll_pointerå±æ€§</strong>ï¼ˆINSERTæ“ä½œå¯¹åº”çš„undoæ—¥å¿—æ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºè¯¥è®°å½•å¹¶æ²¡æœ‰æ›´æ—©çš„ç‰ˆæœ¬ï¼‰ï¼Œå¯ä»¥å°†è¿™äº›undoæ—¥å¿—éƒ½è¿èµ·æ¥ï¼Œä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€ä»¥ç°åœ¨çš„æƒ…å†µå°±åƒä¸‹å›¾ä¸€æ ·ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316175348409.png" alt="image-20230316175348409"></p><p>å¯¹è¯¥è®°å½•æ¯æ¬¡æ›´æ–°åï¼Œéƒ½ä¼šå°†æ—§å€¼æ”¾åˆ°ä¸€æ¡undoæ—¥å¿—ä¸­ï¼Œå°±ç®—æ˜¯è¯¥è®°å½•çš„ä¸€ä¸ªæ—§ç‰ˆæœ¬ï¼Œéšç€æ›´æ–°æ¬¡æ•°çš„å¢å¤šï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šè¢«roll_pointerå±æ€§è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé“¾è¡¨ç§°ä¹‹ä¸ºç‰ˆæœ¬é“¾ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°çš„å€¼ã€‚å¦å¤–ï¼Œæ¯ä¸ªç‰ˆæœ¬ä¸­è¿˜åŒ…å«ç”Ÿæˆè¯¥ç‰ˆæœ¬æ—¶å¯¹åº”çš„äº‹åŠ¡idã€‚<strong>äºæ˜¯å¯ä»¥åˆ©ç”¨è¿™ä¸ªè®°å½•çš„ç‰ˆæœ¬é“¾æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•çš„è¡Œä¸ºï¼Œé‚£ä¹ˆè¿™ç§æœºåˆ¶å°±è¢«ç§°ä¹‹ä¸ºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(Mulit-Version Concurrency Control MVCC)ã€‚</strong></p><h3 id="1-3-ReadView"><strong>1.3.ReadView</strong></h3><p>è¿™ä¸ªReadViewä¸­ä¸»è¦åŒ…å«4ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼š</p><p><strong>m_idsï¼š<strong>è¡¨ç¤ºåœ¨ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿä¸­</strong>æ´»è·ƒçš„è¯»å†™äº‹åŠ¡çš„äº‹åŠ¡idåˆ—è¡¨</strong>ã€‚</p><p><strong>min_trx_idï¼š<strong>è¡¨ç¤ºåœ¨ç”ŸæˆReadViewæ—¶å½“å‰ç³»ç»Ÿä¸­</strong>æ´»è·ƒçš„è¯»å†™äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>m_idsä¸­çš„æœ€å°å€¼ã€‚</strong></p><p><strong>max_trx_idï¼š<strong>è¡¨ç¤ºç”ŸæˆReadViewæ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†</strong>é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„idå€¼</strong>ã€‚</p><blockquote><p>æ³¨æ„max_trx_idå¹¶ä¸æ˜¯m_idsä¸­çš„æœ€å¤§å€¼ï¼Œäº‹åŠ¡idæ˜¯é€’å¢åˆ†é…çš„ã€‚</p><p>æ¯”æ–¹è¯´ç°åœ¨æœ‰idä¸º1ï¼Œ2ï¼Œ3è¿™ä¸‰ä¸ªäº‹åŠ¡ï¼Œä¹‹åidä¸º3çš„äº‹åŠ¡æäº¤äº†ã€‚é‚£ä¹ˆä¸€ä¸ªæ–°çš„è¯»äº‹åŠ¡åœ¨ç”ŸæˆReadViewæ—¶ï¼Œm_idså°±åŒ…æ‹¬1å’Œ2ï¼Œmin_trx_idçš„å€¼å°±æ˜¯1ï¼Œmax_trx_idçš„å€¼å°±æ˜¯4ã€‚</p></blockquote><p>**creator_trx_idï¼š**è¡¨ç¤ºç”Ÿæˆè¯¥ReadViewçš„äº‹åŠ¡çš„äº‹åŠ¡id</p><p><strong>å¿…é¡»è¦çŸ¥é“çš„æ¦‚å¿µï¼ˆä½œç”¨äºSQLæŸ¥è¯¢è¯­å¥ï¼‰</strong></p><p>å¯¹äºä½¿ç”¨<code>READ UNCOMMITTED</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œ<strong>ç”±äºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å°±å¥½äº†</strong>ï¼ˆ<strong>æ‰€ä»¥å°±ä¼šå‡ºç°è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong>ï¼‰ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230316180356855.png" alt="image-20230316180356855"></p><p>å¯¹äºä½¿ç”¨<code>SERIALIZABLE</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œ<strong>InnoDBä½¿ç”¨åŠ é”çš„æ–¹å¼æ¥è®¿é—®è®°å½•</strong>ï¼ˆ<strong>ä¹Ÿå°±æ˜¯æ‰€æœ‰çš„äº‹åŠ¡éƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå½“ç„¶ä¸ä¼šå‡ºç°è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</strong>ï¼‰ã€‚</p><p>å¯¹äºä½¿ç”¨<code>READ COMMITTED</code>å’Œ<code>REPEATABLE READ</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œéƒ½å¿…é¡»ä¿è¯è¯»åˆ°å·²ç»æäº¤äº†çš„äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´å‡å¦‚å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»ä¿®æ”¹äº†è®°å½•ä½†æ˜¯å°šæœªæäº¤ï¼Œæ˜¯ä¸èƒ½ç›´æ¥è¯»å–æœ€æ–°ç‰ˆæœ¬çš„è®°å½•çš„ã€‚</p><p>æ ¸å¿ƒé—®é¢˜å°±æ˜¯ï¼šREAD COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«åœ¨ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ä¸Šçš„åŒºåˆ«æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œå…¶å®ç»“åˆå‰é¢çš„çŸ¥è¯†(<font color="\#87CEFA"> <strong>å¹»è¯»æ˜¯å…³æ³¨æ•°æ®çš„æ–°åŠ ï¼Œä¸å¯é‡å¤è¯»æ˜¯å…³æ³¨æ•°æ®çš„ä¿®æ”¹ã€‚</strong> </font>)ï¼Œè¿™ä¸¤ç§éš”ç¦»çº§åˆ«å…³é”®<strong>æ˜¯éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„</strong>ã€‚<strong>ä¸ºæ­¤ï¼ŒInnoDBæå‡ºäº†ä¸€ä¸ªReadViewçš„æ¦‚å¿µï¼ˆä½œç”¨äºSQLæŸ¥è¯¢è¯­å¥ï¼‰</strong></p><h3 id="1-4-READ-COMMITTED-å·²æäº¤è¯»"><strong>1.4.READ COMMITTED</strong> å·²æäº¤è¯»</h3><h4 id="è„è¯»é—®é¢˜çš„è§£å†³"><strong>è„è¯»é—®é¢˜çš„è§£å†³</strong></h4><p><font color="\#87CEFA">-<strong>ç‰ˆæœ¬é“¾ + ReadView è§£å†³äº†è„è¯»</strong></font></p><p>READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ReadViewã€‚</p><p>åœ¨MySQLä¸­ï¼Œ<strong>READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«çš„çš„ä¸€ä¸ªéå¸¸å¤§çš„åŒºåˆ«å°±æ˜¯å®ƒä»¬ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒã€‚</strong></p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥è¡¨teacher ä¸ºä¾‹ï¼Œå‡è®¾ç°åœ¨è¡¨teacher ä¸­åªæœ‰ä¸€æ¡ç”±äº‹åŠ¡idä¸º60çš„äº‹åŠ¡æ’å…¥çš„ä¸€æ¡è®°å½•ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹READ COMMITTEDå’ŒREPEATABLE READæ‰€è°“çš„ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒåˆ°åº•ä¸åŒåœ¨å“ªé‡Œã€‚</p><p>READ COMMITTED â€”â€” <strong>æ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ªReadView</strong>ï¼š</p><p>æ¯”æ–¹è¯´ç°åœ¨ç³»ç»Ÿé‡Œæœ‰ä¸¤ä¸ªäº‹åŠ¡idåˆ†åˆ«ä¸º80ã€120çš„äº‹åŠ¡åœ¨æ‰§è¡Œï¼š<code>Transaction 80</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;é©¬&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;è¿&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œè¡¨teacher ä¸­numberä¸º1çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316192715661.png" alt="image-20230316192715661"></p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316192725857.png" alt="image-20230316192725857#"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line">SELECE <span class="number">1</span>ï¼šTransaction <span class="number">80</span>ã€<span class="number">120</span>æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;æç‘¾&#x27;</span></span><br></pre></td></tr></table></figure><p>ç¬¬1æ¬¡selectçš„æ—¶é—´ç‚¹ å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316192815200.png" alt="image-20230316192815200"></p><p>è¿™ä¸ªSELECE1çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼šåœ¨æ‰§è¡ŒSELECTè¯­å¥æ—¶ä¼šå…ˆç”Ÿæˆä¸€ä¸ªReadViewï¼š</p><p><strong>ReadViewçš„m_idsåˆ—è¡¨çš„å†…å®¹å°±æ˜¯[80, 120]ï¼Œmin_trx_idä¸º80ï¼Œmax_trx_idä¸º121ï¼Œcreator_trx_idä¸º0ã€‚</strong></p><p>ç„¶åä»ç‰ˆæœ¬é“¾ä¸­æŒ‘é€‰å¯è§çš„è®°å½•ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ€æ–°ç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>è¿</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º80ï¼Œåœ¨m_idsåˆ—è¡¨å†…ï¼Œæ‰€ä»¥ä¸ç¬¦åˆå¯è§æ€§è¦æ±‚ï¼ˆtrx_idå±æ€§å€¼åœ¨ReadViewçš„min_trx_idå’Œmax_trx_idä¹‹é—´è¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ï¼‰ï¼Œæ ¹æ®roll_pointerè·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>é©¬</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¹Ÿä¸º80ï¼Œä¹Ÿåœ¨m_idsåˆ—è¡¨å†…ï¼Œæ‰€ä»¥ä¹Ÿä¸ç¬¦åˆè¦æ±‚ï¼Œç»§ç»­è·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>æç‘¾</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º60ï¼Œå°äºReadViewä¸­çš„min_trx_idå€¼ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬æ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œæœ€åè¿”å›ç»™ç”¨æˆ·çš„ç‰ˆæœ¬å°±æ˜¯è¿™æ¡åˆ—nameä¸ºâ€™<strong>æç‘¾</strong>â€™çš„è®°å½•ã€‚</p><p><strong>æ‰€ä»¥æœ‰äº†è¿™ç§æœºåˆ¶ï¼Œå°±ä¸ä¼šå‘ç”Ÿè„è¯»é—®é¢˜ï¼å› ä¸ºä¼šå»åˆ¤æ–­æ´»è·ƒç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯ä¸åœ¨æ´»è·ƒç‰ˆæœ¬çš„æ‰èƒ½ç”¨ï¼Œä¸å¯èƒ½è¯»åˆ°æ²¡æœ‰ commitçš„è®°å½•ã€‚</strong></p><p><img src="https://zdwtop.cn/blog/image-20230316193754497.png" alt="image-20230316193754497"></p><h4 id="ä¸å¯é‡å¤è¯»é—®é¢˜æ²¡æœ‰è§£å†³"><strong>ä¸å¯é‡å¤è¯»é—®é¢˜æ²¡æœ‰è§£å†³</strong></h4><p>ç„¶åï¼Œæˆ‘ä»¬æŠŠäº‹åŠ¡idä¸º80çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼Œç„¶åå†åˆ°äº‹åŠ¡idä¸º120çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨teacher ä¸­numberä¸º1çš„è®°å½•ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316193954862.png" alt="image-20230316193954862"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transaction <span class="number">120</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;ä¸¥&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;æ™&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨teacher ä¸­numberä¸º1çš„è®°å½•çš„ç‰ˆæœ¬é“¾å°±é•¿è¿™æ ·ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316211601448.png" alt="image-20230316211601448"></p><p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ªnumberä¸º1çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š</p><p>ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">SELECE1ï¼šTransaction <span class="number">80</span>ã€<span class="number">120</span>å‡æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;æç‘¾&#x27;</span></span><br><span class="line"></span><br><span class="line">SELECE2ï¼šTransaction <span class="number">80</span>æäº¤ï¼ŒTransaction <span class="number">120</span>æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;è¿&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>**ç¬¬2æ¬¡selectçš„æ—¶é—´ç‚¹ å¦‚ä¸‹å›¾ï¼š**å°±æ˜¯äº‹åŠ¡80å·²ç»æäº¤äº†ï¼Œ120è¿˜æ²¡æäº¤</p><img src="https://zdwtop.cn/blog/image-20230316211638296.png" alt="image-20230316211638296" style="zoom:50%;"><p>SELECT * FROM teacher WHERE number = 1;</p><p>åœ¨æ‰§è¡ŒSELECTè¯­å¥æ—¶ä¼šåˆä¼šå•ç‹¬ç”Ÿæˆä¸€ä¸ªReadViewï¼Œè¯¥ReadViewä¿¡æ¯å¦‚ä¸‹ï¼š</p><p>æ´»è·ƒid ï¼šm_idsåˆ—è¡¨çš„å†…å®¹å°±æ˜¯[120]ï¼ˆäº‹åŠ¡idä¸º80çš„é‚£ä¸ªäº‹åŠ¡å·²ç»æäº¤äº†ï¼Œæ‰€ä»¥å†æ¬¡ç”Ÿæˆå¿«ç…§æ—¶å°±æ²¡æœ‰å®ƒäº†ï¼‰ï¼Œ<strong>min_trx_idä¸º120ï¼Œmax_trx_idä¸º121</strong>ï¼Œ<strong>creator_trx_idä¸º0ã€‚</strong></p><p>ç„¶åä»ç‰ˆæœ¬é“¾ä¸­æŒ‘é€‰å¯è§çš„è®°å½•ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ€æ–°ç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>æ™</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º120ï¼Œåœ¨m_idsåˆ—è¡¨å†…ï¼Œæ‰€ä»¥ä¸ç¬¦åˆå¯è§æ€§è¦æ±‚ï¼Œæ ¹æ®roll_pointerè·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>ä¸¥</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º120ï¼Œä¹Ÿåœ¨m_idsåˆ—è¡¨å†…ï¼Œæ‰€ä»¥ä¹Ÿä¸ç¬¦åˆè¦æ±‚ï¼Œç»§ç»­è·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>è¿</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º80ï¼Œå°äºReadViewä¸­çš„<code>min_trx_id</code>å€¼120ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬æ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œ<strong>æœ€åè¿”å›ç»™ç”¨æˆ·çš„ç‰ˆæœ¬å°±æ˜¯è¿™æ¡åˆ—nameä¸ºâ€™è¿â€™çš„è®°å½•ã€‚</strong></p><p>å¦‚æœä¹‹åäº‹åŠ¡idä¸º120çš„è®°å½•ä¹Ÿæäº¤äº†ï¼Œå†æ¬¡åœ¨ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­æŸ¥è¯¢è¡¨teacher ä¸­numberå€¼ä¸º1çš„è®°å½•æ—¶ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯â€™<strong>æ™</strong>â€™äº†ï¼Œå…·ä½“æµç¨‹æˆ‘ä»¬å°±ä¸åˆ†æäº†ã€‚</p><p>æ‰€ä»¥ç‰ˆæœ¬é“¾+ReadViewå°±è§£å†³äº†è„è¯»ï¼Œä½†RCéš”ç¦»çº§åˆ«ä¸Šä¼šå‡ºç°ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</p><p>å°±æ˜¯ä¸Šé¢é‚£ä¸ªäº‹åŠ¡æœ‰ä¸¤ä¸ªè¯­å¥æŸ¥è¯¢åŒä¸€ä¸ªè¯­å¥ï¼Œæˆ‘ä»¬åˆ†åˆ«æŸ¥å‡ºæ¥æœ‰ä¸¤ä¸ªæ•°æ®ç»“æœä¸ä¸€è‡´ï¼Œå› ä¸ºä¸¤æ¬¡selectéƒ½ç”Ÿæˆäº†ä¸åŒçš„Readviewï¼Œè€Œç¬¬äºŒæ¬¡çš„readviewæ—¶ï¼Œäº‹åŠ¡80å·²ç»æäº¤ä¸å†æ´»è·ƒäº†ï¼Œä½†æˆ‘ä»¬èº«åˆåœ¨120è¿™ä¸ªäº‹åŠ¡æ—¶å°±èƒ½æŸ¥è¯¢80äº‹åŠ¡æ‰€ä¿®æ”¹çš„æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">SELECE1ï¼šTransaction <span class="number">80</span>ã€<span class="number">120</span>å‡æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;æç‘¾&#x27;</span></span><br><span class="line"></span><br><span class="line">SELECE2ï¼šTransaction <span class="number">80</span>æäº¤ï¼ŒTransaction <span class="number">120</span>æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;è¿&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316212052828.png" alt="image-20230316212052828"></p><p><strong>æ€»ç»“ï¼šRCéš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šç”Ÿæˆç‹¬ç«‹çš„readview</strong></p><h3 id="1-5-REPEATABLE-READ-å¯é‡å¤è¯»"><strong>1.5.REPEATABLE READ</strong> å¯é‡å¤è¯»</h3><h4 id="è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜"><strong>è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜</strong></h4><p>å·²ç»åœ¨ç‰ˆæœ¬é“¾ + ReadViewçš„æƒ…å†µä¸‹å·²ç»å¯ä»¥è§£å†³è„è¯»äº†ï¼Œè§£RRçš„éš”ç¦»çº§åˆ«æ¥è§£å†³ä¸å¯é‡å¤è¯»ã€‚</p><p><font color="\#87CEFA"><strong>REPEATABLE READ â€”â€” åœ¨ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ç”Ÿæˆä¸€ä¸ªReadView</strong></font></p><p>å¯¹äºä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢å°±ä¸ä¼šé‡å¤ç”Ÿæˆäº†ã€‚æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¾‹å­çœ‹ä¸€ä¸‹æ˜¯ä»€ä¹ˆæ•ˆæœã€‚</p><p>æ¯”æ–¹è¯´ç°åœ¨ç³»ç»Ÿé‡Œæœ‰ä¸¤ä¸ªäº‹åŠ¡idåˆ†åˆ«ä¸º80ã€120çš„äº‹åŠ¡åœ¨æ‰§è¡Œï¼šTransaction 80</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;é©¬&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;è¿&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤åˆ»ï¼Œè¡¨teacher ä¸­numberä¸º1çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316213612435.png" alt="image-20230316213612435"></p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š</p><img src="https://zdwtop.cn/blog/image-20230316213622378.png" alt="image-20230316213622378" style="zoom:50%;"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"># SELECE1ï¼šTransaction <span class="number">80</span>ã€<span class="number">120</span>æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;æç‘¾&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªSELECE1çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼šåœ¨æ‰§è¡ŒSELECTè¯­å¥æ—¶ä¼šå…ˆç”Ÿæˆä¸€ä¸ªReadViewï¼š</p><p>ReadViewçš„m_idsåˆ—è¡¨çš„å†…å®¹å°±æ˜¯[80, 120]ï¼Œmin_trx_idä¸º80ï¼Œmax_trx_idä¸º121ï¼Œcreator_trx_idä¸º0ã€‚</p><p>ç„¶åä»ç‰ˆæœ¬é“¾ä¸­æŒ‘é€‰å¯è§çš„è®°å½•ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ€æ–°ç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>è¿</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º80ï¼Œåœ¨m_idsåˆ—è¡¨å†…ï¼Œæ‰€ä»¥ä¸ç¬¦åˆå¯è§æ€§è¦æ±‚ï¼ˆtrx_idå±æ€§å€¼åœ¨ReadViewçš„min_trx_idå’Œmax_trx_idä¹‹é—´è¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›</p><p>å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ï¼‰ï¼Œæ ¹æ®roll_pointerè·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>é©¬</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¹Ÿä¸º80ï¼Œä¹Ÿåœ¨m_idsåˆ—è¡¨å†…ï¼Œæ‰€ä»¥ä¹Ÿä¸ç¬¦åˆè¦æ±‚ï¼Œç»§ç»­è·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯â€™<strong>æç‘¾</strong>â€™ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º60ï¼Œå°äºReadViewä¸­çš„min_trx_idå€¼ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬æ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œæœ€åè¿”å›ç»™ç”¨æˆ·çš„ç‰ˆæœ¬å°±æ˜¯è¿™æ¡åˆ—nameä¸ºâ€™<strong>æç‘¾</strong>â€™çš„è®°å½•ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠäº‹åŠ¡idä¸º80çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼Œç„¶åå†åˆ°äº‹åŠ¡idä¸º120çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨teacher ä¸­numberä¸º1çš„è®°å½•ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316213856999.png" alt="image-20230316213856999"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Transaction120</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line">#æ›´æ–°äº†ä¸€äº›åˆ«çš„è¡¨çš„è®°å½•</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;ä¸¥&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> teacher  <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;æ™&#x27;</span> <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316211601448.png" alt="image-20230316211601448"></p><p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ªnumberä¸º1çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š</p><p>ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"># SELECE1ï¼šTransaction <span class="number">80</span>ã€<span class="number">120</span>å‡æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;æç‘¾&#x27;</span></span><br><span class="line"></span><br><span class="line"># SELECE2ï¼šTransaction <span class="number">80</span>æäº¤ï¼ŒTransaction <span class="number">120</span>æœªæäº¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> number <span class="operator">=</span> <span class="number">1</span>; # å¾—åˆ°çš„åˆ—nameçš„å€¼ä¸º<span class="string">&#x27;æç‘¾&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªSELECE2çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>å› ä¸ºå½“å‰äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸ºREPEATABLE READï¼Œè€Œä¹‹å‰åœ¨æ‰§è¡ŒSELECE1æ—¶å·²ç»ç”Ÿæˆè¿‡ReadViewäº†ï¼Œæ‰€ä»¥æ­¤æ—¶<strong>ç›´æ¥å¤ç”¨ä¹‹å‰çš„ReadView</strong>ï¼Œä¹‹å‰çš„ReadViewçš„m_idsåˆ—è¡¨çš„å†…å®¹å°±æ˜¯[80, 120]ï¼Œmin_trx_idä¸º80ï¼Œmax_trx_idä¸º121ï¼Œcreator_trx_idä¸º0ã€‚</p><p><strong>æ ¹æ®å‰é¢çš„åˆ†æï¼Œè¿”å›çš„å€¼è¿˜æ˜¯â€™æç‘¾â€™ã€‚</strong></p><p><strong>ä¹Ÿå°±æ˜¯è¯´ä¸¤æ¬¡SELECTæŸ¥è¯¢å¾—åˆ°çš„ç»“æœæ˜¯é‡å¤çš„ï¼Œè®°å½•çš„åˆ—nameå€¼éƒ½æ˜¯â€™æç‘¾â€™ï¼Œè¿™å°±æ˜¯å¯é‡å¤è¯»çš„å«ä¹‰ã€‚</strong></p><p><img src="https://zdwtop.cn/blog/image-20230316170549681.png" alt="image-20230316170549681"></p><p><strong>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š</strong></p><p><strong>ReadViewä¸­çš„æ¯”è¾ƒè§„åˆ™(å‰ä¸¤æ¡)</strong></p><ol><li><p>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<code>trx_id</code>å±æ€§å€¼ä¸ReadViewä¸­çš„<code>creator_trx_id</code>å€¼ç›¸åŒï¼Œ<strong>trx_id = creator_trx_id</strong>æ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</p></li><li><p>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<code>trx_id</code>å±æ€§å€¼å°äºReadViewä¸­çš„<code>min_trx_id</code>å€¼ï¼Œ<strong>trx_id &lt; min_trx_id è¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</strong></p></li></ol><h3 id="1-6-MVCCä¸‹çš„å¹»è¯»è§£å†³å’Œå¹»è¯»ç°è±¡"><strong>1.6.MVCCä¸‹çš„å¹»è¯»è§£å†³å’Œå¹»è¯»ç°è±¡</strong></h3><p>ç›®å‰åªæœ‰ä¸²è¡ŒåŒ–å’ŒRRå¯é‡å¤è¯»è§£å†³äº†å¹»è¯»ï¼Œè€ŒRRæ˜¯è§£å†³äº†å¤§éƒ¨åˆ†çš„å¹»è¯»ã€‚</p><p>å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹MVCCå¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œé‚£ä¹ˆå¹»è¯»å‘¢ï¼ŸMVCCæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿå¹»è¯»æ˜¯ä¸€ä¸ªäº‹åŠ¡<strong>æŒ‰ç…§æŸä¸ªç›¸åŒæ¡ä»¶å¤šæ¬¡è¯»å–è®°å½•æ—¶ï¼Œåè¯»å–æ—¶è¯»åˆ°äº†ä¹‹å‰æ²¡æœ‰è¯»åˆ°çš„è®°å½•ï¼Œè€Œè¿™ä¸ªè®°å½•æ¥è‡ªå¦ä¸€ä¸ªäº‹åŠ¡æ·»åŠ çš„æ–°è®°å½•</strong>ã€‚æˆ‘ä»¬å¯ä»¥æƒ³æƒ³ï¼Œåœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡T1å…ˆæ ¹æ®æŸä¸ªæœç´¢æ¡ä»¶è¯»å–åˆ°å¤šæ¡è®°å½•ï¼Œç„¶åäº‹åŠ¡T2æ’å…¥ä¸€æ¡ç¬¦åˆç›¸åº”æœç´¢æ¡ä»¶çš„è®°å½•å¹¶æäº¤ï¼Œç„¶åäº‹åŠ¡T1å†æ ¹æ®ç›¸åŒæœç´¢æ¡ä»¶æ‰§è¡ŒæŸ¥è¯¢ã€‚ç»“æœä¼šæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æŒ‰ç…§<strong>ReadViewä¸­çš„æ¯”è¾ƒè§„åˆ™(åä¸¤æ¡)ï¼š</strong></p><ol start="3"><li><p>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<code>trx_id</code>å±æ€§å€¼å¤§äºæˆ–ç­‰äºReadViewä¸­çš„<code>max_trx_id</code>å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewåæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</p></li><li><p>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<code>trx_id</code>å±æ€§å€¼åœ¨ReadViewçš„<code>min_trx_id</code>å’Œ<code>max_trx_id</code>ä¹‹é—´(min_trx_id &lt; trx_id &lt; max_trx_id)ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹<code>trx_id</code>å±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨<code>m_ids</code>åˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ï¼Œ<strong>è¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ã€‚</strong></p></li></ol><p>ä¸ç®¡äº‹åŠ¡T2æ¯”äº‹åŠ¡T1æ˜¯å¦å…ˆå¼€å¯ï¼Œäº‹åŠ¡T1éƒ½æ˜¯çœ‹ä¸åˆ°T2çš„æäº¤çš„ã€‚è¯·è‡ªè¡ŒæŒ‰ç…§ä¸Šé¢ä»‹ç»çš„ç‰ˆæœ¬é“¾ã€ReadViewä»¥åŠåˆ¤æ–­å¯è§æ€§çš„è§„åˆ™æ¥åˆ†æä¸€ä¸‹ã€‚ä½†æ˜¯ï¼Œåœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹InnoDBä¸­çš„MVCC å¯ä»¥å¾ˆå¤§ç¨‹åº¦åœ°é¿å…å¹»è¯»ç°è±¡ï¼Œè€Œä¸æ˜¯å®Œå…¨ç¦æ­¢å¹»è¯»ã€‚æ€ä¹ˆå›äº‹å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„æƒ…å†µï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316215033903.png" alt="image-20230316215033903"></p><p>æˆ‘ä»¬é¦–å…ˆåœ¨<strong>äº‹åŠ¡T1</strong>ä¸­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> number <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯æ‰¾ä¸åˆ°number = 30çš„è®°å½•çš„ã€‚æˆ‘ä»¬åœ¨<strong>äº‹åŠ¡T2</strong>ä¸­ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="number">30</span>,<span class="string">&#x27;è±¹&#x27;</span>,<span class="string">&#x27;æ•°æ®æ¹–&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316215108427.png" alt="image-20230316215108427"></p><p>é€šè¿‡æ‰§è¡Œinsert into teacher values(30,â€˜è±¹â€™,â€˜æ•°æ®æ¹–â€™);ï¼Œæˆ‘ä»¬å¾€è¡¨ä¸­æ’å…¥äº†ä¸€æ¡number = 30çš„è®°å½•ã€‚<strong>æ­¤æ—¶å›åˆ°äº‹åŠ¡T1</strong>ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> teacher <span class="keyword">set</span> domain<span class="operator">=</span><span class="string">&#x27;RocketMQ&#x27;</span> <span class="keyword">where</span> number<span class="operator">=</span><span class="number">30</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> number <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316215130551.png" alt="image-20230316215130551"></p><p>æ€ä¹ˆå›äº‹ï¼Ÿäº‹åŠ¡T1å¾ˆæ˜æ˜¾å‡ºç°äº†å¹»è¯»ç°è±¡ã€‚åœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ï¼Œ<strong>T1ç¬¬ä¸€æ¬¡æ‰§è¡Œæ™®é€šçš„SELECT è¯­å¥æ—¶ç”Ÿæˆäº†ä¸€ä¸ªReadViewï¼ˆä½†æ˜¯ç‰ˆæœ¬é“¾æ²¡æœ‰ï¼‰ï¼Œä¹‹åT2å‘teacher è¡¨ä¸­æ–°æ’å…¥ä¸€æ¡è®°å½•å¹¶æäº¤ï¼Œç„¶åT1ä¹Ÿè¿›è¡Œäº†ä¸€ä¸ªupdateè¯­å¥ã€‚ReadViewå¹¶ä¸èƒ½é˜»æ­¢T1æ‰§è¡ŒUPDATE æˆ–è€…DELETE è¯­å¥æ¥æ”¹åŠ¨è¿™ä¸ªæ–°æ’å…¥çš„è®°å½•ï¼Œä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œè¿™æ¡æ–°è®°å½•çš„trx_idéšè—åˆ—çš„å€¼å°±å˜æˆäº†T1çš„äº‹åŠ¡idã€‚</strong></p><p><img src="https://zdwtop.cn/blog/image-20230316215158396.png" alt="image-20230316215158396"></p><p>ä¹‹åT1å†ä½¿ç”¨æ™®é€šçš„SELECT è¯­å¥å»æŸ¥è¯¢è¿™æ¡è®°å½•æ—¶å°±å¯ä»¥çœ‹åˆ°è¿™æ¡è®°å½•äº†ï¼Œä¹Ÿå°±å¯ä»¥æŠŠè¿™æ¡è®°å½•è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å› ä¸ºè¿™ä¸ªç‰¹æ®Šç°è±¡çš„å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸ºMVCC å¹¶ä¸èƒ½å®Œå…¨ç¦æ­¢å¹»è¯»ï¼ˆ<strong>å°±æ˜¯ç¬¬ä¸€æ¬¡è¯»å¦‚æœæ˜¯ç©ºçš„æƒ…å†µï¼Œä¸”åœ¨è‡ªå·±äº‹åŠ¡ä¸­è¿›è¡Œäº†è¯¥æ¡æ•°æ®çš„ä¿®æ”¹</strong>ï¼‰ã€‚</p><h3 id="1-7-MVCCå°ç»“"><strong>1.7.MVCCå°ç»“</strong></h3><p>ä»ä¸Šè¾¹çš„æè¿°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ‰€è°“çš„MVCCï¼ˆMulti-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æŒ‡çš„å°±æ˜¯åœ¨ä½¿ç”¨READ COMMITTDã€REPEATABLE READè¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œæ™®é€šçš„SELECTæ“ä½œæ—¶è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ï¼Œè¿™æ ·å­å¯ä»¥ä½¿ä¸åŒäº‹åŠ¡çš„è¯»-å†™ã€å†™-è¯»æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>READ COMMITTDã€REPEATABLE READè¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„ä¸€ä¸ªå¾ˆå¤§ä¸åŒå°±æ˜¯ï¼šç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼ŒREAD COMMITTDåœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œè€ŒREPEATABLE READåªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€šSELECTæ“ä½œå‰ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ä½¿ç”¨è¿™ä¸ªReadViewå°±å¥½äº†ï¼Œä»è€ŒåŸºæœ¬ä¸Šå¯ä»¥é¿å…å¹»è¯»ç°è±¡ï¼ˆ<strong>å°±æ˜¯ç¬¬ä¸€æ¬¡è¯»å¦‚æœReadViewæ˜¯ç©ºçš„æƒ…å†µä¸­çš„æŸäº›æƒ…å†µåˆ™é¿å…ä¸äº†</strong>ï¼‰ã€‚</p><p>å¦å¤–ï¼Œæ‰€è°“çš„MVCCåªæ˜¯åœ¨æˆ‘ä»¬è¿›è¡Œæ™®é€šçš„SEELCTæŸ¥è¯¢æ—¶æ‰ç”Ÿæ•ˆï¼Œæˆªæ­¢åˆ°ç›®å‰æˆ‘ä»¬æ‰€è§çš„æ‰€æœ‰SELECTè¯­å¥éƒ½ç®—æ˜¯æ™®é€šçš„æŸ¥è¯¢ï¼Œè‡³äºä»€ä¹ˆæ˜¯ä¸ªä¸æ™®é€šçš„æŸ¥è¯¢ï¼Œåé¢é©¬ä¸Šå°±ä¼šè®²åˆ°ï¼ˆé”å®šè¯»ï¼‰ã€‚å‡†å¤‡å¼€å¯æˆ‘ä»¬çš„é”ç« èŠ‚äº†å˜›</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;MVCCå¤šå¹¶å‘ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;å‰æçŸ¥è¯†ï¼šrowidï¼šæ²¡æœ‰ä¸»é”®çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚trx_idæ˜¯äº‹åŠ¡IDï¼›&lt;/p&gt;
&lt;p&gt;å…¨ç§°Multi-Version Concurrency Controlï¼Œå³&lt;strong&gt;å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶&lt;/st</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="äº‹åŠ¡" scheme="https://eizo01.github.io/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>MySQLäº‹åŠ¡å’Œéš”ç¦»çº§åˆ«</title>
    <link href="https://eizo01.github.io/posts/46b84e39.html"/>
    <id>https://eizo01.github.io/posts/46b84e39.html</id>
    <published>2022-10-16T12:00:00.000Z</published>
    <updated>2023-03-18T14:02:16.593Z</updated>
    
    <content type="html"><![CDATA[<h1>MySQLäº‹åŠ¡å’Œéš”ç¦»çº§åˆ«</h1><h1><strong>1.ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡</strong></h1><p><strong>äº‹åŠ¡æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘å•ä½ï¼ˆä¸å¯å†è¿›è¡Œåˆ†å‰²ï¼‰ï¼Œç”±ä¸€ä¸ªæœ‰é™çš„æ•°æ®åº“æ“ä½œåºåˆ—æ„æˆï¼ˆå¤šä¸ªDMLè¯­å¥ï¼Œselectè¯­å¥ä¸åŒ…å«äº‹åŠ¡ï¼‰ï¼Œè¦ä¸å…¨éƒ¨æˆåŠŸï¼Œè¦ä¸å…¨éƒ¨ä¸æˆåŠŸã€‚</strong></p><p>ç»å…¸çš„è½¬è´¦ä¾‹å­ï¼šA ç»™B è¦åˆ’é’±ï¼ŒA çš„è´¦æˆ·-1000å…ƒï¼Œ B çš„è´¦æˆ·å°±è¦+1000å…ƒï¼Œè¿™ä¸¤ä¸ªupdate è¯­å¥å¿…é¡»ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥æ‰§è¡Œï¼Œä¸ç„¶A æ‰£é’±äº†ï¼ŒB æ²¡æœ‰åŠ é’±è¿™ç§æƒ…å†µå°±æ˜¯é”™è¯¯çš„ã€‚é‚£ä¹ˆäº‹åŠ¡å°±å¯ä»¥ä¿è¯A ã€B è´¦æˆ·çš„å˜åŠ¨è¦ä¹ˆå…¨éƒ¨ä¸€èµ·å‘ç”Ÿï¼Œè¦ä¹ˆå…¨éƒ¨ä¸€èµ·ä¸å‘ç”Ÿã€‚</p><h1><strong>2.äº‹åŠ¡ç‰¹æ€§</strong></h1><p>äº‹åŠ¡åº”è¯¥å…·æœ‰4ä¸ªå±æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚è¿™å››ä¸ªå±æ€§é€šå¸¸ç§°ä¸º<strong>ACID</strong>ç‰¹æ€§ã€‚</p><ul><li><p><strong>åŸå­æ€§ï¼ˆatomicityï¼‰</strong></p></li><li><p><strong>ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰</strong></p></li><li><p><strong>éš”ç¦»æ€§ï¼ˆisolationï¼‰</strong></p></li><li><p><strong>æŒä¹…æ€§ï¼ˆdurabilityï¼‰</strong></p></li></ul><h3 id="2-1-åŸå­æ€§ï¼ˆatomicityï¼‰"><strong>2.1.åŸå­æ€§ï¼ˆatomicityï¼‰</strong></h3><p>**ä¸€ä¸ªäº‹åŠ¡å¿…é¡»è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œæ•´ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡æ¥è¯´ï¼Œä¸èƒ½åªæ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œã€‚**æ¯”å¦‚ï¼š</p><p>è¿è€å¸ˆå€Ÿç»™æè€å¸ˆ1000å…ƒï¼š</p><p>1.è¿è€å¸ˆå·¥èµ„å¡æ‰£é™¤1000å…ƒ</p><p>2.æè€å¸ˆå·¥èµ„å¡å¢åŠ 1000å…ƒ</p><p>æ•´ä¸ªäº‹åŠ¡çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½å‡ºç°è¿è€å¸ˆå·¥èµ„å¡æ‰£é™¤ï¼Œä½†æ˜¯æè€å¸ˆå·¥èµ„å¡ä¸å¢åŠ çš„æƒ…å†µã€‚å¦‚æœåŸå­æ€§ä¸èƒ½ä¿è¯ï¼Œå°±ä¼šå¾ˆè‡ªç„¶çš„å‡ºç°ä¸€è‡´æ€§é—®é¢˜ã€‚</p><h3 id="2-2-ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰"><strong>2.2.ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰</strong></h3><p><strong>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ç§ä¸€è‡´æ€§è½¬æ¢åˆ°å¦å¤–ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€ï¼Œåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä¹‹åæ•°æ®åº“ä¸­æ•°æ®çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚</strong></p><p>è¿è€å¸ˆå€Ÿç»™æè€å¸ˆ1000å…ƒï¼š</p><p>1.è¿è€å¸ˆå·¥èµ„å¡æ‰£é™¤1000å…ƒ</p><p>2.æè€å¸ˆå·¥èµ„å¡å¢åŠ 1000å…ƒ</p><p>æ‰£é™¤çš„é’±ï¼ˆ-500ï¼‰ ä¸å¢åŠ çš„é’±ï¼ˆ500ï¼‰ ç›¸åŠ åº”è¯¥ä¸º0ï¼Œæˆ–è€…è¯´è¿è€å¸ˆå’Œæè€å¸ˆçš„è´¦æˆ·çš„é’±åŠ èµ·æ¥ï¼Œå‰ååº”è¯¥ä¸å˜ã€‚</p><h3 id="2-3-éš”ç¦»æ€§ï¼ˆisolationï¼‰"><strong>2.3.éš”ç¦»æ€§ï¼ˆisolationï¼‰</strong></h3><p>ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</p><p><strong>å¦‚æœéš”ç¦»æ€§ä¸èƒ½ä¿è¯ï¼Œä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>è¿è€å¸ˆå€Ÿç»™æè€å¸ˆç”Ÿæ´»è´¹ï¼Œå€Ÿäº†ä¸¤æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯1000ï¼Œè¿è€å¸ˆçš„å¡é‡Œå¼€å§‹æœ‰10000ï¼Œæè€å¸ˆçš„å¡é‡Œå¼€å§‹æœ‰500ï¼Œä»ç†è®ºä¸Šï¼Œå€Ÿå®Œåï¼Œè¿è€å¸ˆçš„å¡é‡Œæœ‰8000ï¼Œæè€å¸ˆçš„å¡é‡Œåº”è¯¥æœ‰2500ã€‚</p><p>æˆ‘ä»¬å°†è¿è€å¸ˆå‘æè€å¸ˆåŒæ—¶è¿›è¡Œçš„ä¸¤æ¬¡è½¬è´¦æ“ä½œåˆ†åˆ«ç§°ä¸ºT1å’ŒT2ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­T1å’ŒT2æ˜¯åº”è¯¥æ²¡æœ‰å…³ç³»çš„ï¼Œå¯ä»¥å…ˆæ‰§è¡Œå®ŒT1ï¼Œå†æ‰§è¡ŒT2ï¼Œæˆ–è€…å…ˆæ‰§è¡Œå®ŒT2ï¼Œå†æ‰§è¡ŒT1ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>ä½†æ˜¯å¾ˆä¸å¹¸ï¼ŒçœŸå®çš„æ•°æ®åº“ä¸­T1å’ŒT2çš„æ“ä½œå¯èƒ½äº¤æ›¿æ‰§è¡Œçš„ï¼Œæ‰§è¡Œé¡ºåºå°±æœ‰å¯èƒ½æ˜¯ï¼š</p><p><img src="https://zdwtop.cn/blog/image-20230316164908989.png" alt="image-20230316164908989"></p><p>å¦‚æœæŒ‰ç…§ä¸Šå›¾ä¸­çš„æ‰§è¡Œé¡ºåºæ¥è¿›è¡Œä¸¤æ¬¡è½¬è´¦çš„è¯ï¼Œæœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼Œè¿è€å¸ˆçš„è´¦æˆ·é‡Œè¿˜å‰©9000å…ƒé’±ï¼Œç›¸å½“äºåªæ‰£äº†1000å…ƒé’±ï¼Œä½†æ˜¯æè€å¸ˆçš„è´¦æˆ·é‡Œå´æˆäº†2500å…ƒé’±ï¼Œå¤šäº†1000å…ƒï¼Œè¿™é“¶è¡Œå²‚ä¸æ˜¯è¦äºæ­»äº†ï¼Ÿ</p><p>æ‰€ä»¥å¯¹äºç°å®ä¸–ç•Œä¸­çŠ¶æ€è½¬æ¢å¯¹åº”çš„æŸäº›æ•°æ®åº“æ“ä½œæ¥è¯´ï¼Œä¸ä»…è¦ä¿è¯è¿™äº›æ“ä½œä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œå®Œæˆï¼Œè€Œä¸”è¦ä¿è¯å…¶å®ƒçš„çŠ¶æ€è½¬æ¢ä¸ä¼šå½±å“åˆ°æœ¬æ¬¡çŠ¶æ€è½¬æ¢ï¼Œè¿™ä¸ªè§„åˆ™è¢«ç§°ä¹‹ä¸ºéš”ç¦»æ€§ã€‚</p><h3 id="2-4-æŒä¹…æ€§ï¼ˆdurabilityï¼‰"><strong>2.4.æŒä¹…æ€§ï¼ˆdurabilityï¼‰</strong></h3><p>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚æ­¤æ—¶å³ä½¿ç³»ç»Ÿå´©æºƒï¼Œå·²ç»æäº¤çš„ä¿®æ”¹æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p><h1><strong>3.äº‹åŠ¡å¹¶å‘å¼•å‘çš„é—®é¢˜</strong></h1><p>æˆ‘ä»¬çŸ¥é“MySQLæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼æœåŠ¡å™¨æ¶æ„çš„è½¯ä»¶ï¼Œå¯¹äºåŒä¸€ä¸ªæœåŠ¡å™¨æ¥è¯´ï¼Œå¯ä»¥æœ‰è‹¥å¹²ä¸ªå®¢æˆ·ç«¯ä¸ä¹‹è¿æ¥ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥ä¸Šä¹‹åï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºä¸€ä¸ªä¼šè¯ï¼ˆSessionï¼‰ã€‚æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥åœ¨è‡ªå·±çš„ä¼šè¯ä¸­å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚è¯­å¥ï¼Œä¸€ä¸ªè¯·æ±‚è¯­å¥å¯èƒ½æ˜¯æŸä¸ªäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæœåŠ¡å™¨æ¥è¯´å¯èƒ½åŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡ã€‚</p><p>åœ¨ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº‹åŠ¡æœ‰ä¸€ä¸ªç§°ä¹‹ä¸ºéš”ç¦»æ€§çš„ç‰¹æ€§ï¼Œç†è®ºä¸Šåœ¨æŸä¸ªäº‹åŠ¡å¯¹æŸä¸ªæ•°æ®è¿›è¡Œè®¿é—®æ—¶ï¼Œå…¶ä»–äº‹åŠ¡åº”è¯¥è¿›è¡Œæ’é˜Ÿï¼Œå½“è¯¥äº‹åŠ¡æäº¤ä¹‹åï¼Œ å…¶ä»–äº‹åŠ¡æ‰å¯ä»¥ç»§ç»­è®¿é—®è¿™ä¸ªæ•°æ®ï¼Œè¿™æ ·çš„è¯å¹¶å‘äº‹åŠ¡çš„æ‰§è¡Œå°±å˜æˆäº†ä¸²è¡ŒåŒ–æ‰§è¡Œã€‚å½“ç„¶ä¸²è¡ŒåŒ–å¯ä»¥ä¿è¯äº‹åŠ¡ï¼Œä½†æ˜¯ä¸²è¡ŒåŒ–æ‰§è¡Œæ€§èƒ½å½±å“å¤ªå¤§ï¼Œ</p><p><strong>æˆ‘ä»¬æ—¢æƒ³ä¿æŒäº‹åŠ¡çš„ä¸€å®šçš„éš”ç¦»æ€§ï¼Œåˆæƒ³è®©æœåŠ¡å™¨åœ¨å¤„ç†è®¿é—®åŒä¸€æ•°æ®çš„å¤šä¸ªäº‹åŠ¡æ—¶æ€§èƒ½å°½é‡é«˜äº›ï¼Œå½“æˆ‘ä»¬èˆå¼ƒéš”ç¦»æ€§çš„æ—¶å€™</strong>ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä»€ä¹ˆæ ·çš„æ•°æ®é—®é¢˜å‘¢ï¼Ÿ</p><h3 id="3-1-è„è¯»"><strong>3.1.è„è¯»</strong></h3><p>å½“ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¤–ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼Œè¢«ç§°ä¸ºè„è¯»ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230316170126044.png" alt="image-20230316170126044"></p><ol><li><p>åœ¨äº‹åŠ¡Aæ‰§â¾è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡Aå¯¹æ•°æ®èµ„æºè¿›â¾äº†ä¿®æ”¹ï¼Œäº‹åŠ¡Bè¯»å–äº†äº‹åŠ¡Aä¿®æ”¹åçš„æ•°æ®ã€‚</p></li><li><p>ç”±äºæŸäº›åŸå› ï¼Œäº‹åŠ¡Aå¹¶æ²¡æœ‰å®Œæˆæäº¤ï¼Œå‘â½£äº†RollBackæ“ä½œï¼Œåˆ™äº‹åŠ¡Bè¯»å–çš„æ•°æ®å°±æ˜¯è„æ•°æ®ã€‚</p></li></ol><p><font color="\#87CEFA"><strong>è¿™ç§è¯»å–åˆ°å¦â¼€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®çš„ç°è±¡å°±æ˜¯è„è¯»(Dirty Read).</strong></font></p><h3 id="3-2-ä¸å¯é‡å¤è¯»"><strong>3.2.ä¸å¯é‡å¤è¯»</strong></h3><p>å½“äº‹åŠ¡å†…ç›¸åŒçš„è®°å½•è¢«æ£€ç´¢ä¸¤æ¬¡ï¼Œä¸”ä¸¤æ¬¡å¾—åˆ°çš„ç»“æœä¸åŒæ—¶ï¼Œæ­¤ç°è±¡ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230316170549681.png" alt="image-20230316170549681"></p><p>äº‹åŠ¡Bè¯»å–äº†ä¸¤æ¬¡æ•°æ®èµ„æºï¼Œåœ¨è¿™ä¸¤æ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­äº‹åŠ¡Aä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´äº‹åŠ¡Båœ¨è¿™ä¸¤æ¬¡è¯»å–å‡ºæ¥çš„æ•°æ®ä¸â¼€è‡´ã€‚</p><h3 id="3-3-å¹»è¯»"><strong>3.3.å¹»è¯»</strong></h3><p>åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å°†æ–°è®°å½•æ·»åŠ åˆ°æ­£åœ¨è¯»å–çš„äº‹åŠ¡ä¸­æ—¶ï¼Œä¼šå‘ç”Ÿå¹»è¯»ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230316170757089.png" alt="image-20230316170757089"></p><p>äº‹åŠ¡Bå‰åä¸¤æ¬¡è¯»å–åŒâ¼€ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œåœ¨äº‹åŠ¡Bä¸¤æ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­äº‹åŠ¡A<strong>æ–°å¢äº†æ•°æ®</strong>ï¼Œå¯¼è‡´äº‹åŠ¡Båâ¼€æ¬¡è¯»å–åˆ°å‰â¼€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„â¾ã€‚</p><p><font color="\#87CEFA"><strong>å¹»è¯»å’Œä¸å¯é‡å¤è¯»æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯å¹»è¯»é‡ç‚¹å¼ºè°ƒäº†è¯»å–åˆ°äº†ä¹‹å‰è¯»å–æ²¡æœ‰è·å–åˆ°çš„è®°å½•ã€‚</strong></font></p><p><font color="\#87CEFA"> <strong>å¹»è¯»æ˜¯å…³æ³¨æ•°æ®çš„æ–°åŠ ï¼Œä¸å¯é‡å¤è¯»æ˜¯å…³æ³¨æ•°æ®çš„ä¿®æ”¹ã€‚</strong>Â </font></p><h1><strong>4.SQLæ ‡å‡†ä¸­çš„å››ç§éš”ç¦»çº§åˆ«</strong></h1><p>æˆ‘ä»¬ä¸Šè¾¹ä»‹ç»äº†å‡ ç§å¹¶å‘äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œè¿™äº›é—®é¢˜ä¹Ÿæœ‰è½»é‡ç¼“æ€¥ä¹‹åˆ†ï¼Œæˆ‘ä»¬ç»™è¿™äº›é—®é¢˜æŒ‰ç…§ä¸¥é‡æ€§æ¥æ’ä¸€ä¸‹åºï¼š</p><p><code>è„è¯» &gt; ä¸å¯é‡å¤è¯» &gt; å¹»è¯»</code></p><p>æˆ‘ä»¬ä¸Šè¾¹æ‰€è¯´çš„èˆå¼ƒä¸€éƒ¨åˆ†éš”ç¦»æ€§æ¥æ¢å–ä¸€éƒ¨åˆ†æ€§èƒ½åœ¨è¿™é‡Œå°±ä½“ç°åœ¨ï¼šè®¾ç«‹ä¸€äº›éš”ç¦»çº§åˆ«ï¼Œéš”ç¦»çº§åˆ«è¶Šä½ï¼Œè¶Šä¸¥é‡çš„é—®é¢˜å°±è¶Šå¯èƒ½å‘ç”Ÿã€‚æœ‰ä¸€å¸®äººï¼ˆå¹¶ä¸æ˜¯è®¾è®¡MySQLçš„å¤§å”ä»¬ï¼‰åˆ¶å®šäº†ä¸€ä¸ªæ‰€è°“çš„SQLæ ‡å‡†ï¼Œåœ¨æ ‡å‡†ä¸­è®¾ç«‹äº†4ä¸ªéš”ç¦»çº§åˆ«ï¼š</p><p><strong>READ UNCOMMITTEDï¼šæœªæäº¤è¯»ã€‚</strong></p><p><strong>READ COMMITTEDï¼šå·²æäº¤è¯»ã€‚</strong></p><p><strong>REPEATABLE READï¼šå¯é‡å¤è¯»ã€‚</strong></p><p><strong>SERIALIZABLEï¼šå¯ä¸²è¡ŒåŒ–ã€‚</strong></p><img src="https://zdwtop.cn/blog/image-20230316171114737.png" alt="image-20230316171114737" style="zoom:80%;"><p>SQLæ ‡å‡†ä¸­è§„å®šï¼Œé’ˆå¯¹ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œå¹¶å‘äº‹åŠ¡å¯ä»¥å‘ç”Ÿä¸åŒä¸¥é‡ç¨‹åº¦çš„é—®é¢˜ï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹ï¼š</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><p><strong>RU æœªæäº¤è¯»  - READ UNCOMMITTEDéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</strong></p><p>**RC å·²æäº¤è¯»- READ COMMITTEDéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¸å¯ä»¥å‘ç”Ÿè„è¯»é—®é¢˜ã€‚ **</p><p><strong>ï¼ˆé»˜è®¤ï¼‰REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½å‘ç”Ÿå¹»è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¸å¯ä»¥å‘ç”Ÿè„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚  RR è§£å†³äº†å¤§éƒ¨åˆ†çš„å¹»è¯»é—®é¢˜ï¼Œä½†æ²¡æœ‰å®Œå…¨è§£å†³ å¯é‡å¤è¯»ã€‚</strong></p><p><strong>SERIALIZABLEéš”ç¦»çº§åˆ«ä¸‹ï¼Œå„ç§é—®é¢˜éƒ½ä¸å¯ä»¥å‘ç”Ÿã€‚</strong></p><h1><strong>5.MySQLä¸­çš„éš”ç¦»çº§åˆ«</strong></h1><p>æœ¬æ–‡ä¸­æ‰€è®¨è®ºçš„MySQLè™½ç„¶æ”¯æŒ4ç§éš”ç¦»çº§åˆ«ï¼Œä½†ä¸SQLæ ‡å‡†ä¸­æ‰€è§„å®šçš„å„çº§éš”ç¦»çº§åˆ«å…è®¸å‘ç”Ÿçš„é—®é¢˜å´æœ‰äº›å‡ºå…¥ï¼ŒMySQLåœ¨<code>REPEATABLE READ(é»˜è®¤)</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯å¯ä»¥ç¦æ­¢å¹»è¯»é—®é¢˜çš„å‘ç”Ÿçš„ã€‚</p><img src="https://zdwtop.cn/blog/image-20230316171312958.png" alt="image-20230316171312958" style="zoom:80%;"><p>MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ä¸ºREPEATABLE READï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> [<span class="keyword">GLOBAL</span><span class="operator">|</span>SESSION] TRANSACTION ISOLATION LEVEL level;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„levelå¯é€‰å€¼æœ‰4ä¸ªï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">level: &#123;</span><br><span class="line">    REPEATABLE READ</span><br><span class="line">   <span class="operator">|</span> READ COMMITTED</span><br><span class="line">   <span class="operator">|</span> READ UNCOMMITTED</span><br><span class="line">   <span class="operator">|</span> SERIALIZABLE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨GLOBALå…³é”®å­—ï¼ˆåœ¨å…¨å±€èŒƒå›´å½±å“ï¼‰ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨SESSIONå…³é”®å­—ï¼ˆåœ¨ä¼šè¯èŒƒå›´å½±å“ï¼‰ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¹å½“å‰ä¼šè¯çš„æ‰€æœ‰åç»­çš„äº‹åŠ¡æœ‰æ•ˆ</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br></pre></td></tr></table></figure><p><strong>åªå¯¹æ‰§è¡Œè¯­å¥åçš„ä¸‹ä¸€ä¸ªäº‹åŠ¡äº§ç”Ÿå½±å“ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹å½“å‰ä¼šè¯äº‹åŠ¡ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction</span>_isolation;</span><br></pre></td></tr></table></figure><h1><strong>6.MySQLäº‹åŠ¡</strong></h1><h3 id="6-1-äº‹åŠ¡åŸºæœ¬è¯­æ³•"><strong>6.1.äº‹åŠ¡åŸºæœ¬è¯­æ³•</strong></h3><p><strong>äº‹åŠ¡å¼€å§‹</strong></p><ol><li>begin</li><li>START TRANSACTIONï¼ˆæ¨èï¼‰</li><li>begin work</li></ol><p><strong>äº‹åŠ¡å›æ»š</strong></p><p>rollback</p><p><strong>äº‹åŠ¡æäº¤</strong></p><p>commit</p><h3 id="6-2-ä¿å­˜ç‚¹"><strong>6.2.ä¿å­˜ç‚¹</strong></h3><p>å¦‚æœä½ å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œäº†å¾ˆå¤šè¯­å¥ï¼Œå¿½ç„¶å‘ç°æŸæ¡è¯­å¥æœ‰ç‚¹é—®é¢˜ï¼Œä½ åªå¥½ä½¿ç”¨ROLLBACKè¯­å¥æ¥è®©æ•°æ®åº“çŠ¶æ€æ¢å¤åˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰çš„æ ·å­ï¼Œç„¶åä¸€åˆ‡ä»å¤´å†æ¥ï¼Œä½†æ˜¯å¯èƒ½æ ¹æ®ä¸šåŠ¡å’Œæ•°æ®çš„å˜åŒ–ï¼Œä¸éœ€è¦å…¨éƒ¨å›æ»šã€‚</p><p>æ‰€ä»¥MySQLé‡Œæå‡ºäº†ä¸€ä¸ªä¿å­˜ç‚¹ï¼ˆè‹±æ–‡ï¼šsavepointï¼‰çš„æ¦‚å¿µï¼Œå°±æ˜¯åœ¨äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“è¯­å¥ä¸­æ‰“å‡ ä¸ªç‚¹ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨ROLLBACKè¯­å¥æ—¶å¯ä»¥æŒ‡å®šä¼šæ»šåˆ°å“ªä¸ªç‚¹ï¼Œè€Œä¸æ˜¯å›åˆ°æœ€åˆçš„åŸç‚¹ã€‚å®šä¹‰ä¿å­˜ç‚¹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><p>SAVEPOINT ä¿å­˜ç‚¹åç§°;</p><p>å½“æˆ‘ä»¬æƒ³å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹è¿™ä¸ªè¯­å¥ï¼ˆä¸‹è¾¹è¯­å¥ä¸­çš„å•è¯WORKå’ŒSAVEPOINTæ˜¯å¯æœ‰å¯æ— çš„ï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> [<span class="keyword">SAVEPOINT</span>] ä¿å­˜ç‚¹åç§°;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¦‚æœROLLBACKè¯­å¥åè¾¹ä¸è·Ÿéšä¿å­˜ç‚¹åç§°çš„è¯ï¼Œä¼šç›´æ¥å›æ»šåˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤æŸä¸ªä¿å­˜ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> ä¿å­˜ç‚¹åç§°;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‰è¦æŠŠè‡ªå·±æäº¤å…ˆç»™å…³é—­</p><p><img src="https://zdwtop.cn/blog/image-20230316172500603.png" alt="image-20230316172500603"></p><p><img src="https://zdwtop.cn/blog/image-20230316172503895.png" alt="image-20230316172503895"></p><p><img src="https://zdwtop.cn/blog/image-20230316172519101.png" alt="image-20230316172519101"></p><h3 id="6-3-éšå¼æäº¤â€“é‡è¦"><strong>6.3.éšå¼æäº¤â€“é‡è¦</strong></h3><p>å½“æˆ‘ä»¬ä½¿ç”¨START TRANSACTIONæˆ–è€…BEGINè¯­å¥å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œæˆ–è€…æŠŠç³»ç»Ÿå˜é‡<code>autocommit</code>çš„å€¼è®¾ç½®ä¸ºOFFæ—¶ï¼Œäº‹åŠ¡å°±ä¸ä¼šè¿›è¡Œè‡ªåŠ¨æäº¤ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¾“å…¥äº†æŸäº›è¯­å¥ä¹‹åå°±ä¼šæ‚„æ‚„çš„æäº¤æ‰ï¼Œå°±åƒæˆ‘ä»¬è¾“å…¥äº†COMMITè¯­å¥äº†ä¸€æ ·ï¼Œè¿™ç§å› ä¸ºæŸäº›ç‰¹æ®Šçš„è¯­å¥è€Œå¯¼è‡´äº‹åŠ¡æäº¤çš„æƒ…å†µç§°ä¸ºéšå¼æäº¤ï¼Œè¿™äº›ä¼šå¯¼è‡´äº‹åŠ¡éšå¼æäº¤çš„è¯­å¥åŒ…æ‹¬ï¼š</p><h4 id="6-3-1-æ‰§è¡ŒDDL-å®šä¹‰è¯­å¥"><strong>6.3.1.æ‰§è¡ŒDDL-å®šä¹‰è¯­å¥</strong></h4><p><strong>å®šä¹‰æˆ–ä¿®æ”¹æ•°æ®åº“å¯¹è±¡çš„æ•°æ®å®šä¹‰è¯­è¨€</strong>ï¼ˆDatadefinition languageï¼Œç¼©å†™ä¸ºï¼šDDLï¼‰ã€‚</p><p>æ‰€è°“çš„æ•°æ®åº“å¯¹è±¡ï¼ŒæŒ‡çš„å°±æ˜¯æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ç­‰ç­‰è¿™äº›ä¸œè¥¿ã€‚å½“æˆ‘ä»¬ä½¿ç”¨<code>CREATE</code>ã€<code>ALTER</code>ã€<code>DROP</code>ç­‰è¯­å¥å»ä¿®æ”¹è¿™äº›æ‰€è°“çš„æ•°æ®åº“å¯¹è±¡æ—¶ï¼Œå°±ä¼š<strong>éšå¼çš„æäº¤å‰è¾¹è¯­å¥æ‰€å±äºçš„äº‹åŠ¡</strong>ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> ... # äº‹åŠ¡ä¸­çš„ä¸€æ¡è¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> ... # äº‹åŠ¡ä¸­çš„ä¸€æ¡è¯­å¥</span><br><span class="line"></span><br><span class="line">... # äº‹åŠ¡ä¸­çš„å…¶å®ƒè¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ...</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316172813762.png" alt="image-20230316172813762"></p><h4 id="6-3-2-éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹mysqlæ•°æ®åº“ä¸­çš„è¡¨"><strong>6.3.2.éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹mysqlæ•°æ®åº“ä¸­çš„è¡¨</strong></h4><p>å½“æˆ‘ä»¬ä½¿ç”¨<code>ALTER USER</code>ã€<code>CREATE USER</code>ã€<code>DROP USER</code>ã€<code>GRANT</code>ã€<code>RENAME USER</code>ã€<code>REVOKE</code>ã€<code>SET PASSWORD</code>ç­‰è¯­å¥æ—¶ä¹Ÿä¼šéšå¼çš„æäº¤å‰è¾¹è¯­å¥æ‰€å±äºçš„äº‹åŠ¡ã€‚</p><h4 id="6-3-3-äº‹åŠ¡æ§åˆ¶æˆ–å…³äºé”å®šçš„è¯­å¥"><strong>6.3.3.äº‹åŠ¡æ§åˆ¶æˆ–å…³äºé”å®šçš„è¯­å¥</strong></h4><p>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªä¼šè¯é‡Œï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æˆ–è€…å›æ»šæ—¶å°±åˆä½¿ç”¨<code>START TRANSACTION</code>æˆ–è€…<code>BEGIN</code>è¯­å¥å¼€å¯äº†å¦ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œä¼šéšå¼çš„æäº¤ä¸Šä¸€ä¸ªäº‹åŠ¡ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> ... # äº‹åŠ¡ä¸­çš„ä¸€æ¡è¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> ... # äº‹åŠ¡ä¸­çš„ä¸€æ¡è¯­å¥</span><br><span class="line"></span><br><span class="line">... # äº‹åŠ¡ä¸­çš„å…¶å®ƒè¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span>; #  </span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230316173035210.png" alt="image-20230316173035210"></p><p>æˆ–è€…å½“å‰çš„<code>autocommit</code>ç³»ç»Ÿå˜é‡çš„å€¼ä¸ºOFFï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠå®ƒè°ƒä¸ºONæ—¶ï¼Œä¹Ÿä¼šéšå¼çš„æäº¤å‰è¾¹è¯­å¥æ‰€å±çš„äº‹åŠ¡ã€‚</p><p>æˆ–è€…ä½¿ç”¨<code>LOCK TABLES</code>ã€<code>UNLOCK TABLES</code>ç­‰å…³äºé”å®šçš„è¯­å¥ä¹Ÿä¼šéšå¼çš„æäº¤å‰è¾¹è¯­å¥æ‰€å±çš„äº‹åŠ¡ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;MySQLäº‹åŠ¡å’Œéš”ç¦»çº§åˆ«&lt;/h1&gt;
&lt;h1&gt;&lt;strong&gt;1.ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘å•ä½ï¼ˆä¸å¯å†è¿›è¡Œåˆ†å‰²ï¼‰ï¼Œç”±ä¸€ä¸ªæœ‰é™çš„æ•°æ®åº“æ“ä½œåºåˆ—æ„æˆï¼ˆå¤šä¸ªDMLè¯­å¥ï¼Œselectè¯­å¥ä¸</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="äº‹åŠ¡" scheme="https://eizo01.github.io/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç´¢å¼•ä¼˜åŒ–</title>
    <link href="https://eizo01.github.io/posts/484a2385.html"/>
    <id>https://eizo01.github.io/posts/484a2385.html</id>
    <published>2022-10-13T12:00:00.000Z</published>
    <updated>2023-03-18T14:02:16.580Z</updated>
    
    <content type="html"><![CDATA[<h1>ä»€ä¹ˆæ—¶å€™é€‚ç”¨ç´¢å¼•ï¼Ÿ</h1><ul><li>å­—æ®µæœ‰å”¯ä¸€æ€§é™åˆ¶çš„ï¼Œæ¯”å¦‚å•†å“ç¼–ç ï¼›</li><li>ç»å¸¸ç”¨äº <code>WHERE</code> æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼Œè¿™æ ·èƒ½å¤Ÿæé«˜æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸æ˜¯ä¸€ä¸ªå­—æ®µï¼Œå¯ä»¥å»ºç«‹è”åˆç´¢å¼•ã€‚</li><li>ç»å¸¸ç”¨äº <code>GROUP BY</code> å’Œ <code>ORDER BY</code> çš„å­—æ®µï¼Œè¿™æ ·åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±ä¸éœ€è¦å†å»åšä¸€æ¬¡æ’åºäº†ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½å·²ç»çŸ¥é“äº†å»ºç«‹ç´¢å¼•ä¹‹ååœ¨ B+Tree ä¸­çš„è®°å½•éƒ½æ˜¯æ’åºå¥½çš„ã€‚</li></ul><h1>ä»€ä¹ˆæ—¶å€™ä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Ÿ</h1><ul><li><code>WHERE</code> æ¡ä»¶ï¼Œ<code>GROUP BY</code>ï¼Œ<code>ORDER BY</code> é‡Œç”¨ä¸åˆ°çš„å­—æ®µï¼Œç´¢å¼•çš„ä»·å€¼æ˜¯å¿«é€Ÿå®šä½ï¼Œå¦‚æœèµ·ä¸åˆ°å®šä½çš„å­—æ®µé€šå¸¸æ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„ï¼Œå› ä¸ºç´¢å¼•æ˜¯ä¼šå ç”¨ç‰©ç†ç©ºé—´çš„ã€‚</li><li>å­—æ®µä¸­å­˜åœ¨å¤§é‡é‡å¤æ•°æ®ï¼Œä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Œæ¯”å¦‚æ€§åˆ«å­—æ®µï¼Œåªæœ‰ç”·å¥³ï¼Œå¦‚æœæ•°æ®åº“è¡¨ä¸­ï¼Œç”·å¥³çš„è®°å½•åˆ†å¸ƒå‡åŒ€ï¼Œé‚£ä¹ˆæ— è®ºæœç´¢å“ªä¸ªå€¼éƒ½å¯èƒ½å¾—åˆ°ä¸€åŠçš„æ•°æ®ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè¿˜ä¸å¦‚ä¸è¦ç´¢å¼•ï¼Œå› ä¸º MySQL è¿˜æœ‰ä¸€ä¸ªæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å‘ç°æŸä¸ªå€¼å‡ºç°åœ¨è¡¨çš„æ•°æ®è¡Œä¸­çš„ç™¾åˆ†æ¯”å¾ˆé«˜çš„æ—¶å€™ï¼Œå®ƒä¸€èˆ¬ä¼šå¿½ç•¥ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>è¡¨æ•°æ®å¤ªå°‘çš„æ—¶å€™ï¼Œä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼›</li><li>ç»å¸¸æ›´æ–°çš„å­—æ®µä¸ç”¨åˆ›å»ºç´¢å¼•ï¼Œæ¯”å¦‚ä¸è¦å¯¹ç”µå•†é¡¹ç›®çš„ç”¨æˆ·ä½™é¢å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å­—æ®µé¢‘ç¹ä¿®æ”¹ï¼Œç”±äºè¦ç»´æŠ¤ B+Treeçš„æœ‰åºæ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢‘ç¹çš„é‡å»ºç´¢å¼•ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¼šå½±å“æ•°æ®åº“æ€§èƒ½çš„ã€‚</li></ul><h1>ä¼˜åŒ–ç´¢å¼•</h1><h3 id="å‰ç¼€ç´¢å¼•ä¼˜åŒ–">å‰ç¼€ç´¢å¼•ä¼˜åŒ–</h3><p>å‰ç¼€ç´¢å¼•é¡¾åæ€ä¹‰å°±æ˜¯ä½¿ç”¨æŸä¸ªå­—æ®µä¸­å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å‰ç¼€æ¥å»ºç«‹ç´¢å¼•å‘¢ï¼Ÿ</p><p>ä½¿ç”¨å‰ç¼€ç´¢å¼•æ˜¯ä¸ºäº†å‡å°ç´¢å¼•å­—æ®µå¤§å°ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„ç´¢å¼•å€¼ï¼Œæœ‰æ•ˆæé«˜ç´¢å¼•çš„æŸ¥è¯¢é€Ÿåº¦ã€‚åœ¨ä¸€äº›å¤§å­—ç¬¦ä¸²çš„å­—æ®µä½œä¸ºç´¢å¼•æ—¶ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡å°ç´¢å¼•é¡¹çš„å¤§å°ã€‚</p><p>ä¸è¿‡ï¼Œå‰ç¼€ç´¢å¼•æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>order by å°±æ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼›</li><li>æ— æ³•æŠŠå‰ç¼€ç´¢å¼•ç”¨ä½œè¦†ç›–ç´¢å¼•ï¼›</li></ul><h3 id="è¦†ç›–ç´¢å¼•ä¼˜åŒ–">è¦†ç›–ç´¢å¼•ä¼˜åŒ–</h3><p>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ SQL ä¸­ query çš„æ‰€æœ‰å­—æ®µï¼Œåœ¨ç´¢å¼• B+Tree çš„å¶å­èŠ‚ç‚¹ä¸Šéƒ½èƒ½æ‰¾å¾—åˆ°çš„é‚£äº›ç´¢å¼•ï¼Œä»äºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢å¾—åˆ°è®°å½•ï¼Œè€Œä¸éœ€è¦é€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢è·å¾—ï¼Œå¯ä»¥é¿å…å›è¡¨çš„æ“ä½œã€‚</p><p>å‡è®¾æˆ‘ä»¬åªéœ€è¦æŸ¥è¯¢å•†å“çš„åç§°ã€ä»·æ ¼ï¼Œæœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥é¿å…å›è¡¨å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œå³ã€Œå•†å“IDã€åç§°ã€ä»·æ ¼ã€ä½œä¸ºä¸€ä¸ªè”åˆç´¢å¼•ã€‚å¦‚æœç´¢å¼•ä¸­å­˜åœ¨è¿™äº›æ•°æ®ï¼ŒæŸ¥è¯¢å°†ä¸ä¼šå†æ¬¡æ£€ç´¢ä¸»é”®ç´¢å¼•ï¼Œä»è€Œé¿å…å›è¡¨ã€‚</p><p>æ‰€ä»¥ï¼Œä½¿ç”¨è¦†ç›–ç´¢å¼•çš„å¥½å¤„å°±æ˜¯ï¼Œä¸éœ€è¦æŸ¥è¯¢å‡ºåŒ…å«æ•´è¡Œè®°å½•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¹Ÿå°±å‡å°‘äº†å¤§é‡çš„ I/O æ“ä½œã€‚</p><h3 id="ä¸»é”®ç´¢å¼•æœ€å¥½æ˜¯è‡ªå¢çš„">ä¸»é”®ç´¢å¼•æœ€å¥½æ˜¯è‡ªå¢çš„</h3><p>æˆ‘ä»¬åœ¨å»ºè¡¨çš„æ—¶å€™ï¼Œéƒ½ä¼šé»˜è®¤å°†ä¸»é”®ç´¢å¼•è®¾ç½®ä¸ºè‡ªå¢çš„ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿåˆä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><p>InnoDB åˆ›å»ºä¸»é”®ç´¢å¼•é»˜è®¤ä¸ºèšç°‡ç´¢å¼•ï¼Œæ•°æ®è¢«å­˜æ”¾åœ¨äº† B+Tree çš„å¶å­èŠ‚ç‚¹ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªå¶å­èŠ‚ç‚¹å†…çš„å„ä¸ªæ•°æ®æ˜¯æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾çš„ï¼Œå› æ­¤ï¼Œæ¯å½“æœ‰ä¸€æ¡æ–°çš„æ•°æ®æ’å…¥æ—¶ï¼Œæ•°æ®åº“ä¼šæ ¹æ®ä¸»é”®å°†å…¶æ’å…¥åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚</p><p><strong>å¦‚æœæˆ‘ä»¬ä½¿ç”¨è‡ªå¢ä¸»é”®</strong>ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥çš„æ–°æ•°æ®å°±ä¼šæŒ‰é¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¸éœ€è¦ç§»åŠ¨å·²æœ‰çš„æ•°æ®ï¼Œå½“é¡µé¢å†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°é¡µé¢ã€‚å› ä¸ºæ¯æ¬¡<strong>æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œä¸éœ€è¦é‡æ–°ç§»åŠ¨æ•°æ®</strong>ï¼Œå› æ­¤è¿™ç§æ’å…¥æ•°æ®çš„æ–¹æ³•æ•ˆç‡éå¸¸é«˜ã€‚</p><p><strong>å¦‚æœæˆ‘ä»¬ä½¿ç”¨éè‡ªå¢ä¸»é”®</strong>ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„ç´¢å¼•å€¼éƒ½æ˜¯éšæœºçš„ï¼Œå› æ­¤æ¯æ¬¡æ’å…¥æ–°çš„æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šæ’å…¥åˆ°ç°æœ‰æ•°æ®é¡µä¸­é—´çš„æŸä¸ªä½ç½®ï¼Œè¿™å°†ä¸å¾—ä¸ç§»åŠ¨å…¶å®ƒæ•°æ®æ¥æ»¡è¶³æ–°æ•°æ®çš„æ’å…¥ï¼Œç”šè‡³éœ€è¦ä»ä¸€ä¸ªé¡µé¢å¤åˆ¶æ•°æ®åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬é€šå¸¸å°†è¿™ç§æƒ…å†µç§°ä¸º<strong>é¡µåˆ†è£‚</strong>ã€‚<strong>é¡µåˆ†è£‚è¿˜æœ‰å¯èƒ½ä¼šé€ æˆå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´ç´¢å¼•ç»“æ„ä¸ç´§å‡‘ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æŸä¸ªæ•°æ®é¡µä¸­çš„æ•°æ®æ˜¯1ã€3ã€5ã€9ï¼Œä¸”æ•°æ®é¡µæ»¡äº†ï¼Œç°åœ¨å‡†å¤‡æ’å…¥ä¸€ä¸ªæ•°æ®7ï¼Œåˆ™éœ€è¦æŠŠæ•°æ®é¡µåˆ†å‰²ä¸ºä¸¤ä¸ªæ•°æ®é¡µï¼š</p><p>å‡ºç°é¡µåˆ†è£‚æ—¶ï¼Œéœ€è¦å°†ä¸€ä¸ªé¡µçš„è®°å½•ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé¡µï¼Œæ€§èƒ½ä¼šå—åˆ°å½±å“ï¼ŒåŒæ—¶é¡µç©ºé—´çš„åˆ©ç”¨ç‡ä¸‹é™ï¼Œé€ æˆå­˜å‚¨ç©ºé—´çš„æµªè´¹ã€‚</p><p>è€Œå¦‚æœè®°å½•æ˜¯é¡ºåºæ’å…¥çš„ï¼Œä¾‹å¦‚æ’å…¥æ•°æ®11ï¼Œåˆ™åªéœ€å¼€è¾Ÿæ–°çš„æ•°æ®é¡µï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿé¡µåˆ†è£‚ï¼š</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/%E7%B4%A2%E5%BC%95/%E9%A1%B5%E5%88%86%E8%A3%82.png" alt="img"></p><p>å‡ºç°é¡µåˆ†è£‚æ—¶ï¼Œéœ€è¦å°†ä¸€ä¸ªé¡µçš„è®°å½•ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé¡µï¼Œæ€§èƒ½ä¼šå—åˆ°å½±å“ï¼ŒåŒæ—¶é¡µç©ºé—´çš„åˆ©ç”¨ç‡ä¸‹é™ï¼Œé€ æˆå­˜å‚¨ç©ºé—´çš„æµªè´¹ã€‚</p><p>è€Œå¦‚æœè®°å½•æ˜¯é¡ºåºæ’å…¥çš„ï¼Œä¾‹å¦‚æ’å…¥æ•°æ®11ï¼Œåˆ™åªéœ€å¼€è¾Ÿæ–°çš„æ•°æ®é¡µï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿé¡µåˆ†è£‚ï¼š</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/%E7%B4%A2%E5%BC%95/%E5%BC%80%E8%BE%9F%E6%96%B0%E9%A1%B5.png" alt="1"></p><p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®ã€‚</p><p>å¦å¤–ï¼Œä¸»é”®å­—æ®µçš„é•¿åº¦ä¸è¦å¤ªå¤§ï¼Œå› ä¸º<strong>ä¸»é”®å­—æ®µé•¿åº¦è¶Šå°ï¼Œæ„å‘³ç€äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è¶Šå°ï¼ˆäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®æ˜¯ä¸»é”®å€¼ï¼‰ï¼Œè¿™æ ·äºŒçº§ç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå°</strong>ã€‚</p><h3 id="ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º-NOT-NULL">ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º NOT NULL</h3><p>ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨ç´¢å¼•ï¼Œç´¢å¼•åˆ—è¦è®¾ç½®ä¸º NOT NULL çº¦æŸã€‚æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>ç¬¬ä¸€åŸå› ï¼šç´¢å¼•åˆ—å­˜åœ¨ NULL å°±ä¼šå¯¼è‡´ä¼˜åŒ–å™¨åœ¨åšç´¢å¼•é€‰æ‹©çš„æ—¶å€™æ›´åŠ å¤æ‚ï¼Œæ›´åŠ éš¾ä»¥ä¼˜åŒ–ï¼Œå› ä¸ºå¯ä¸º NULL çš„åˆ—ä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ¯”è¾ƒéƒ½æ›´å¤æ‚ï¼Œæ¯”å¦‚è¿›è¡Œç´¢å¼•ç»Ÿè®¡æ—¶ï¼Œcount ä¼šçœç•¥å€¼ä¸ºNULL çš„è¡Œã€‚</li><li>ç¬¬äºŒä¸ªåŸå› ï¼šNULL å€¼æ˜¯ä¸€ä¸ªæ²¡æ„ä¹‰çš„å€¼ï¼Œä½†æ˜¯å®ƒä¼šå ç”¨ç‰©ç†ç©ºé—´ï¼Œæ‰€ä»¥ä¼šå¸¦æ¥çš„å­˜å‚¨ç©ºé—´çš„é—®é¢˜ï¼Œå› ä¸º InnoDB å­˜å‚¨è®°å½•çš„æ—¶å€™ï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨å…è®¸ä¸º NULL çš„å­—æ®µï¼Œé‚£è¡Œæ ¼å¼ä¸­<strong>è‡³å°‘ä¼šç”¨ 1 å­—èŠ‚ç©ºé—´å­˜å‚¨ NULL å€¼åˆ—è¡¨</strong>ï¼Œå¦‚ä¸‹å›¾çš„ç´«è‰²éƒ¨åˆ†ï¼š</li></ul><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/row_format/COMPACT.drawio.png" alt="img"></p><h3 id="é˜²æ­¢ç´¢å¼•å¤±æ•ˆ">é˜²æ­¢ç´¢å¼•å¤±æ•ˆ</h3><p>ç”¨ä¸Šäº†ç´¢å¼•å¹¶ä¸æ„å‘³ç€æŸ¥è¯¢çš„æ—¶å€™ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿ƒé‡Œè¦æ¸…æ¥šæœ‰å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä»è€Œé¿å…å†™å‡ºç´¢å¼•å¤±æ•ˆçš„æŸ¥è¯¢è¯­å¥ï¼Œå¦åˆ™è¿™æ ·çš„æŸ¥è¯¢æ•ˆç‡æ˜¯å¾ˆä½çš„ã€‚</p><ul><li>å½“æˆ‘ä»¬ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ <code>like %xx</code> æˆ–è€… <code>like %xx%</code>è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼›</li><li>å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—åšäº†è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢æ“ä½œï¼Œè¿™äº›æƒ…å†µä¸‹éƒ½ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼›</li><li>è”åˆç´¢å¼•è¦èƒ½æ­£ç¡®ä½¿ç”¨éœ€è¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>åœ¨ WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ä»€ä¹ˆæ—¶å€™é€‚ç”¨ç´¢å¼•ï¼Ÿ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å­—æ®µæœ‰å”¯ä¸€æ€§é™åˆ¶çš„ï¼Œæ¯”å¦‚å•†å“ç¼–ç ï¼›&lt;/li&gt;
&lt;li&gt;ç»å¸¸ç”¨äº &lt;code&gt;WHERE&lt;/code&gt; æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼Œè¿™æ ·èƒ½å¤Ÿæé«˜æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸æ˜¯ä¸€ä¸ªå­—æ®µï¼Œå¯ä»¥å»ºç«‹è”åˆç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;ç»å¸¸ç”¨äº &lt;</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="ç´¢å¼•" scheme="https://eizo01.github.io/tags/%E7%B4%A2%E5%BC%95/"/>
    
    <category term="sqlä¼˜åŒ–" scheme="https://eizo01.github.io/tags/sql%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>MySQLæ‰§è¡Œè®¡åˆ’</title>
    <link href="https://eizo01.github.io/posts/4c47caa9.html"/>
    <id>https://eizo01.github.io/posts/4c47caa9.html</id>
    <published>2022-10-10T13:00:00.000Z</published>
    <updated>2022-10-20T12:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>MySQLæ‰§è¡Œè®¡åˆ’</strong></h1><h2 id="2-Explainæ‰§è¡Œè®¡åˆ’"><strong>2. Explainæ‰§è¡Œè®¡åˆ’</strong></h2><h3 id="2-1-ä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’"><strong>2.1. ä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’</strong></h3><p>æœ‰äº†æ…¢æŸ¥è¯¢è¯­å¥åï¼Œå°±è¦å¯¹è¯­å¥è¿›è¡Œåˆ†æã€‚ä¸€æ¡æŸ¥è¯¢è¯­å¥åœ¨ç»è¿‡MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨çš„å„ç§åŸºäºæˆæœ¬å’Œè§„åˆ™çš„ä¼˜åŒ–ä¼šåç”Ÿæˆä¸€ä¸ªæ‰€è°“çš„æ‰§è¡Œè®¡åˆ’ï¼Œè¿™ä¸ªæ‰§è¡Œè®¡åˆ’å±•ç¤ºäº†æ¥ä¸‹æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼ï¼Œæ¯”å¦‚å¤šè¡¨è¿æ¥çš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Œå¯¹äºæ¯ä¸ªè¡¨é‡‡ç”¨ä»€ä¹ˆè®¿é—®æ–¹æ³•æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢ç­‰ç­‰ã€‚EXPLAINè¯­å¥æ¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹æŸä¸ªæŸ¥è¯¢è¯­å¥çš„å…·ä½“æ‰§è¡Œè®¡åˆ’ï¼Œæˆ‘ä»¬éœ€è¦ææ‡‚EPLATNEXPLAINçš„å„ä¸ªè¾“å‡ºé¡¹éƒ½æ˜¯å¹²å˜›ä½¿çš„ï¼Œä»è€Œå¯ä»¥æœ‰é’ˆå¯¹æ€§çš„æå‡æˆ‘ä»¬æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½ã€‚</p><p>é€šè¿‡ä½¿ç”¨EXPLAINå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“MySQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥çš„ã€‚åˆ†ææŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ€»çš„æ¥è¯´é€šè¿‡EXPLAINæˆ‘ä»¬å¯ä»¥ï¼š</p><ul><li>è¡¨çš„è¯»å–é¡ºåº</li><li>æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li><li>å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li><li>å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</li><li>è¡¨ä¹‹é—´çš„å¼•ç”¨</li><li>æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</li></ul><h3 id="2-3-æ‰§è¡Œè®¡åˆ’çš„è¯­æ³•"><strong>2.3. æ‰§è¡Œè®¡åˆ’çš„è¯­æ³•</strong></h3><p>æ‰§è¡Œè®¡åˆ’çš„è¯­æ³•å…¶å®éå¸¸ç®€å•ï¼š åœ¨SQLæŸ¥è¯¢çš„å‰é¢åŠ ä¸ŠEXPLAINå…³é”®å­—å°±è¡Œã€‚æ¯”å¦‚ï¼š<code>EXPLAIN select * from table1</code></p><p>é‡ç‚¹çš„å°±æ˜¯EXPLAINåé¢ä½ è¦åˆ†æçš„SQLè¯­å¥</p><p>é™¤äº†ä»¥SELECTå¼€å¤´çš„æŸ¥è¯¢è¯­å¥ï¼Œå…¶ä½™çš„DELETEã€INSERTã€REPLACEä»¥åŠUPOATEè¯­å¥å‰è¾¹éƒ½å¯ä»¥åŠ ä¸ŠEXPLAINï¼Œç”¨æ¥æŸ¥çœ‹è¿™äº›è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¸è¿‡æˆ‘ä»¬è¿™é‡Œå¯¹SELECTè¯­å¥æ›´æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥åè¾¹åªä¼šä»¥SELECTè¯­å¥ä¸ºä¾‹æ¥æè¿°EsxPLAINè¯­å¥çš„ç”¨æ³•ã€‚</p><h3 id="2-4-æ‰§è¡Œè®¡åˆ’è¯¦è§£"><strong>2.4. æ‰§è¡Œè®¡åˆ’è¯¦è§£</strong></h3><p>ä¸ºäº†è®©å¤§å®¶å…ˆæœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œæˆ‘ä»¬æŠŠEXPLAINè¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å…ˆå¤§è‡´ç½—åˆ—ä¸€ä¸‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp;</span><br></pre></td></tr></table></figure><ul><li><p><strong>id</strong> <strong>ï¼š åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­æ¯ä¸ªSELECTå…³é”®å­—éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„id</strong></p></li><li><p><strong>select_type</strong> <strong>ï¼š SELECT å…³é”®å­—å¯¹åº”çš„é‚£ä¸ªæŸ¥è¯¢çš„ç±»å‹</strong></p></li><li><p><strong>table</strong> <strong>ï¼šè¡¨å</strong></p></li><li><p><strong>partitions</strong> <strong>ï¼šåŒ¹é…çš„åˆ†åŒºä¿¡æ¯</strong></p></li><li><p><strong>type</strong> <strong>ï¼šé’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•</strong></p></li><li><p><strong>possible_keys</strong> <strong>ï¼šå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•</strong></p></li><li><p><strong>key</strong> <strong>ï¼šå®é™…ä¸Šä½¿ç”¨çš„ç´¢å¼•</strong></p></li><li><p><strong>key_len</strong> <strong>ï¼šå®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦</strong></p></li><li><p><strong>ref</strong> <strong>ï¼šå½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯</strong></p></li><li><p><strong>rows</strong> <strong>ï¼šé¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡æ•°</strong></p></li><li><p><strong>filtered</strong> <strong>ï¼šæŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯”</strong></p></li><li><p><strong>Extra</strong> <strong>ï¼šâ€”äº›é¢å¤–çš„ä¿¡æ¯</strong></p></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä¸€ä¸ªä¸€ä¸ªå­—æ®µçš„è§£é‡Šï¼Œæ‰§è¡Œè®¡åˆ’æ˜¯æˆ‘ä»¬ä¼˜åŒ–SQLçš„ç¬¬ä¸€æ­¥ã€‚</p><h4 id="2-4-1-id">2.4.1 <strong>id</strong></h4><p>æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬å†™çš„æŸ¥è¯¢è¯­å¥ä¸€èˆ¬éƒ½ä»¥SELECTå…³é”®å­—å¼€å¤´ï¼Œæ¯”è¾ƒç®€å•çš„æŸ¥è¯¢è¯­å¥é‡Œåªæœ‰ä¸€ä¸ªSELECTå…³é”®å­—ï¼Œ</p><p>ç¨å¾®å¤æ‚ä¸€ç‚¹çš„è¿æ¥æŸ¥è¯¢ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ªSELECTå…³é”®å­—ï¼Œæ¯”å¦‚:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span><span class="keyword">FROM</span> s1 </span><br><span class="line"><span class="keyword">INNER</span> J0IN s2 <span class="keyword">ON</span> s1.id <span class="operator">=</span> s2.id </span><br><span class="line"><span class="keyword">WHERE</span> s1.order_status <span class="operator">=</span> <span class="number">0</span> ;</span><br></pre></td></tr></table></figure><p><strong>ä½†æ˜¯ä¸‹è¾¹ä¸¤ç§æƒ…å†µä¸‹åœ¨ä¸€æ¡æŸ¥è¯¢è¯­å¥ä¸­ä¼šå‡ºç°å¤šä¸ªSELECTå…³é”®å­—:</strong></p><ol><li>æŸ¥è¯¢ä¸­åŒ…å«å­æŸ¥è¯¢çš„æƒ…å†µ</li></ol><p>æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­å°±åŒ…å«2ä¸ªSELECTå…³é”®å­—:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span><span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2);</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥è¯¢ä¸­åŒ…å«UNIONè¯­å¥çš„æƒ…å†µ</li></ol><p>æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­ä¹ŸåŒ…å«2ä¸ªSELECTå…³é”®å­—:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2 ;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢è¯­å¥ä¸­æ¯å‡ºç°ä¸€ä¸ªSELECTå…³é”®å­—ï¼ŒMySQLå°±ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„idå€¼ã€‚è¿™ä¸ªidå€¼å°±æ˜¯EXPLAINè¯­å¥çš„ç¬¬ä¸€ä¸ªåˆ—ã€‚</p><h5 id="å•SELECTå…³é”®å­—"><strong>å•SELECTå…³é”®å­—</strong></h5><p>æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ä¸­åªæœ‰ä¸€ä¸ªSELECTå…³é”®å­—ï¼Œæ‰€ä»¥EXPLAINçš„ç»“æœä¸­ä¹Ÿå°±åªæœ‰ä¸€æ¡idåˆ—ä¸º1çš„è®°å½•âˆ¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="è¿æ¥æŸ¥è¯¢"><strong>è¿æ¥æŸ¥è¯¢</strong></h5><p>å¯¹äºè¿æ¥æŸ¥è¯¢æ¥è¯´ï¼Œä¸€ä¸ªSELEOTå…³é”®å­—åè¾¹çš„FROMå­å¥ä¸­å¯ä»¥è·Ÿéšå¤šä¸ªè¡¨ï¼Œæ‰€ä»¥åœ¨è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¿™äº›è®°å½•çš„idå€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Â EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">inner</span> <span class="keyword">join</span> s2;</span><br><span class="line">Â #å³ä½¿ä½ ç”¨äº†å†…è¿æ¥ï¼Œmysqlä»–ä¹Ÿè®¤ä¸ºæ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314163143189.png" alt="image-20230314163143189"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°è¿æ¥æŸ¥è¯¢ä¸­å‚ä¸è¿æ¥çš„s1å’Œs2è¡¨åˆ†åˆ«å¯¹åº”ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¿™ä¸¤æ¡è®°å½•å¯¹åº”çš„idå€¼éƒ½æ˜¯1ã€‚è¿™é‡Œéœ€è¦å¤§å®¶è®°ä½çš„æ˜¯ï¼Œåœ¨è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œè¿™äº›è®°å½•çš„idåˆ—çš„å€¼æ˜¯ç›¸åŒçš„ã€‚</p><h5 id="åŒ…å«å­æŸ¥è¯¢"><strong>åŒ…å«å­æŸ¥è¯¢</strong></h5><p>å¯¹äºåŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œå°±å¯èƒ½æ¶‰åŠå¤šä¸ªSELECTå…³é”®å­—ï¼Œæ‰€ä»¥åœ¨åŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªSELECTå…³é”®å­—éƒ½ä¼šå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„idå€¼ï¼Œæ¯”å¦‚è¿™æ ·:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> s2) <span class="keyword">OR</span> order_no <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314163739963.png" alt="image-20230314163739963"></p><p>ä½†æ˜¯è¿™é‡Œå¤§å®¶éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œ**æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½å¯¹æ¶‰åŠå­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œé‡å†™ï¼Œä»è€Œè½¬æ¢ä¸ºè¿æ¥æŸ¥è¯¢ã€‚**æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸä¸ªåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦è¿›è¡Œäº†é‡å†™ï¼Œç›´æ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’å°±å¥½äº†ï¼Œæ¯”å¦‚è¯´:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> s2 <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1651212459071/6475b28cd68144b89566254b0891a210.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œä½†æ˜¯æ‰§è¡Œè®¡åˆ’ä¸­s1å’Œs2è¡¨å¯¹åº”çš„è®°å½•çš„idå€¼å…¨éƒ¨æ˜¯1ï¼Œ<strong>è¿™å°±è¡¨æ˜äº†æŸ¥è¯¢ä¼˜åŒ–å™¨å°†å­æŸ¥è¯¢è½¬æ¢ä¸ºäº†è¿æ¥æŸ¥è¯¢,</strong></p><h5 id="åŒ…å«UNIONå­å¥"><strong>åŒ…å«UNIONå­å¥</strong></h5><p>å¯¹äºåŒ…å«UNIONå­å¥çš„æŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œæ¯ä¸ªSELECTå…³é”®å­—å¯¹åº”ä¸€ä¸ªidå€¼ä¹Ÿæ˜¯æ²¡é”™çš„ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ç‚¹å„¿ç‰¹åˆ«çš„ä¸œè¥¿ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/5983/1651212459071/4907ca3c4cea47a0add9684f8081acc3.png" alt="image.png"></p><p>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œè®¡åˆ’çš„ç¬¬ä¸‰æ¡è®°å½•ä¸ºä»€ä¹ˆè¿™æ ·ï¼Ÿ<strong>UNIONå­å¥ä¼šæŠŠå¤šä¸ªæŸ¥è¯¢çš„ç»“æœé›†åˆå¹¶èµ·æ¥å¹¶å¯¹ç»“æœé›†ä¸­çš„è®°å½•è¿›è¡Œå»é‡</strong>ï¼Œæ€ä¹ˆå»é‡å‘¢? **MySQLä½¿ç”¨çš„æ˜¯å†…éƒ¨çš„ä¸´æ—¶è¡¨ã€‚**æ­£å¦‚ä¸Šè¾¹çš„æŸ¥è¯¢è®¡åˆ’ä¸­æ‰€ç¤ºï¼ŒUNION å­å¥æ˜¯ä¸ºäº†æŠŠidä¸º1çš„æŸ¥è¯¢å’Œidä¸º2çš„æŸ¥è¯¢çš„ç»“æœé›†åˆå¹¶èµ·æ¥å¹¶å»é‡ã€‚</p><p>æ‰€ä»¥åœ¨å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªåä¸ºçš„ä¸´æ—¶è¡¨ï¼ˆå°±æ˜¯æ‰§è¡Œè®¡åˆ’ç¬¬ä¸‰æ¡è®°å½•çš„tableåˆ—çš„åç§°)ï¼Œidä¸ºNULLè¡¨æ˜è¿™ä¸ªä¸´æ—¶è¡¨æ˜¯ä¸ºäº†åˆå¹¶ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†è€Œåˆ›å»ºçš„ã€‚</p><p>è·ŸUNION å¯¹æ¯”èµ·æ¥ï¼Œ<strong>UNIONALLå°±ä¸éœ€è¦ä¸ºæœ€ç»ˆçš„ç»“æœé›†è¿›è¡Œå»é‡</strong>ï¼Œ<font color="blue"><strong>å®ƒåªæ˜¯å•çº¯çš„æŠŠå¤šä¸ªæŸ¥è¯¢çš„ç»“æœé›†ä¸­çš„è®°å½•åˆå¹¶æˆä¸€ä¸ªå¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚</strong></font>æ‰€ä»¥åœ¨åŒ…å«UNION ALLå­å¥çš„æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œå°±æ²¡æœ‰é‚£ä¸ªidä¸ºNULLçš„è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s2;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314164241278.png" alt="image-20230314164241278"></p><h4 id="2-4-2-select-type"><strong>2.4.2 select_type</strong></h4><ul><li><p><strong>SIMPLE</strong>ï¼šç®€å•çš„selectæŸ¥è¯¢,<strong>ä¸ä½¿ç”¨ union åŠå­æŸ¥è¯¢</strong> ï¼šæœ€å¤–å±‚çš„select æŸ¥è¯¢</p></li><li><p><strong>UNIONï¼šUNION</strong>ä¸­çš„ç¬¬äºŒä¸ªæˆ–éšåçš„ select æŸ¥è¯¢,ä¸ ä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢çš„ç»“æœé›† â€“ UNIONALL</p></li><li><p><strong>UNIONRESULTï¼šUNION</strong> ç»“æœé›†</p></li><li><p><strong>SUBQUERY</strong>ï¼š<strong>å­æŸ¥è¯¢</strong>ä¸­çš„ç¬¬ä¸€ä¸ªselect æŸ¥è¯¢,ä¸ä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢çš„ç»“æœé›†</p></li><li><p><strong>DEPENDENTUNIONï¼šUNION</strong> ä¸­çš„ç¬¬äºŒä¸ªæˆ–éšåçš„ select æŸ¥è¯¢,ä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢çš„ç»“æœé›†</p></li><li><p><strong>DEPENDENTSUBQUERY</strong>ï¼š<strong>å­æŸ¥è¯¢</strong>ä¸­çš„ç¬¬ä¸€ä¸ª select æŸ¥è¯¢,ä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢çš„ç»“æœé›†</p></li><li><p><strong>DERIVED</strong>ï¼šç”¨äº from å­å¥é‡Œæœ‰å­æŸ¥è¯¢çš„æƒ…å†µã€‚ MySQL ä¼š é€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢, æŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚</p></li></ul><h4 id="2-4-3-table"><strong>2.4.3 table</strong></h4><p>ä¸è®ºæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šå¤æ‚ï¼Œé‡Œè¾¹åŒ…å«äº†å¤šå°‘ä¸ªè¡¨ï¼Œåˆ°æœ€åä¹Ÿæ˜¯éœ€è¦å¯¹æ¯ä¸ªè¡¨ è¿›è¡Œå•è¡¨è®¿é—®çš„ï¼ŒMySQLè§„å®šEXPLAINè¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³•ï¼Œè¯¥æ¡è®°å½•çš„tableåˆ—ä»£è¡¨ç€è¯¥è¡¨çš„è¡¨åã€‚</p><img src="HTTP://zdwtop.cn/blog/image-20230314164547476.png" alt="image-20230314164547476" style="zoom:67%;"><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314164553572.png" alt="image-20230314164553572" style="zoom:67%;"></p><p>å¯ä»¥çœ‹è§ï¼Œåªæ¶‰åŠå¯¹s1è¡¨çš„å•è¡¨æŸ¥è¯¢ï¼Œæ‰€ä»¥EXPLAINè¾“å‡ºä¸­åªæœ‰ä¸€æ¡è®°å½•ï¼Œå…¶ä¸­çš„tableåˆ—çš„å€¼æ˜¯s1ï¼Œè€Œè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­æœ‰ä¸¤æ¡è®°å½•ï¼Œè¿™ä¸¤æ¡è®°å½•çš„tableåˆ—åˆ†åˆ«æ˜¯s1å’Œs2.</p><h4 id="2-4-4-partitions">2.4.4 partitions</h4><p>å’Œåˆ†åŒºè¡¨æœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’çš„partitionsåˆ—çš„å€¼éƒ½æ˜¯NULLã€‚</p><h3 id="2-4-5-type"><strong>2.4.5 type</strong></h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ æ‰§è¡Œè®¡åˆ’çš„ä¸€æ¡è®°å½•å°±ä»£è¡¨ç€MySQLå¯¹æŸä¸ªè¡¨çš„æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„è®¿é—®æ–¹æ³•/è®¿é—®ç±»å‹ï¼Œå…¶ä¸­çš„typeåˆ—å°±è¡¨æ˜äº†è¿™ä¸ªè®¿é—®æ–¹æ³•/è®¿é—®ç±»å‹æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š</p><p>å‡ºç°æ¯”è¾ƒå¤šçš„æ˜¯    <code> system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</code></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<font color="blue"><strong>å¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°refã€‚</strong></font></p><h4 id="2-4-5-1-system">2.4.5.1 system</h4><p>å½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•å¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚MyISAMã€Memoryï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯systemã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test_myisam;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314165235705.png" alt="image-20230314165235705"></p><p>å½“ç„¶ï¼Œå¦‚æœæ”¹æˆä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ï¼Œè¯•è¯•çœ‹æ‰§è¡Œè®¡åˆ’çš„typeåˆ—çš„å€¼æ˜¯ä»€ä¹ˆã€‚</p><p><img src="HTTP://zdwtop.cn/blog/image-20230314165240265.png" alt="image-20230314165240265"></p><h4 id="2-4-5-2-const"><strong>2.4.5.2 const</strong></h4><p><font color="blue"><strong>å°±æ˜¯å½“æˆ‘ä»¬æ ¹æ®ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯constã€‚</strong></font>å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚</p><p>ä¾‹å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">716</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314165636024.png" alt="image-20230314165636024"></p><p>B+æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—æ’åºçš„ï¼Œå¯¹äºçš„èšç°‡ç´¢å¼•æ¥è¯´ï¼Œå®ƒå¯¹åº”çš„B+æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•å°±æ˜¯æŒ‰ç…§idåˆ—æ’åºçš„ã€‚B+æ ‘çŸ®èƒ–ï¼Œæ‰€ä»¥è¿™æ ·æ ¹æ®ä¸»é”®å€¼å®šä½ä¸€æ¡è®°å½•çš„é€Ÿåº¦å¾ˆå¿«ã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æ ¹æ®å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—æ¥å®šä½ä¸€æ¡è®°å½•çš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«çš„ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ä¼ª<span class="keyword">sql</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time<span class="operator">=</span>â€™â€™ <span class="keyword">and</span> order_status<span class="operator">=</span>â€™â€™ <span class="keyword">and</span> expire_time<span class="operator">=</span>â€™â€™ ;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œåˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥å…ˆä»<strong>u_idx_day_status</strong>å¯¹åº”çš„B+æ ‘ç´¢å¼•ä¸­æ ¹æ®ç´¢å¼•åˆ—ä¸å¸¸æ•°çš„ç­‰å€¼æ¯”è¾ƒæ¡ä»¶å®šä½åˆ°ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå†æ ¹æ®è¯¥è®°å½•çš„idå€¼åˆ°èšç°‡ç´¢å¼•ä¸­è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>MySQLæŠŠè¿™ç§é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—æ¥å®šä½ä¸€æ¡è®°å½•çš„è®¿é—®æ–¹æ³•å®šä¹‰ä¸ºï¼š<font color="blue"><strong>constï¼Œæ„æ€æ˜¯å¸¸æ•°çº§åˆ«çš„ï¼Œä»£ä»·æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚</strong></font></p><p>ä¸è¿‡è¿™ç§<strong>constè®¿é—®æ–¹æ³•åªèƒ½åœ¨ä¸»é”®åˆ—æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—å’Œä¸€ä¸ªå¸¸æ•°è¿›è¡Œç­‰å€¼æ¯”è¾ƒæ—¶</strong>æ‰æœ‰æ•ˆï¼Œå¦‚æœä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•æ˜¯ç”±å¤šä¸ªåˆ—æ„æˆçš„è¯ï¼Œç»„æˆç´¢å¼•çš„æ¯ä¸€ä¸ªåˆ—éƒ½æ˜¯ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼æ¯”è¾ƒæ—¶ï¼Œè¿™ä¸ªconstè®¿é—®æ–¹æ³•æ‰æœ‰æ•ˆã€‚</p><p>å¯¹äºå”¯ä¸€äºŒçº§ç´¢å¼•æ¥è¯´ï¼ŒæŸ¥è¯¢è¯¥åˆ—ä¸ºNULLå€¼çš„æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºå”¯ä¸€å’ŒäºŒçº§ç´¢å¼•åˆ—å¹¶ä¸é™åˆ¶ NULL å€¼çš„æ•°é‡ï¼Œæ‰€ä»¥ä¸Šè¿°è¯­å¥å¯èƒ½è®¿é—®åˆ°å¤šæ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>is nullä¸å¯ä»¥ä½¿ç”¨constè®¿é—®æ–¹æ³•æ¥æ‰§è¡Œã€‚</strong></p><h4 id="2-4-5-3-eq-ref-è¿æ¥æŸ¥è¯¢">2.4.5.3 eq_ref è¿æ¥æŸ¥è¯¢</h4><p>åœ¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡Œè®¿é—®çš„ã€ˆå¦‚æœ<strong>è¯¥ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•æ˜¯è”åˆç´¢å¼•çš„è¯ï¼Œæ‰€æœ‰çš„ç´¢å¼•åˆ—éƒ½å¿…é¡»è¿›è¡Œç­‰å€¼æ¯”è¾ƒ</strong>)ï¼Œåˆ™å¯¹è¯¥è¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯eq_refã€‚</p><p>(<strong>é©±åŠ¨è¡¨ä¸è¢«é©±åŠ¨è¡¨ï¼š</strong> <strong>Aè¡¨å’ŒBè¡¨joinè¿æ¥æŸ¥è¯¢ï¼Œå¦‚æœé€šè¿‡Aè¡¨çš„ç»“æœé›†ä½œä¸ºå¾ªç¯åŸºç¡€æ•°æ®ï¼Œç„¶åä¸€æ¡ä¸€æ¡åœ°é€šè¿‡è¯¥ç»“æœé›†ä¸­çš„æ•°æ®ä½œä¸ºè¿‡æ»¤æ¡ä»¶åˆ°Bè¡¨ä¸­æŸ¥è¯¢æ•°æ®ï¼Œç„¶ååˆå¹¶ç»“æœã€‚é‚£ä¹ˆæˆ‘ä»¬ç§°Aè¡¨ä¸ºé©±åŠ¨è¡¨ï¼ŒBè¡¨ä¸ºè¢«é©±åŠ¨è¡¨</strong>)</p><p>æ¯”æ–¹è¯´:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.id = s2.id;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314172316367.png" alt="image-20230314172316367"></p><p>ä»æ‰§è¡Œè®¡åˆ’çš„ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼ŒMySQLæ‰“ç®—å°†s2ä½œä¸ºé©±åŠ¨è¡¨ï¼Œs1ä½œä¸ºè¢«é©±åŠ¨è¡¨ï¼Œé‡ç‚¹å…³æ³¨s1çš„è®¿é—®æ–¹æ³•æ˜¯eq_refï¼Œè¡¨æ˜åœ¨è®¿é—®s1è¡¨çš„æ—¶å€™å¯ä»¥é€šè¿‡ä¸»é”®çš„ç­‰å€¼åŒ¹é…æ¥è¿›è¡Œè®¿é—®ã€‚</p><h4 id="2-4-5-4-ref"><strong>2.4.5.4 ref</strong></h4><p><font color="blue"><strong>å½“é€šè¿‡æ™®é€šçš„äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶æ¥æŸ¥è¯¢æŸä¸ªè¡¨ï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±å¯èƒ½æ˜¯refã€‚</strong></font></p><p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œï¼Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä»–å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314172518630.png" alt="image-20230314172518630"></p><p>å¯¹äºè¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é€‰æ‹©å…¨è¡¨æ‰«ææ¥é€ä¸€å¯¹æ¯”æœç´¢æ¡ä»¶æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆä½¿ç”¨äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”è®°å½•çš„idå€¼ï¼Œç„¶åå†å›è¡¨åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>ç”±äºæ™®é€šäºŒçº§ç´¢å¼•å¹¶ä¸é™åˆ¶ç´¢å¼•åˆ—å€¼çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥å¯èƒ½æ‰¾åˆ°å¤šæ¡å¯¹åº”çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨äºŒçº§ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢çš„ä»£ä»·å–å†³äºç­‰å€¼åŒ¹é…åˆ°çš„äºŒçº§ç´¢å¼•è®°  å½•æ¡æ•°ã€‚å¦‚æœåŒ¹é…çš„è®°å½•è¾ƒå°‘ï¼Œåˆ™å›è¡¨çš„ä»£ä»·è¿˜æ˜¯æ¯”è¾ƒä½çš„ï¼Œæ‰€ä»¥MySQLå¯èƒ½é€‰æ‹©ä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚è¿™ç§æœç´¢æ¡ä»¶ä¸ºäºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°ç­‰å€¼æ¯”è¾ƒï¼Œé‡‡ç”¨äºŒçº§ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢çš„è®¿é—®æ–¹æ³•ç§°ä¸ºï¼šrefã€‚</p><p><strong>å¯¹äºæ™®é€šçš„äºŒçº§ç´¢å¼•æ¥è¯´ï¼Œé€šè¿‡ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼æ¯”è¾ƒåå¯èƒ½åŒ¹é…åˆ°å¤šæ¡è¿ç»­çš„è®°å½•ï¼Œè€Œä¸æ˜¯åƒä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•é‚£æ ·æœ€å¤šåªèƒ½åŒ¹é…1æ¡è®°å½•ï¼Œæ‰€ä»¥è¿™ç§refè®¿é—®æ–¹æ³•æ¯”constè¦å·®äº›ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ç­‰å€¼æ¯”è¾ƒæ—¶åŒ¹é…çš„è®°å½•æ•°è¾ƒå°‘æ—¶çš„æ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„</strong>ï¼ˆå¦‚æœåŒ¹é…çš„äºŒçº§ç´¢å¼•è®°å½•å¤ªå¤šé‚£ä¹ˆå›è¡¨çš„æˆæœ¬å°±å¤ªå¤§äº†ï¼‰ã€‚</p><h4 id="2-4-5-5-range">2.4.5.5 range</h4><p><font color="blue"><strong>å¦‚æœä½¿ç”¨ç´¢å¼•è·å–æŸäº›èŒƒå›´åŒºé—´çš„è®°å½•ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä½¿ç”¨åˆ°rangeè®¿é—®æ–¹æ³•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„whereè¯­å¥ä¸­å‡ºç°äº†betweenã€&lt;ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ã€‚</strong></font></p><p>è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ‰«ææ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸè¯­å¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>); EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">AND</span> order_no <span class="operator">&lt;</span> <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314173014169.png" alt="image-20230314173014169"></p><p>è¿™ç§åˆ©ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´åŒ¹é…çš„è®¿é—®æ–¹æ³•ç§°ä¹‹ä¸ºï¼šrangeã€‚</p><p>æ­¤å¤„æ‰€è¯´çš„ä½¿ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´åŒ¹é…ä¸­çš„ ç´¢å¼• å¯ä»¥æ˜¯èšç°‡ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒçº§ç´¢å¼•ã€‚</p><h4 id="2-4-5-6-index"><strong>2.4.5.6 index</strong></h4><p>å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨çš„ç´¢å¼•è®°å½•æ—¶ï¼Œè¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯indexã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> insert_time <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> expire_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:36:47&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314173032226.png" alt="image-20230314173032226"></p><h4 id="2-4-5-7-all"><strong>2.4.5.7 all</strong></h4><p><strong>æœ€ç†Ÿæ‚‰çš„å…¨è¡¨æ‰«æï¼Œå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314173048781.png" alt="image-20230314173048781"></p><h4 id="2-4-6-possible-keysä¸key"><strong>2.4.6 possible_keysä¸key</strong></h4><p>åœ¨EXPLAIN è¯­å¥è¾“å‡ºçš„æ‰§è¡Œè®¡åˆ’ä¸­,possible_keysåˆ—è¡¨ç¤ºåœ¨æŸä¸ªæŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¯¹æŸä¸ªè¡¨æ‰§è¡Œå•è¡¨æŸ¥è¯¢æ—¶å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•æœ‰å“ªäº›ï¼Œkeyåˆ—è¡¨ç¤ºå®é™…ç”¨åˆ°çš„ç´¢å¼•æœ‰å“ªäº›ï¼Œå¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢:ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> order_note <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> insert_time <span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:36:47&#x27;</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314173101529.png" alt="image-20230314173101529"></p><p>ä¸Šè¿°æ‰§è¡Œè®¡åˆ’çš„possible keysåˆ—çš„å€¼è¡¨ç¤ºè¯¥æŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°u_idx_day_status,idx_insert_timeä¸¤ä¸ªç´¢å¼•ï¼Œç„¶åkeyåˆ—çš„å€¼æ˜¯u_idx_day_statusï¼Œè¡¨ç¤ºç»è¿‡æŸ¥è¯¢ä¼˜åŒ–å™¨è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•çš„æˆæœ¬åï¼Œæœ€åå†³å®šä½¿ç”¨u_idx_day_statusæ¥æ‰§è¡ŒæŸ¥è¯¢æ¯”è¾ƒåˆ’ç®—ã€‚</p><h4 id="2-4-7-key-len"><strong>2.4.7 key_len</strong></h4><p><strong>key_lenåˆ—è¡¨ç¤ºå½“ä¼˜åŒ–å™¨å†³å®šä½¿ç”¨æŸä¸ªç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œè¯¥ç´¢å¼•è®°å½•çš„æœ€å¤§é•¿åº¦ï¼Œè®¡ç®—æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š</strong></p><p>å¯¹äºä½¿ç”¨å›ºå®šé•¿åº¦ç±»å‹çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œå®ƒå®é™…å ç”¨çš„å­˜å‚¨ç©ºé—´çš„æœ€å¤§é•¿åº¦å°±æ˜¯è¯¥å›ºå®šå€¼ï¼Œå¯¹äºæŒ‡å®šå­—ç¬¦é›†çš„å˜é•¿ç±»å‹çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œæ¯”å¦‚æŸä¸ªç´¢å¼•åˆ—çš„ç±»å‹æ˜¯VARCHAR(100)ï¼Œä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯utf8ï¼Œé‚£ä¹ˆè¯¥åˆ—å®é™…å ç”¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´å°±æ˜¯100 x 3 = 300ä¸ªå­—èŠ‚ã€‚</p><p><font color="blue"><strong>å¦‚æœè¯¥ç´¢å¼•åˆ—å¯ä»¥å­˜å‚¨NULLå€¼ï¼Œåˆ™key_lenæ¯”ä¸å¯ä»¥å­˜å‚¨NULLå€¼æ—¶å¤š1ä¸ªå­—èŠ‚ã€‚</strong></font></p><p>å¯¹äºå˜é•¿å­—æ®µæ¥è¯´ï¼Œéƒ½ä¼šæœ‰2ä¸ªå­—èŠ‚çš„ç©ºé—´æ¥å­˜å‚¨è¯¥å˜é•¿åˆ—çš„å®é™…é•¿åº¦ã€‚</p><p>â½å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">718</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314173238109.png" alt="image-20230314173238109"></p><p>ç”±äºidåˆ—çš„ç±»å‹æ˜¯bigintï¼Œå¹¶ä¸”ä¸å¯ä»¥å­˜å‚¨NULLå€¼ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¯¥åˆ—çš„ç´¢å¼•æ—¶ke  y_lenå¤§å°å°±æ˜¯8ã€‚</p><p>å¯¹äºå¯å˜é•¿åº¦çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314173308431.png" alt="image-20230314173308431"></p><p>ç”±äºorder_noåˆ—çš„ç±»å‹æ˜¯VARCHAR(50)ï¼Œæ‰€ä»¥è¯¥åˆ—å®é™…æœ€å¤šå ç”¨çš„å­˜å‚¨ç©ºé—´å°±æ˜¯50*3å­—èŠ‚ï¼Œåˆå› ä¸ºè¯¥åˆ—æ˜¯å¯å˜é•¿åº¦åˆ—ï¼Œæ‰€ä»¥key_lenéœ€è¦åŠ 2ï¼Œæ‰€ä»¥æœ€åken_lençš„å€¼å°±æ˜¯152ã€‚</p><p>MySQLåœ¨æ‰§è¡Œè®¡åˆ’ä¸­è¾“å‡ºkey_lenåˆ—ä¸»è¦æ˜¯ä¸ºäº†è®©æˆ‘ä»¬åŒºåˆ†æŸä¸ªä½¿ç”¨è”åˆç´¢å¼•çš„æŸ¥è¯¢å…·ä½“ç”¨äº†å‡ ä¸ªç´¢å¼•åˆ—(å¤åˆç´¢å¼•æœ‰æœ€å·¦å‰ç¼€çš„ç‰¹æ€§ï¼Œå¦‚æœå¤åˆç´¢å¼•èƒ½å…¨éƒ¨ä½¿ç”¨ä¸Šï¼Œåˆ™æ˜¯å¤åˆç´¢å¼•å­—æ®µçš„ç´¢å¼•é•¿åº¦ä¹‹å’Œï¼Œè¿™ä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤å®šå¤åˆç´¢å¼•æ˜¯å¦éƒ¨åˆ†ä½¿ç”¨ï¼Œè¿˜æ˜¯å…¨éƒ¨ä½¿ç”¨)ï¼Œè€Œä¸æ˜¯ä¸ºäº†å‡†ç¡®çš„è¯´æ˜é’ˆå¯¹æŸä¸ªå…·ä½“å­˜å‚¨å¼•æ“å­˜å‚¨å˜é•¿å­—æ®µçš„å®é™…é•¿åº¦å ç”¨çš„ç©ºé—´åˆ°åº•æ˜¯å ç”¨1ä¸ªå­—èŠ‚è¿˜æ˜¯2ä¸ªå­—èŠ‚ã€‚</p><h4 id="2-4-8-rows"><strong>2.4.8 rows</strong></h4><p>å¦‚æœæŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®šä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼å¯¹æŸä¸ªè¡¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ‰§è¡Œè®¡åˆ’çš„rowsåˆ—å°±ä»£è¡¨é¢„è®¡éœ€è¦æ‰«æçš„è¡Œæ•°ï¼Œå¦‚æœä½¿ç”¨ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ‰§è¡Œè®¡åˆ’çš„rowsåˆ—å°±ä»£è¡¨é¢„è®¡æ‰«æçš„ç´¢å¼•è®°å½•è¡Œæ•°ã€‚æ¯”å¦‚ä¸‹è¾¹ä¸¤ä¸ªä¸ªæŸ¥è¯¢:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;z&#x27;</span>; EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> order_no <span class="operator">&gt;</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314173434845.png" alt="image-20230314173434845"></p><p>æˆ‘ä»¬çœ‹åˆ°æ‰§è¡Œè®¡åˆ’çš„rowsåˆ—çš„å€¼æ˜¯åˆ†åˆ«æ˜¯1å’Œ10573ï¼Œè¿™æ„å‘³ç€æŸ¥è¯¢ä¼˜åŒ–å™¨åœ¨ç»è¿‡åˆ†æä½¿ç”¨idx_order_noè¿›è¡ŒæŸ¥è¯¢çš„æˆæœ¬ä¹‹åï¼Œè§‰å¾—æ»¡è¶³order_no&gt; â€™ z 'è¿™ä¸ªæ¡ä»¶çš„è®°å½•åªæœ‰1æ¡ï¼Œè§‰å¾—æ»¡è¶³order_no&gt; â€™ a 'è¿™ä¸ªæ¡ä»¶çš„è®°å½•æœ‰10573æ¡ã€‚</p><h4 id="2-4-9-filtered"><strong>2.4.9 filtered</strong></h4><p>æŸ¥è¯¢ä¼˜åŒ–å™¨é¢„æµ‹æœ‰å¤šå°‘æ¡è®°å½•æ»¡â¾œå…¶ä½™çš„æœç´¢æ¡ä»¶ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿçœ‹å…·ä½“çš„è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">5890</span> <span class="keyword">AND</span> order_note <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä»æ‰§è¡Œè®¡åˆ’çš„keyåˆ—ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¯¥æŸ¥è¯¢ä½¿ç”¨ PRIMARYç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œä»rowsåˆ—å¯ä»¥çœ‹å‡ºæ»¡è¶³id &gt; 5890çš„è®°å½•æœ‰5286æ¡ã€‚æ‰§è¡Œè®¡åˆ’çš„filteredåˆ—å°±ä»£è¡¨æŸ¥è¯¢ä¼˜åŒ–å™¨é¢„æµ‹åœ¨è¿™5286æ¡è®°å½•ä¸­ï¼Œæœ‰å¤šå°‘æ¡è®°å½•æ»¡è¶³å…¶ä½™çš„æœç´¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯order_note = 'aâ€™è¿™ä¸ªæ¡ä»¶çš„ç™¾åˆ†æ¯”ã€‚æ­¤å¤„filteredåˆ—çš„å€¼æ˜¯10.0ï¼Œè¯´æ˜æŸ¥è¯¢ä¼˜åŒ–å™¨é¢„æµ‹åœ¨5286æ¡è®°å½•ä¸­æœ‰10.00%çš„è®°å½•æ»¡è¶³order_note = 'aâ€™è¿™ä¸ªæ¡ä»¶ã€‚</p><p>å¯¹äºå•è¡¨æŸ¥è¯¢æ¥è¯´ï¼Œè¿™ä¸ªfilteredåˆ—çš„å€¼æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œæˆ‘ä»¬æ›´å…³æ³¨åœ¨è¿æ¥æŸ¥è¯¢ä¸­é©±åŠ¨è¡¨å¯¹åº”çš„æ‰§è¡Œè®¡åˆ’è®°å½•çš„filteredå€¼ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> s1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> s2 <span class="keyword">ON</span> s1.order_no <span class="operator">=</span> s2.order_no <span class="keyword">WHERE</span> s1.order_note <span class="operator">&gt;</span> <span class="string">&#x27;ä½ å¥½ï¼Œæç„•è‹±&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="HTTP://zdwtop.cn/blog/image-20230314173456971.png" alt="image-20230314173456971"></p><p>ä»æ‰§è¡Œè®¡åˆ’ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨æ‰“ç®—æŠŠs1å½“ä½œé©±åŠ¨è¡¨ï¼Œs2å½“ä½œè¢«é©±åŠ¨è¡¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é©±åŠ¨è¡¨s1è¡¨çš„æ‰§è¡Œè®¡åˆ’çš„rowsåˆ—ä¸º10573ï¼Œfilteredåˆ—ä¸º33.33 ï¼Œè¿™æ„å‘³ç€é©±åŠ¨è¡¨s1çš„æ‰‡å‡ºå€¼å°±æ˜¯10573 x 33.33 % = 3524.3ï¼Œè¿™è¯´æ˜è¿˜è¦å¯¹è¢«é©±åŠ¨è¡¨æ‰§è¡Œå¤§çº¦3524æ¬¡æŸ¥è¯¢ã€‚</p><h4 id="2-4-10-Extra"><strong>2.4.10 Extra</strong></h4><p>é¡¾åæ€ä¹‰ï¼ŒExtraåˆ—æ˜¯ç”¨æ¥è¯´æ˜ä¸€äº›é¢å¤–ä¿¡æ¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›é¢å¤–ä¿¡æ¯æ¥æ›´å‡†ç¡®çš„ç†è§£MySQLåˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥</p><h2 id="3-æŸ¥è¯¢ä¼˜åŒ–å™¨"><strong>3. æŸ¥è¯¢ä¼˜åŒ–å™¨</strong></h2><p>åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¼šç»å†æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä¼˜åŒ–ã€‚</p><p>ä¸€æ¡SQLè¯­å¥åœ¨MySQLæ‰§è¡Œçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<a href="note://WEB3e268b96236aa0be2836098b82f482b6">ä¸€æ¡sqlçš„æ‰§è¡Œ</a></p><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314173545770.png" alt="image-20230314173545770"></p><ul><li><p>è¿æ¥å™¨ï¼šå»ºç«‹è¿æ¥ï¼Œç®¡ç†è¿æ¥ã€æ ¡éªŒç”¨æˆ·èº«ä»½ï¼›</p></li><li><p>æŸ¥è¯¢ç¼“å­˜ï¼šæŸ¥è¯¢è¯­å¥å¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚MySQL 8.0 å·²åˆ é™¤è¯¥æ¨¡å—ï¼›</p></li><li><p>è§£æ SQLï¼Œé€šè¿‡è§£æå™¨å¯¹ SQL æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œç„¶åæ„å»ºè¯­æ³•æ ‘ï¼Œæ–¹ä¾¿åç»­æ¨¡å—è¯»å–è¡¨åã€å­—æ®µã€è¯­å¥ç±»å‹ï¼›</p></li><li><p>æ‰§è¡Œ SQLï¼šæ‰§è¡Œ SQL å…±æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š</p></li><li><ul><li>é¢„å¤„ç†é˜¶æ®µï¼šæ£€æŸ¥è¡¨æˆ–å­—æ®µæ˜¯å¦å­˜åœ¨ï¼›å°† select * ä¸­çš„ * ç¬¦å·æ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ã€‚</li><li>ä¼˜åŒ–é˜¶æ®µï¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œ é€‰æ‹©æŸ¥è¯¢æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼›</li><li>æ‰§è¡Œé˜¶æ®µï¼šæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li></ul></li></ul><p>â€‹    <img src="HTTP://zdwtop.cn/blog/image-20230314173551430.png" alt="image-20230314173551430"></p><p>1.å¦‚æœæ˜¯æŸ¥è¯¢è¯­å¥ï¼ˆselectè¯­å¥ï¼‰ï¼Œé¦–å…ˆä¼šæŸ¥è¯¢ç¼“å­˜æ˜¯å¦å·²æœ‰ç›¸åº”ç»“æœï¼Œæœ‰åˆ™è¿”å›ç»“æœï¼Œæ— åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼ˆå¦‚æœä¸æ˜¯æŸ¥è¯¢è¯­å¥ï¼ŒåŒæ ·è°ƒåˆ°ä¸‹ä¸€æ­¥ï¼‰</p><p>2.è§£ææŸ¥è¯¢ï¼Œåˆ›å»ºä¸€ä¸ªå†…éƒ¨æ•°æ®ç»“æ„ï¼ˆè§£ææ ‘ï¼‰ï¼Œè¿™ä¸ªè§£ææ ‘ä¸»è¦ç”¨æ¥SQLè¯­å¥çš„è¯­ä¹‰ä¸è¯­æ³•è§£æï¼›</p><p>ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œ<strong>è¯æ³•åˆ†æ</strong>ã€‚MySQL ä¼šæ ¹æ®ä½ è¾“å…¥çš„å­—ç¬¦ä¸²è¯†åˆ«å‡ºå…³é”®å­—å‡ºæ¥ï¼Œæ„å»ºå‡º SQL è¯­æ³•æ ‘ï¼Œè¿™æ ·æ–¹ä¾¿åé¢æ¨¡å—è·å– SQL ç±»å‹ã€è¡¨åã€å­—æ®µåã€ where æ¡ä»¶ç­‰ç­‰ã€‚</p><p>ç¬¬äºŒä»¶äº‹æƒ…ï¼Œ<strong>è¯­æ³•åˆ†æ</strong>ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•è§£æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•ã€‚</p><p>3.æ‰§è¡Œ SQLï¼šä¼˜åŒ–SQLè¯­å¥ï¼Œä¾‹å¦‚é‡å†™æŸ¥è¯¢ï¼Œå†³å®šè¡¨çš„è¯»å–é¡ºåºï¼Œä»¥åŠé€‰æ‹©éœ€è¦çš„ç´¢å¼•ç­‰ã€‚è¿™ä¸€é˜¶æ®µç”¨æˆ·æ˜¯å¯ä»¥æŸ¥è¯¢çš„ï¼ŒæŸ¥è¯¢æœåŠ¡å™¨ä¼˜åŒ–å™¨æ˜¯å¦‚ä½•è¿›è¡Œä¼˜åŒ–çš„ï¼Œä¾¿äºç”¨æˆ·é‡æ„æŸ¥è¯¢å’Œä¿®æ”¹ç›¸å…³é…ç½®ï¼Œè¾¾åˆ°æœ€ä¼˜åŒ–ã€‚ä¸€é˜¶æ®µè¿˜æ¶‰åŠåˆ°å­˜å‚¨å¼•æ“ï¼Œä¼˜åŒ–å™¨ä¼šè¯¢é—®å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚æŸä¸ªæ“ä½œçš„å¼€é”€ä¿¡æ¯ã€æ˜¯å¦å¯¹ç‰¹å®šç´¢å¼•æœ‰æŸ¥è¯¢ä¼˜åŒ–ç­‰ã€‚</p><p>æ¯æ¡<code>SELECT</code> æŸ¥è¯¢è¯­å¥æµç¨‹ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‹é¢è¿™ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li><p>prepare é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯é¢„å¤„ç†é˜¶æ®µï¼›</p></li><li><ul><li>æ£€æŸ¥ SQL æŸ¥è¯¢è¯­å¥ä¸­çš„è¡¨æˆ–è€…å­—æ®µæ˜¯å¦å­˜åœ¨ï¼›</li></ul></li><li><ul><li>å°† select * ä¸­çš„ * ç¬¦å·ï¼Œæ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ï¼›</li></ul></li><li><p>optimize é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¼˜åŒ–é˜¶æ®µï¼›</p></li><li><ul><li>é‡å†™æŸ¥è¯¢ï¼Œå†³å®šè¡¨çš„è¯»å–é¡ºåºï¼Œä»¥åŠé€‰æ‹©éœ€è¦çš„ç´¢å¼•</li></ul></li><li><p>execute é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œé˜¶æ®µï¼›</p></li><li><ul><li>è¿™ä¸ªå·¥ä½œæ˜¯ç”±ã€Œæ‰§è¡Œå™¨ã€å®Œæˆçš„ã€‚åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå™¨å°±ä¼šå’Œå­˜å‚¨å¼•æ“äº¤äº’äº†ï¼Œäº¤äº’æ˜¯ä»¥è®°å½•ä¸ºå•ä½çš„ã€‚</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;MySQLæ‰§è¡Œè®¡åˆ’&lt;/strong&gt;&lt;/h1&gt;
&lt;h2 id=&quot;2-Explainæ‰§è¡Œè®¡åˆ’&quot;&gt;&lt;strong&gt;2. Explainæ‰§è¡Œè®¡åˆ’&lt;/strong&gt;&lt;/h2&gt;
&lt;h3 id=&quot;2-1-ä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’&quot;&gt;&lt;strong&gt;2.1. ä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’&lt;/s</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="æ‰§è¡Œè®¡åˆ’" scheme="https://eizo01.github.io/tags/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>MySQLæ…¢æŸ¥è¯¢</title>
    <link href="https://eizo01.github.io/posts/b141163c.html"/>
    <id>https://eizo01.github.io/posts/b141163c.html</id>
    <published>2022-10-09T12:30:00.000Z</published>
    <updated>2022-10-21T12:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>MySQLè°ƒä¼˜é‡‘å­—å¡”</strong></h1><p>æ•´ä½“ä»‹ç»MySQLçš„è°ƒä¼˜çš„é€‰æ‹©ï¼Œç®€å•äº†è§£å³å¯ã€‚</p><p><img src="HTTP://zdwtop.cn/blog/image-20230314174431189.png" alt="image-20230314174431189"></p><p>å¾ˆæ˜æ˜¾ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œè¶Šå¾€ä¸Šèµ°ï¼Œéš¾åº¦è¶Šæ¥è¶Šé«˜ï¼Œæ”¶ç›Šå´æ˜¯è¶Šæ¥è¶Šå°çš„ã€‚</p><p>å¯¹äº<strong>æ¶æ„è°ƒä¼˜</strong>ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡æ—¶é¦–å…ˆéœ€è¦å……åˆ†è€ƒè™‘ä¸šåŠ¡çš„å®é™…æƒ…å†µï¼Œæ˜¯å¦å¯ä»¥æŠŠä¸é€‚åˆæ•°æ®åº“åšçš„äº‹æƒ…æ”¾åˆ°æ•°æ®ä»“åº“ã€æœç´¢å¼•æ“æˆ–è€…ç¼“å­˜ä¸­å»åšï¼›ç„¶åè€ƒè™‘å†™çš„å¹¶å‘é‡æœ‰å¤šå¤§ï¼Œæ˜¯å¦éœ€è¦é‡‡ç”¨åˆ†å¸ƒå¼ï¼›æœ€åè€ƒè™‘è¯»çš„å‹åŠ›æ˜¯å¦å¾ˆå¤§ï¼Œæ˜¯å¦éœ€è¦è¯»å†™åˆ†ç¦»ã€‚å¯¹äºæ ¸å¿ƒåº”ç”¨æˆ–è€…é‡‘èç±»çš„åº”ç”¨ï¼Œéœ€è¦é¢å¤–è€ƒè™‘æ•°æ®å®‰å…¨å› ç´ ï¼Œæ•°æ®æ˜¯å¦ä¸å…è®¸ä¸¢å¤±ã€‚æ‰€ä»¥åœ¨è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œé¦–å…ˆéœ€è¦å…³æ³¨å’Œä¼˜åŒ–çš„åº”è¯¥æ˜¯æ¶æ„ï¼Œå¦‚æœæ¶æ„ä¸åˆç†ï¼Œå³ä½¿æ˜¯DBAèƒ½åšçš„äº‹æƒ…å…¶å®æ˜¯ä¹Ÿæ˜¯æ¯”è¾ƒæœ‰é™çš„ã€‚</p><p>å¯¹äº<strong>MySQLè°ƒä¼˜</strong>ï¼Œéœ€è¦ç¡®è®¤ä¸šåŠ¡è¡¨ç»“æ„è®¾è®¡æ˜¯å¦åˆç†ï¼ŒSQLè¯­å¥ä¼˜åŒ–æ˜¯å¦è¶³å¤Ÿï¼Œè¯¥æ·»åŠ çš„ç´¢å¼•æ˜¯å¦éƒ½æ·»åŠ äº†ï¼Œæ˜¯å¦å¯ä»¥å‰”é™¤å¤šä½™çš„ç´¢å¼•ç­‰ç­‰</p><p>æ¯”å¦‚<strong>ç¡¬ä»¶å’ŒOSè°ƒä¼˜</strong>ï¼Œéœ€è¦å¯¹ç¡¬ä»¶å’ŒOSæœ‰ç€éå¸¸æ·±åˆ»çš„äº†è§£ï¼Œä»…ä»…å°±ç£ç›˜ä¸€é¡¹æ¥è¯´ï¼Œä¸€èˆ¬éDBAèƒ½æƒ³åˆ°çš„è°ƒæ•´å°±æ˜¯SSDç›˜æ¯”ç”¨æœºæ¢°ç¡¬ç›˜æ›´å¥½ã€‚DBAçº§åˆ«è€ƒè™‘çš„è‡³å°‘åŒ…æ‹¬äº†ï¼Œä½¿ç”¨ä»€ä¹ˆæ ·çš„ç£ç›˜é˜µåˆ—ï¼ˆRAIDï¼‰çº§åˆ«ã€æ˜¯å¦å¯ä»¥åˆ†æ•£ç£ç›˜IOã€æ˜¯å¦ä½¿ç”¨è£¸è®¾å¤‡å­˜æ”¾æ•°æ®ï¼Œä½¿ç”¨å“ªç§æ–‡ä»¶ç³»ç»Ÿï¼ˆç›®å‰æ¯”è¾ƒæ¨èçš„æ˜¯XFSï¼‰ï¼Œæ“ä½œç³»ç»Ÿçš„ç£ç›˜è°ƒåº¦ç®—æ³•é€‰æ‹©ï¼Œæ˜¯å¦éœ€è¦è°ƒæ•´æ“ä½œç³»ç»Ÿæ–‡ä»¶ç®¡ç†æ–¹é¢æ¯”å¦‚atimeå±æ€§ç­‰ç­‰ã€‚</p><p>æ‰€ä»¥æœ¬ç« æˆ‘ä»¬é‡ç‚¹å…³æ³¨MySQLæ–¹é¢çš„è°ƒä¼˜ï¼Œç‰¹åˆ«æ˜¯ç´¢å¼•ã€‚SQL/ç´¢å¼•è°ƒä¼˜è¦æ±‚å¯¹ä¸šåŠ¡å’Œæ•°æ®æµéå¸¸æ¸…æ¥šã€‚</p><blockquote><p>åœ¨é˜¿é‡Œå·´å·´å†…éƒ¨ï¼Œæœ‰ä¸‰åˆ†ä¹‹äºŒçš„DBAæ˜¯ä¸šåŠ¡DBAï¼Œä»ä¸šåŠ¡éœ€æ±‚è®¨è®ºåˆ°è¡¨ç»“æ„å®¡æ ¸ã€SQLè¯­å¥å®¡æ ¸ã€ä¸Šçº¿ã€ç´¢å¼•æ›´æ–°ã€ç‰ˆæœ¬è¿­ä»£å‡çº§ï¼Œç”šè‡³å“ªäº›æ•°æ®åº”è¯¥æ”¾åˆ°éå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå“ªäº›æ•°æ®æ”¾åˆ°æ•°æ®ä»“åº“ã€æœç´¢å¼•æ“æˆ–è€…ç¼“å­˜ä¸­ï¼Œéƒ½éœ€è¦è¿™äº›DBAè·Ÿè¸ªå’Œå¤å®¡ã€‚ä»–ä»¬ç”šè‡³å¯ä»¥ç§°ä¸ºæ•°æ®æ¶æ„å¸ˆï¼ˆData Architecherï¼‰ã€‚</p></blockquote><h2 id="1-æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"><strong>1. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</strong></h2><p>å‰é¢çš„ç« èŠ‚æˆ‘ä»¬çŸ¥é“å¦‚ä½•è®¾è®¡æœ€ä¼˜çš„åº“è¡¨ç»“æ„ã€å¦‚ä½•å»ºç«‹æœ€å¥½çš„ç´¢å¼•ï¼Œè¿™äº›å¯¹äºé«˜æ€§èƒ½æ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä½†è¿™äº›è¿˜ä¸å¤Ÿâ€”è¿˜éœ€è¦åˆç†çš„è®¾è®¡æŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢å†™å¾—å¾ˆç³Ÿç³•ï¼Œå³ä½¿åº“è¡¨ç»“æ„å†åˆç†ã€ç´¢å¼•å†åˆé€‚ï¼Œä¹Ÿæ— æ³•å®ç°é«˜æ€§èƒ½ã€‚</p><p>æ…¢æŸ¥è¯¢åŸºç¡€ -ä¼˜åŒ–æ•°æ®è®¿é—®</p><ul><li>æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•</li><li>å–å‡ºå…¨éƒ¨çš„åˆ—</li><li>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®  -redisç¼“å­˜</li></ul><p>æ˜¯å¦æ‰«é¢é¢å¤–çš„è®°å½•</p><ul><li>å“åº”æ—¶é—´  æœåŠ¡æ—¶é—´ + æ’é˜Ÿæ—¶é—´</li><li>æ‰«æçš„è¡Œæ•°å’Œè¿”å›çš„è¡Œæ•°</li><li>æ‰«æçš„è¡Œæ•°å’Œè®¿é—®ç±»å‹</li></ul><p>1ã€ä½¿ç”¨è¦†ç›–ç´¢å¼• 2ã€æ•°æ®è¡¨ç»“æ„ ç»Ÿè®¡æ±‡æ€» æŠ¥è¡¨ æ±‡æ€»ä¿¡æ¯ï¼ˆæ±‡æ€»è¡¨ï¼‰</p><p>3ã€é‡å†™å¤æ‚çš„æŸ¥è¯¢SQL</p><h3 id="1-1-ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢">1.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŸ¥è¯¢èŠ±è´¹å¤§é‡æ—¶é—´çš„æ—¥å¿—ï¼Œæ˜¯æŒ‡mysqlè®°å½•æ‰€æœ‰æ‰§è¡Œè¶…è¿‡<strong>long_query_time</strong>å‚æ•°è®¾å®šçš„æ—¶é—´é˜ˆå€¼çš„SQLè¯­å¥çš„æ—¥å¿—ã€‚è¯¥æ—¥å¿—èƒ½ä¸ºSQLè¯­å¥çš„ä¼˜åŒ–å¸¦æ¥å¾ˆå¥½çš„å¸®åŠ©ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å…³é—­çš„ï¼Œè¦ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œé¦–å…ˆè¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ã€‚å¦‚ä½•å¼€å¯ï¼Œæˆ‘ä»¬ç¨åå†è¯´ã€‚</p><h4 id="1-1-2-æ…¢æŸ¥è¯¢åŸºç¡€-ä¼˜åŒ–æ•°æ®è®¿é—®">1.1.2 æ…¢æŸ¥è¯¢åŸºç¡€-ä¼˜åŒ–æ•°æ®è®¿é—®</h4><p>æŸ¥è¯¢æ€§èƒ½ä½ä¸‹æœ€åŸºæœ¬çš„åŸå› æ˜¯è®¿é—®çš„æ•°æ®å¤ªå¤šã€‚å¤§éƒ¨åˆ†æ€§èƒ½ä½ä¸‹çš„æŸ¥è¯¢éƒ½å¯ä»¥é€šè¿‡å‡å°‘è®¿é—®çš„æ•°æ®é‡çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äºä½æ•ˆçš„æŸ¥è¯¢ï¼Œä¸€èˆ¬é€šè¿‡ä¸‹é¢ä¸¤ä¸ªæ­¥éª¤æ¥åˆ†ææ€»æ˜¯å¾ˆæœ‰æ•ˆ:</p><ol><li><p>ç¡®è®¤åº”ç”¨ç¨‹åºæ˜¯å¦åœ¨æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ã€‚è¿™é€šå¸¸æ„å‘³ç€è®¿é—®äº†å¤ªå¤šçš„è¡Œï¼Œä½†æœ‰æ—¶å€™ä¹Ÿå¯èƒ½æ˜¯è®¿é—®äº†å¤ªå¤šçš„åˆ—ã€‚</p></li><li><p>ç¡®è®¤MySQLæœåŠ¡å™¨å±‚æ˜¯å¦åœ¨åˆ†æå¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œã€‚</p></li></ol><h4 id="1-1-3-è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®ï¼Ÿ"><strong>1.1.3 è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®ï¼Ÿ</strong></h4><p>æœ‰äº›æŸ¥è¯¢ä¼šè¯·æ±‚è¶…è¿‡å®é™…éœ€è¦çš„æ•°æ®ï¼Œç„¶åè¿™äº›å¤šä½™çš„æ•°æ®ä¼šè¢«åº”ç”¨ç¨‹åºä¸¢å¼ƒã€‚è¿™ä¼šç»™MySQLæœåŠ¡å™¨å¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ï¼Œå¹¶å¢åŠ ç½‘ç»œå¼€é”€ï¼Œå¦å¤–ä¹Ÿä¼šæ¶ˆè€—åº”ç”¨æœåŠ¡å™¨çš„CPUå’Œå†…å­˜èµ„æºã€‚æ¯”å¦‚:</p><h5 id="æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•"><strong>æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•</strong></h5><p>ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯å¸¸å¸¸ä¼šè¯¯ä»¥ä¸ºMySQLä¼šåªè¿”å›éœ€è¦çš„æ•°æ®ï¼Œå®é™…ä¸ŠMySQLå´æ˜¯å…ˆè¿”å›å…¨éƒ¨ç»“æœé›†å†è¿›è¡Œè®¡ç®—ã€‚æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›äº†è§£å…¶ä»–æ•°æ®åº“ç³»ç»Ÿçš„äººä¼šè®¾è®¡å‡ºè¿™ç±»åº”ç”¨ç¨‹åºã€‚</p><img src="HTTP://zdwtop.cn/blog/image-20230314160139644.png" alt="image-20230314160139644" style="zoom:50%;"><img src="HTTP://zdwtop.cn/blog/image-20230314160146155.png" alt="image-20230314160146155" style="zoom:50%;"><p>ä»¥ä¸ŠSQLä½ è®¤ä¸ºMySQLä¼šæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶åªè¿”å›ä»–ä»¬éœ€è¦çš„20æ¡æ•°æ®ï¼Œç„¶ååœæ­¢æŸ¥è¯¢ã€‚å®é™…æƒ…å†µæ˜¯MySQLä¼šæŸ¥è¯¢å‡ºå…¨éƒ¨çš„ç»“æœé›†ï¼Œå®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºä¼šæ¥æ”¶å…¨éƒ¨çš„ç»“æœé›†æ•°æ®ï¼Œç„¶åæŠ›å¼ƒå…¶ä¸­å¤§éƒ¨åˆ†æ•°æ®ã€‚</p><h5 id="æ€»æ˜¯å–å‡ºå…¨éƒ¨åˆ—"><strong>æ€»æ˜¯å–å‡ºå…¨éƒ¨åˆ—</strong></h5><p>æ¯æ¬¡çœ‹åˆ°<code>SELECT*</code>çš„æ—¶å€™éƒ½éœ€è¦ç”¨æ€€ç–‘çš„çœ¼å…‰å®¡è§†ï¼Œæ˜¯ä¸æ˜¯çœŸçš„éœ€è¦è¿”å›å…¨éƒ¨çš„åˆ—ï¼Ÿå¾ˆå¯èƒ½ä¸æ˜¯å¿…éœ€çš„ã€‚<font color="blue"><strong>å–å‡ºå…¨éƒ¨åˆ—ï¼Œä¼šè®©ä¼˜åŒ–å™¨æ— æ³•å®Œæˆç´¢å¼•è¦†ç›–æ‰«æè¿™ç±»ä¼˜åŒ–,è¿˜ä¼šä¸ºæœåŠ¡å™¨å¸¦æ¥é¢å¤–çš„I/Oã€å†…å­˜å’ŒCPUçš„æ¶ˆè€—ã€‚</strong></font>å› æ­¤ï¼Œä¸€äº›å·¥ä½œåœºæ™¯æ˜¯ä¸¥æ ¼ç¦æ­¢SELECT *çš„å†™æ³•çš„ï¼Œè¿™æ ·åšæœ‰æ—¶å€™è¿˜èƒ½é¿å…æŸäº›åˆ—è¢«ä¿®æ”¹å¸¦æ¥çš„é—®é¢˜ã€‚</p><p><strong>å°¤å…¶æ˜¯ä½¿ç”¨äºŒçº§ç´¢å¼•ï¼Œä½¿ç”¨*çš„æ–¹å¼ä¼šå¯¼è‡´å›è¡¨ï¼Œå¯¼è‡´æ€§èƒ½ä½ä¸‹ã€‚</strong></p><p>ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨SELECT*å¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨äº†æŸç§ç¼“å­˜æœºåˆ¶ï¼Œæˆ–è€…æœ‰å…¶ä»–è€ƒè™‘ï¼Œè·å–è¶…è¿‡éœ€è¦çš„æ•°æ®ä¹Ÿå¯rrèƒ½æœ‰å…¶å¥½å¤„ï¼Œä½†ä¸è¦å¿˜è®°è¿™æ ·åšçš„ä»£ä»·æ˜¯ä»€ä¹ˆã€‚è·å–å¹¶ç¼“å­˜æ‰€æœ‰çš„åˆ—çš„æŸ¥è¯¢ï¼Œç›¸æ¯”å¤šä¸ªç‹¬ç«‹çš„åªè·å–éƒ¨åˆ†åˆ—çš„æŸ¥è¯¢å¯èƒ½å°±æ›´æœ‰å¥½å¤„ã€‚</p><h5 id="é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®"><strong>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®</strong></h5><p>ä¸æ–­åœ°é‡å¤æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ï¼Œç„¶åæ¯æ¬¡éƒ½è¿”å›å®Œå…¨ç›¸åŒçš„æ•°æ®ã€‚æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯ï¼Œå½“åˆæ¬¡æŸ¥è¯¢çš„æ—¶å€™å°†è¿™ä¸ªæ•°æ®<strong>ç¼“å­˜</strong>èµ·æ¥ï¼Œéœ€è¦çš„æ—¶å€™ä»ç¼“å­˜ä¸­å–å‡ºï¼Œè¿™æ ·æ€§èƒ½æ˜¾ç„¶ä¼šæ›´å¥½ã€‚</p><h4 id="1-1-4-æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•">1.1.4 æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•</h4><p>åœ¨ç¡®å®šæŸ¥è¯¢åªè¿”å›éœ€è¦çš„æ•°æ®ä»¥åï¼Œæ¥ä¸‹æ¥åº”è¯¥çœ‹çœ‹æŸ¥è¯¢ä¸ºäº†è¿”å›ç»“æœæ˜¯å¦æ‰«æäº†è¿‡å¤šçš„æ•°æ®ã€‚å¯¹äºMySQLï¼Œæœ€ç®€å•çš„è¡¡é‡æŸ¥è¯¢å¼€é”€çš„ä¸‰ä¸ªæŒ‡æ ‡å¦‚ä¸‹:</p><h5 id="å“åº”æ—¶é—´ã€æ‰«æçš„è¡Œæ•°ã€è¿”å›çš„è¡Œæ•°"><strong>å“åº”æ—¶é—´ã€æ‰«æçš„è¡Œæ•°ã€è¿”å›çš„è¡Œæ•°</strong></h5><p>æ²¡æœ‰å“ªä¸ªæŒ‡æ ‡èƒ½å¤Ÿå®Œç¾åœ°è¡¡é‡æŸ¥è¯¢çš„å¼€é”€ï¼Œä½†å®ƒä»¬å¤§è‡´åæ˜ äº†MySQLåœ¨å†…éƒ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶éœ€è¦è®¿é—®å¤šå°‘æ•°æ®ï¼Œå¹¶å¯ä»¥å¤§æ¦‚æ¨ç®—å‡ºæŸ¥è¯¢è¿è¡Œçš„æ—¶é—´ã€‚è¿™ä¸‰ä¸ªæŒ‡æ ‡éƒ½ä¼šè®°å½•åˆ°MySQLçš„æ…¢æ—¥å¿—ä¸­ï¼Œæ‰€ä»¥æ£€æŸ¥æ…¢æ—¥å¿—è®°å½•æ˜¯æ‰¾å‡ºæ‰«æè¡Œæ•°è¿‡å¤šçš„æŸ¥è¯¢çš„å¥½åŠæ³•ã€‚</p><ul><li><strong>å“åº”æ—¶é—´</strong></li></ul><p>å“åº”æ—¶é—´æ˜¯ä¸¤ä¸ªéƒ¨åˆ†ä¹‹å’Œ:æœåŠ¡æ—¶é—´å’Œæ’é˜Ÿæ—¶é—´ã€‚</p><p>æœåŠ¡æ—¶é—´æ˜¯æŒ‡æ•°æ®åº“å¤„ç†è¿™ä¸ªæŸ¥è¯¢çœŸæ­£èŠ±äº†å¤šé•¿æ—¶é—´ã€‚</p><p>æ’é˜Ÿæ—¶é—´æ˜¯æŒ‡æœåŠ¡å™¨å› ä¸ºç­‰å¾…æŸäº›èµ„æºè€Œæ²¡æœ‰çœŸæ­£æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶é—´â€”-å¯èƒ½æ˜¯ç­‰I/Oæ“ä½œå®Œæˆï¼Œä¹Ÿå¯èƒ½æ˜¯ç­‰å¾…è¡Œé”ï¼Œç­‰ç­‰ã€‚</p><ul><li><strong>æ‰«æçš„è¡Œæ•°å’Œè¿”å›çš„è¡Œæ•°</strong></li></ul><p>åˆ†ææŸ¥è¯¢æ—¶ï¼ŒæŸ¥çœ‹è¯¥æŸ¥è¯¢æ‰«æçš„è¡Œæ•°æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿè¯´æ˜è¯¥æŸ¥è¯¢æ‰¾åˆ°éœ€è¦çš„æ•°æ®çš„æ•ˆç‡é«˜ä¸é«˜ã€‚</p><p>ç†æƒ³æƒ…å†µä¸‹æ‰«æçš„è¡Œæ•°å’Œè¿”å›çš„è¡Œæ•°åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚ä½†å®é™…æƒ…å†µä¸­è¿™ç§â€œç¾äº‹â€å¹¶ä¸å¤šã€‚ä¾‹å¦‚åœ¨åšä¸€ä¸ªå…³è”æŸ¥è¯¢æ—¶ï¼ŒæœåŠ¡å™¨å¿…é¡»è¦æ‰«æå¤šè¡Œæ‰èƒ½ç”Ÿæˆç»“æœé›†ä¸­çš„ä¸€è¡Œã€‚æ‰«æçš„è¡Œæ•°å¯¹è¿”å›çš„è¡Œæ•°çš„æ¯”ç‡é€šå¸¸å¾ˆå°ï¼Œä¸€èˆ¬åœ¨1:1å’Œ10:1ä¹‹é—´ï¼Œä¸è¿‡æœ‰æ—¶å€™è¿™ä¸ªå€¼ä¹Ÿå¯èƒ½éå¸¸éå¸¸å¤§ã€‚</p><ul><li><strong>æ‰«æçš„è¡Œæ•°å’Œè®¿é—®ç±»å‹</strong></li></ul><p>åœ¨è¯„ä¼°æŸ¥è¯¢å¼€é”€çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸‹ä»è¡¨ä¸­æ‰¾åˆ°æŸä¸€è¡Œæ•°æ®çš„æˆæœ¬ã€‚MySQLæœ‰å¥½å‡ ç§è®¿é—®æ–¹å¼å¯ä»¥æŸ¥æ‰¾å¹¶è¿”å›ä¸€è¡Œç»“æœã€‚æœ‰äº›è®¿é—®æ–¹å¼å¯èƒ½éœ€è¦æ‰«æå¾ˆå¤šè¡Œæ‰èƒ½è¿”å›ä¸€è¡Œç»“æœï¼Œä¹Ÿæœ‰äº›è®¿é—®æ–¹å¼å¯èƒ½æ— é¡»æ‰«æå°±èƒ½è¿”å›ç»“æœã€‚</p><p>åœ¨<strong>EXPLAINè¯­å¥ä¸­</strong>çš„typeåˆ—ååº”äº†è®¿é—®ç±»å‹ã€‚è®¿é—®ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œä»å…¨è¡¨æ‰«æåˆ°ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æã€å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€å¸¸æ•°å¼•ç”¨ç­‰ã€‚è¿™é‡Œåˆ—çš„è¿™äº›ï¼Œé€Ÿåº¦æ˜¯ä»æ…¢åˆ°å¿«ï¼Œæ‰«æçš„è¡Œæ•°ä¹Ÿæ˜¯ä»å°åˆ°å¤§ã€‚ä½ ä¸éœ€è¦è®°ä½è¿™äº›è®¿é—®ç±»å‹ï¼Œä½†éœ€è¦æ˜ç™½<strong>æ‰«æè¡¨ã€æ‰«æç´¢å¼•ã€èŒƒå›´è®¿é—®å’Œå•å€¼è®¿é—®çš„æ¦‚å¿µã€‚</strong></p><blockquote><p>å¦‚æœæŸ¥è¯¢æ²¡æœ‰åŠæ³•æ‰¾åˆ°åˆé€‚çš„è®¿é—®ç±»å‹ï¼Œé‚£ä¹ˆè§£å†³çš„æœ€å¥½åŠæ³•é€šå¸¸å°±æ˜¯å¢åŠ ä¸€ä¸ªåˆé€‚çš„ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆç´¢å¼•å¯¹äºæŸ¥è¯¢ä¼˜åŒ–å¦‚æ­¤é‡è¦äº†ã€‚ç´¢å¼•è®© MySQLä»¥æœ€é«˜æ•ˆã€æ‰«æè¡Œæ•°æœ€å°‘çš„æ–¹å¼æ‰¾åˆ°éœ€è¦çš„è®°å½•ã€‚</p></blockquote><p>ä¸€èˆ¬ MySQLèƒ½å¤Ÿä½¿ç”¨å¦‚ä¸‹ä¸‰ç§æ–¹å¼åº”ç”¨WHEREæ¡ä»¶ï¼Œä»å¥½åˆ°åä¾æ¬¡ä¸º:</p><ol><li>åœ¨ç´¢å¼•ä¸­ä½¿ç”¨WHEREæ¡ä»¶æ¥è¿‡æ»¤ä¸åŒ¹é…çš„è®°å½•ã€‚è¿™æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆçš„ã€‚</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .... <span class="keyword">from</span> <span class="keyword">where</span> a<span class="operator">&gt;</span><span class="number">100</span> <span class="keyword">and</span> a <span class="operator">&lt;</span><span class="number">200</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«ææ¥è¿”å›è®°å½•ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿‡æ»¤ä¸éœ€è¦çš„è®°å½•å¹¶è¿”å›å‘½ä¸­çš„ç»“æœã€‚è¿™æ˜¯åœ¨ MySQLæœåŠ¡å™¨å±‚å®Œæˆçš„ï¼Œä½†æ— é¡»å†å›è¡¨æŸ¥è¯¢è®°å½•ã€‚</p></li><li><p>ä»æ•°æ®è¡¨ä¸­è¿”å›æ•°æ®(å­˜åœ¨å›è¡¨)ï¼Œç„¶åè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚è¿™åœ¨ MySQLæœåŠ¡å™¨å±‚å®Œæˆï¼ŒMySQLéœ€è¦å…ˆä»æ•°æ®è¡¨è¯»å‡ºè®°å½•ç„¶åè¿‡æ»¤ã€‚</p></li></ol><p>å¥½çš„ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢ä½¿ç”¨åˆé€‚çš„è®¿é—®ç±»å‹ï¼Œå°½å¯èƒ½åœ°åªæ‰«æéœ€è¦çš„æ•°æ®è¡Œã€‚</p><p><strong>å¦‚æœå‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œé‚£ä¹ˆé€šå¸¸å¯ä»¥å°è¯•ä¸‹é¢çš„æŠ€å·§å»ä¼˜åŒ–å®ƒ:</strong></p><p>1ã€ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼ŒæŠŠæ‰€æœ‰éœ€è¦ç”¨çš„åˆ—éƒ½æ”¾åˆ°ç´¢å¼•ä¸­ï¼Œè¿™æ ·å­˜å‚¨å¼•æ“æ— é¡»å›è¡¨è·å–å¯¹åº”è¡Œå°±å¯ä»¥è¿”å›ç»“æœäº†</p><p>2ã€æ”¹å˜åº“è¡¨ç»“æ„ã€‚ä¾‹å¦‚ä½¿ç”¨å•ç‹¬çš„æ±‡æ€»è¡¨ã€‚</p><p>3ã€é‡å†™è¿™ä¸ªå¤æ‚çš„æŸ¥è¯¢ï¼Œè®©MySQLä¼˜åŒ–å™¨èƒ½å¤Ÿä»¥æ›´ä¼˜åŒ–çš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ã€‚</p><h3 id="1-2-æ…¢æŸ¥è¯¢"><strong>1.2 æ…¢æŸ¥è¯¢</strong></h3><p><strong>1.3.3.1æ…¢æŸ¥è¯¢é…ç½®</strong></p><p>æˆ‘ä»¬å·²ç»çŸ¥é“æ…¢æŸ¥è¯¢æ—¥å¿—å¯ä»¥å¸®åŠ©å®šä½å¯èƒ½å­˜åœ¨é—®é¢˜çš„SQLè¯­å¥ï¼Œä»è€Œè¿›è¡ŒSQLè¯­å¥å±‚é¢çš„ä¼˜åŒ–ã€‚ä½†æ˜¯é»˜è®¤å€¼ä¸ºå…³é—­çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼€å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> VARIABLES <span class="keyword">like</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="HTTP://zdwtop.cn/blog/image-20230314161024083.png" alt="image-20230314161024083" style="zoom:67%;"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> slow_query_log<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å¼€å¯1ï¼Œå…³é—­0</p><p>ä½†æ˜¯å¤šæ…¢ç®—æ…¢ï¼ŸMySQLä¸­å¯ä»¥è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå°†è¿è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰SQLè¯­å¥éƒ½è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚<code>long_query_time</code>å‚æ•°å°±æ˜¯è¿™ä¸ªé˜ˆå€¼ã€‚<strong>é»˜è®¤å€¼ä¸º10</strong>ï¼Œä»£è¡¨10ç§’ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> VARIABLES <span class="keyword">like</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br><span class="line">#å½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"># é»˜è®¤<span class="number">10</span>ç§’ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿è®¾ç½®ä¸º<span class="number">0</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶å¯¹äºè¿è¡Œçš„SQLè¯­å¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œåˆ™MySQLæ•°æ®åº“ä¹Ÿå¯ä»¥å°†è¿™æ¡SQLè¯­å¥è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼Œæ§åˆ¶å‚æ•°æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> VARIABLES <span class="keyword">like</span> <span class="string">&#x27;%log_queries_not_using_indexes%&#x27;</span>;#å¼€å¯<span class="number">1</span>ï¼Œå…³é—­<span class="number">0</span>ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line"><span class="keyword">show</span> VARIABLES <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log_file%&#x27;</span>;#æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶åå­—</span><br></pre></td></tr></table></figure><img src="HTTP://zdwtop.cn/blog/image-20230314161404029.png" alt="image-20230314161404029" style="zoom:67%;">    <img src="HTTP://zdwtop.cn/blog/image-20230314161157667.png" alt="image-20230314161157667" style="zoom:67%;"><p>å°ç»“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">slow_query_log #å¯åŠ¨åœæ­¢æ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line"></span><br><span class="line">slow_query_log_file #æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—å¾—å­˜å‚¨è·¯å¾„åŠæ–‡ä»¶ï¼ˆé»˜è®¤å’Œæ•°æ®æ–‡ä»¶æ”¾ä¸€èµ·ï¼‰</span><br><span class="line"></span><br><span class="line">long_query_time #æŒ‡å®šè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—<span class="keyword">SQL</span>æ‰§è¡Œæ—¶é—´å¾—ä¼å€¼ï¼ˆå•ä½ï¼šç§’ï¼Œé»˜è®¤<span class="number">10</span>ç§’ï¼‰</span><br><span class="line"></span><br><span class="line">log_queries_not_using_indexes  #æ˜¯å¦è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„<span class="keyword">SQL</span></span><br><span class="line"></span><br><span class="line">llog_output #æ—¥å¿—å­˜æ”¾çš„åœ°æ–¹å¯ä»¥æ˜¯<span class="keyword">TABLE</span>[FILE,<span class="keyword">TABLE</span>]</span><br></pre></td></tr></table></figure><p>ps:ç”±äºç¯‡å¹…è¿‡é•¿ï¼Œæ‰§è¡Œè®¡åˆ’è¯·ä¸‹ä¸€ç¯‡æ–‡ç« </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;MySQLè°ƒä¼˜é‡‘å­—å¡”&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;æ•´ä½“ä»‹ç»MySQLçš„è°ƒä¼˜çš„é€‰æ‹©ï¼Œç®€å•äº†è§£å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;HTTP://zdwtop.cn/blog/image-20230314174431189.png&quot; alt=&quot;ima</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="æ…¢æŸ¥è¯¢" scheme="https://eizo01.github.io/tags/%E6%85%A2%E6%9F%A5%E8%AF%A2/"/>
    
  </entry>
  
  <entry>
    <title>é«˜æ€§èƒ½çš„ç´¢å¼•åˆ›å»ºç­–ç•¥</title>
    <link href="https://eizo01.github.io/posts/5ae93cc9.html"/>
    <id>https://eizo01.github.io/posts/5ae93cc9.html</id>
    <published>2022-10-06T12:00:00.000Z</published>
    <updated>2022-10-06T14:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>é«˜æ€§èƒ½çš„ç´¢å¼•ä½¿ç”¨ç­–ç•¥</strong></h1><p>ä»Šå¤©è¦ç”¨åˆ°çš„è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `order_exp`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_exp` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">22</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;è®¢å•çš„ä¸»é”®&#x27;</span>,</span><br><span class="line">  `order_no` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„ç¼–å·&#x27;</span>,</span><br><span class="line">  `order_note` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„è¯´æ˜&#x27;</span>,</span><br><span class="line">  `insert_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ’å…¥è®¢å•çš„æ—¶é—´&#x27;</span>,</span><br><span class="line">  `expire_duration` <span class="type">bigint</span>(<span class="number">22</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„è¿‡æœŸæ—¶é•¿ï¼Œå•ä½ç§’&#x27;</span>,</span><br><span class="line">  `expire_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„è¿‡æœŸæ—¶é—´&#x27;</span>,</span><br><span class="line">  `order_status` <span class="type">smallint</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;è®¢å•çš„çŠ¶æ€ï¼Œ0ï¼šæœªæ”¯ä»˜ï¼›1ï¼šå·²æ”¯ä»˜ï¼›-1ï¼šå·²è¿‡æœŸï¼Œå…³é—­&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `u_idx_day_status` (`insert_time`,`order_status`,`expire_time`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  KEY `idx_order_no` (`order_no`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  KEY `idx_expire_time` (`expire_time`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">10819</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 ROW_FORMAT<span class="operator">=</span><span class="keyword">DYNAMIC</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `order_exp_cut`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_exp_cut` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">22</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;è®¢å•çš„ä¸»é”®&#x27;</span>,</span><br><span class="line">  `order_no` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„ç¼–å·&#x27;</span>,</span><br><span class="line">  `order_note` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„è¯´æ˜&#x27;</span>,</span><br><span class="line">  `insert_time` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ’å…¥è®¢å•çš„æ—¶é—´&#x27;</span>,</span><br><span class="line">  `expire_duration` <span class="type">bigint</span>(<span class="number">22</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„è¿‡æœŸæ—¶é•¿ï¼Œå•ä½ç§’&#x27;</span>,</span><br><span class="line">  `expire_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„è¿‡æœŸæ—¶é—´&#x27;</span>,</span><br><span class="line">  `order_status` <span class="type">smallint</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;è®¢å•çš„çŠ¶æ€ï¼Œ0ï¼šæœªæ”¯ä»˜ï¼›1ï¼šå·²æ”¯ä»˜ï¼›-1ï¼šå·²è¿‡æœŸï¼Œå…³é—­&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `u_idx_day_status` (`insert_time`,`order_status`,`expire_time`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  KEY `idx_order_no` (`order_no`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  KEY `idx_expire_time` (`expire_time`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">10819</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 ROW_FORMAT<span class="operator">=</span><span class="keyword">DYNAMIC</span>;</span><br></pre></td></tr></table></figure><h2 id="1-ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ"><strong>1. ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ</strong></h2><p>æˆ‘ä»¬é€šå¸¸ä¼šçœ‹åˆ°ä¸€äº›æŸ¥è¯¢ä¸å½“åœ°ä½¿ç”¨ç´¢å¼•ï¼Œæˆ–è€…ä½¿å¾—MySQLæ— æ³•ä½¿ç”¨å·²æœ‰çš„ç´¢å¼•ã€‚å¦‚æœæŸ¥è¯¢ä¸­çš„åˆ—ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œåˆ™ MySQLå°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚â€œç‹¬ç«‹çš„åˆ—â€æ˜¯æŒ‡ç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‡è®¾idä¸Šæœ‰ä¸»é”®ç´¢å¼•ï¼Œä½†æ˜¯ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢æ— æ³•ä½¿ç”¨ä¸»é”®ç´¢å¼•:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> id <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">17</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315210042935.png" alt="image-20230315210042935"></p><p>å‡­è‚‰çœ¼å¾ˆå®¹æ˜“çœ‹å‡º WHEREä¸­çš„è¡¨è¾¾å¼å…¶å®ç­‰ä»·äºid= 16ï¼Œä½†æ˜¯MySQLæ— æ³•è‡ªåŠ¨è§£æè¿™ä¸ªæ–¹ç¨‹å¼ã€‚è¿™å®Œå…¨æ˜¯ç”¨æˆ·è¡Œä¸ºã€‚æˆ‘ä»¬åº”è¯¥å…»æˆç®€åŒ–WHEREæ¡ä»¶çš„ä¹ æƒ¯ï¼Œå§‹ç»ˆå°†ç´¢å¼•åˆ—å•ç‹¬æ”¾åœ¨æ¯”è¾ƒç¬¦å·çš„ä¸€ä¾§ã€‚</p><p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªå¸¸è§çš„é”™è¯¯:</p><p>åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°ï¼Œä¹Ÿæ˜¯æ— æ³•åˆ©ç”¨ç´¢å¼•çš„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(insert_time)<span class="operator">=</span><span class="keyword">YEAR</span>(DATE_SUB(NOW(),<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>));</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="keyword">BETWEEN</span> str_to_date(<span class="string">&#x27;01/01/2021&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>) <span class="keyword">and</span> str_to_date(<span class="string">&#x27;12/31/2021&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315213106919.png" alt="image-20230315213106919"></p><p>åˆ©ç”¨è”åˆç´¢å¼•,ä¿®æ”¹æŸ¥è¯¢åˆ—</p><p><img src="https://zdwtop.cn/blog/image-20230315213455603.png" alt="image-20230315213455603"></p><h2 id="2-å°½é‡å…¨å€¼åŒ¹é…"><strong>2.å°½é‡å…¨å€¼åŒ¹é…</strong></h2><p>å»ºç«‹äº†è”åˆç´¢å¼•åˆ—åï¼Œå¦‚æœæˆ‘ä»¬çš„æœç´¢æ¡ä»¶ä¸­çš„åˆ—å’Œç´¢å¼•åˆ—ä¸€è‡´çš„è¯ï¼Œè¿™ç§æƒ…å†µå°±ç§°ä¸ºå…¨å€¼åŒ¹é…ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥æ‰¾è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp </span><br><span class="line"><span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:34:55&#x27;</span>                                       </span><br><span class="line"><span class="keyword">and</span> order_status<span class="operator">=</span><span class="number">0</span> </span><br><span class="line"><span class="keyword">and</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:14&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å»ºç«‹çš„u_idx_day_statusrç´¢å¼•åŒ…å«çš„3ä¸ªåˆ—åœ¨è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­éƒ½å±•ç°å‡ºæ¥äº†ï¼Œè”åˆç´¢å¼•ä¸­çš„ä¸‰ä¸ªåˆ—éƒ½å¯èƒ½è¢«ç”¨åˆ°ã€‚</p><pre><code><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNIQUE</span> KEY `u_idx_day_status` (`insert_time`,`order_status`,`expire_time`) <span class="keyword">USING</span> BTREE,</span><br></pre></td></tr></table></figure></code></pre><p><img src="https://zdwtop.cn/blog/image-20230315213755786.png" alt="image-20230315213755786"></p><p>ä¹Ÿè®¸è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼ŒWHEREå­å¥ä¸­çš„å‡ ä¸ªæœç´¢æ¡ä»¶çš„é¡ºåºå¯¹æŸ¥è¯¢ç»“æœæœ‰å•¥å½±å“ä¹ˆï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬è°ƒæ¢ insert_time, order_status, expire_timeè¿™å‡ ä¸ªæœç´¢åˆ—çš„é¡ºåºå¯¹æŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹æœ‰å½±å“ä¹ˆï¼Ÿæ¯”æ–¹è¯´å†™æˆä¸‹è¾¹è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp </span><br><span class="line"><span class="keyword">where</span>  order_status<span class="operator">=</span><span class="number">0</span> </span><br><span class="line"><span class="keyword">and</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:14&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ”¾å¿ƒï¼ŒMySQLæ²¡è¿™ä¹ˆè ¢ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šåˆ†æè¿™äº›æœç´¢æ¡ä»¶å¹¶ä¸”æŒ‰ç…§å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•ä¸­åˆ—çš„é¡ºåºæ¥å†³å®šå…ˆä½¿ç”¨å“ªä¸ªæœç´¢æ¡ä»¶ï¼Œåä½¿ç”¨å“ªä¸ªæœç´¢æ¡ä»¶ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230315214026869.png" alt="image-20230315214026869"></p><p>æ‰€ä»¥ï¼Œå½“å»ºç«‹äº†è”åˆç´¢å¼•åˆ—åï¼Œèƒ½åœ¨whereæ¡ä»¶ä¸­ä½¿ç”¨ç´¢å¼•çš„å°½é‡ä½¿ç”¨ã€‚</p><h2 id="3-æœ€ä½³å·¦å‰ç¼€æ³•åˆ™"><strong>3.æœ€ä½³å·¦å‰ç¼€æ³•åˆ™</strong></h2><p>å»ºç«‹äº†è”åˆç´¢å¼•åˆ—ï¼Œå¦‚æœæœç´¢æ¡ä»¶ä¸å¤Ÿå…¨å€¼åŒ¹é…æ€ä¹ˆåŠï¼Ÿåœ¨æˆ‘ä»¬çš„æœç´¢è¯­å¥ä¸­ä¹Ÿå¯ä»¥ä¸ç”¨åŒ…å«å…¨éƒ¨è”åˆç´¢å¼•ä¸­çš„åˆ—ï¼Œä½†è¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚</p><p>æœç´¢æ¡ä»¶ä¸­å¿…é¡»å‡ºç°å·¦è¾¹çš„åˆ—æ‰å¯ä»¥ä½¿ç”¨åˆ°è¿™ä¸ªB+æ ‘ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNIQUE</span> KEY `u_idx_day_status` (`insert_time`,`order_status`,`expire_time`) <span class="keyword">USING</span> BTREE,</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:23:42&#x27;</span> <span class="keyword">and</span> order_status<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315214331538.png" alt="image-20230315214331538"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:23:42&#x27;</span> ;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315214412145.png" alt="image-20230315214412145"></p><p><strong>åªè¦å‡ºç°å·¦è¾¹çš„ç¬¬ä¸€åˆ—å°±ä¼šå¼€å§‹ä½¿ç”¨ç´¢å¼•ï¼</strong></p><p>æ¥ä¸‹æ¥è¯·çœ‹è¿™ä¸¤ä¸ªè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_status<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315214535140.png" alt="image-20230315214535140"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> s1 <span class="keyword">where</span> order_status<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:14&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315214903250.png" alt="image-20230315214903250"></p><p><strong>æœç´¢æ¡ä»¶ä¸­æ²¡æœ‰å‡ºç°å·¦è¾¹çš„åˆ—ä¸å¯ä»¥ä½¿ç”¨åˆ°è¿™ä¸ªB+æ ‘ç´¢å¼•ã€‚</strong></p><p><font color="\#87CEFA"><strong>é‚£ä¸ºä»€ä¹ˆæœç´¢æ¡ä»¶ä¸­å¿…é¡»å‡ºç°å·¦è¾¹çš„åˆ—æ‰å¯ä»¥ä½¿ç”¨åˆ°è¿™ä¸ªB+æ ‘ç´¢å¼•å‘¢ï¼Ÿæ¯”å¦‚ä¸‹è¾¹çš„è¯­å¥å°±ç”¨ä¸åˆ°è¿™ä¸ªB+æ ‘ç´¢å¼•ä¹ˆï¼Ÿ</strong></font></p><p>å› ä¸ºB+æ ‘çš„æ•°æ®é¡µå’Œè®°å½•å…ˆæ˜¯æŒ‰ç…§insert_timeåˆ—çš„å€¼æ’åºçš„ï¼Œåœ¨insert_timeåˆ—çš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹æ‰ä½¿ç”¨order_statusåˆ—è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´insert_timeåˆ—çš„å€¼ä¸åŒçš„è®°å½•ä¸­order_statusçš„å€¼å¯èƒ½æ˜¯æ— åºçš„ã€‚</p><p>è€Œç°åœ¨ä½ è·³è¿‡insert_timeåˆ—ç›´æ¥æ ¹æ®order_statusçš„å€¼å»æŸ¥æ‰¾ï¼Œæ€ä¹ˆå¯èƒ½å‘¢ï¼Ÿexpire_timeä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œé‚£å¦‚æœæˆ‘å°±æƒ³åœ¨åªä½¿ç”¨expire_timeçš„å€¼å»é€šè¿‡B+æ ‘ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾å’‹åŠå‘¢ï¼Ÿè¿™å¥½åŠï¼Œä½ å†å¯¹expire_timeåˆ—å»ºä¸€ä¸ªB+æ ‘ç´¢å¼•å°±è¡Œäº†ã€‚</p><p>å†è¡¥å……ä¸€ä¸ªä¹‹å‰è®²ç´¢å¼•çš„å›¾ï¼šé“ç†ä¸€æ ·ï¼Œè¡¥å……ä¸€ä¸‹ç»†èŠ‚</p><img src="https://zdwtop.cn/blog/image-20230315215236733.png" alt="image-20230315215236733" style="zoom:50%;"><p>ä½†æ˜¯éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨è”åˆç´¢å¼•ä¸­å°½å¯èƒ½å¤šçš„åˆ—ï¼Œæœç´¢æ¡ä»¶ä¸­çš„å„ä¸ªåˆ—å¿…é¡»æ˜¯è”åˆç´¢å¼•ä¸­ä»æœ€å·¦è¾¹è¿ç»­çš„åˆ—ã€‚æ¯”æ–¹è¯´è”åˆç´¢å¼•<code>u_idx_day_status</code>ä¸­åˆ—çš„å®šä¹‰é¡ºåºæ˜¯ insert_time, order_status, expire_timeï¼Œ<strong>å¦‚æœæˆ‘ä»¬çš„æœç´¢æ¡ä»¶ä¸­åªæœ‰insert_timeå’Œexpire_timeï¼Œè€Œæ²¡æœ‰ä¸­é—´çš„order_statusã€‚</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp </span><br><span class="line"><span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:23:42&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:14&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315215504330.png" alt="image-20230315215504330"></p><p><strong>è¯·æ³¨æ„key_len,åªæœ‰5ï¼Œè¯´æ˜åªæœ‰insert_timeç”¨åˆ°äº†ï¼Œå…¶ä»–çš„æ²¡æœ‰ç”¨åˆ°ã€‚</strong></p><h2 id="4-èŒƒå›´æ¡ä»¶æ”¾æœ€å"><strong>4.èŒƒå›´æ¡ä»¶æ”¾æœ€å</strong></h2><p>è¿™ä¸€ç‚¹ï¼Œä¹Ÿæ˜¯é’ˆå¯¹è”åˆç´¢å¼•æ¥è¯´çš„ï¼Œå‰é¢æˆ‘ä»¬åå¤å¼ºè°ƒè¿‡ï¼Œæ‰€æœ‰è®°å½•éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’å¥½åºçš„ï¼Œè€Œ<font color="\#87CEFA"><strong>è”åˆç´¢å¼•åˆ™æ˜¯æŒ‰åˆ›å»ºç´¢å¼•æ—¶çš„é¡ºåºè¿›è¡Œåˆ†ç»„æ’åºã€‚</strong></font></p><p>æ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">where</span> </span><br><span class="line">insert_time <span class="operator">&gt;</span> <span class="string">&#x27;2021-03-22 18:23:42&#x27;</span> <span class="keyword">and</span> insert_time<span class="operator">&lt;</span><span class="string">&#x27;2021-03-22 18:35:00&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315215926405.png" alt="image-20230315215926405"></p><p>ç”±äºB+æ ‘ä¸­çš„æ•°æ®é¡µå’Œè®°å½•æ˜¯å…ˆæŒ‰insert_timeåˆ—æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šè¾¹çš„æŸ¥è¯¢è¿‡ç¨‹å…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><ol><li><p>æ‰¾åˆ°<code>insert_time</code>å€¼ä¸ºâ€™2021-03-22 18:23:42â€™ çš„è®°å½•ã€‚</p></li><li><p>æ‰¾åˆ°<code>insert_time</code>å€¼ä¸ºâ€™2021-03-22 18:35:00â€™çš„è®°å½•ã€‚</p></li></ol><p>ç”±äºæ‰€æœ‰è®°å½•éƒ½æ˜¯ç”±é“¾è¡¨è¿èµ·æ¥çš„ï¼Œæ‰€ä»¥ä»–ä»¬ä¹‹é—´çš„è®°å½•éƒ½å¯ä»¥å¾ˆå®¹æ˜“çš„å–å‡ºæ¥ï¼Œæ‰¾åˆ°è¿™äº›è®°å½•çš„ä¸»é”®å€¼ï¼Œå†åˆ°èšç°‡ç´¢å¼•ä¸­å›è¡¨æŸ¥æ‰¾å®Œæ•´çš„è®°å½•ã€‚</p><p>ä½†æ˜¯å¦‚æœå¯¹å¤šä¸ªåˆ—åŒæ—¶è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œåªæœ‰å¯¹ç´¢å¼•æœ€å·¦è¾¹çš„é‚£ä¸ªåˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™æ‰èƒ½ç”¨åˆ°B+æ ‘ç´¢å¼•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp_cut <span class="keyword">where</span> </span><br><span class="line">insert_time<span class="operator">&gt;</span><span class="string">&#x27;2021-03-22 18:23:42&#x27;</span> <span class="keyword">and</span> insert_time<span class="operator">&lt;</span><span class="string">&#x27;2021-03-22 18:35:00&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> order_status <span class="operator">&gt;</span> <span class="number">-1</span>;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¿™é‡Œkey_len æ˜¯ 6å‘¢ï¼Ÿä½ å¯ä»¥å›åˆ°å¼€å¤´æŸ¥çœ‹ï¼Œinsert_timeä¸ºç©ºï¼Œè¡Œæ ¼å¼æ˜¯å¤š1ä¸ªå­—èŠ‚å­˜å‚¨çš„ã€‚è¡Œæ ¼å¼ä»¥åä¼šè®²çš„ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230315215635123.png" alt="image-20230315215635123"></p><p>ä¸Šè¾¹è¿™ä¸ªæŸ¥è¯¢å¯ä»¥åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>é€šè¿‡æ¡ä»¶insert_time&gt;â€˜2021-03-22 18:23:42â€™ and insert_time&lt;â€˜2021-03-22 18:35:00â€™ æ¥å¯¹insert_timeè¿›è¡ŒèŒƒå›´ï¼ŒæŸ¥æ‰¾çš„ç»“æœå¯èƒ½æœ‰å¤šæ¡insert_timeå€¼ä¸åŒçš„è®°å½•ï¼Œ</p><p>ç„¶å å¯¹è¿™äº›insert_timeå€¼ä¸åŒçš„è®°å½•ç»§ç»­é€šè¿‡order_status&gt;-1æ¡ä»¶ç»§ç»­è¿‡æ»¤ã€‚</p><p>è¿™æ ·å­å¯¹äºè”åˆç´¢å¼•<code>u_idx_day_status</code>æ¥è¯´ï¼Œåªèƒ½ç”¨åˆ°insert_timeåˆ—çš„éƒ¨åˆ†ï¼Œè€Œç”¨ä¸åˆ°order_statusåˆ—çš„éƒ¨åˆ†ï¼ˆè¿™é‡Œçš„key_lenå’Œä¹‹å‰çš„SQLçš„æ˜¯ä¸€æ ·é•¿ï¼‰ï¼Œå› ä¸ºåªæœ‰insert_timeå€¼ç›¸åŒçš„æƒ…å†µä¸‹æ‰èƒ½ç”¨order_statusåˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªæŸ¥è¯¢ä¸­é€šè¿‡insert_timeè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è®°å½•ä¸­å¯èƒ½å¹¶ä¸æ˜¯æŒ‰ç…§order_statusåˆ—è¿›è¡Œæ’åºçš„ï¼Œæ‰€ä»¥åœ¨æœç´¢æ¡ä»¶ä¸­ç»§ç»­ä»¥order_statusåˆ—è¿›è¡ŒæŸ¥æ‰¾æ—¶æ˜¯ç”¨ä¸åˆ°è¿™ä¸ªB+æ ‘ç´¢å¼•çš„ã€‚</p><p><strong>æ‰€ä»¥å¯¹äºä¸€ä¸ªè”åˆç´¢å¼•æ¥è¯´ï¼Œè™½ç„¶å¯¹å¤šä¸ªåˆ—éƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾æ—¶åªèƒ½ç”¨åˆ°æœ€å·¦è¾¹é‚£ä¸ªç´¢å¼•åˆ—ï¼Œä½†æ˜¯å¦‚æœå·¦è¾¹çš„åˆ—æ˜¯ç²¾ç¡®æŸ¥æ‰¾ï¼Œåˆ™å³è¾¹çš„åˆ—å¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp_cut <span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> <span class="keyword">and</span> order_status<span class="operator">=</span><span class="number">0</span> </span><br><span class="line"><span class="keyword">and</span> expire_time<span class="operator">&gt;</span><span class="string">&#x27;2021-03-22 18:23:57&#x27;</span> <span class="keyword">and</span> expire_time<span class="operator">&lt;</span><span class="string">&#x27;2021-03-22 18:35:00&#x27;</span> ;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315220600614.png" alt="image-20230315220600614"></p><p><strong>è€Œä¸­é—´æœ‰èŒƒå›´æŸ¥è¯¢ä¼šå¯¼è‡´åé¢çš„åˆ—å…¨éƒ¨å¤±æ•ˆï¼Œæ— æ³•å……åˆ†åˆ©ç”¨è¿™ä¸ªè”åˆç´¢å¼•ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp_cut </span><br><span class="line"><span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:23:42&#x27;</span>  <span class="keyword">and</span> order_status<span class="operator">&gt;</span><span class="number">-1</span>  </span><br><span class="line"><span class="keyword">and</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:14&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315220614355.png" alt="image-20230315220614355"></p><p>â€‹</p><h2 id="5-è¦†ç›–ç´¢å¼•å°½é‡ç”¨"><strong>5.è¦†ç›–ç´¢å¼•å°½é‡ç”¨</strong></h2><p>è¦†ç›–ç´¢å¼•æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œèƒ½å¤Ÿæå¤§åœ°æé«˜æ€§èƒ½ï¼Œä¸‰æ˜Ÿç´¢å¼•é‡Œæœ€é‡è¦çš„é‚£é¢—æ˜Ÿå°±æ˜¯å®½ç´¢å¼•æ˜Ÿã€‚è€ƒè™‘ä¸€ä¸‹å¦‚æœæŸ¥è¯¢åªéœ€è¦æ‰«æç´¢å¼•è€Œæ— é¡»å›è¡¨ï¼Œä¼šå¸¦æ¥å¤šå°‘å¥½å¤„:</p><p>**ç´¢å¼•æ¡ç›®é€šå¸¸è¿œå°äºæ•°æ®è¡Œå¤§å°ï¼Œæ‰€ä»¥å¦‚æœåªéœ€è¦è¯»å–ç´¢å¼•ï¼Œé‚£ MySQLå°±ä¼šæå¤§åœ°å‡å°‘æ•°æ®è®¿é—®é‡ã€‚**è¿™å¯¹ç¼“å­˜çš„è´Ÿè½½éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å“åº”æ—¶é—´å¤§éƒ¨åˆ†èŠ±è´¹åœ¨æ•°æ®æ‹·è´ä¸Šã€‚è¦†ç›–ç´¢å¼•å¯¹äºI/Oå¯†é›†å‹çš„åº”ç”¨ä¹Ÿæœ‰å¸®åŠ©ï¼Œå› ä¸ºç´¢å¼•æ¯”æ•°æ®æ›´å°,æ›´å®¹æ˜“å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­ã€‚</p><p><strong>å› ä¸ºç´¢å¼•æ˜¯æŒ‰ç…§åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å¯¹äºI/Oå¯†é›†å‹çš„èŒƒå›´æŸ¥è¯¢ä¼šæ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œæ•°æ®çš„I/Oè¦å°‘å¾—å¤šã€‚</strong></p><p>ç”±äºInnoDBçš„èšç°‡ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•å¯¹InnoDBè¡¨ç‰¹åˆ«æœ‰ç”¨ã€‚InnoDBçš„äºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜äº†è¡Œçš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœäºŒçº§ä¸»é”®èƒ½å¤Ÿè¦†ç›–æŸ¥è¯¢ï¼Œåˆ™å¯ä»¥é¿å…å¯¹ä¸»é”®ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚</p><p><em><em>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•(åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢(ç´¢å¼•åˆ—å’ŒæŸ¥è¯¢åˆ—ä¸€è‡´))ï¼Œä¸æ˜¯å¿…è¦çš„æƒ…å†µä¸‹å‡å°‘select</em>ï¼Œé™¤éæ˜¯éœ€è¦å°†è¡¨ä¸­çš„å…¨éƒ¨åˆ—æ£€ç´¢åï¼Œè¿›è¡Œç¼“å­˜ã€‚</em>*</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp_cut </span><br><span class="line"><span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> order_status<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:04&#x27;</span> ;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315220738490.png" alt="image-20230315220738490"></p><p><strong>ä½¿ç”¨å…·ä½“åç§°å–ä»£</strong>*</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN  <span class="keyword">select</span> expire_time,order_status,expire_time <span class="keyword">from</span></span><br><span class="line">order_exp_cut <span class="keyword">where</span> insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> <span class="keyword">and</span> order_status<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span></span><br><span class="line">expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:35:04&#x27;</span> ;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315220816672.png" alt="image-20230315220816672"></p><p><strong>è§£é‡Šä¸€ä¸‹Extraä¸­çš„Using index</strong></p><p>å½“æˆ‘ä»¬çš„æŸ¥è¯¢åˆ—è¡¨ä»¥åŠæœç´¢æ¡ä»¶ä¸­åªåŒ…å«å±äºæŸä¸ªç´¢å¼•çš„åˆ—ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯ä»¥<strong>ä½¿ç”¨ç´¢å¼•è¦†ç›–çš„æƒ…å†µ</strong>ä¸‹ï¼Œåœ¨Extraåˆ—å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯ã€‚ä»¥ä¸Šçš„æŸ¥è¯¢ä¸­åªéœ€è¦ç”¨åˆ°<code>u_idx_day_status</code>è€Œä¸éœ€è¦å›è¡¨æ“ä½œï¼š</p><h2 id="6-ä¸ç­‰äºè¦æ…ç”¨"><strong>6.ä¸ç­‰äºè¦æ…ç”¨</strong></h2><p>mysql åœ¨ä½¿ç”¨ä¸ç­‰äº(<code>!= æˆ–è€…&lt;&gt;</code>)çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•<strong>ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">&lt;&gt;</span> <span class="string">&#x27;DD00_6S&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315220918205.png" alt="image-20230315220918205"></p><p><strong>è§£é‡Šä¸€ä¸‹Extraä¸­çš„Using where</strong>å½“æˆ‘ä»¬ä½¿ç”¨<strong>å…¨è¡¨æ‰«ææ¥æ‰§è¡Œå¯¹æŸä¸ªè¡¨çš„æŸ¥è¯¢</strong>ï¼Œå¹¶ä¸”è¯¥è¯­å¥çš„WHEREå­å¥ä¸­æœ‰é’ˆå¯¹è¯¥è¡¨çš„æœç´¢æ¡ä»¶æ—¶ï¼Œåœ¨Extraåˆ—ä¸­ä¼šæç¤ºä¸Šè¿°é¢å¤–ä¿¡æ¯ã€‚</p><h2 id="7-Null-Not-æœ‰å½±å“">7.Null/Not æœ‰å½±å“</h2><p>éœ€è¦æ³¨æ„null/not nullå¯¹ç´¢å¼•çš„å¯èƒ½å½±å“</p><p><strong>è¡¨order_expçš„order_noä¸ºç´¢å¼•åˆ—ï¼ŒåŒæ—¶ä¸å…è®¸ä¸ºnullï¼Œ</strong></p><p><img src="https://zdwtop.cn/blog/image-20230315221009568.png" alt="image-20230315221009568"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315221032536.png" alt="image-20230315221032536"></p><p><img src="https://zdwtop.cn/blog/image-20230315221047735.png" alt="image-20230315221047735"></p><p>å¯ä»¥çœ‹è§ï¼Œ<code>order_no is null</code>çš„æƒ…å†µä¸‹ï¼Œ<strong>MySQLç›´æ¥è¡¨ç¤ºImpossible WHERE(æŸ¥è¯¢è¯­å¥çš„WHEREå­å¥æ°¸è¿œä¸ºFALSEæ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯)ï¼Œå¯¹äº is not nullç›´æ¥èµ°çš„å…¨è¡¨æ‰«æã€‚</strong></p><p><strong>è¡¨order_exp_cutçš„order_noä¸ºç´¢å¼•åˆ—ï¼ŒåŒæ—¶å…è®¸ä¸ºnullï¼Œ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp_cut <span class="keyword">WHERE</span> order_no <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp_cut <span class="keyword">WHERE</span> order_no <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315221138170.png" alt="image-20230315221138170"></p><p><img src="https://zdwtop.cn/blog/image-20230315221838213.png" alt="image-20230315221838213"></p><p><strong>is nullä¼šèµ°refç±»å‹çš„ç´¢å¼•è®¿é—®ï¼Œis not null;ä¾ç„¶æ˜¯å…¨è¡¨æ‰«æã€‚</strong></p><p>æ‰€ä»¥æ€»ç»“èµ·æ¥ï¼š</p><p><font color="\#87CEFA"><strong>is not nullå®¹æ˜“å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œis nullåˆ™ä¼šåŒºåˆ†è¢«æ£€ç´¢çš„åˆ—æ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯nullåˆ™ä¼šèµ°refç±»å‹çš„ç´¢å¼•è®¿é—®ï¼Œå¦‚æœä¸ä¸ºnullï¼Œä¹Ÿæ˜¯å…¨è¡¨æ‰«æã€‚</strong></font></p><p><strong>ä½†æ˜¯å½“è”åˆç´¢å¼•ä¸Šä½¿ç”¨æ—¶è¦†ç›–ç´¢å¼•æ—¶ï¼Œæƒ…å†µä¼šæœ‰ä¸€äº›ä¸åŒ(order_exp_cutè¡¨çš„order_noå¯ä¸ºç©º)ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> order_status,expire_time <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line">explain <span class="keyword">SELECT</span> order_status,expire_time <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> insert_time <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315221300009.png" alt="image-20230315221300009"></p><p><img src="https://zdwtop.cn/blog/image-20230315221324650.png" alt="image-20230315221324650"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> order_status,expire_time <span class="keyword">FROM</span> order_exp_cut <span class="keyword">WHERE</span> insert_time <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line">explain <span class="keyword">SELECT</span> order_status,expire_time <span class="keyword">FROM</span> order_exp_cut <span class="keyword">WHERE</span> insert_time <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315221504553.png" alt="image-20230315221504553"></p><p><font color="\#87CEFA"><strong>æ ¹æ®system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL çš„åŸåˆ™ï¼Œçœ‹èµ·æ¥åœ¨è”åˆç´¢å¼•ä¸­ï¼Œis not nullçš„<code>order_exp_cut</code>è¡¨ç°ä¼šæ›´å¥½ï¼ˆå¦‚æœåˆ—å¯ä¸ºnullçš„è¯ï¼‰ï¼Œä½†æ˜¯key_lençš„é•¿åº¦å¢åŠ äº†1ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œåœ¨è®¾è®¡è¡¨æ—¶åˆ—å°½å¯èƒ½çš„ä¸è¦å£°æ˜ä¸ºnullã€‚</strong></font></p><p><strong>çœæµï¼šåˆ—ä¸è¦è®¾ç½®ä¸ºç©º</strong></p><h2 id="8-LikeæŸ¥è¯¢è¦å½“å¿ƒ"><strong>8.LikeæŸ¥è¯¢è¦å½“å¿ƒ</strong></h2><p>likeä»¥é€šé…ç¬¦å¼€å¤´(â€˜%abcâ€¦â€™)ï¼Œmysqlç´¢å¼•å¤±æ•ˆä¼šå˜æˆå…¨è¡¨æ‰«æçš„æ“ä½œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="keyword">like</span> <span class="string">&#x27;%_6S&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315221957524.png" alt="image-20230315221957524"></p><p>æ­¤æ—¶å¦‚æœä½¿ç”¨è¦†ç›–ç´¢å¼•å¯ä»¥æ”¹å–„è¿™ä¸ªé—®é¢˜</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> order_status,expire_time <span class="keyword">FROM</span> order_exp_cut <span class="keyword">WHERE</span> insert_time <span class="keyword">like</span> <span class="string">&#x27;%18:35:09&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315222033090.png" alt="image-20230315222033090"></p><p>â€‹</p><h2 id="9-å­—ç¬¦ç±»å‹åŠ å¼•å·"><strong>9.å­—ç¬¦ç±»å‹åŠ å¼•å·</strong></h2><p>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;6&#x27;</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315222104653.png" alt="image-20230315222104653"></p><p><img src="https://zdwtop.cn/blog/image-20230315222111152.png" alt="image-20230315222111152"></p><p><strong>MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚ä¸Šä¸ªè¯­å¥é‡Œä¼šå°è¯•å°†order_noè½¬æ¢ä¸ºæ•°å­—åå’Œ6è¿›è¡Œæ¯”è¾ƒï¼Œè‡ªç„¶é€ æˆç´¢å¼•å¤±æ•ˆã€‚</strong></p><h2 id="10-ä½¿ç”¨orå…³é”®å­—æ—¶è¦æ³¨æ„"><strong>10.ä½¿ç”¨orå…³é”®å­—æ—¶è¦æ³¨æ„</strong></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;DD00_6S&#x27;</span> <span class="keyword">OR</span> order_no <span class="operator">=</span> <span class="string">&#x27;DD00_9S&#x27;</span>;</span><br><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> expire_time<span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:09&#x27;</span>  <span class="keyword">OR</span> order_note <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315222200433.png" alt="image-20230315222200433"></p><p><strong>è¡¨ç°æ˜¯ä¸ä¸€æ ·çš„ï¼Œç¬¬ä¸€ä¸ªSQLçš„oræ˜¯ç›¸åŒåˆ—ï¼Œç›¸å½“äºäº§ç”Ÿä¸¤ä¸ªæ‰«æåŒºé—´ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šç´¢å¼•ã€‚</strong></p><p>ç¬¬äºŒä¸ªSQLä¸­oræ˜¯ä¸åŒåˆ—ï¼Œå¹¶ä¸”order_noteä¸æ˜¯ç´¢å¼•ã€‚æ‰€ä»¥åªèƒ½å…¨è¡¨æ‰«æ</p><p>å½“ç„¶å¦‚æœä¸¤ä¸ªæ¡ä»¶éƒ½æ˜¯ç´¢å¼•åˆ—ï¼Œæƒ…å†µä¼šæœ‰å˜åŒ–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp </span><br><span class="line"><span class="keyword">WHERE</span> expire_time<span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:09&#x27;</span>  <span class="keyword">OR</span> order_no <span class="operator">=</span> <span class="string">&#x27;DD00_6S&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315222303244.png" alt="image-20230315222303244"></p><p>è¿™ä¹Ÿç»™äº†æˆ‘ä»¬æç¤ºï¼Œå¦‚æœæˆ‘ä»¬å°† SQLæ”¹æˆ<strong>union all</strong></p><p><strong>Union Allï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œï¼ŒåŒ…æ‹¬é‡å¤è¡Œï¼Œä¸è¿›è¡Œæ’åºï¼›</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> expire_time<span class="operator">=</span> <span class="string">&#x27;2021-03-22 18:35:09&#x27;</span>                  </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">WHERE</span> order_note <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>å½“ç„¶ä½¿ç”¨è¦†ç›–æ‰«æä¹Ÿå¯ä»¥æ”¹å–„è¿™ä¸ªé—®é¢˜ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> order_status,id <span class="keyword">FROM</span> order_exp_cut <span class="keyword">WHERE</span> </span><br><span class="line">insert_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:34:55&#x27;</span> <span class="keyword">or</span> expire_time<span class="operator">=</span><span class="string">&#x27;2021-03-22 18:28:28&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315222423696.png" alt="image-20230315222423696"></p><h2 id="11-ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åºå’Œåˆ†ç»„"><strong>11.ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åºå’Œåˆ†ç»„</strong></h2><p>MySQLæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”Ÿæˆæœ‰åºçš„ç»“æœï¹”é€šè¿‡æ’åºæ“ä½œï¹”æˆ–è€…æŒ‰ç´¢å¼•é¡ºåºæ‰«ææ–½ï¹”</p><p>å¦‚æœEXPLAINå‡ºæ¥çš„typeåˆ—çš„å€¼ä¸ºâ€œindexâ€ï¼Œåˆ™è¯´æ˜MySQLä½¿ç”¨äº†ç´¢å¼•æ‰«ææ¥åšæ’åºã€‚</p><p>æ‰«æç´¢å¼•æœ¬èº«æ˜¯å¾ˆå¿«çš„ï¼Œå› ä¸ºåªéœ€è¦ä»ä¸€æ¡ç´¢å¼•è®°å½•ç§»åŠ¨åˆ°ç´§æ¥ç€çš„ä¸‹ä¸€æ¡è®°å½•ã€‚ä½†å¦‚æœç´¢å¼•ä¸èƒ½è¦†ç›–æŸ¥è¯¢æ‰€éœ€çš„å…¨éƒ¨åˆ—ï¼Œé‚£å°±ä¸å¾—ä¸æ¯æ‰«æä¸€æ¡ç´¢å¼•è®°å½•å°±éƒ½å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œã€‚è¿™åŸºæœ¬ä¸Šéƒ½æ˜¯éšæœºI/Oï¼Œå› æ­¤æŒ‰ç´¢å¼•é¡ºåºè¯»å–æ•°æ®çš„é€Ÿåº¦é€šå¸¸è¦æ¯”é¡ºåºåœ°å…¨è¡¨æ‰«ææ…¢ï¼Œå°¤å…¶æ˜¯åœ¨IOå¯†é›†å‹çš„å·¥ä½œè´Ÿè½½æ—¶ã€‚</p><p>MySQLå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•æ—¢æ»¡è¶³æ’åºï¼Œåˆç”¨äºæŸ¥æ‰¾è¡Œã€‚å› æ­¤ï¼Œå¦‚æœå¯èƒ½ï¼Œè®¾è®¡ç´¢å¼•æ—¶åº”è¯¥å°½å¯èƒ½åœ°åŒæ—¶æ»¡è¶³è¿™ä¸¤ç§ä»»åŠ¡ï¼Œè¿™æ ·æ˜¯æœ€å¥½çš„ã€‚</p><p>åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’ŒORDER BYå­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘ï¼ˆå€’åºæˆ–æ­£åºï¼‰éƒ½ä¸€æ ·æ—¶ï¼ŒMySQLæ‰èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œåˆ™åªæœ‰å½“0RDER BYå­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€ä¸ªè¡¨æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºã€‚</p><h2 id="12-æ’åºè¦å½“å¿ƒ"><strong>12.æ’åºè¦å½“å¿ƒ</strong></h2><p><strong>ASCå‡åºã€DESCé™åºåˆ«æ··ç”¨</strong></p><p>å¯¹äºä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºçš„åœºæ™¯ï¼Œæˆ‘ä»¬è¦æ±‚å„ä¸ªæ’åºåˆ—çš„æ’åºé¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¦ä¹ˆå„ä¸ªåˆ—éƒ½æ˜¯ASCè§„åˆ™æ’åºï¼Œè¦ä¹ˆéƒ½æ˜¯DESCè§„åˆ™æ’åºã€‚</p><p><strong>æ’åºåˆ—åŒ…å«éåŒä¸€ä¸ªç´¢å¼•çš„åˆ—ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº</strong></p><p>ç”¨æ¥æ’åºçš„å¤šä¸ªåˆ—ä¸æ˜¯ä¸€ä¸ªç´¢å¼•é‡Œçš„ï¼Œè¿™ç§æƒ…å†µä¹Ÿä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">order_no,insert_time;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315222754337.png" alt="image-20230315222754337"></p><h2 id="13-å°½å¯èƒ½æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ"><strong>13.å°½å¯èƒ½æŒ‰ä¸»é”®é¡ºåºæ’å…¥è¡Œ</strong></h2><p>æœ€å¥½é¿å…éšæœºçš„ï¼ˆä¸è¿ç»­ä¸”å€¼çš„åˆ†å¸ƒèŒƒå›´éå¸¸å¤§ï¼‰èšç°‡ç´¢å¼•ï¼Œç‰¹åˆ«æ˜¯å¯¹äºI/Oå¯†é›†å‹çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œä»æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œä½¿ç”¨UUIDæ¥ä½œä¸ºèšç°‡ç´¢å¼•åˆ™ä¼šå¾ˆç³Ÿç³•ï¼Œå®ƒä½¿å¾—èšç°‡ç´¢å¼•çš„æ’å…¥å˜å¾—å®Œå…¨éšæœºï¼Œè¿™æ˜¯æœ€åçš„æƒ…å†µï¼Œä½¿å¾—æ•°æ®æ²¡æœ‰ä»»ä½•èšé›†ç‰¹æ€§ã€‚</p><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>AUTO_INCREMENT</code>è‡ªå¢åˆ—ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ•°æ®è¡Œæ˜¯æŒ‰é¡ºåºå†™å…¥ï¼Œå¯¹äºæ ¹æ®ä¸»é”®åšå…³è”æ“ä½œçš„æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ã€‚</p><p><strong>æ³¨æ„åˆ°å‘UUIDä¸»é”®æ’å…¥è¡Œä¸ä»…èŠ±è´¹çš„æ—¶é—´æ›´é•¿ï¼Œè€Œä¸”ç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿæ›´å¤§ã€‚è¿™ä¸€æ–¹é¢æ˜¯ç”±äºä¸»é”®å­—æ®µæ›´é•¿ï¹”å¦ä¸€æ–¹é¢æ¯«æ— ç–‘é—®æ˜¯ç”±äºé¡µåˆ†è£‚å’Œç¢ç‰‡å¯¼è‡´çš„ã€‚</strong></p><p>å› ä¸ºä¸»é”®çš„å€¼æ˜¯é¡ºåºçš„ï¼Œæ‰€ä»¥InnoDBæŠŠæ¯ä¸€æ¡è®°å½•éƒ½å­˜å‚¨åœ¨ä¸Šä¸€æ¡è®°å½•çš„åé¢ã€‚å½“è¾¾åˆ°é¡µçš„æœ€å¤§å¡«å……å› å­æ—¶(InnoDBé»˜è®¤çš„æœ€å¤§å¡«å……å› å­æ˜¯é¡µå¤§å°çš„15/16ï¼Œç•™å‡ºéƒ¨åˆ†ç©ºé—´ç”¨äºä»¥åä¿®æ”¹)ï¼Œä¸‹ä¸€æ¡è®°å½•å°±ä¼šå†™å…¥æ–°çš„é¡µä¸­ã€‚ä¸€æ—¦æ•°æ®æŒ‰ç…§è¿™ç§é¡ºåºçš„æ–¹å¼åŠ è½½,ä¸»é”®é¡µå°±ä¼šè¿‘ä¼¼äºè¢«é¡ºåºçš„è®°å½•å¡«æ»¡,è¿™ä¹Ÿæ­£æ˜¯æ‰€æœŸæœ›çš„ç»“æœã€‚</p><p>å¦‚æœæ–°è¡Œçš„ä¸»é”®å€¼ä¸ä¸€å®šæ¯”ä¹‹å‰æ’å…¥çš„å¤§ï¼Œæ‰€ä»¥InnoDBæ— æ³•ç®€å•åœ°æ€»æ˜¯æŠŠæ–°è¡Œæ’å…¥åˆ°ç´¢å¼•çš„æœ€åï¼Œè€Œæ˜¯éœ€è¦ä¸ºæ–°çš„è¡Œå¯»æ‰¾åˆé€‚çš„ä½ç½®-â€”é€šå¸¸æ˜¯å·²æœ‰æ•°æ®çš„ä¸­é—´ä½ç½®â€”â€”å¹¶ä¸”åˆ†é…ç©ºé—´ã€‚è¿™ä¼šå¢åŠ å¾ˆå¤šçš„é¢å¤–å·¥ä½œï¼Œå¹¶å¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å¤Ÿä¼˜åŒ–ã€‚ä¸‹é¢æ˜¯æ€»ç»“çš„ä¸€äº›ç¼ºç‚¹:</p><p>å†™å…¥çš„ç›®æ ‡é¡µå¯èƒ½å·²ç»åˆ·åˆ°ç£ç›˜ä¸Šå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œæˆ–è€…æ˜¯è¿˜æ²¡æœ‰è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼ŒInnoDBåœ¨æ’å…¥ä¹‹å‰ä¸å¾—ä¸å…ˆæ‰¾åˆ°å¹¶ä»ç£ç›˜è¯»å–ç›®æ ‡é¡µåˆ°å†…å­˜ä¸­ã€‚è¿™å°†å¯¼è‡´å¤§é‡çš„éšæœºIOã€‚</p><p>å› ä¸ºå†™å…¥æ˜¯ä¹±åºçš„ï¼ŒInnoDBä¸å¾—ä¸é¢‘ç¹åœ°åšé¡µåˆ†è£‚æ“ä½œï¼Œä»¥ä¾¿ä¸ºæ–°çš„è¡Œåˆ†é…ç©ºé—´ã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´ç§»åŠ¨å¤§é‡æ•°æ®ï¼Œä¸€æ¬¡æ’å…¥æœ€å°‘éœ€è¦ä¿®æ”¹ä¸‰ä¸ªé¡µè€Œä¸æ˜¯ä¸€ä¸ªé¡µã€‚</p><p><strong>æ‰€ä»¥ä½¿ç”¨InnoDBæ—¶åº”è¯¥å°½å¯èƒ½åœ°æŒ‰ä¸»é”®é¡ºåºæ’å…¥æ•°æ®ï¼Œå¹¶ä¸”å°½å¯èƒ½åœ°ä½¿ç”¨å•è°ƒå¢åŠ çš„èšç°‡é”®çš„å€¼æ¥æ’å…¥æ–°è¡Œã€‚</strong></p><h2 id="14-ä¼˜åŒ–CountæŸ¥è¯¢"><strong>14.ä¼˜åŒ–CountæŸ¥è¯¢</strong></h2><p>é¦–å…ˆè¦æ³¨æ„ï¼Œ<strong>COUNT()æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°</strong>ï¼Œæœ‰ä¸¤ç§éå¸¸ä¸åŒçš„ä½œç”¨:<strong>å®ƒå¯ä»¥ç»Ÿè®¡æŸä¸ªåˆ—å€¼çš„æ•°é‡ï¼Œä¹Ÿå¯ä»¥ç»Ÿè®¡è¡Œæ•°ã€‚</strong></p><p><strong>åœ¨ç»Ÿè®¡åˆ—å€¼æ—¶è¦æ±‚åˆ—å€¼æ˜¯éç©ºçš„ï¼ˆä¸ç»Ÿè®¡NULL)ã€‚</strong></p><p><strong>COUNT()çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯ç»Ÿè®¡ç»“æœé›†çš„è¡Œæ•°ã€‚å¸¸ç”¨çš„å°±æ˜¯å°±æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨COUNT(*)ã€‚å®é™…ä¸Šï¼Œå®ƒä¼šå¿½ç•¥æ‰€æœ‰çš„åˆ—è€Œç›´æ¥ç»Ÿè®¡æ‰€æœ‰çš„è¡Œæ•°ã€‚</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> test;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(c1) <span class="keyword">from</span> test;</span><br></pre></td></tr></table></figure><img src="https://zdwtop.cn/blog/image-20230315223058262.png" alt="image-20230315223058262" style="zoom:50%;"><p>é€šå¸¸æ¥è¯´ï¼ŒCOUNT()éƒ½éœ€è¦æ‰«æå¤§é‡çš„è¡Œï¼ˆæ„å‘³ç€è¦è®¿é—®å¤§é‡æ•°æ®ï¼‰æ‰èƒ½è·å¾—ç²¾ç¡®çš„ç»“æœï¼Œå› æ­¤æ˜¯å¾ˆéš¾ä¼˜åŒ–çš„ã€‚**åœ¨MySQLå±‚é¢èƒ½åšçš„åŸºæœ¬åªæœ‰ç´¢å¼•è¦†ç›–æ‰«æäº†ã€‚**å¦‚æœè¿™è¿˜ä¸å¤Ÿ,å°±éœ€è¦è€ƒè™‘ä¿®æ”¹åº”ç”¨çš„æ¶æ„ï¼Œå¯ä»¥ç”¨ä¼°ç®—å€¼å–ä»£ç²¾ç¡®å€¼ï¼Œå¯ä»¥å¢åŠ æ±‡æ€»è¡¨ï¼Œæˆ–è€…å¢åŠ ç±»ä¼¼Redisè¿™æ ·çš„å¤–éƒ¨ç¼“å­˜ç³»ç»Ÿã€‚</p><h2 id="15-ä¼˜åŒ–limitåˆ†é¡µ"><strong>15.ä¼˜åŒ–limitåˆ†é¡µ</strong></h2><p>åœ¨ç³»ç»Ÿä¸­éœ€è¦è¿›è¡Œåˆ†é¡µæ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨LIMITåŠ ä¸Šåç§»é‡çš„åŠæ³•å®ç°ï¼ŒåŒæ—¶åŠ ä¸Šåˆé€‚çš„ORDER BYå­å¥ã€‚</p><p>ä¸€ä¸ªéå¸¸å¸¸è§åˆä»¤äººå¤´ç–¼çš„é—®é¢˜å°±æ˜¯ï¼Œåœ¨åç§»é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œä¾‹å¦‚å¯èƒ½æ˜¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp limit <span class="number">10000</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æŸ¥è¯¢ï¼Œè¿™æ—¶MySQLéœ€è¦æŸ¥è¯¢10010æ¡è®°å½•ç„¶ååªè¿”å›æœ€å10æ¡ï¼Œå‰é¢10000æ¡è®°å½•éƒ½å°†è¢«æŠ›å¼ƒï¼Œè¿™æ ·çš„ä»£ä»·éå¸¸é«˜ã€‚</p><p>ä¼˜åŒ–æ­¤ç±»åˆ†é¡µæŸ¥è¯¢çš„ä¸€ä¸ªæœ€ç®€å•çš„åŠæ³•æ˜¯</p><p>ä¼šå…ˆæŸ¥è¯¢ç¿»é¡µä¸­éœ€è¦çš„Næ¡æ•°æ®çš„ä¸»é”®å€¼ï¼Œç„¶åæ ¹æ®ä¸»é”®å€¼å›è¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„Næ¡æ•°æ®ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æŸ¥è¯¢Næ¡æ•°æ®çš„ä¸»é”®idåœ¨ç´¢å¼•ä¸­å®Œæˆï¼Œæ‰€ä»¥æ•ˆç‡ä¼šé«˜ä¸€äº›ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (<span class="keyword">select</span> id <span class="keyword">from</span> order_exp limit <span class="number">10000</span>,<span class="number">10</span>) b,order_exp a</span><br><span class="line"><span class="keyword">where</span> a.id <span class="operator">=</span> b.id;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315223241334.png" alt="image-20230315223241334"></p><p>ä»æ‰§è¡Œè®¡åˆ’ä¸­å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆæ‰§è¡Œå­æŸ¥è¯¢ä¸­çš„order_expè¡¨ï¼Œæ ¹æ®ä¸»é”®åšç´¢å¼•å…¨è¡¨æ‰«æï¼Œç„¶åä¸aè¡¨é€šè¿‡idåšä¸»é”®å…³è”æŸ¥è¯¢ï¼Œç›¸æ¯”ä¼ ç»Ÿå†™æ³•ä¸­çš„å…¨è¡¨æ‰«ææ•ˆç‡ä¼šé«˜ä¸€äº›ã€‚</p><p>ä¸Šé¢å·²ç»æ˜¯å®˜æ–¹æ¨èçš„æ–¹æ³•ï¼Œé€šè¿‡è¦†ç›–ç´¢å¼• å’Œ å­æŸ¥è¯¢ä¼˜åŒ–ï¼Œ ä¸šåŠ¡ä¸Šå¯ä»¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</p><p>ä»ä¸¤ç§å†™æ³•ä¸Šèƒ½çœ‹å‡ºæ€§èƒ½æœ‰ä¸€å®šçš„å·®è·ï¼Œè™½ç„¶å¹¶ä¸æ˜æ˜¾ï¼Œä½†æ˜¯éšç€æ•°æ®é‡çš„å¢å¤§ï¼Œä¸¤è€…æ‰§è¡Œçš„æ•ˆç‡ä¾¿ä¼šä½“ç°å‡ºæ¥ã€‚</p><p>ä¸Šé¢çš„å†™æ³•è™½ç„¶å¯ä»¥è¾¾åˆ°ä¸€å®šç¨‹åº¦çš„ä¼˜åŒ–ï¼Œä½†è¿˜æ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚æœ€ä½³çš„æ–¹å¼æ˜¯åœ¨ä¸šåŠ¡ä¸Šè¿›è¡Œé…åˆä¿®æ”¹ä¸ºä»¥ä¸‹è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">67</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315224116974.png" alt="image-20230315224116974"></p><p>é‡‡ç”¨è¿™ç§å†™æ³•ï¼Œéœ€è¦å‰ç«¯é€šè¿‡ç‚¹å‡»Moreæ¥è·å¾—æ›´å¤šæ•°æ®ï¼Œè€Œä¸æ˜¯çº¯ç²¹çš„ç¿»é¡µï¼Œå› æ­¤ï¼Œæ¯æ¬¡æŸ¥è¯¢åªéœ€è¦ä½¿ç”¨ä¸Šæ¬¡æŸ¥è¯¢å‡ºçš„æ•°æ®ä¸­çš„idæ¥è·å–æ¥ä¸‹æ¥çš„æ•°æ®å³å¯ï¼Œä½†è¿™ç§å†™æ³•éœ€è¦ä¸šåŠ¡é…åˆã€‚</p><h2 id="16-å…³äºNullçš„ç‰¹åˆ«è¯´æ˜"><strong>16.å…³äºNullçš„ç‰¹åˆ«è¯´æ˜</strong></h2><p>å¯¹äºNullåˆ°åº•ç®—ä»€ä¹ˆï¼Œå­˜åœ¨ç€åˆ†æ­§ï¼š</p><ol><li>æœ‰çš„è®¤ä¸ºNULLå€¼ä»£è¡¨ä¸€ä¸ªæœªç¡®å®šçš„å€¼ï¼ŒMySQLè®¤ä¸º<strong>ä»»ä½•å’ŒNULLå€¼åšæ¯”è¾ƒçš„è¡¨è¾¾å¼çš„å€¼éƒ½ä¸ºNULL</strong>ï¼ŒåŒ…æ‹¬<code>select null=null</code>å’Œ<code>select null!=null</code>;</li></ol><img src="https://zdwtop.cn/blog/image-20230315224233884.png" alt="image-20230315224233884" style="zoom:50%;"><ol start="2"><li><p>æœ‰çš„è®¤ä¸ºå…¶å®NULLå€¼åœ¨ä¸šåŠ¡ä¸Šå°±æ˜¯ä»£è¡¨æ²¡æœ‰ï¼Œæ‰€æœ‰çš„NULLå€¼å’Œèµ·æ¥ç®—ä¸€ä»½ï¼›</p></li><li><p>æœ‰çš„è®¤ä¸ºè¿™NULLå®Œå…¨æ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥åœ¨ç»Ÿè®¡æ•°é‡æ—¶å‹æ ¹å„¿ä¸èƒ½æŠŠå®ƒä»¬ç®—è¿›æ¥ã€‚</p></li></ol><p>å‡è®¾ä¸€ä¸ªè¡¨ä¸­æŸä¸ªåˆ—c1çš„è®°å½•ä¸º(2,1000,null,null)ï¼Œåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œè¡¨ä¸­c1çš„è®°å½•æ•°ä¸º4ï¼Œç¬¬äºŒç§è¡¨ä¸­c1çš„è®°å½•æ•°ä¸º3ï¼Œç¬¬ä¸‰ç§è¡¨ä¸­c1çš„è®°å½•æ•°ä¸º2ã€‚</p><p>åœ¨å¯¹ç»Ÿè®¡ç´¢å¼•åˆ—ä¸é‡å¤å€¼çš„æ•°é‡æ—¶å¦‚ä½•å¯¹å¾…NULLå€¼ï¼ŒMySQLä¸“é—¨æä¾›äº†ä¸€ä¸ª<code>innodb_stats_method</code>çš„ç³»ç»Ÿå˜é‡ï¼Œ</p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_stats_method">https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_stats_method</a></p><p><strong>è¿™ä¸ªç³»ç»Ÿå˜é‡æœ‰ä¸‰ä¸ªå€™é€‰å€¼ï¼š</strong></p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nulls<span class="emphasis">_equalï¼šè®¤ä¸ºæ‰€æœ‰NULLå€¼éƒ½æ˜¯ç›¸ç­‰çš„ã€‚è¿™ä¸ªå€¼ä¹Ÿæ˜¯innodb_</span>stats<span class="emphasis">_methodçš„é»˜è®¤å€¼ã€‚</span></span><br><span class="line"><span class="emphasis">å¦‚æœæŸä¸ªç´¢å¼•åˆ—ä¸­NULLå€¼ç‰¹åˆ«å¤šçš„è¯ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼ä¼šè®©ä¼˜åŒ–å™¨è®¤ä¸ºæŸä¸ªåˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤æ¬¡æ•°ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥å€¾å‘äºä¸ä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ã€‚</span></span><br><span class="line"><span class="emphasis">nulls_</span>unequalï¼šè®¤ä¸ºæ‰€æœ‰NULLå€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚</span><br><span class="line">å¦‚æœæŸä¸ªç´¢å¼•åˆ—ä¸­NULLå€¼ç‰¹åˆ«å¤šçš„è¯ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼ä¼šè®©ä¼˜åŒ–å™¨è®¤ä¸ºæŸä¸ªåˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤æ¬¡æ•°ç‰¹åˆ«å°‘ï¼Œæ‰€ä»¥å€¾å‘äºä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ã€‚</span><br><span class="line">nulls<span class="emphasis">_ignoredï¼šç›´æ¥æŠŠNULLå€¼å¿½ç•¥æ‰ã€‚</span></span><br></pre></td></tr></table></figure><p>åœ¨MySQL5.7.22ä»¥åçš„ç‰ˆæœ¬ï¼Œå¯¹è¿™ä¸ª<code>innodb_stats_method</code>çš„ä¿®æ”¹ä¸èµ·ä½œç”¨ï¼ŒMySQLæŠŠè¿™ä¸ªå€¼åœ¨ä»£ç é‡Œå†™æ­»ä¸ºnulls_equalã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´MySQLåœ¨è¿›è¡Œç´¢å¼•åˆ—çš„æ•°æ®ç»Ÿè®¡è¡Œä¸ºåˆæŠŠnullè§†ä¸ºç¬¬äºŒç§æƒ…å†µï¼ˆNULLå€¼åœ¨ä¸šåŠ¡ä¸Šå°±æ˜¯ä»£è¡¨æ²¡æœ‰ï¼Œæ‰€æœ‰çš„NULLå€¼å’Œèµ·æ¥ç®—ä¸€ä»½ï¼‰ï¼Œçœ‹èµ·æ¥ï¼ŒMySQLä¸­å¯¹Nullå€¼çš„å¤„ç†ä¹Ÿå¾ˆåˆ†è£‚ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œå¯¹äºåˆ—çš„å£°æ˜å°½å¯èƒ½çš„ä¸è¦å…è®¸ä¸ºnullã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;é«˜æ€§èƒ½çš„ç´¢å¼•ä½¿ç”¨ç­–ç•¥&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;ä»Šå¤©è¦ç”¨åˆ°çš„è¡¨&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/s</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="ç´¢å¼•" scheme="https://eizo01.github.io/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>é«˜æ€§èƒ½çš„ç´¢å¼•åˆ›å»ºç­–ç•¥</title>
    <link href="https://eizo01.github.io/posts/5ae93cc9.html"/>
    <id>https://eizo01.github.io/posts/5ae93cc9.html</id>
    <published>2022-10-05T12:00:00.000Z</published>
    <updated>2022-10-05T14:32:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1><strong>é«˜æ€§èƒ½çš„ç´¢å¼•åˆ›å»ºç­–ç•¥</strong></h1><p>æ­£ç¡®åœ°åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•æ˜¯å®ç°é«˜æ€§èƒ½æŸ¥è¯¢çš„åŸºç¡€ã€‚å‰é¢çš„æ–‡ç« æˆ‘ä»¬å·²ç»äº†è§£äº†ç´¢å¼•ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œå„ç§ç±»å‹çš„ç´¢å¼•åŠå…¶å¯¹åº”çš„ä¼˜ç¼ºç‚¹ã€‚ç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•çœŸæ­£åœ°å‘æŒ¥è¿™äº›ç´¢å¼•çš„ä¼˜åŠ¿ã€‚</p><h2 id="1â€¦ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å°"><strong>1â€¦ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å°</strong></h2><p>è¿™ä¸ªå¯ä»¥å‚è€ƒ <a href="https://javazdw.top/posts/86b66af2.html"><strong>å­—æ®µæ•°æ®ç±»å‹ä¼˜åŒ–</strong></a>è¿™ç¯‡æ–‡ç« </p><p>æˆ‘ä»¬åœ¨å®šä¹‰è¡¨ç»“æ„çš„æ—¶å€™è¦æ˜¾å¼çš„æŒ‡å®šåˆ—çš„ç±»å‹ï¼Œä»¥æ•´æ•°ç±»å‹ä¸ºä¾‹ï¼Œæœ‰TTNYINTã€NEDUMNTã€INTã€BIGTNTè¿™ä¹ˆå‡ ç§ï¼Œå®ƒä»¬å ç”¨çš„å­˜å‚¨ç©ºé—´ä¾æ¬¡é€’å¢ï¼Œæˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„ç±»å‹å¤§å°æŒ‡çš„å°±æ˜¯è¯¥ç±»å‹è¡¨ç¤ºçš„æ•°æ®èŒƒå›´çš„å¤§å°ã€‚èƒ½è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å½“ç„¶ä¹Ÿæ˜¯ä¾æ¬¡é€’å¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹æŸä¸ªæ•´æ•°åˆ—å»ºç«‹ç´¢å¼•çš„è¯ï¼Œåœ¨è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©ç´¢å¼•åˆ—ä½¿ç”¨è¾ƒå°çš„ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬èƒ½ä½¿ç”¨INTå°±ä¸è¦ä½¿ç”¨BIGINTï¼Œèƒ½ä½¿ç”¨NEDIUMINTå°±ä¸è¦ä½¿ç”¨INTï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®ç±»å‹è¶Šå°ï¼Œåœ¨æŸ¥è¯¢æ—¶è¿›è¡Œçš„æ¯”è¾ƒæ“ä½œè¶Šå¿«ï¼ˆCPUå±‚æ¬¡)æ•°æ®ç±»å‹è¶Šå°ï¼Œç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥æ”¾ä¸‹æ›´å¤šçš„è®°å½•ï¼Œä»è€Œå‡å°‘ç£ç›˜/0å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æŠŠæ›´å¤šçš„æ•°æ®é¡µç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€ŒåŠ å¿«è¯»å†™æ•ˆç‡ã€‚</p><p><font color="\#87CEFA"><strong>è¿™ä¸ªå»ºè®®å¯¹äºè¡¨çš„ä¸»é”®æ¥è¯´æ›´åŠ é€‚ç”¨ï¼Œå› ä¸ºä¸ä»…æ˜¯èšç°‡ç´¢å¼•ä¸­ä¼šå­˜å‚¨ä¸»é”®å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„äºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹å¤„éƒ½ä¼šå­˜å‚¨ä¸€ä»½è®°å½•çš„ä¸»é”®å€¼ï¼Œå¦‚æœä¸»é”®é€‚ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ„å‘³ç€èŠ‚çœæ›´å¤šçš„å­˜å‚¨ç©ºé—´å’Œæ›´é«˜æ•ˆçš„I/0ã€‚</strong></font></p><h2 id="2-ç´¢å¼•çš„é€‰æ‹©æ€§"><strong>2.ç´¢å¼•çš„é€‰æ‹©æ€§</strong></h2><p>**åˆ›å»ºç´¢å¼•åº”è¯¥é€‰æ‹©é€‰æ‹©æ€§/ç¦»æ•£æ€§é«˜çš„åˆ—ã€‚ç´¢å¼•çš„é€‰æ‹©æ€§/ç¦»æ•£æ€§æ˜¯æŒ‡ï¼Œä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆä¹Ÿç§°ä¸ºåŸºæ•°ï¼Œcardinality)å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°ï¼ˆN)çš„æ¯”å€¼ï¼ŒèŒƒå›´ä»1/Nåˆ°1ä¹‹é—´ã€‚ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå› ä¸ºé€‰æ‹©æ€§é«˜çš„ç´¢å¼•å¯ä»¥è®©MySQLåœ¨æŸ¥æ‰¾æ—¶è¿‡æ»¤æ‰æ›´å¤šçš„è¡Œã€‚**å”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1ï¼Œè¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚</p><p>å¾ˆå·®çš„ç´¢å¼•é€‰æ‹©æ€§å°±æ˜¯åˆ—ä¸­çš„æ•°æ®é‡å¤åº¦å¾ˆé«˜ï¼Œæ¯”å¦‚æ€§åˆ«å­—æ®µï¼Œä¸è€ƒè™‘æ”¿æ²»æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸¤è€…å¯èƒ½ï¼Œç”·æˆ–å¥³ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨æŸ¥è¯¢æ—¶ï¼Œå³ä½¿ä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼Œä»æ¦‚ç‡çš„è§’åº¦æ¥è¯´ï¼Œä¾ç„¶å¯èƒ½æŸ¥å‡ºä¸€åŠçš„æ•°æ®å‡ºæ¥ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230315184507246.png" alt="image-20230315184507246"></p><p>å“ªåˆ—åšä¸ºç´¢å¼•å­—æ®µæœ€å¥½ï¼Ÿå½“ç„¶æ˜¯å§“åå­—æ®µï¼Œå› ä¸ºé‡Œé¢çš„æ•°æ®æ²¡æœ‰ä»»ä½•é‡å¤ï¼Œæ€§åˆ«å­—æ®µæ˜¯æœ€ä¸é€‚åˆåšç´¢å¼•çš„ï¼Œå› ä¸ºæ•°æ®çš„é‡å¤åº¦éå¸¸é«˜ã€‚</p><p>æ€ä¹ˆç®—ç´¢å¼•çš„é€‰æ‹©æ€§/ç¦»æ•£æ€§ï¼Ÿæ¯”å¦‚personè¿™ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> name)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span><span class="operator">*</span>) <span class="keyword">FROM</span> person;<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> sex)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span><span class="operator">*</span>) <span class="keyword">FROM</span> person;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> age)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span><span class="operator">*</span>) <span class="keyword">FROM</span> person;<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span>  area)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span><span class="operator">*</span>) <span class="keyword">FROM</span> person;</span><br></pre></td></tr></table></figure><h2 id="3-å‰ç¼€ç´¢å¼•"><strong>3.å‰ç¼€ç´¢å¼•</strong></h2><p><font color="\#87CEFA">Â **é’ˆå¯¹blobã€textã€å¾ˆé•¿çš„varcharå­—æ®µï¼Œmysqlä¸æ”¯æŒç´¢å¼•ä»–ä»¬çš„å…¨éƒ¨é•¿åº¦ï¼Œéœ€å»ºç«‹å‰ç¼€ç´¢å¼•ã€‚ **</font></p><p><strong>è¯­æ³•ï¼š<code>Alter table tableName add key/index (column(X))  Â  Â  </code></strong></p><p>**ä¼˜ç‚¹ï¼š**å‰ç¼€ç´¢å¼•æ˜¯ä¸€ç§èƒ½ä½¿ç´¢å¼•æ›´å°ã€æ›´å¿«çš„æœ‰æ•ˆåŠæ³•ï¼Œä½†å¦ä¸€æ–¹é¢ä¹Ÿæœ‰å…¶ç¼ºç‚¹MySQLæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšORDER BYå’ŒGROUP BYï¼Œä¹Ÿæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšè¦†ç›–æ‰«æã€‚</p><p>**æœ‰æ—¶å€™åç¼€ç´¢å¼• (suffixindex)ä¹Ÿæœ‰ç”¨é€”ï¼ˆä¾‹å¦‚ï¼Œæ‰¾åˆ°æŸä¸ªåŸŸåçš„æ‰€æœ‰ç”µå­é‚®ä»¶åœ°å€)ã€‚**MySQLåŸç”Ÿå¹¶ä¸æ”¯æŒåå‘ç´¢å¼•ï¼Œä½†æ˜¯å¯ä»¥æŠŠå­—ç¬¦ä¸²åè½¬åå­˜å‚¨ï¼Œå¹¶åŸºäºæ­¤å»ºç«‹å‰ç¼€ç´¢å¼•ã€‚å¯ä»¥é€šè¿‡è§¦å‘å™¨æˆ–è€…åº”ç”¨ç¨‹åºè‡ªè¡Œå¤„ç†æ¥ç»´æŠ¤ç´¢å¼•ã€‚</p><p>æ¡ˆä¾‹ï¼š</p><p>è¿™é‡Œæ˜¯ä¸€å¼ ç”µå½±è®¢å•è®°å½•è¡¨</p><p><img src="https://zdwtop.cn/blog/image-20230315185543570.png" alt="image-20230315185543570"></p><p>é¦–å…ˆæ‰¾åˆ°æœ€å¸¸è§çš„å€¼çš„åˆ—è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note,<span class="number">3</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> sel3,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note,<span class="number">4</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="keyword">AS</span> sel4,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note,<span class="number">5</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> sel5,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">6</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel6,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">7</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel7,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">8</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel8,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">9</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel9,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">10</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel10,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">11</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel11,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">12</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel12,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">13</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel13,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">14</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel14,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(order_note, <span class="number">15</span>))<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> sel15,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> order_note)<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">As</span> total</span><br><span class="line"><span class="keyword">FROM</span> order_exp;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315185559295.png" alt="image-20230315185559295"></p><p>å¯ä»¥çœ‹è§ï¼Œä»ç¬¬10ä¸ªå¼€å§‹é€‰æ‹©æ€§çš„å¢åŠ å€¼å¾ˆé«˜ï¼Œéšç€å‰ç¼€å­—ç¬¦çš„è¶Šæ¥è¶Šå¤šï¼Œé€‰æ‹©åº¦ä¹Ÿåœ¨ä¸æ–­ä¸Šå‡ï¼Œä½†æ˜¯å¢é•¿åˆ°ç¬¬15æ—¶ï¼Œå·²ç»å’Œç¬¬14æ²¡å¤ªå¤§å·®åˆ«äº†ï¼Œé€‰æ‹©æ€§æå‡çš„å¹…åº¦å·²ç»å¾ˆå°äº†ï¼Œéƒ½éå¸¸æ¥è¿‘æ•´ä¸ªåˆ—çš„é€‰æ‹©æ€§äº†ã€‚</p><p><strong>é‚£ä¹ˆé’ˆå¯¹è¿™ä¸ªå­—æ®µåšå‰ç¼€ç´¢å¼•çš„è¯ï¼Œä»ç¬¬13åˆ°ç¬¬15éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©</strong></p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå·²ç»æ‰¾åˆ°äº†åˆé€‚çš„å‰ ç¼€é•¿åº¦ï¼Œå¦‚ä½•åˆ›å»ºå‰ç¼€ç´¢å¼•:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> order_exp <span class="keyword">ADD</span> KEY (order_note(<span class="number">14</span>));</span><br></pre></td></tr></table></figure><p>å»ºç«‹å‰ç¼€ç´¢å¼•åæŸ¥è¯¢è¯­å¥å¹¶ä¸éœ€è¦æ›´æ”¹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_exp <span class="keyword">where</span> order_note <span class="operator">=</span> <span class="string">&#x27;xxxx&#x27;</span> ;</span><br></pre></td></tr></table></figure><h2 id="4-åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•"><strong>4.åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•</strong></h2><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªä¸ºå‡ºç°åœ¨WHERE å­å¥ä¸­çš„åˆ—ã€è¿æ¥å­å¥ä¸­çš„è¿æ¥åˆ—åˆ›å»ºç´¢å¼•ï¼Œè€Œå‡ºç°åœ¨æŸ¥è¯¢åˆ—è¡¨ä¸­çš„åˆ—ä¸€èˆ¬å°±æ²¡å¿…è¦å»ºç«‹ç´¢å¼•äº†ï¼Œé™¤éæ˜¯éœ€è¦ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼›åˆæˆ–è€…ä¸ºå‡ºç°åœ¨ORDER BYæˆ–GROUP BYå­å¥ä¸­çš„åˆ—åˆ›å»ºç´¢å¼•ï¼Œè¿™å¥è¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ¯”å¦‚ï¼š</p><p><strong>æœç´¢</strong></p><p>åªä¸º <strong>æ¡ä»¶ä¸­çš„åˆ—</strong>å»ºç«‹ç´¢å¼•å³å¯:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> order_note <span class="keyword">from</span> <span class="keyword">where</span> .... <span class="keyword">and</span> ....</span><br></pre></td></tr></table></figure><p><strong>æ’åº</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> order_exp <span class="keyword">ORDER</span> <span class="keyword">BY</span> insert_time, order_status,expire_time;</span><br></pre></td></tr></table></figure><p><img src="https://zdwtop.cn/blog/image-20230315185937120.png" alt="image-20230315185937120"></p><p>æŸ¥è¯¢çš„ç»“æœé›†éœ€è¦å…ˆæŒ‰ç…§<code>insert_time</code>å€¼æ’åºï¼Œ**å¦‚æœè®°å½•çš„insert_timeå€¼ç›¸åŒï¼Œåˆ™éœ€è¦æŒ‰ç…§order_statusæ¥æ’åºï¼Œå¦‚æœorder_statusçš„å€¼ç›¸åŒï¼Œåˆ™éœ€è¦æŒ‰ç…§expire_timeæ’åºã€‚**å›é¡¾ä¸€ä¸‹è”åˆç´¢å¼•çš„å­˜å‚¨ç»“æ„ï¼Œ<code>u_idx_day_status</code>ç´¢å¼•æœ¬èº«å°±æ˜¯æŒ‰ç…§ä¸Šè¿°è§„åˆ™æ’å¥½åºçš„ï¼Œæ‰€ä»¥ç›´æ¥ä»ç´¢å¼•ä¸­æå–æ•°æ®ï¼Œç„¶åè¿›è¡Œå›è¡¨æ“ä½œå–å‡ºè¯¥ç´¢å¼•ä¸­ä¸åŒ…å«çš„åˆ—å°±å¥½äº†ã€‚</p><p><img src="https://zdwtop.cn/blog/image-20230315185948824.png" alt="image-20230315185948824"></p><h2 id="5-å¤šåˆ—ç´¢å¼•"><strong>5.å¤šåˆ—ç´¢å¼•</strong></h2><p>å¾ˆå¤šäººå¯¹å¤šåˆ—ç´¢å¼•çš„ç†è§£éƒ½ä¸å¤Ÿã€‚ä¸€ä¸ªå¸¸è§çš„é”™è¯¯å°±æ˜¯ï¼Œä¸ºæ¯ä¸ªåˆ—åˆ›å»ºç‹¬ç«‹çš„ç´¢å¼•ï¼Œæˆ–è€…æŒ‰ç…§é”™è¯¯çš„é¡ºåºåˆ›å»ºå¤šåˆ—ç´¢å¼•ã€‚</p><p>æˆ‘ä»¬é‡åˆ°çš„æœ€å®¹æ˜“å¼•èµ·å›°æƒ‘çš„é—®é¢˜å°±æ˜¯ç´¢å¼•åˆ—çš„é¡ºåºã€‚æ­£ç¡®çš„é¡ºåºä¾èµ–äºä½¿ç”¨è¯¥ç´¢å¼•çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”åŒæ—¶éœ€è¦è€ƒè™‘å¦‚ä½•æ›´å¥½åœ°æ»¡è¶³æ’åºå’Œåˆ†ç»„çš„éœ€è¦ã€‚</p><p><strong>åå¤å¼ºè°ƒè¿‡ï¼Œåœ¨ä¸€ä¸ªå¤šåˆ—B-Treeç´¢å¼•ä¸­ï¼Œç´¢å¼•åˆ—çš„é¡ºåºæ„å‘³ç€ç´¢å¼•é¦–å…ˆæŒ‰ç…§æœ€å·¦åˆ—è¿›è¡Œæ’åºï¼Œå…¶æ¬¡æ˜¯ç¬¬äºŒåˆ—ï¼Œç­‰ç­‰ã€‚æ‰€ä»¥ï¼Œç´¢å¼•å¯ä»¥æŒ‰ç…§å‡åºæˆ–è€…é™åºè¿›è¡Œæ‰«æï¼Œä»¥æ»¡è¶³ç²¾ç¡®ç¬¦åˆåˆ—é¡ºåºçš„ORDER BYã€GROUP BYå’ŒDISTINCTç­‰å­å¥çš„æŸ¥è¯¢éœ€æ±‚ã€‚</strong></p><p>æ‰€ä»¥å¤šåˆ—ç´¢å¼•çš„åˆ—é¡ºåºè‡³å…³é‡è¦ã€‚å¯¹äºå¦‚ä½•é€‰æ‹©ç´¢å¼•çš„åˆ—é¡ºåºæœ‰ä¸€ä¸ªç»éªŒæ³•åˆ™ï¼š<font color="\#87CEFA"> <strong>å°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åˆ°ç´¢å¼•æœ€å‰åˆ—ã€‚å½“ä¸éœ€è¦è€ƒè™‘æ’åºå’Œåˆ†ç»„æ—¶ï¼Œå°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åœ¨å‰é¢é€šå¸¸æ˜¯å¾ˆå¥½çš„ã€‚</strong></font>è¿™æ—¶å€™ç´¢å¼•çš„ä½œç”¨åªæ˜¯ç”¨äºä¼˜åŒ–WHEREæ¡ä»¶çš„æŸ¥æ‰¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ ·è®¾è®¡çš„ç´¢å¼•ç¡®å®èƒ½å¤Ÿæœ€å¿«åœ°è¿‡æ»¤å‡ºéœ€è¦çš„è¡Œï¼Œå¯¹äºåœ¨WHEREå­å¥ä¸­åªä½¿ç”¨äº†ç´¢å¼•éƒ¨åˆ†å‰ç¼€åˆ—çš„æŸ¥è¯¢æ¥è¯´é€‰æ‹©æ€§ä¹Ÿæ›´é«˜ã€‚</p><p>ç„¶è€Œï¼Œæ€§èƒ½ä¸åªæ˜¯ä¾èµ–äºç´¢å¼•åˆ—çš„é€‰æ‹©æ€§ï¼Œä¹Ÿå’ŒæŸ¥è¯¢æ¡ä»¶çš„æœ‰å…³ã€‚å¯èƒ½éœ€è¦æ ¹æ®é‚£äº›è¿è¡Œé¢‘ç‡æœ€é«˜çš„æŸ¥è¯¢æ¥è°ƒæ•´ç´¢å¼•åˆ—çš„é¡ºåºï¼Œæ¯”å¦‚æ’åºå’Œåˆ†ç»„ï¼Œè®©è¿™ç§æƒ…å†µä¸‹ç´¢å¼•çš„é€‰æ‹©æ€§æœ€é«˜ã€‚</p><p>åŒæ—¶ï¼Œåœ¨ä¼˜åŒ–æ€§èƒ½çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ç›¸åŒçš„åˆ—ä½†é¡ºåºä¸åŒçš„ç´¢å¼•æ¥æ»¡è¶³ä¸åŒç±»å‹çš„æŸ¥è¯¢éœ€æ±‚ã€‚</p><h2 id="6-ä¸‰æ˜Ÿç´¢å¼•"><strong>6.ä¸‰æ˜Ÿç´¢å¼•</strong></h2><p><strong>ä¸‰æ˜Ÿç´¢å¼•æ¦‚å¿µ</strong></p><p>å¯¹äºä¸€ä¸ªæŸ¥è¯¢è€Œè¨€ï¼Œä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ï¼Œå¯èƒ½æ˜¯å…¶æœ€å¥½çš„ç´¢å¼•ã€‚</p><p>æ»¡è¶³çš„æ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li><p>ç´¢å¼•å°†ç›¸å…³çš„è®°å½•æ”¾åˆ°ä¸€èµ·åˆ™è·å¾—ä¸€æ˜Ÿ    ï¼ˆæ¯”é‡27%ï¼‰</p></li><li><p>å¦‚æœç´¢å¼•ä¸­çš„æ•°æ®é¡ºåºå’ŒæŸ¥æ‰¾ä¸­çš„æ’åˆ—é¡ºåºä¸€è‡´åˆ™è·å¾—äºŒæ˜Ÿï¼ˆæ’åºæ˜Ÿï¼‰ ï¼ˆæ¯”é‡27%ï¼‰</p></li><li><p>å¦‚æœç´¢å¼•ä¸­çš„åˆ—åŒ…å«äº†æŸ¥è¯¢ä¸­éœ€è¦çš„å…¨éƒ¨åˆ—åˆ™è·å¾—ä¸‰æ˜Ÿï¼ˆå®½ç´¢å¼•æ˜Ÿï¼‰ ï¼ˆæ¯”é‡50%ï¼‰</p></li></ul><p>è¿™ä¸‰é¢—æ˜Ÿï¼Œå“ªé¢—æœ€é‡è¦ï¼Ÿç¬¬ä¸‰é¢—æ˜Ÿã€‚å› ä¸ºå°†ä¸€ä¸ªåˆ—æ’é™¤åœ¨ç´¢å¼•ä¹‹å¤–å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šç£ç›˜éšæœºè¯»ï¼ˆå›è¡¨æ“ä½œï¼‰ã€‚ç¬¬ä¸€å’Œç¬¬äºŒé¢—æ˜Ÿé‡è¦æ€§å·®ä¸å¤šï¼Œå¯ä»¥ç†è§£ä¸ºç¬¬ä¸‰é¢—æ˜Ÿæ¯”é‡æ˜¯50%ï¼Œç¬¬ä¸€é¢—æ˜Ÿä¸º27%ï¼Œç¬¬äºŒé¢—æ˜Ÿä¸º23%ï¼Œæ‰€ä»¥åœ¨å¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹ï¼Œä¼šå…ˆè€ƒè™‘ç¬¬ä¸€é¢—æ˜Ÿï¼Œä½†ä¼šæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´è¿™ä¸¤é¢—æ˜Ÿçš„ä¼˜å…ˆåº¦ã€‚</p><p><strong>ä¸€æ˜Ÿï¼š</strong></p><p>ä¸€æ˜Ÿçš„æ„æ€å°±æ˜¯ï¼šå¦‚æœä¸€ä¸ªæŸ¥è¯¢ç›¸å…³çš„ç´¢å¼•è¡Œæ˜¯ç›¸é‚»çš„æˆ–è€…è‡³å°‘ç›¸è·è¶³å¤Ÿé è¿‘çš„è¯ï¼Œå¿…é¡»æ‰«æçš„ç´¢å¼•ç‰‡å®½åº¦å°±ä¼šç¼©è‡³æœ€çŸ­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®©ç´¢å¼•ç‰‡å°½é‡å˜çª„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç´¢å¼•çš„æ‰«æèŒƒå›´è¶Šå°è¶Šå¥½ã€‚</p><p><strong>äºŒæ˜Ÿï¼ˆæ’åºæ˜Ÿï¼‰</strong> ï¼š</p><p>åœ¨æ»¡è¶³ä¸€æ˜Ÿçš„æƒ…å†µä¸‹ï¼Œå½“æŸ¥è¯¢éœ€è¦æ’åºï¼Œgroup byã€ order byï¼Œå¦‚æœæŸ¥è¯¢æ‰€éœ€çš„é¡ºåºä¸ç´¢å¼•æ˜¯ä¸€è‡´çš„ï¼ˆç´¢å¼•æœ¬èº«æ˜¯æœ‰åºçš„ï¼‰ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨å†å¦å¤–æ’åºäº†ï¼Œä¸€èˆ¬æ¥è¯´æ’åºå¯æ˜¯å½±å“æ€§èƒ½çš„å…³é”®å› ç´ ã€‚</p><p><strong>ä¸‰æ˜Ÿï¼ˆå®½ç´¢å¼•æ˜Ÿï¼‰</strong> ï¼š</p><p>åœ¨æ»¡è¶³äº†äºŒæ˜Ÿçš„æƒ…å†µä¸‹ï¼Œå¦‚æœç´¢å¼•ä¸­æ‰€åŒ…å«äº†è¿™ä¸ªæŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—ï¼ˆåŒ…æ‹¬ where å­å¥å’Œ select å­å¥ä¸­æ‰€éœ€çš„åˆ—ï¼Œä¹Ÿå°±æ˜¯è¦†ç›–ç´¢å¼•ï¼‰ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒæŸ¥è¯¢å°±ä¸å†éœ€è¦å›è¡¨äº†ï¼Œå‡å°‘äº†æŸ¥è¯¢çš„æ­¥éª¤å’ŒIOè¯·æ±‚æ¬¡æ•°ï¼Œæ€§èƒ½å‡ ä¹å¯ä»¥æå‡ä¸€å€ã€‚</p><h2 id="7-è®¾è®¡ä¸‰æ˜Ÿç´¢å¼•å®æˆ˜"><strong>7.è®¾è®¡ä¸‰æ˜Ÿç´¢å¼•å®æˆ˜</strong></h2><p><strong>ç°åœ¨æœ‰è¡¨ï¼ŒSQLå¦‚ä¸‹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (</span><br><span class="line">    cno <span class="type">INT</span>,</span><br><span class="line">    lname <span class="type">VARCHAR</span> (<span class="number">10</span>),</span><br><span class="line">    fname <span class="type">VARCHAR</span> (<span class="number">10</span>),</span><br><span class="line">    sex <span class="type">INT</span>,</span><br><span class="line">    weight <span class="type">INT</span>,</span><br><span class="line">    city <span class="type">VARCHAR</span> (<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cust <span class="keyword">ON</span> customer (city, lname, fname, cno);</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸‹é¢çš„SQLè€Œè¨€ï¼Œè¿™æ˜¯ä¸ªä¸‰æ˜Ÿç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span> cno,fname <span class="keyword">from</span> customer <span class="keyword">where</span> lname<span class="operator">=</span>â€™xxâ€™ <span class="keyword">and</span> city <span class="operator">=</span>â€™yyâ€™ <span class="keyword">order</span> <span class="keyword">by</span> fname;</span><br></pre></td></tr></table></figure><p>æ¥è¯„ä¼°ä¸‹ï¼š</p><p><strong>ç¬¬ä¸€é¢—æ˜Ÿï¼šæ‰€æœ‰ç­‰å€¼è°“è¯çš„åˆ—ï¼Œæ˜¯ç»„åˆç´¢å¼•çš„å¼€å¤´çš„åˆ—ï¼Œå¯ä»¥æŠŠç´¢å¼•ç‰‡ç¼©å¾—å¾ˆçª„ï¼Œç¬¦åˆã€‚</strong></p><p>æ ¹æ®ä¹‹å‰è®²è¿‡çš„è”åˆç´¢å¼•ï¼Œæˆ‘ä»¬æ˜¯çŸ¥é“æ¡ä»¶å·²ç»æŠŠæœç´¢èŒƒå›´æœåˆ°å¾ˆçª„äº†ï¼Œä¾‹å¦‚å›¾ä¸­</p><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315190526119.png" alt="image-20230315190526119" style="zoom:50%;"></p><p><strong>ç¬¬äºŒé¢—æ˜Ÿï¼šorder byçš„fnameå­—æ®µåœ¨ç»„åˆç´¢å¼•ä¸­ä¸”æ˜¯ç´¢å¼•è‡ªåŠ¨æ’åºå¥½çš„ï¼Œç¬¦åˆã€‚</strong></p><p><strong>ç¬¬ä¸‰é¢—æ˜Ÿï¼šselectä¸­çš„cnoå­—æ®µã€fnameå­—æ®µåœ¨ç»„åˆç´¢å¼•ä¸­å­˜åœ¨ï¼Œç¬¦åˆã€‚</strong></p><p><strong>ç°åœ¨æœ‰è¡¨ï¼ŒSQLå¦‚ä¸‹ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test` (</span><br><span class="line">    `id` <span class="type">INT</span> (<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `user_name` <span class="type">VARCHAR</span> (<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `sex` <span class="type">INT</span> (<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `age` <span class="type">INT</span> (<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `c_date` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">) ENGINE <span class="operator">=</span> INNODB AUTO_INCREMENT <span class="operator">=</span> <span class="number">12</span> <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_sex_age <span class="keyword">ON</span> test (user_name,sex,age);</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœæˆ‘ä»¬å»ºç«‹ç´¢å¼•(user_name,sex,age)ï¼š</strong></p><p>SQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_name,sex,age <span class="keyword">from</span> test </span><br><span class="line"><span class="keyword">where</span> user_name <span class="keyword">like</span> <span class="string">&#x27;é©¬%&#x27;</span>  </span><br><span class="line"><span class="keyword">and</span> sex <span class="operator">=</span><span class="number">1</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> age</span><br></pre></td></tr></table></figure><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315191003735.png" alt="image-20230315191003735" style="zoom: 67%;"></p><img src="https://zdwtop.cn/blog/image-20230315191012650.png" alt="image-20230315191012650" style="zoom: 67%;"><p>ç¬¬ä¸‰é¢—æ˜Ÿï¼Œæ»¡è¶³</p><p>ç¬¬ä¸€é¢—æ˜Ÿï¼Œæ»¡è¶³</p><p>ç¬¬äºŒé¢—æ˜Ÿï¼Œä¸æ»¡è¶³ï¼Œuser_name é‡‡ç”¨äº†èŒƒå›´åŒ¹é…ï¼Œsex æ˜¯è¿‡æ»¤åˆ—ï¼Œæ­¤æ—¶age åˆ—æ— æ³•ä¿è¯æœ‰åºçš„ã€‚</p><p>ä¸Šè¿°æˆ‘ä»¬çœ‹åˆ°ï¼Œæ­¤æ—¶ç´¢å¼•(user_name,sex,age)å¹¶ä¸èƒ½æ»¡è¶³ä¸‰æ˜Ÿç´¢å¼•ä¸­çš„ç¬¬äºŒé¢—æ˜Ÿï¼ˆæ’åºï¼‰ã€‚</p><p><strong>äºæ˜¯æˆ‘ä»¬æ”¹æ”¹ï¼Œå»ºç«‹ç´¢å¼•(sex, ageï¼Œuser_name)ï¼š</strong></p><p>â€‹    <img src="https://zdwtop.cn/blog/image-20230315191445143.png" alt="image-20230315191445143" style="zoom:67%;"></p><p>ç¬¬ä¸€é¢—æ˜Ÿï¼Œä¸æ»¡è¶³ï¼Œåªå¯ä»¥åŒ¹é…åˆ°sexï¼Œsexé€‰æ‹©æ€§å¾ˆå·®ï¼Œæ„å‘³ç€æ˜¯ä¸€ä¸ªå®½ç´¢å¼•ç‰‡(åŒæ—¶å› ä¸ºageä¹Ÿä¼šå¯¼è‡´æ’åºé€‰æ‹©çš„ç¢ç‰‡é—®é¢˜)</p><p>ç¬¬äºŒé¢—æ˜Ÿï¼Œæ»¡è¶³ï¼Œç­‰å€¼sex çš„æƒ…å†µä¸‹ï¼Œageæ˜¯æœ‰åºçš„ï¼Œ</p><p>ç¬¬ä¸‰é¢—æ˜Ÿï¼Œæ»¡è¶³ï¼ŒselectæŸ¥è¯¢çš„åˆ—éƒ½åœ¨ç´¢å¼•åˆ—ä¸­ï¼Œ</p><p>å¯¹äºç´¢å¼•(sex,ageï¼Œuser_name)æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶æ— æ³•æ»¡è¶³ç¬¬ä¸€é¢—æ˜Ÿï¼Œçª„ç´¢å¼•ç‰‡çš„éœ€æ±‚ã€‚</p><p>ä»¥ä¸Š2ä¸ªç´¢å¼•ï¼Œéƒ½æ˜¯æ— æ³•åŒæ—¶æ»¡è¶³ä¸‰æ˜Ÿç´¢å¼•è®¾è®¡ä¸­çš„ä¸‰ä¸ªéœ€æ±‚çš„ï¼Œæˆ‘ä»¬åªèƒ½å°½åŠ›æ»¡è¶³2ä¸ªã€‚è€Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæ»¡è¶³2é¢—æ˜Ÿï¼Œå·²ç»èƒ½ç¼©å°å¾ˆå¤§çš„æŸ¥è¯¢èŒƒå›´äº†ï¼Œå…·ä½“æœ€ç»ˆè¦ä¿ç•™é‚£ä¸€é¢—æ˜Ÿï¼ˆæ’åºæ˜Ÿ or çª„ç´¢å¼•ç‰‡æ˜Ÿï¼‰ï¼Œè¿™ä¸ªå°±éœ€è¦çœ‹æŸ¥è¯¢è€…è‡ªå·±çš„ç€é‡ç‚¹äº†ï¼Œæ— æ³•ç»™å‡ºæ ‡å‡†ç­”æ¡ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;strong&gt;é«˜æ€§èƒ½çš„ç´¢å¼•åˆ›å»ºç­–ç•¥&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;æ­£ç¡®åœ°åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•æ˜¯å®ç°é«˜æ€§èƒ½æŸ¥è¯¢çš„åŸºç¡€ã€‚å‰é¢çš„æ–‡ç« æˆ‘ä»¬å·²ç»äº†è§£äº†ç´¢å¼•ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œå„ç§ç±»å‹çš„ç´¢å¼•åŠå…¶å¯¹åº”çš„ä¼˜ç¼ºç‚¹ã€‚ç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•çœŸæ­£åœ°å‘æŒ¥è¿™äº›ç´¢å¼•çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h2 id=&quot;1â€¦ç´¢</summary>
      
    
    
    
    <category term="MySQL" scheme="https://eizo01.github.io/categories/MySQL/"/>
    
    
    <category term="ç´¢å¼•" scheme="https://eizo01.github.io/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
</feed>
